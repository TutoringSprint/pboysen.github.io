!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";function elt(tag,attrs){var result=document.createElement(tag);if(attrs)for(var _name in attrs)"style"==_name?result.style.cssText=attrs[_name]:null!=attrs[_name]&&result.setAttribute(_name,attrs[_name]);for(var _len=arguments.length,args=Array(_len>2?_len-2:0),_key=2;_len>_key;_key++)args[_key-2]=arguments[_key];for(var i=0;i<args.length;i++)add(args[i],result);return result}function add(value,target){if("string"==typeof value&&(value=document.createTextNode(value)),Array.isArray(value))for(var i=0;i<value.length;i++)add(value[i],target);else target.appendChild(value)}function requestAnimationFrame(f){reqFrame?reqFrame(f):setTimeout(f,10)}function classTest(cls){return new RegExp("(^|\\s)"+cls+"(?:$|\\s)\\s*")}function rmClass(node,cls){var current=node.className,match=classTest(cls).exec(current);if(match){var after=current.slice(match.index+match[0].length);node.className=current.slice(0,match.index)+(after?match[1]+after:"")}}function addClass(node,cls){var current=node.className;classTest(cls).test(current)||(node.className+=(current?" ":"")+cls)}function contains(parent,child){return 1!=child.nodeType&&(child=child.parentNode),child&&parent.contains(child)}function insertCSS(css){cssNode?cssNode.textContent+=css:accumulatedCSS+=css}function ensureCSSAdded(){cssNode||(cssNode=document.createElement("style"),cssNode.textContent="/* ProseMirror CSS */\n"+accumulatedCSS,document.head.insertBefore(cssNode,document.head.firstChild))}Object.defineProperty(exports,"__esModule",{value:!0}),exports.elt=elt,exports.requestAnimationFrame=requestAnimationFrame,exports.rmClass=rmClass,exports.addClass=addClass,exports.contains=contains,exports.insertCSS=insertCSS,exports.ensureCSSAdded=ensureCSSAdded;var reqFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,ie_upto10=/MSIE \d/.test(navigator.userAgent),ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),browser={mac:/Mac/.test(navigator.platform),ie_upto10:ie_upto10,ie_11up:ie_11up,ie:ie_upto10||ie_11up,gecko:/gecko\/\d/i.test(navigator.userAgent)};exports.browser=browser;var accumulatedCSS="",cssNode=null},{}],2:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function nothing(){}function ensureSelection(pm){if(pm.selection.node){var found=(0,_selection.findSelectionNear)(pm.doc,pm.selection.from,1,!0);found&&(0,_selection.setDOMSelectionToPos)(pm,found.head)}return!1}Object.defineProperty(exports,"__esModule",{value:!0});var _browserkeymap=require("browserkeymap"),_browserkeymap2=_interopRequireDefault(_browserkeymap),_selection=require("./selection"),_dom=require("../dom"),keys={Esc:nothing,Enter:nothing,"Mod-Enter":nothing,"Shift-Enter":nothing,Backspace:nothing,Delete:nothing,"Mod-B":nothing,"Mod-I":nothing,"Mod-Backspace":nothing,"Mod-Delete":nothing,"Shift-Backspace":nothing,"Shift-Delete":nothing,"Shift-Mod-Backspace":nothing,"Shift-Mod-Delete":nothing,"Mod-Z":nothing,"Mod-Y":nothing,"Shift-Mod-Z":nothing,"Ctrl-D":nothing,"Ctrl-H":nothing,"Ctrl-Alt-Backspace":nothing,"Alt-D":nothing,"Alt-Delete":nothing,"Alt-Backspace":nothing,"Mod-A":ensureSelection};["Left","Right","Up","Down","Home","End","PageUp","PageDown"].forEach(function(key){keys[key]=keys["Shift-"+key]=keys["Mod-"+key]=keys["Shift-Mod-"+key]=keys["Alt-"+key]=keys["Shift-Alt-"+key]=ensureSelection}),["Left","Mod-Left","Right","Mod-Right","Up","Down"].forEach(function(key){return delete keys[key]}),_dom.browser.mac&&(keys["Ctrl-F"]=keys["Ctrl-B"]=keys["Ctrl-P"]=keys["Ctrl-N"]=keys["Alt-F"]=keys["Alt-B"]=keys["Ctrl-A"]=keys["Ctrl-E"]=keys["Ctrl-V"]=keys.goPageUp=ensureSelection);var captureKeys=new _browserkeymap2["default"](keys);exports.captureKeys=captureKeys},{"../dom":1,"./selection":14,browserkeymap:52}],3:[function(require,module,exports){"use strict";function isWordChar(ch){return/\w/.test(ch)||isExtendingChar(ch)||ch>""&&(ch.toUpperCase()!=ch.toLowerCase()||nonASCIISingleCaseWordChar.test(ch))}function charCategory(ch){return/\s/.test(ch)?"space":isWordChar(ch)?"word":"other"}function isExtendingChar(ch){return ch.charCodeAt(0)>=768&&extendingChar.test(ch)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isWordChar=isWordChar,exports.charCategory=charCategory,exports.isExtendingChar=isExtendingChar;var nonASCIISingleCaseWordChar=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,extendingChar=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/},{}],4:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function defineCommand(spec){commands[spec.name]&&_utilError.NamespaceError.raise("Duplicate definition of command "+spec.name),commands[spec.name]=spec}function defineParamHandler(name,handler){paramHandlers[name]=handler}function getParamHandler(pm){var option=pm.options.commandParamHandler;return option&&paramHandlers[option]?paramHandlers[option]:void 0}function deriveCommands(pm){function add(name,spec,self){pm.isIncluded(name)&&(found[name]&&_utilError.NamespaceError.raise("Duplicate definition of command "+name),found[name]=new Command(spec,self,name))}function addAndOverride(name,spec,self){if(Object.prototype.hasOwnProperty.call(config,name)){var confSpec=config[name];if(!confSpec)return;if(confSpec.run)return;var newSpec=Object.create(null);for(var prop in spec)newSpec[prop]=spec[prop];for(var prop in confSpec)newSpec[prop]=confSpec[prop];spec=newSpec}add(name,spec,self)}var found=Object.create(null),config=pm.options.commands;pm.schema.registry("command",function(spec,type,name){if(spec.derive){var conf="object"==typeof spec.derive?spec.derive:{},dname=conf.name||spec.name,derive=type.constructor.deriveableCommands[dname];derive||_utilError.AssertionError.raise("Don't know how to derive command "+dname);var derived=derive.call(type,conf);for(var prop in spec)"derive"!=prop&&(derived[prop]=spec[prop]);spec=derived}addAndOverride("schema:"+name+":"+spec.name,spec,type)});for(var _name in commands)addAndOverride(_name,commands[_name]);for(var _name2 in config){var spec=config[_name2];spec&&spec.run&&add(_name2,spec)}return found}function deriveKeymap(pm){function add(command,keys){for(var i=0;i<keys.length;i++){var _d$$exec=/^(.+?)(?:\((\d+)\))?$/.exec(keys[i]),_d$$exec2=_slicedToArray(_d$$exec,3),_name3=(_d$$exec2[0],_d$$exec2[1]),_d$$exec2$2=_d$$exec2[2],rank=void 0===_d$$exec2$2?50:_d$$exec2$2;(0,_utilSortedinsert2["default"])(bindings[_name3]||(bindings[_name3]=[]),{command:command,rank:rank},function(a,b){return a.rank-b.rank})}}var bindings={},platform=_dom.browser.mac?"mac":"pc";for(var _name4 in pm.commands){var cmd=pm.commands[_name4],keys=cmd.spec.keys;keys&&(Array.isArray(keys)&&add(cmd,keys),keys.all&&add(cmd,keys.all),keys[platform]&&add(cmd,keys[platform]))}for(var key in bindings)bindings[key]=bindings[key].map(function(b){return b.command.name});return new _browserkeymap2["default"](bindings)}function markActive(pm,type){var sel=pm.selection;return sel.empty?type.isInSet(pm.activeMarks()):pm.doc.rangeHasMark(sel.from,sel.to,type)}function canAddInline(pm,type){var _pm$selection=pm.selection,from=_pm$selection.from,to=_pm$selection.to,empty=_pm$selection.empty;if(empty)return!type.isInSet(pm.activeMarks())&&pm.doc.path(from.path).type.canContainMark(type);var can=!1;return pm.doc.nodesBetween(from,to,function(node){return can||node.isTextblock&&!node.type.canContainMark(type)?!1:void(node.isInline&&!type.isInSet(node.marks)&&(can=!0))}),can}function markApplies(pm,type){var _pm$selection2=pm.selection,from=_pm$selection2.from,to=_pm$selection2.to,relevant=!1;return pm.doc.nodesBetween(from,to,function(node){return node.isTextblock?(node.type.canContainMark(type)&&(relevant=!0),!1):void 0}),relevant}function selectedNodeAttr(pm,type,name){var node=pm.selection.node;return node&&node.type==type?node.attrs[name]:void 0}function moveBackward(parent,offset,by){"char"!=by&&"word"!=by&&_utilError.AssertionError.raise("Unknown motion unit: "+by);for(var cat=null,counted=0;;){if(0==offset)return offset;var _parent$chunkBefore=parent.chunkBefore(offset),start=_parent$chunkBefore.start,node=_parent$chunkBefore.node;if(!node.isText)return cat?offset:offset-1;if("char"==by)for(var i=offset-start;i>0;i--){if(!(0,_char.isExtendingChar)(node.text.charAt(i-1)))return offset-1;offset--}else if("word"==by)for(var i=offset-start;i>0;i--){var nextCharCat=(0,_char.charCategory)(node.text.charAt(i-1));if(null==cat||1==counted&&"space"==cat)cat=nextCharCat;else if(cat!=nextCharCat)return offset;offset--,counted++}}}function deleteBarrier(pm,cut){var around=pm.doc.path(cut.path),before=around.child(cut.offset-1),after=around.child(cut.offset);if(!before.type.canContainContent(after.type)||pm.tr.join(cut).apply(andScroll)===!1){var conn=void 0;if(after.isTextblock&&(conn=before.type.findConnection(after.type))){var tr=pm.tr,end=cut.move(1);if(tr.step("ancestor",cut,end,null,{types:[before.type].concat(_toConsumableArray(conn)),attrs:[before.attrs].concat(_toConsumableArray(conn.map(function(){return null})))}),tr.join(end),tr.join(cut),tr.apply(andScroll)!==!1)return}var selAfter=(0,_selection.findSelectionFrom)(pm.doc,cut,1);return pm.tr.lift(selAfter.from,selAfter.to).apply(andScroll)}}function moveForward(parent,offset,by){"char"!=by&&"word"!=by&&_utilError.AssertionError.raise("Unknown motion unit: "+by);for(var cat=null,counted=0;;){if(offset==parent.size)return offset;var _parent$chunkAfter=parent.chunkAfter(offset),start=_parent$chunkAfter.start,node=_parent$chunkAfter.node;if(!node.isText)return cat?offset:offset+1;if("char"==by)for(var i=offset-start;i<node.text.length;i++){if(!(0,_char.isExtendingChar)(node.text.charAt(i+1)))return offset+1;offset++}else if("word"==by)for(var i=offset-start;i<node.text.length;i++){var nextCharCat=(0,_char.charCategory)(node.text.charAt(i));if(null==cat||1==counted&&"space"==cat)cat=nextCharCat;else if(cat!=nextCharCat)return offset;offset++,counted++}}}function joinPointAbove(pm){var _pm$selection9=pm.selection,node=_pm$selection9.node,from=_pm$selection9.from;return node?(0,_transform.joinableBlocks)(pm.doc,from)?from:null:(0,_transform.joinPoint)(pm.doc,from,-1)}function joinPointBelow(pm){var _pm$selection10=pm.selection,node=_pm$selection10.node,to=_pm$selection10.to;return node?(0,_transform.joinableBlocks)(pm.doc,to)?to:null:(0,_transform.joinPoint)(pm.doc,to,1)}function isAtTopOfListItem(doc,from,to,listType){return _model.Pos.samePath(from.path,to.path)&&from.path.length>=2&&0==from.path[from.path.length-1]&&listType.canContain(doc.path(from.path.slice(0,from.path.length-1)))}function alreadyHasBlockType(doc,from,to,type,attrs){var found=!1;return attrs||(attrs={}),doc.nodesBetween(from,to||from,function(node){return node.isTextblock?(node.hasMarkup(type,attrs)&&(found=!0),!1):void 0}),found}function listTextblockTypes(pm){var cached=pm.schema.cached.textblockTypes;if(cached)return cached;var found=[];for(var _name5 in pm.schema.nodes){var type=pm.schema.nodes[_name5];if(type.textblockTypes)for(var i=0;i<type.textblockTypes.length;i++){var info=type.textblockTypes[i];(0,_utilSortedinsert2["default"])(found,{label:info.label,value:{type:type,attrs:info.attrs},rank:info.rank},function(a,b){return a.rank-b.rank})}}return pm.schema.cached.textblockTypes=found}function currentTextblockType(pm){var _pm$selection24=pm.selection,from=_pm$selection24.from,to=_pm$selection24.to,node=_pm$selection24.node;if(!node||node.isInline){if(!_model.Pos.samePath(from.path,to.path))return null;node=pm.doc.path(from.path)}else if(!node.isTextblock)return null;for(var types=listTextblockTypes(pm),i=0;i<types.length;i++){var tp=types[i],val=tp.value;if(node.hasMarkup(val.type,val.attrs))return tp.value}}function nodeAboveSelection(pm){var sel=pm.selection,i=0;if(sel.node)return!!sel.from.depth&&sel.from.shorten();for(;i<sel.head.depth&&i<sel.anchor.depth&&sel.head.path[i]==sel.anchor.path[i];i++);return 0==i?!1:sel.head.shorten(i-1)}function moveSelectionBlock(pm,dir){var _pm$selection25=pm.selection,from=_pm$selection25.from,to=_pm$selection25.to,node=_pm$selection25.node,side=dir>0?to:from;return(0,_selection.findSelectionFrom)(pm.doc,node&&node.isBlock?side:side.shorten(null,dir>0?1:0),dir)}function selectNodeHorizontally(pm,dir){var _pm$selection26=pm.selection,empty=_pm$selection26.empty,node=_pm$selection26.node,from=_pm$selection26.from,to=_pm$selection26.to;if(!empty&&!node)return!1;if(node&&node.isInline)return pm.setTextSelection(dir>0?to:from),!0;var parent=void 0;if(!node&&(parent=pm.doc.path(from.path))&&(dir>0?from.offset<parent.size:from.offset)){var _ref=dir>0?parent.chunkAfter(from.offset):parent.chunkBefore(from.offset),nextNode=_ref.node,start=_ref.start;return nextNode.type.selectable&&start==from.offset-(dir>0?0:1)?(pm.setNodeSelection(0>dir?from.move(-1):from),!0):!1}var next=moveSelectionBlock(pm,dir);return next&&(next instanceof _selection.NodeSelection||node)?(pm.setSelectionDirect(next),!0):!1}function selectNodeVertically(pm,dir){var _pm$selection27=pm.selection,empty=_pm$selection27.empty,node=_pm$selection27.node,from=_pm$selection27.from,to=_pm$selection27.to;if(!empty&&!node)return!1;var leavingTextblock=!0;if((!node||node.isInline)&&(leavingTextblock=(0,_selection.verticalMotionLeavesTextblock)(pm,dir>0?to:from,dir)),leavingTextblock){var next=moveSelectionBlock(pm,dir);if(next&&next instanceof _selection.NodeSelection)return pm.setSelectionDirect(next),node||(pm.sel.lastNonNodePos=from),!0}if(!node)return!1;if(node.isInline)return(0,_selection.setDOMSelectionToPos)(pm,from),!1;var last=pm.sel.lastNonNodePos,beyond=(0,_selection.findSelectionFrom)(pm.doc,0>dir?from:to,dir);return last&&beyond&&_model.Pos.samePath(last.path,beyond.from.path)?((0,_selection.setDOMSelectionToPos)(pm,last),!1):(pm.setSelectionDirect(beyond),!0)}Object.defineProperty(exports,"__esModule",{value:!0});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i["return"]&&_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();exports.defineCommand=defineCommand,exports.defineParamHandler=defineParamHandler,exports.deriveCommands=deriveCommands,exports.deriveKeymap=deriveKeymap;var _browserkeymap=require("browserkeymap"),_browserkeymap2=_interopRequireDefault(_browserkeymap),_model=require("../model"),_transform=require("../transform"),_dom=require("../dom"),_utilSortedinsert=require("../util/sortedinsert"),_utilSortedinsert2=_interopRequireDefault(_utilSortedinsert),_utilError=require("../util/error"),_char=require("./char"),_selection=require("./selection"),commands=Object.create(null),paramHandlers=Object.create(null),Command=function(){function Command(spec,self,name){_classCallCheck(this,Command),this.name=name||spec.name,this.name||_utilError.NamespaceError.raise("Trying to define a command without a name"),this.spec=spec,this.self=self}return _createClass(Command,[{key:"exec",value:function(pm,params){var _this=this,run=this.spec.run;if(!this.params.length)return run.call(this.self,pm);if(params)return run.call.apply(run,[this.self,pm].concat(_toConsumableArray(params)));var handler=getParamHandler(pm);return handler?void handler(pm,this,function(params){params&&run.call.apply(run,[_this.self,pm].concat(_toConsumableArray(params)))}):!1}},{key:"select",value:function(pm){var f=this.spec.select;return f?f.call(this.self,pm):!0}},{key:"active",value:function(pm){var f=this.spec.active;return f?f.call(this.self,pm):!1}},{key:"params",get:function(){return this.spec.params||empty}},{key:"label",get:function(){return this.spec.label||this.name}}]),Command}();exports.Command=Command;var empty=[],andScroll={scrollIntoView:!0};_model.NodeType.deriveableCommands=Object.create(null),_model.MarkType.deriveableCommands=Object.create(null),_model.MarkType.deriveableCommands.set=function(){return{run:function(pm){pm.setMark(this,!0)},select:function(pm){return canAddInline(pm,this)}}},_model.MarkType.deriveableCommands.unset=function(){return{run:function(pm){pm.setMark(this,!1)},select:function(pm){return markActive(pm,this)}}},_model.MarkType.deriveableCommands.toggle=function(){return{run:function(pm){pm.setMark(this,null)},active:function(pm){return markActive(pm,this)},select:function(pm){return markApplies(pm,this)}}},_model.StrongMark.register("command",{name:"set",derive:!0,label:"Set strong"}),_model.StrongMark.register("command",{name:"unset",derive:!0,label:"Unset strong"}),_model.StrongMark.register("command",{name:"toggle",derive:!0,label:"Toggle strong",menuGroup:"inline(20)",display:{type:"icon",width:805,height:1024,path:"M317 869q42 18 80 18 214 0 214-191 0-65-23-102-15-25-35-42t-38-26-46-14-48-6-54-1q-41 0-57 5 0 30-0 90t-0 90q0 4-0 38t-0 55 2 47 6 38zM309 442q24 4 62 4 46 0 81-7t62-25 42-51 14-81q0-40-16-70t-45-46-61-24-70-8q-28 0-74 7 0 28 2 86t2 86q0 15-0 45t-0 45q0 26 0 39zM0 950l1-53q8-2 48-9t60-15q4-6 7-15t4-19 3-18 1-21 0-19v-37q0-561-12-585-2-4-12-8t-25-6-28-4-27-2-17-1l-2-47q56-1 194-6t213-5q13 0 39 0t38 0q40 0 78 7t73 24 61 40 42 59 16 78q0 29-9 54t-22 41-36 32-41 25-48 22q88 20 146 76t58 141q0 57-20 102t-53 74-78 48-93 27-100 8q-25 0-75-1t-75-1q-60 0-175 6t-132 6z"},keys:["Mod-B"]}),_model.EmMark.register("command",{name:"set",derive:!0,label:"Add emphasis"}),_model.EmMark.register("command",{name:"unset",derive:!0,label:"Remove emphasis"}),_model.EmMark.register("command",{name:"toggle",derive:!0,label:"Toggle emphasis",menuGroup:"inline(21)",display:{type:"icon",width:585,height:1024,path:"M0 949l9-48q3-1 46-12t63-21q16-20 23-57 0-4 35-165t65-310 29-169v-14q-13-7-31-10t-39-4-33-3l10-58q18 1 68 3t85 4 68 1q27 0 56-1t69-4 56-3q-2 22-10 50-17 5-58 16t-62 19q-4 10-8 24t-5 22-4 26-3 24q-15 84-50 239t-44 203q-1 5-7 33t-11 51-9 47-3 32l0 10q9 2 105 17-1 25-9 56-6 0-18 0t-18 0q-16 0-49-5t-49-5q-78-1-117-1-29 0-81 5t-69 6z"},keys:["Mod-I"]}),_model.CodeMark.register("command",{name:"set",derive:!0,label:"Set code style"}),_model.CodeMark.register("command",{name:"unset",derive:!0,label:"Remove code style"}),_model.CodeMark.register("command",{name:"toggle",derive:!0,label:"Toggle code style",menuGroup:"inline(22)",display:{type:"icon",width:896,height:1024,path:"M608 192l-96 96 224 224-224 224 96 96 288-320-288-320zM288 192l-288 320 288 320 96-96-224-224 224-224-96-96z"},keys:["Mod-`"]});var linkIcon={type:"icon",width:951,height:1024,path:"M832 694q0-22-16-38l-118-118q-16-16-38-16-24 0-41 18 1 1 10 10t12 12 8 10 7 14 2 15q0 22-16 38t-38 16q-8 0-15-2t-14-7-10-8-12-12-10-10q-18 17-18 41 0 22 16 38l117 118q15 15 38 15 22 0 38-14l84-83q16-16 16-38zM430 292q0-22-16-38l-117-118q-16-16-38-16-22 0-38 15l-84 83q-16 16-16 38 0 22 16 38l118 118q15 15 38 15 24 0 41-17-1-1-10-10t-12-12-8-10-7-14-2-15q0-22 16-38t38-16q8 0 15 2t14 7 10 8 12 12 10 10q18-17 18-41zM941 694q0 68-48 116l-84 83q-47 47-116 47-69 0-116-48l-117-118q-47-47-47-116 0-70 50-119l-50-50q-49 50-118 50-68 0-116-48l-118-118q-48-48-48-116t48-116l84-83q47-47 116-47 69 0 116 48l117 118q47 47 47 116 0 70-50 119l50 50q49-50 118-50 68 0 116 48l118 118q48 48 48 116z"};_model.LinkMark.register("command",{name:"unset",derive:!0,label:"Unlink",menuGroup:"inline(30)",active:function(){return!0},display:linkIcon}),_model.LinkMark.register("command",{name:"set",label:"Add link",run:function(pm,href,title){pm.setMark(this,!0,{href:href,title:title})},params:[{label:"Target",type:"text"},{label:"Title",type:"text","default":""}],select:function(pm){return markApplies(pm,this)&&!markActive(pm,this)},menuGroup:"inline(30)",display:linkIcon}),_model.Image.register("command",{name:"insert",label:"Insert image",run:function(pm,src,alt,title){return pm.tr.replaceSelection(this.create({src:src,title:title,alt:alt})).apply(andScroll)},params:[{label:"Image URL",type:"text",prefill:function(pm){return selectedNodeAttr(pm,this,"src")}},{label:"Description / alternative text",type:"text","default":"",prefill:function(pm){return selectedNodeAttr(pm,this,"alt")||pm.selectedText}},{label:"Title",type:"text","default":"",prefill:function(pm){return selectedNodeAttr(pm,this,"title")}}],select:function(pm){return pm.doc.path(pm.selection.from.path).type.canContainType(this)},menuGroup:"inline(40)",display:{type:"icon",width:1097,height:1024,path:"M365 329q0 45-32 77t-77 32-77-32-32-77 32-77 77-32 77 32 32 77zM950 548v256h-804v-109l182-182 91 91 292-292zM1005 146h-914q-7 0-12 5t-5 12v694q0 7 5 12t12 5h914q7 0 12-5t5-12v-694q0-7-5-12t-12-5zM1097 164v694q0 37-26 64t-64 26h-914q-37 0-64-26t-26-64v-694q0-37 26-64t64-26h914q37 0 64 26t26 64z"}}),defineCommand({name:"deleteSelection",label:"Delete the selection",run:function(pm){return pm.tr.replaceSelection().apply(andScroll)},keys:{all:["Backspace(10)","Delete(10)","Mod-Backspace(10)","Mod-Delete(10)"],mac:["Ctrl-H(10)","Alt-Backspace(10)","Ctrl-D(10)","Ctrl-Alt-Backspace(10)","Alt-Delete(10)","Alt-D(10)"]}}),defineCommand({name:"joinBackward",label:"Join with the block above",run:function(pm){var _pm$selection3=pm.selection,head=_pm$selection3.head,empty=_pm$selection3.empty;if(!empty||head.offset>0)return!1;for(var before=void 0,cut=void 0,i=head.path.length-1;!before&&i>=0;i--)head.path[i]>0&&(cut=head.shorten(i),before=pm.doc.path(cut.path).child(cut.offset-1));return before?null==before.type.contains?pm.tr["delete"](cut.move(-1),cut).apply(andScroll):deleteBarrier(pm,cut):pm.tr.lift(head).apply(andScroll)},keys:["Backspace(30)","Mod-Backspace(30)"]}),defineCommand({name:"deleteCharBefore",label:"Delete a character before the cursor",run:function(pm){var _pm$selection4=pm.selection,head=_pm$selection4.head,empty=_pm$selection4.empty;if(!empty||0==head.offset)return!1;var from=moveBackward(pm.doc.path(head.path),head.offset,"char");return pm.tr["delete"](new _model.Pos(head.path,from),head).apply(andScroll)},keys:{all:["Backspace(60)"],mac:["Ctrl-H(40)"]}}),defineCommand({name:"deleteWordBefore",label:"Delete the word before the cursor",run:function(pm){var _pm$selection5=pm.selection,head=_pm$selection5.head,empty=_pm$selection5.empty;if(!empty||0==head.offset)return!1;var from=moveBackward(pm.doc.path(head.path),head.offset,"word");return pm.tr["delete"](new _model.Pos(head.path,from),head).apply(andScroll)},keys:{all:["Mod-Backspace(40)"],mac:["Alt-Backspace(40)"]}}),defineCommand({name:"joinForward",label:"Join with the block below",run:function(pm){var _pm$selection6=pm.selection,head=_pm$selection6.head,empty=_pm$selection6.empty;if(!empty||head.offset<pm.doc.path(head.path).size)return!1;for(var after=void 0,cut=void 0,i=head.path.length-1;!after&&i>=0;i--){cut=head.shorten(i,1);var _parent=pm.doc.path(cut.path);cut.offset<_parent.size&&(after=_parent.child(cut.offset))}return after?null==after.type.contains?pm.tr["delete"](cut,cut.move(1)).apply(andScroll):deleteBarrier(pm,cut):!1},keys:["Delete(30)","Mod-Delete(30)"]}),defineCommand({name:"deleteCharAfter",label:"Delete a character after the cursor",run:function(pm){var _pm$selection7=pm.selection,head=_pm$selection7.head,empty=_pm$selection7.empty;if(!empty||head.offset==pm.doc.path(head.path).size)return!1;var to=moveForward(pm.doc.path(head.path),head.offset,"char");return pm.tr["delete"](head,new _model.Pos(head.path,to)).apply(andScroll)},keys:{all:["Delete(60)"],mac:["Ctrl-D(60)"]}}),defineCommand({name:"deleteWordAfter",label:"Delete a word after the cursor",run:function(pm){var _pm$selection8=pm.selection,head=_pm$selection8.head,empty=_pm$selection8.empty;if(!empty||head.offset==pm.doc.path(head.path).size)return!1;var to=moveForward(pm.doc.path(head.path),head.offset,"word");return pm.tr["delete"](head,new _model.Pos(head.path,to)).apply(andScroll)},keys:{all:["Mod-Delete(40)"],mac:["Ctrl-Alt-Backspace(40)","Alt-Delete(40)","Alt-D(40)"]}}),defineCommand({name:"joinUp",label:"Join with above block",run:function(pm){var point=joinPointAbove(pm),isNode=pm.selection.node;return point?(pm.tr.join(point).apply(),void(isNode&&pm.setNodeSelection(point.move(-1)))):!1},select:function(pm){return joinPointAbove(pm)},menuGroup:"block(80)",display:{type:"icon",width:800,height:900,path:"M0 75h800v125h-800z M0 825h800v-125h-800z M250 400h100v-100h100v100h100v100h-100v100h-100v-100h-100z"},keys:["Alt-Up"]}),defineCommand({name:"joinDown",label:"Join with below block",run:function(pm){var node=pm.selection.node,point=joinPointBelow(pm);return point?(pm.tr.join(point).apply(),void(node&&pm.setNodeSelection(point.move(-1)))):!1},select:function(pm){return joinPointBelow(pm)},keys:["Alt-Down"]}),defineCommand({name:"lift",label:"Lift out of enclosing block",run:function(pm){var _pm$selection11=pm.selection,from=_pm$selection11.from,to=_pm$selection11.to;return pm.tr.lift(from,to).apply(andScroll)},select:function(pm){var _pm$selection12=pm.selection,from=_pm$selection12.from,to=_pm$selection12.to;return(0,_transform.canLift)(pm.doc,from,to)},menuGroup:"block(75)",display:{type:"icon",width:1024,height:1024,path:"M219 310v329q0 7-5 12t-12 5q-8 0-13-5l-164-164q-5-5-5-13t5-13l164-164q5-5 13-5 7 0 12 5t5 12zM1024 749v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12zM1024 530v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 310v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 91v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12z"},keys:["Alt-Left"]}),_model.NodeType.deriveableCommands.wrap=function(conf){return{run:function(pm){var _pm$selection13=pm.selection,from=_pm$selection13.from,to=_pm$selection13.to,head=_pm$selection13.head,doJoin=!1;if(this.isList&&head&&isAtTopOfListItem(pm.doc,from,to,this)){if(0==from.path[from.path.length-2])return!1;doJoin=!0}var tr=pm.tr.wrap(from,to,this,conf.attrs);return doJoin&&tr.join(from.shorten(from.depth-2)),tr.apply(andScroll)},select:function(pm){var _pm$selection14=pm.selection,from=_pm$selection14.from,to=_pm$selection14.to,head=_pm$selection14.head;return this.isList&&head&&isAtTopOfListItem(pm.doc,from,to,this)&&0==from.path[from.path.length-2]?!1:(0,_transform.canWrap)(pm.doc,from,to,this,conf.attrs)}}},_model.BulletList.register("command",{name:"wrap",derive:!0,label:"Wrap the selection in a bullet list",menuGroup:"block(40)",display:{type:"icon",width:768,height:896,path:"M0 512h128v-128h-128v128zM0 256h128v-128h-128v128zM0 768h128v-128h-128v128zM256 512h512v-128h-512v128zM256 256h512v-128h-512v128zM256 768h512v-128h-512v128z"},keys:["Alt-Right '*'","Alt-Right '-'"]}),_model.OrderedList.register("command",{name:"wrap",derive:!0,label:"Wrap the selection in an ordered list",menuGroup:"block(41)",display:{type:"icon",width:768,height:896,path:"M320 512h448v-128h-448v128zM320 768h448v-128h-448v128zM320 128v128h448v-128h-448zM79 384h78v-256h-36l-85 23v50l43-2v185zM189 590c0-36-12-78-96-78-33 0-64 6-83 16l1 66c21-10 42-15 67-15s32 11 32 28c0 26-30 58-110 112v50h192v-67l-91 2c49-30 87-66 87-113l1-1z"},keys:["Alt-Right '1'"]}),_model.BlockQuote.register("command",{name:"wrap",derive:!0,label:"Wrap the selection in a block quote",menuGroup:"block(45)",display:{type:"icon",width:640,height:896,path:"M0 448v256h256v-256h-128c0 0 0-128 128-128v-128c0 0-256 0-256 256zM640 320v-128c0 0-256 0-256 256v256h256v-256h-128c0 0 0-128 128-128z"},keys:["Alt-Right '>'","Alt-Right '\"'"]}),_model.HardBreak.register("command",{name:"insert",label:"Insert hard break",run:function(pm){var _pm$selection15=pm.selection,node=_pm$selection15.node,from=_pm$selection15.from;return node&&node.isBlock?!1:pm.doc.path(from.path).type.isCode?pm.tr.typeText("\n").apply(andScroll):pm.tr.replaceSelection(this.create()).apply(andScroll)},keys:["Mod-Enter","Shift-Enter"]}),defineCommand({name:"newlineInCode",label:"Insert newline",run:function(pm){var _pm$selection16=pm.selection,from=_pm$selection16.from,to=_pm$selection16.to,node=_pm$selection16.node,block=void 0;return!node&&_model.Pos.samePath(from.path,to.path)&&(block=pm.doc.path(from.path)).type.isCode&&to.offset<block.size?pm.tr.typeText("\n").apply(andScroll):!1},keys:["Enter(10)"]}),defineCommand({name:"createParagraphNear",label:"Create a paragraph near the selected leaf block",run:function(pm){var _pm$selection17=pm.selection,from=_pm$selection17.from,to=_pm$selection17.to,node=_pm$selection17.node;if(!node||!node.isBlock||node.type.contains)return!1;var side=from.offset?to:from;pm.tr.insert(side,pm.schema.defaultTextblockType().create()).apply(andScroll),
pm.setTextSelection(new _model.Pos(side.toPath(),0))},keys:["Enter(20)"]}),defineCommand({name:"liftEmptyBlock",label:"Move current block up",run:function(pm){var _pm$selection18=pm.selection,head=_pm$selection18.head,empty=_pm$selection18.empty;if(!empty||head.offset>0||pm.doc.path(head.path).size)return!1;if(head.depth>1){var shorter=head.shorten();if(shorter.offset>0&&shorter.offset<pm.doc.path(shorter.path).size-1&&pm.tr.split(shorter).apply()!==!1)return}return pm.tr.lift(head).apply(andScroll)},keys:["Enter(30)"]}),defineCommand({name:"splitBlock",label:"Split the current block",run:function(pm){var _pm$selection19=pm.selection,from=_pm$selection19.from,to=_pm$selection19.to,node=_pm$selection19.node,block=pm.doc.path(to.path);if(node&&node.isBlock)return from.offset?pm.tr.split(from).apply(andScroll):!1;var type=to.offset==block.size?pm.schema.defaultTextblockType():null;return pm.tr["delete"](from,to).split(from,1,type).apply(andScroll)},keys:["Enter(60)"]}),_model.ListItem.register("command",{name:"split",label:"Split the current list item",run:function(pm){var _pm$selection20=pm.selection,from=_pm$selection20.from,to=_pm$selection20.to,node=_pm$selection20.node;if(node&&node.isBlock||from.path.length<2||!_model.Pos.samePath(from.path,to.path))return!1;var toParent=from.shorten(),grandParent=pm.doc.path(toParent.path);if(grandParent.type!=this)return!1;var nextType=to.offset==grandParent.child(toParent.offset).size?pm.schema.defaultTextblockType():null;return pm.tr["delete"](from,to).split(from,2,nextType).apply(andScroll)},keys:["Enter(50)"]}),_model.NodeType.deriveableCommands.make=function(conf){return{run:function(pm){var _pm$selection21=pm.selection,from=_pm$selection21.from,to=_pm$selection21.to;return pm.tr.setBlockType(from,to,this,conf.attrs).apply(andScroll)},select:function(pm){var _pm$selection22=pm.selection,from=_pm$selection22.from,to=_pm$selection22.to,node=_pm$selection22.node;return node?node.isTextblock&&!node.hasMarkup(this,conf.attrs):!alreadyHasBlockType(pm.doc,from,to,this,conf.attrs)}}};for(var i=1;6>=i;i++)_model.Heading.register("command",{name:"make"+i,derive:{name:"make",attrs:{level:i}},label:"Change to heading "+i,keys:["Mod-H '"+i+"'"]});_model.Paragraph.register("command",{name:"make",derive:!0,label:"Change to paragraph",keys:["Mod-P"]}),_model.CodeBlock.register("command",{name:"make",derive:!0,label:"Change to code block",keys:["Mod-\\"]}),_model.NodeType.deriveableCommands.insert=function(conf){return{run:function(pm){return pm.tr.replaceSelection(this.create(conf.attrs)).apply(andScroll)}}},_model.HorizontalRule.register("command",{name:"insert",derive:!0,label:"Insert horizontal rule",keys:["Mod-Shift--"]}),defineCommand({name:"textblockType",label:"Change block type",run:function(pm,type){var _pm$selection23=pm.selection,from=_pm$selection23.from,to=_pm$selection23.to;return pm.tr.setBlockType(from,to,type.type,type.attrs).apply()},select:function(pm){var node=pm.selection.node;return!node||node.isTextblock},params:[{label:"Type",type:"select",options:listTextblockTypes,prefill:currentTextblockType,defaultLabel:"Type..."}],display:{type:"param"},menuGroup:"block(10)"}),_model.Paragraph.prototype.textblockTypes=[{label:"Normal",rank:10}],_model.CodeBlock.prototype.textblockTypes=[{label:"Code",rank:20}],_model.Heading.prototype.textblockTypes=[1,2,3,4,5,6].map(function(n){return{label:"Head "+n,attrs:{level:n},rank:30+n}}),defineCommand({name:"selectParentNode",label:"Select parent node",run:function(pm){var node=nodeAboveSelection(pm);return node?void pm.setNodeSelection(node):!1},select:function(pm){return nodeAboveSelection(pm)},menuGroup:"block(90)",display:{type:"icon",text:"⬚",style:"font-weight: bold; vertical-align: 20%"},keys:["Esc"]}),defineCommand({name:"selectNodeLeft",label:"Move the selection onto or out of the block to the left",run:function(pm){var done=selectNodeHorizontally(pm,-1);return done&&pm.scrollIntoView(),done},keys:["Left","Mod-Left"]}),defineCommand({name:"selectNodeRight",label:"Move the selection onto or out of the block to the right",run:function(pm){var done=selectNodeHorizontally(pm,1);return done&&pm.scrollIntoView(),done},keys:["Right","Mod-Right"]}),defineCommand({name:"selectNodeUp",label:"Move the selection onto or out of the block above",run:function(pm){var done=selectNodeVertically(pm,-1);return done!==!1&&pm.scrollIntoView(),done},keys:["Up"]}),defineCommand({name:"selectNodeDown",label:"Move the selection onto or out of the block below",run:function(pm){var done=selectNodeVertically(pm,1);return done!==!1&&pm.scrollIntoView(),done},keys:["Down"]}),defineCommand({name:"undo",label:"Undo last change",run:function(pm){return pm.scrollIntoView(),pm.history.undo()},select:function(pm){return pm.history.canUndo()},menuGroup:"history(10)",display:{type:"icon",width:1024,height:1024,path:"M761 1024c113-206 132-520-313-509v253l-384-384 384-384v248c534-13 594 472 313 775z"},keys:["Mod-Z"]}),defineCommand({name:"redo",label:"Redo last undone change",run:function(pm){return pm.scrollIntoView(),pm.history.redo()},select:function(pm){return pm.history.canRedo()},menuGroup:"history(20)",display:{type:"icon",width:1024,height:1024,path:"M576 248v-248l384 384-384 384v-253c-446-10-427 303-313 509-280-303-221-789 313-775z"},keys:["Mod-Y","Shift-Mod-Z"]})},{"../dom":1,"../model":31,"../transform":37,"../util/error":48,"../util/sortedinsert":51,"./char":3,"./selection":14,browserkeymap:52}],5:[function(require,module,exports){"use strict";var _dom=require("../dom");(0,_dom.insertCSS)('\n\n.ProseMirror {\n  border: 1px solid silver;\n  position: relative;\n}\n\n.ProseMirror-content {\n  padding: 4px 8px 4px 14px;\n  white-space: pre-wrap;\n  line-height: 1.2;\n}\n\n.ProseMirror-drop-target {\n  position: absolute;\n  width: 1px;\n  background: #666;\n  display: none;\n}\n\n.ProseMirror-content ul.tight p, .ProseMirror-content ol.tight p {\n  margin: 0;\n}\n\n.ProseMirror-content ul, .ProseMirror-content ol {\n  padding-left: 30px;\n  cursor: default;\n}\n\n.ProseMirror-content blockquote {\n  padding-left: 1em;\n  border-left: 3px solid #eee;\n  margin-left: 0; margin-right: 0;\n}\n\n.ProseMirror-content pre {\n  white-space: pre-wrap;\n}\n\n.ProseMirror-selectednode {\n  outline: 2px solid #8cf;\n}\n\n.ProseMirror-content p:first-child,\n.ProseMirror-content h1:first-child,\n.ProseMirror-content h2:first-child,\n.ProseMirror-content h3:first-child,\n.ProseMirror-content h4:first-child,\n.ProseMirror-content h5:first-child,\n.ProseMirror-content h6:first-child {\n  margin-top: .3em;\n}\n\n/* Add space around the hr to make clicking it easier */\n\n.ProseMirror-content hr {\n  position: relative;\n  height: 6px;\n  border: none;\n}\n\n.ProseMirror-content hr:after {\n  content: "";\n  position: absolute;\n  left: 10px;\n  right: 10px;\n  top: 2px;\n  border-top: 2px solid silver;\n}\n\n.ProseMirror-content img {\n  cursor: default;\n}\n\n/* Make sure li selections wrap around markers */\n\n.ProseMirror-content li {\n  position: relative;\n  pointer-events: none; /* Don\'t do weird stuff with marker clicks */\n}\n.ProseMirror-content li > * {\n  pointer-events: auto;\n}\n\nli.ProseMirror-selectednode {\n  outline: none;\n}\n\nli.ProseMirror-selectednode:after {\n  content: "";\n  position: absolute;\n  left: -32px;\n  right: -2px; top: -2px; bottom: -2px;\n  border: 2px solid #8cf;\n  pointer-events: none;\n}\n\n')},{"../dom":1}],6:[function(require,module,exports){"use strict";function isAtEnd(node,pos,depth){for(var i=depth||0;i<pos.path.length;i++){var n=pos.path[depth];if(n<node.size-1)return!1;node=node.child(n)}return pos.offset==node.size}function isAtStart(pos,depth){if(pos.offset>0)return!1;for(var i=depth||0;i<pos.path.length;i++)if(pos.path[depth]>0)return!1;return!0}function parseNearSelection(pm){for(var dom=pm.content,node=pm.doc,_pm$selection=pm.selection,from=_pm$selection.from,to=_pm$selection.to,depth=0;;depth++){var toNode=node.child(to.path[depth]),fromStart=isAtStart(from,depth+1),toEnd=isAtEnd(toNode,to,depth+1);if(fromStart||toEnd||from.path[depth]!=to.path[depth]||toNode.isTextblock){var startOffset=depth==from.depth?from.offset:from.path[depth];fromStart&&startOffset>0&&startOffset--;var endOffset=depth==to.depth?to.offset:to.path[depth]+1;toEnd&&endOffset<node.size-1&&endOffset++;var parsed=(0,_format.fromDOM)(pm.schema,dom,{topNode:node.copy(),from:startOffset,to:dom.childNodes.length-(node.size-endOffset)});parsed=parsed.copy(node.content.slice(0,startOffset).append(parsed.content).append(node.content.slice(endOffset)));for(var i=depth-1;i>=0;i--){var wrap=pm.doc.path(from.path.slice(0,i));parsed=wrap.replace(from.path[i],parsed)}return parsed}node=toNode,dom=(0,_selection.findByPath)(dom,from.path[depth],!1)}}function applyDOMChange(pm){var updated=parseNearSelection(pm),changeStart=(0,_model.findDiffStart)(pm.doc.content,updated.content);if(changeStart){var changeEnd=findDiffEndConstrained(pm.doc.content,updated.content,changeStart);return pm.markRangeDirty(pm.doc.siblingRange(changeStart,changeEnd.a)),pm.tr.replace(changeStart,changeEnd.a,updated,changeStart,changeEnd.b).apply(),!0}return!1}function offsetBy(first,second,pos){var same=(0,_transformTree.samePathDepth)(first,second),firstEnd=same==first.depth,secondEnd=same==second.depth,off=(secondEnd?second.offset:second.path[same])-(firstEnd?first.offset:first.path[same]),shorter=firstEnd?pos.move(off):pos.shorten(same,off);return secondEnd?shorter:shorter.extend(new _model.Pos(second.path.slice(same),second.offset))}function findDiffEndConstrained(a,b,start){var end=(0,_model.findDiffEnd)(a,b);return end?end.a.cmp(start)<0?{a:start,b:offsetBy(end.a,start,end.b)}:end.b.cmp(start)<0?{a:offsetBy(end.b,start,end.a),b:start}:end:end}function textContext(data){var range=getSelection().getRangeAt(0),start=range.startContainer,end=range.endContainer;if(start==end&&3==start.nodeType){var value=start.nodeValue,lead=range.startOffset,_end=range.endOffset;return data&&_end>=data.length&&value.slice(_end-data.length,_end)==data&&(lead=_end-data.length),{inside:start,lead:lead,trail:value.length-_end}}for(var sizeBefore=null,sizeAfter=null,before=start.childNodes[range.startOffset-1]||nodeBefore(start);before.lastChild;)before=before.lastChild;if(before&&3==before.nodeType){var value=before.nodeValue;sizeBefore=value.length,data&&value.slice(value.length-data.length)==data&&(sizeBefore-=data.length)}for(var after=end.childNodes[range.endOffset]||nodeAfter(end);after.firstChild;)after=after.firstChild;return after&&3==after.nodeType&&(sizeAfter=after.nodeValue.length),{before:before,sizeBefore:sizeBefore,after:after,sizeAfter:sizeAfter}}function textInContext(context,deflt){if(context.inside){var _val=context.inside.nodeValue;return _val.slice(context.lead,_val.length-context.trail)}var before=context.before,after=context.after,val="";if(!before)return deflt;3==before.nodeType&&(val=before.nodeValue.slice(context.sizeBefore));var scan=scanText(before,after);if(null==scan)return deflt;if(val+=scan,after&&3==after.nodeType){var valAfter=after.nodeValue;val+=valAfter.slice(0,valAfter.length-context.sizeAfter)}return val}function nodeAfter(node){for(;;){var next=node.nextSibling;if(next){for(;next.firstChild;)next=next.firstChild;return next}if(!(node=node.parentElement))return null}}function nodeBefore(node){for(;;){var prev=node.previousSibling;if(prev){for(;prev.lastChild;)prev=prev.lastChild;return prev}if(!(node=node.parentElement))return null}}function scanText(start,end){for(var text="",cur=nodeAfter(start);;){if(cur==end)return text;if(!cur)return null;3==cur.nodeType&&(text+=cur.nodeValue),cur=cur.firstChild||nodeAfter(cur)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.applyDOMChange=applyDOMChange,exports.textContext=textContext,exports.textInContext=textInContext;var _model=require("../model"),_format=require("../format"),_transformTree=require("../transform/tree"),_selection=require("./selection")},{"../format":17,"../model":31,"../transform/tree":45,"./selection":14}],7:[function(require,module,exports){"use strict";function options(path,ranges){return{onRender:function(node,dom,offset){return node.isText||null!=node.type.contains||(dom.contentEditable=!1,node.isBlock&&dom.setAttribute("pm-leaf","true")),node.isBlock&&null!=offset&&dom.setAttribute("pm-offset",offset),node.isTextblock&&adjustTrailingHacks(dom,node),dom},renderInlineFlat:function(node,dom,offset){ranges.advanceTo(new _model.Pos(path,offset));for(var end=new _model.Pos(path,offset+node.width),nextCut=ranges.nextChangeBefore(end),inner=dom,wrapped=void 0,i=0;i<node.marks.length;i++)inner=inner.firstChild;1!=dom.nodeType&&(dom=(0,_dom.elt)("span",null,dom),nextCut||(wrapped=dom)),wrapped||!nextCut&&!ranges.current.length||(wrapped=inner==dom?dom=(0,_dom.elt)("span",null,inner):inner.parentNode.appendChild((0,_dom.elt)("span",null,inner))),dom.setAttribute("pm-offset",offset),null==node.type.contains&&dom.setAttribute("pm-leaf",node.isText?node.width:"true");for(var inlineOffset=0;nextCut;){var size=nextCut-offset,split=splitSpan(wrapped,size);ranges.current.length&&(split.className=ranges.current.join(" ")),split.setAttribute("pm-inner-offset",inlineOffset),inlineOffset+=size,offset+=size,ranges.advanceTo(new _model.Pos(path,offset)),(nextCut=ranges.nextChangeBefore(end))||wrapped.setAttribute("pm-inner-offset",inlineOffset)}return ranges.current.length&&(wrapped.className=ranges.current.join(" ")),dom},document:document,path:path}}function splitSpan(span,at){var textNode=span.firstChild,text=textNode.nodeValue,newNode=span.parentNode.insertBefore((0,_dom.elt)("span",null,text.slice(0,at)),span);return textNode.nodeValue=text.slice(at),newNode}function draw(pm,doc){pm.content.textContent="",pm.content.appendChild((0,_format.toDOM)(doc,options([],pm.ranges.activeRangeTracker())))}function adjustTrailingHacks(dom,node){var needs=0==node.size||node.lastChild.type.isBR?"br":node.lastChild.isText||null!=node.lastChild.type.contains?null:"text",last=dom.lastChild,has=last&&1==last.nodeType&&last.hasAttribute("pm-ignore")?"BR"==last.nodeName?"br":"text":null;needs!=has&&(has&&dom.removeChild(last),needs&&dom.appendChild("br"==needs?(0,_dom.elt)("br",{"pm-ignore":"trailing-break"}):(0,_dom.elt)("span",{"pm-ignore":"cursor-text"},"")))}function findNodeIn(iter,node){for(var copy=iter.copy(),child=void 0;child=copy.next().value;)if(child==node)return child}function movePast(dom){var next=dom.nextSibling;return dom.parentNode.removeChild(dom),next}function redraw(pm,dirty,doc,prev){function scan(dom,node,prev){for(var iNode=node.iter(),iPrev=prev.iter(),pChild=iPrev.next().value,domPos=dom.firstChild,child=void 0;child=iNode.next().value;){var offset=iNode.offset-child.width,matching=void 0,reuseDOM=void 0;if(node.isTextblock||opts.path.push(offset),pChild==child)matching=pChild;else if(matching=findNodeIn(iPrev,child))for(;pChild!=matching;)pChild=iPrev.next().value,domPos=movePast(domPos);if(matching&&!dirty.get(matching))reuseDOM=!0;else if(pChild&&!child.isText&&child.sameMarkup(pChild)&&dirty.get(pChild)!=_main.DIRTY_REDRAW){if(reuseDOM=!0,pChild.type.contains){for(var contentNode=domPos;;){var first=contentNode.firstChild;if(!first||first.hasAttribute("pm-ignore")||first.hasAttribute("pm-offset"))break;contentNode=first}scan(contentNode,child,pChild)}}else{var rendered=(0,_format.nodeToDOM)(child,opts,offset);dom.insertBefore(rendered,domPos),reuseDOM=!1}reuseDOM&&(domPos.setAttribute("pm-offset",offset),domPos=domPos.nextSibling,pChild=iPrev.next().value),node.isTextblock||opts.path.pop()}for(;pChild;)domPos=movePast(domPos),pChild=iPrev.next().value;node.isTextblock&&adjustTrailingHacks(dom,node)}var opts=options([],pm.ranges.activeRangeTracker());scan(pm.content,doc,prev)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.draw=draw,exports.redraw=redraw;var _model=require("../model"),_format=require("../format"),_dom=require("../dom"),_main=require("./main")},{"../dom":1,"../format":17,"../model":31,"./main":11}],8:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function isDelStep(step){return"replace"==step.type&&step.from.offset<step.to.offset&&_model.Pos.samePath(step.from.path,step.to.path)&&(!step.param||0==step.param.content.size)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_model=require("../model"),_transform=require("../transform"),InvertedStep=function InvertedStep(step,version,id){_classCallCheck(this,InvertedStep),this.step=step,this.version=version,this.id=id},BranchRemapping=function(){function BranchRemapping(branch){_classCallCheck(this,BranchRemapping),this.branch=branch,this.remap=new _transform.Remapping,this.version=branch.version,this.mirrorBuffer=Object.create(null)}return _createClass(BranchRemapping,[{key:"moveToVersion",value:function(version){for(;this.version>version;)this.addNextMap()}},{key:"addNextMap",value:function(){var found=this.branch.mirror[this.version],mapOffset=this.branch.maps.length-(this.branch.version-this.version)-1,id=this.remap.addToFront(this.branch.maps[mapOffset],this.mirrorBuffer[this.version]);return--this.version,null!=found&&(this.mirrorBuffer[found]=id),id}},{key:"movePastStep",value:function(result){var id=this.addNextMap();result&&this.remap.addToBack(result.map,id)}}]),BranchRemapping}(),workTime=100,pauseTime=150,CompressionWorker=function(){function CompressionWorker(doc,branch,callback){_classCallCheck(this,CompressionWorker),this.branch=branch,this.callback=callback,this.remap=new BranchRemapping(branch),this.doc=doc,this.events=[],this.maps=[],this.version=this.startVersion=branch.version,this.i=branch.events.length,this.timeout=null,this.aborted=!1}return _createClass(CompressionWorker,[{key:"work",value:function(){var _this=this;if(!this.aborted)for(var endTime=Date.now()+workTime;;){if(0==this.i)return this.finish();for(var _event=this.branch.events[--this.i],outEvent=[],j=_event.length-1;j>=0;j--){var _event$j=_event[j],step=_event$j.step,stepVersion=_event$j.version,stepID=_event$j.id;this.remap.moveToVersion(stepVersion);var mappedStep=step.map(this.remap.remap);if(mappedStep&&isDelStep(step)){for(var extra=0,start=step.from;j>0;){var next=_event[j-1];if(next.version!=stepVersion-1||!isDelStep(next.step)||start.cmp(next.step.to))break;extra+=next.step.to.offset-next.step.from.offset,start=next.step.from,stepVersion--,j--,this.remap.addNextMap()}if(extra>0){var _start=mappedStep.from.move(-extra);mappedStep=new _transform.Step("replace",_start,mappedStep.to,_start)}}var result=mappedStep&&mappedStep.apply(this.doc);result&&(this.doc=result.doc,this.maps.push(result.map.invert()),outEvent.push(new InvertedStep(mappedStep,this.version,stepID)),this.version--),this.remap.movePastStep(result)}if(outEvent.length&&(outEvent.reverse(),this.events.push(outEvent)),Date.now()>endTime)return void(this.timeout=window.setTimeout(function(){return _this.work()},pauseTime))}}},{key:"finish",value:function(){this.aborted||(this.events.reverse(),this.maps.reverse(),this.callback(this.maps.concat(this.branch.maps.slice(this.branch.maps.length-(this.branch.version-this.startVersion))),this.events))}},{key:"abort",value:function(){this.aborted=!0,window.clearTimeout(this.timeout)}}]),CompressionWorker}(),compressStepCount=150,Branch=function(){function Branch(maxDepth){_classCallCheck(this,Branch),this.maxDepth=maxDepth,this.version=0,this.nextStepID=1,this.maps=[],this.mirror=Object.create(null),this.events=[],this.stepsSinceCompress=0,this.compressing=null,this.compressTimeout=null}return _createClass(Branch,[{key:"clear",value:function(force){(force||!this.empty())&&(this.maps.length=this.events.length=this.stepsSinceCompress=0,this.mirror=Object.create(null),this.abortCompression())}},{key:"newEvent",value:function(){for(this.abortCompression(),this.events.push([]);this.events.length>this.maxDepth;)this.events.shift()}},{key:"addMap",value:function(map){return this.empty()?void 0:(this.maps.push(map),this.version++,this.stepsSinceCompress++,!0)}},{key:"empty",value:function(){return 0==this.events.length}},{key:"addStep",value:function(step,map,id){this.addMap(map),null==id&&(id=this.nextStepID++),this.events[this.events.length-1].push(new InvertedStep(step,this.version,id))}},{key:"addTransform",value:function(transform,ids){this.abortCompression();for(var i=0;i<transform.steps.length;i++){var inverted=transform.steps[i].invert(transform.docs[i],transform.maps[i]);this.addStep(inverted,transform.maps[i],ids&&ids[i])}}},{key:"popEvent",value:function(doc,allowCollapsing){this.abortCompression();var event=this.events.pop();if(!event)return null;for(var remap=new BranchRemapping(this),collapsing=allowCollapsing,tr=new _transform.Transform(doc),ids=[],i=event.length-1;i>=0;i--){var invertedStep=event[i],step=invertedStep.step;if(collapsing&&invertedStep.version==remap.version)this.version--,delete this.mirror[this.version],this.maps.pop(),tr.step(step),ids.push(invertedStep.id),--remap.version;else{collapsing=!1,remap.moveToVersion(invertedStep.version),step=step.map(remap.remap);var result=step&&tr.step(step);result&&(ids.push(invertedStep.id),this.addMap(result.map)&&(this.mirror[this.version]=invertedStep.version)),i>0&&remap.movePastStep(result)}}return this.empty()&&this.clear(!0),{transform:tr,ids:ids}}},{key:"getVersion",value:function(){return{id:this.nextStepID,version:this.version}}},{key:"findVersion",value:function(version){for(var i=this.events.length-1;i>=0;i--)for(var _event2=this.events[i],j=_event2.length-1;j>=0;j--){var step=_event2[j];if(step.id==version.id)return{event:i,step:j};if(step.id<version.id)return{event:i,step:j+1}}}},{key:"rebased",value:function(newMaps,rebasedTransform,positions){if(!this.empty()){this.abortCompression();var startVersion=this.version-positions.length;out:for(var i=this.events.length-1;i>=0;i--)for(var _event3=this.events[i],j=_event3.length-1;j>=0;j--){var step=_event3[j];if(step.version<=startVersion)break out;var off=positions[step.version-startVersion-1];if(-1==off)_event3.splice(j--,1);else{var inv=rebasedTransform.steps[off].invert(rebasedTransform.docs[off],rebasedTransform.maps[off]);_event3[j]=new InvertedStep(inv,startVersion+newMaps.length+off+1,step.id)}}this.maps.length>positions.length?this.maps=this.maps.slice(0,this.maps.length-positions.length).concat(newMaps).concat(rebasedTransform.maps):this.maps=rebasedTransform.maps.slice(),this.version=startVersion+newMaps.length+rebasedTransform.maps.length,this.stepsSinceCompress+=newMaps.length+rebasedTransform.steps.length-positions.length}}},{key:"abortCompression",value:function(){this.compressing&&(this.compressing.abort(),this.compressing=null)}},{key:"needsCompression",value:function(){return this.stepsSinceCompress>compressStepCount&&!this.compressing}},{key:"startCompression",value:function(doc){var _this2=this;this.compressing=new CompressionWorker(doc,this,function(maps,events){_this2.maps=maps,_this2.events=events,_this2.mirror=Object.create(null),_this2.compressing=null,_this2.stepsSinceCompress=0}),this.compressing.work()}}]),Branch}(),compressDelay=750,History=function(){function History(pm){var _this3=this;_classCallCheck(this,History),this.pm=pm,this.done=new Branch(pm.options.historyDepth),this.undone=new Branch(pm.options.historyDepth),this.lastAddedAt=0,this.ignoreTransform=!1,this.allowCollapsing=!0,pm.on("transform",function(transform,options){return _this3.recordTransform(transform,options)})}return _createClass(History,[{key:"recordTransform",value:function(transform,options){if(!this.ignoreTransform){if(0==options.addToHistory)for(var i=0;i<transform.maps.length;i++){var map=transform.maps[i];this.done.addMap(map),this.undone.addMap(map)}else{this.undone.clear();var now=Date.now();now>this.lastAddedAt+this.pm.options.historyEventDelay&&this.done.newEvent(),this.done.addTransform(transform),this.lastAddedAt=now}this.maybeScheduleCompression()}}},{key:"undo",value:function(){return this.shift(this.done,this.undone)}},{key:"redo",value:function(){return this.shift(this.undone,this.done)}},{key:"canUndo",value:function(){return this.done.events.length>0}},{key:"canRedo",value:function(){return this.undone.events.length>0}},{key:"shift",value:function(from,to){var event=from.popEvent(this.pm.doc,this.allowCollapsing);if(!event)return!1;var transform=event.transform,ids=event.ids;return this.ignoreTransform=!0,this.pm.apply(transform),this.ignoreTransform=!1,transform.steps.length?(to&&(to.newEvent(),to.addTransform(transform,ids)),this.lastAddedAt=0,!0):this.shift(from,to)}},{key:"getVersion",value:function(){return this.done.getVersion()}},{key:"backToVersion",value:function(version){var found=this.done.findVersion(version);if(!found)return!1;var event=this.done.events[found.event],combined=this.done.events.slice(found.event+1).reduce(function(comb,arr){return comb.concat(arr)},event.slice(found.step));this.done.events.length=found.event+((event.length=found.step)?1:0),this.done.events.push(combined),this.shift(this.done)}},{key:"rebased",value:function(newMaps,rebasedTransform,positions){this.done.rebased(newMaps,rebasedTransform,positions),this.undone.rebased(newMaps,rebasedTransform,positions),this.maybeScheduleCompression()}},{key:"maybeScheduleCompression",value:function(){this.maybeScheduleCompressionForBranch(this.done),this.maybeScheduleCompressionForBranch(this.undone)}},{key:"maybeScheduleCompressionForBranch",value:function(branch){var _this4=this;window.clearTimeout(branch.compressTimeout),branch.needsCompression()&&(branch.compressTimeout=window.setTimeout(function(){branch.needsCompression()&&branch.startCompression(_this4.pm.doc)},compressDelay))}}]),History}();exports.History=History},{"../model":31,"../transform":37}],9:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0});var _browserkeymap=require("browserkeymap"),_browserkeymap2=_interopRequireDefault(_browserkeymap),_main=require("./main");Object.defineProperty(exports,"ProseMirror",{enumerable:!0,get:function(){return _main.ProseMirror}});var _options=require("./options");Object.defineProperty(exports,"defineOption",{enumerable:!0,get:function(){return _options.defineOption}});var _selection=require("./selection");Object.defineProperty(exports,"Range",{enumerable:!0,get:function(){return _selection.Range}}),Object.defineProperty(exports,"SelectionError",{enumerable:!0,get:function(){return _selection.SelectionError}});var _range=require("./range");Object.defineProperty(exports,"MarkedRange",{enumerable:!0,get:function(){return _range.MarkedRange}});var _commands=require("./commands");Object.defineProperty(exports,"defineCommand",{enumerable:!0,get:function(){return _commands.defineCommand}}),Object.defineProperty(exports,"defineParamHandler",{enumerable:!0,get:function(){return _commands.defineParamHandler}}),Object.defineProperty(exports,"Command",{enumerable:!0,get:function(){return _commands.Command}}),exports.Keymap=_browserkeymap2["default"]},{"./commands":4,"./main":11,"./options":12,"./range":13,"./selection":14,browserkeymap:52}],10:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function dispatchKey(pm,name,e){var seq=pm.input.keySeq;if(seq){if(_browserkeymap2["default"].isModifierKey(name))return!0;clearTimeout(stopSeq),stopSeq=setTimeout(function(){pm.input.keySeq==seq&&(pm.input.keySeq=null)},50),name=seq+" "+name}for(var handle=function handle(bound){if(bound===!1)return"nothing";if("..."==bound)return"multi";if(null==bound)return!1;var result=!1;if(Array.isArray(bound))for(var i=0;result===!1&&i<bound.length;i++)result=handle(bound[i]);else result="string"==typeof bound?pm.execCommand(bound):bound(pm);return 0==result?!1:"handled"},result=void 0,i=0;!result&&i<pm.input.keymaps.length;i++)result=handle(pm.input.keymaps[i].map.lookup(name,pm));return result||(result=handle(pm.input.baseKeymap.lookup(name,pm))||handle(_capturekeys.captureKeys.lookup(name))),"multi"==result&&(pm.input.keySeq=name),("handled"==result||"multi"==result)&&e.preventDefault(),seq&&!result&&/\'$/.test(name)?(e.preventDefault(),!0):!!result}function inputText(pm,range,text){if(range.empty&&!text)return!1;var marks=pm.input.storedMarks||pm.doc.marksAt(range.from);pm.tr.replaceWith(range.from,range.to,pm.schema.text(text,marks)).apply({scrollIntoView:!0}),pm.signal("textInput",text)}function selectClickedNode(pm,e){var pos=(0,_selection.selectableNodeAbove)(pm,e.target,{left:e.clientX,top:e.clientY},!0);if(!pos)return pm.sel.pollForUpdate();var _pm$selection=pm.selection,node=_pm$selection.node,from=_pm$selection.from;if(node&&pos.depth>=from.depth&&0==pos.shorten(from.depth).cmp(from)){if(0==from.depth)return pm.sel.pollForUpdate();pos=from.shorten()}pm.setNodeSelection(pos),pm.focus(),e.preventDefault()}function finishComposing(pm){var info=pm.input.composing,text=(0,_domchange.textInContext)(info.context,info.endData),range=(0,_selection.rangeFromDOMLoose)(pm);pm.ensureOperation(),pm.input.composing=null,text!=info.data&&inputText(pm,info.range,text),range&&!range.eq(pm.sel.range)&&pm.setSelectionDirect(range)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();exports.dispatchKey=dispatchKey;var _browserkeymap=require("browserkeymap"),_browserkeymap2=_interopRequireDefault(_browserkeymap),_model=require("../model"),_format=require("../format"),_dom=require("../dom"),_capturekeys=require("./capturekeys"),_domchange=require("./domchange"),_selection=require("./selection"),stopSeq=null,handlers={},Input=function(){function Input(pm){var _this=this;_classCallCheck(this,Input),this.pm=pm,this.baseKeymap=null,this.keySeq=null,this.composing=null,this.shiftKey=this.updatingComposition=!1,this.skipInput=0,this.draggingFrom=!1,this.keymaps=[],this.defaultKeymap=null,this.storedMarks=null,this.dropTarget=pm.wrapper.appendChild((0,_dom.elt)("div",{"class":"ProseMirror-drop-target"}));var _loop=function(_event){var handler=handlers[_event];pm.content.addEventListener(_event,function(e){return handler(pm,e)})};for(var _event in handlers)_loop(_event);pm.on("selectionChange",function(){return _this.storedMarks=null})}return _createClass(Input,[{key:"maybeAbortComposition",value:function(){if(this.composing&&!this.updatingComposition){if(this.composing.finished)finishComposing(this.pm);else{this.composing=null,this.skipInput++;var sel=getSelection();if(sel.rangeCount){var range=sel.getRangeAt(0);sel.removeAllRanges(),sel.addRange(range)}}return!0}}}]),Input}();exports.Input=Input,handlers.keydown=function(pm,e){if(16==e.keyCode&&(pm.input.shiftKey=!0),!pm.input.composing){
var name=_browserkeymap2["default"].keyName(e);name&&dispatchKey(pm,name,e)||pm.sel.pollForUpdate()}},handlers.keyup=function(pm,e){16==e.keyCode&&(pm.input.shiftKey=!1)},handlers.keypress=function(pm,e){if(!(pm.input.composing||!e.charCode||e.ctrlKey&&!e.altKey||_dom.browser.mac&&e.metaKey||dispatchKey(pm,_browserkeymap2["default"].keyName(e)))){var sel=pm.selection;sel.node&&null==sel.node.contains&&(pm.tr["delete"](sel.from,sel.to).apply(),sel=pm.selection),inputText(pm,sel,String.fromCharCode(e.charCode)),e.preventDefault()}};var lastClick=0,oneButLastClick=0;handlers.mousedown=function(pm,e){if(e.ctrlKey)return selectClickedNode(pm,e);pm.sel.pollForUpdate();var now=Date.now(),doubleClick=500>now-lastClick,tripleClick=600>now-oneButLastClick;if(oneButLastClick=lastClick,lastClick=now,tripleClick){e.preventDefault();var pos=(0,_selection.selectableNodeAbove)(pm,e.target,{left:e.clientX,top:e.clientY},!0);if(pos){var node=pm.doc.nodeAfter(pos);if(node.isBlock&&!node.isTextblock)pm.setNodeSelection(pos);else{var path=node.isInline?pos.path:pos.toPath();node.isInline&&(node=pm.doc.path(path)),pm.setTextSelection(new _model.Pos(path,0),new _model.Pos(path,node.size))}pm.focus()}}else{var leaveToBrowser=pm.input.shiftKey||doubleClick,x=e.clientX,y=e.clientY,up=function up(){if(removeEventListener("mouseup",up),removeEventListener("mousemove",move),!(0,_selection.handleNodeClick)(pm,e)){var pos=!leaveToBrowser&&(0,_selection.selectableNodeAbove)(pm,e.target,{left:e.clientX,top:e.clientY});pos?(pm.setNodeSelection(pos),pm.focus()):pm.sel.pollForUpdate()}},move=function(e){!leaveToBrowser&&(Math.abs(x-e.clientX)>4||Math.abs(y-e.clientY)>4)&&(leaveToBrowser=!0),pm.sel.pollForUpdate()};addEventListener("mouseup",up),addEventListener("mousemove",move)}},handlers.touchdown=function(pm){pm.sel.pollForUpdate()};var Composing=function Composing(pm,data){_classCallCheck(this,Composing),this.finished=!1,this.context=(0,_domchange.textContext)(data),this.data=data,this.endData=null;var range=pm.selection;if(data){var path=range.head.path,line=pm.doc.path(path).textContent,found=line.indexOf(data,range.head.offset-data.length);found>-1&&found<=range.head.offset+data.length&&(range=new _selection.TextSelection(new _model.Pos(path,found),new _model.Pos(path,found+data.length)))}this.range=range};handlers.compositionstart=function(pm,e){if(!pm.input.maybeAbortComposition()){pm.flush(),pm.input.composing=new Composing(pm,e.data);var above=pm.selection.head.shorten();pm.markRangeDirty({from:above,to:above.move(1)})}},handlers.compositionupdate=function(pm,e){var info=pm.input.composing;info&&info.data!=e.data&&(info.data=e.data,pm.input.updatingComposition=!0,inputText(pm,info.range,info.data),pm.input.updatingComposition=!1,info.range=new _selection.TextSelection(info.range.from,info.range.from.move(info.data.length)))},handlers.compositionend=function(pm,e){var info=pm.input.composing;info&&(pm.input.composing.finished=!0,pm.input.composing.endData=e.data,setTimeout(function(){pm.input.composing==info&&finishComposing(pm)},20))},handlers.input=function(pm){return pm.input.skipInput?--pm.input.skipInput:pm.input.composing?void(pm.input.composing.finished&&finishComposing(pm)):(pm.sel.stopPollingForUpdate(),(0,_domchange.applyDOMChange)(pm),void pm.scrollIntoView())};var lastCopied=null;handlers.copy=handlers.cut=function(pm,e){var _pm$selection2=pm.selection,from=_pm$selection2.from,to=_pm$selection2.to,empty=_pm$selection2.empty;if(!empty){var fragment=pm.selectedDoc;lastCopied={doc:pm.doc,from:from,to:to,html:(0,_format.toHTML)(fragment),text:(0,_format.toText)(fragment)},e.clipboardData&&(e.preventDefault(),e.clipboardData.clearData(),e.clipboardData.setData("text/html",lastCopied.html),e.clipboardData.setData("text/plain",lastCopied.text),"cut"!=e.type||empty||pm.tr["delete"](from,to).apply())}},handlers.paste=function(pm,e){if(e.clipboardData){var sel=pm.selection,txt=e.clipboardData.getData("text/plain"),html=e.clipboardData.getData("text/html");if(html||txt){e.preventDefault();var doc=void 0,from=void 0,to=void 0;if(pm.input.shiftKey&&txt)doc=(0,_format.fromText)(pm.schema,txt);else if(!lastCopied||lastCopied.html!=html&&lastCopied.text!=txt)doc=html?(0,_format.fromHTML)(pm.schema,html):(0,_format.parseFrom)(pm.schema,txt,(0,_format.knownSource)("markdown")?"markdown":"text");else{var _lastCopied=lastCopied;doc=_lastCopied.doc,from=_lastCopied.from,to=_lastCopied.to}pm.tr.replace(sel.from,sel.to,doc,from||(0,_selection.findSelectionAtStart)(doc).from,to||(0,_selection.findSelectionAtEnd)(doc).to).apply(),pm.scrollIntoView()}}},handlers.dragstart=function(pm,e){if(e.dataTransfer){var fragment=pm.selectedDoc;e.dataTransfer.setData("text/html",(0,_format.toHTML)(fragment)),e.dataTransfer.setData("text/plain",(0,_format.toText)(fragment)),pm.input.draggingFrom=!0}},handlers.dragend=function(pm){return window.setTimeout(function(){return pm.input.dragginFrom=!1},50)},handlers.dragover=handlers.dragenter=function(pm,e){e.preventDefault();var cursorPos=pm.posAtCoords({left:e.clientX,top:e.clientY});if(cursorPos){var coords=(0,_selection.coordsAtPos)(pm,cursorPos),rect=pm.wrapper.getBoundingClientRect();coords.top-=rect.top,coords.right-=rect.left,coords.bottom-=rect.top,coords.left-=rect.left;var target=pm.input.dropTarget;target.style.display="block",target.style.left=coords.left-1+"px",target.style.top=coords.top+"px",target.style.height=coords.bottom-coords.top+"px"}},handlers.dragleave=function(pm){return pm.input.dropTarget.style.display=""},handlers.drop=function(pm,e){if(pm.input.dropTarget.style.display="",e.dataTransfer){var html=void 0,txt=void 0,doc=void 0;if((html=e.dataTransfer.getData("text/html"))?doc=(0,_format.fromHTML)(pm.schema,html,{document:document}):(txt=e.dataTransfer.getData("text/plain"))&&(doc=(0,_format.parseFrom)(pm.schema,txt,(0,_format.knownSource)("markdown")?"markdown":"text")),doc){e.preventDefault();var insertPos=pm.posAtCoords({left:e.clientX,top:e.clientY});if(!insertPos)return;var tr=pm.tr;pm.input.draggingFrom&&!e.ctrlKey&&(tr.deleteSelection(),insertPos=tr.map(insertPos).pos),tr.replace(insertPos,insertPos,doc,(0,_selection.findSelectionAtStart)(doc).from,(0,_selection.findSelectionAtEnd)(doc).to).apply(),pm.setTextSelection(insertPos,tr.map(insertPos).pos),pm.focus()}}},handlers.focus=function(pm){(0,_dom.addClass)(pm.wrapper,"ProseMirror-focused"),pm.signal("focus")},handlers.blur=function(pm){(0,_dom.rmClass)(pm.wrapper,"ProseMirror-focused"),pm.signal("blur")}},{"../dom":1,"../format":17,"../model":31,"./capturekeys":2,"./domchange":6,"./selection":14,browserkeymap:52}],11:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _get=function(_x4,_x5,_x6){for(var _again=!0;_again;){var object=_x4,property=_x5,receiver=_x6;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x4=parent,_x5=property,_x6=receiver,_again=!0,desc=parent=void 0}},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();require("./css");var _browserkeymap=require("browserkeymap"),_browserkeymap2=_interopRequireDefault(_browserkeymap),_model=require("../model"),_transform=require("../transform"),_utilSortedinsert=require("../util/sortedinsert"),_utilSortedinsert2=_interopRequireDefault(_utilSortedinsert),_utilError=require("../util/error"),_utilMap=require("../util/map"),_utilEvent=require("../util/event"),_dom=require("../dom"),_format=require("../format"),_options=require("./options"),_selection2=require("./selection"),_draw=require("./draw"),_input=require("./input"),_history=require("./history"),_commands=require("./commands"),_range=require("./range"),ProseMirror=function(){function ProseMirror(opts){_classCallCheck(this,ProseMirror),(0,_dom.ensureCSSAdded)(),opts=this.options=(0,_options.parseOptions)(opts),this.schema=opts.schema,null==opts.doc&&(opts.doc=this.schema.node("doc",null,[this.schema.node("paragraph")])),this.content=(0,_dom.elt)("div",{"class":"ProseMirror-content"}),this.wrapper=(0,_dom.elt)("div",{"class":"ProseMirror"},this.content),this.wrapper.ProseMirror=this,opts.place&&opts.place.appendChild?opts.place.appendChild(this.wrapper):opts.place&&opts.place(this.wrapper),this.setDocInner(opts.docFormat?(0,_format.parseFrom)(this.schema,opts.doc,opts.docFormat):opts.doc),(0,_draw.draw)(this,this.doc),this.content.contentEditable=!0,opts.label&&this.content.setAttribute("aria-label",opts.label),this.mod=Object.create(null),this.operation=null,this.dirtyNodes=new _utilMap.Map,this.flushScheduled=!1,this.sel=new _selection2.SelectionState(this),this.accurateSelection=!1,this.input=new _input.Input(this),this.commands=null,this.commandKeys=null,this.updateCommands(),(0,_options.initOptions)(this)}return _createClass(ProseMirror,[{key:"setOption",value:function(name,value){(0,_options.setOption)(this,name,value),this.signal("optionChanged",name,value)}},{key:"getOption",value:function(name){return this.options[name]}},{key:"updateCommands",value:function(){this.signal("commandsChanging"),this.commands=(0,_commands.deriveCommands)(this),this.input.baseKeymap=(0,_commands.deriveKeymap)(this),this.commandKeys=Object.create(null),this.signal("commandsChanged")}},{key:"isIncluded",value:function(name){for(var i=0;i<this.options.include.length;i++){var ns=this.options.include[i],match="default"==ns?-1==name.indexOf(":"):name==ns||0==name.indexOf(ns)&&":"==name.charAt(ns.length);if(match)return!0}}},{key:"setTextSelection",value:function(anchor,head){this.setSelection(new _selection2.TextSelection(anchor,head))}},{key:"setNodeSelection",value:function(pos){this.checkPos(pos,!1);var parent=this.doc.path(pos.path);pos.offset>=parent.size&&_selection2.SelectionError.raise("Trying to set a node selection at the end of a node");var node=parent.child(pos.offset);node.type.selectable||_selection2.SelectionError.raise("Trying to select a non-selectable node"),this.input.maybeAbortComposition(),this.sel.setAndSignal(new _selection2.NodeSelection(pos,pos.move(1),node))}},{key:"setSelection",value:function(selection){selection instanceof _selection2.TextSelection?(this.checkPos(selection.head,!0),selection.empty||this.checkPos(selection.anchor,!0)):this.checkPos(selection.to,!1),this.setSelectionDirect(selection)}},{key:"setSelectionDirect",value:function(selection){this.ensureOperation(),this.input.maybeAbortComposition(),selection.eq(this.sel.range)||this.sel.setAndSignal(selection)}},{key:"setContent",value:function(value,format){format&&(value=(0,_format.parseFrom)(this.schema,value,format)),this.setDoc(value)}},{key:"getContent",value:function(format){return format?(0,_format.serializeTo)(this.doc,format):this.doc}},{key:"setDocInner",value:function(doc){doc.type!=this.schema.nodes.doc&&_utilError.AssertionError.raise("Trying to set a document with a different schema"),this.doc=doc,this.ranges=new _range.RangeStore(this),this.history=new _history.History(this)}},{key:"setDoc",value:function(doc,sel){sel||(sel=(0,_selection2.findSelectionAtStart)(doc)),this.signal("beforeSetDoc",doc,sel),this.ensureOperation(),this.setDocInner(doc),this.sel.set(sel,!0),this.signal("setDoc",doc,sel)}},{key:"updateDoc",value:function(doc,mapping,selection){this.ensureOperation(),this.input.maybeAbortComposition(),this.ranges.transform(mapping),this.doc=doc,this.sel.setAndSignal(selection||this.sel.range.map(doc,mapping)),this.signal("change")}},{key:"apply",value:function(transform){var options=arguments.length<=1||void 0===arguments[1]?nullOptions:arguments[1];return transform.doc==this.doc?!1:(transform.docs[0]!=this.doc&&(0,_model.findDiffStart)(transform.docs[0],this.doc)&&_utilError.AssertionError.raise("Applying a transform that does not start with the current document"),this.updateDoc(transform.doc,transform,options.selection),this.signal("transform",transform,options),options.scrollIntoView&&this.scrollIntoView(),transform)}},{key:"checkPos",value:function(pos,textblock){this.doc.isValidPos(pos,textblock)||_utilError.AssertionError.raise("Position "+pos+" is not valid in current document")}},{key:"ensureOperation",value:function(){return this.operation||this.startOperation()}},{key:"startOperation",value:function(){var _this=this;return this.sel.beforeStartOp(),this.operation=new Operation(this),this.flushScheduled||((0,_dom.requestAnimationFrame)(function(){_this.flushScheduled=!1,_this.flush()}),this.flushScheduled=!0),this.operation}},{key:"flush",value:function(){if(document.body.contains(this.wrapper)&&this.operation){this.signal("flushing");var op=this.operation;if(op){this.operation=null,this.accurateSelection=!0;var docChanged=op.doc!=this.doc||this.dirtyNodes.size,redrawn=!1;this.input.composing||!docChanged&&!op.composingAtStart||((0,_draw.redraw)(this,this.dirtyNodes,this.doc,op.doc),this.dirtyNodes.clear(),redrawn=!0),!redrawn&&op.sel.eq(this.sel.range)||this.input.composing||this.sel.toDOM(op.focus),op.scrollIntoView!==!1&&(0,_selection2.scrollIntoView)(this,op.scrollIntoView),docChanged&&this.signal("draw"),this.signal("flush"),this.signal("flushed"),this.accurateSelection=!1}}}},{key:"addKeymap",value:function(map){var rank=arguments.length<=1||void 0===arguments[1]?50:arguments[1];(0,_utilSortedinsert2["default"])(this.input.keymaps,{map:map,rank:rank},function(a,b){return a.rank-b.rank})}},{key:"removeKeymap",value:function(map){for(var maps=this.input.keymaps,i=0;i<maps.length;++i)if(maps[i].map==map||maps[i].map.options.name==map)return maps.splice(i,1),!0}},{key:"markRange",value:function(from,to,options){this.checkPos(from),this.checkPos(to);var range=new _range.MarkedRange(from,to,options);return this.ranges.addRange(range),range}},{key:"removeRange",value:function(range){this.ranges.removeRange(range)}},{key:"setMark",value:function(type,to,attrs){var sel=this.selection;if(sel.empty){var marks=this.activeMarks();if(null==to&&(to=!type.isInSet(marks)),to&&!this.doc.path(sel.head.path).type.canContainMark(type))return;this.input.storedMarks=to?type.create(attrs).addToSet(marks):type.removeFromSet(marks),this.signal("activeMarkChange")}else(null!=to?to:!this.doc.rangeHasMark(sel.from,sel.to,type))?this.apply(this.tr.addMark(sel.from,sel.to,type.create(attrs))):this.apply(this.tr.removeMark(sel.from,sel.to,type))}},{key:"activeMarks",value:function(){var head;return this.input.storedMarks||((head=this.selection.head)?this.doc.marksAt(head):[])}},{key:"focus",value:function(){this.operation?this.operation.focus=!0:this.sel.toDOM(!0)}},{key:"hasFocus",value:function(){return this.sel.range instanceof _selection2.NodeSelection?document.activeElement==this.content:(0,_selection2.hasFocus)(this)}},{key:"posAtCoords",value:function(coords){return(0,_selection2.posAtCoords)(this,coords)}},{key:"coordsAtPos",value:function(pos){return this.checkPos(pos),(0,_selection2.coordsAtPos)(this,pos)}},{key:"scrollIntoView",value:function(){var pos=arguments.length<=0||void 0===arguments[0]?null:arguments[0];pos&&this.checkPos(pos),this.ensureOperation(),this.operation.scrollIntoView=pos}},{key:"execCommand",value:function(name,params){var cmd=this.commands[name];return!(!cmd||cmd.exec(this,params)===!1)}},{key:"keyForCommand",value:function(name){var cached=this.commandKeys[name];if(void 0!==cached)return cached;var cmd=this.commands[name],keymap=this.input.baseKeymap;if(!cmd)return this.commandKeys[name]=null;var key=cmd.spec.key||(_dom.browser.mac?cmd.spec.macKey:cmd.spec.pcKey);if(key){key=_browserkeymap2["default"].normalizeKeyName(Array.isArray(key)?key[0]:key);var deflt=keymap.bindings[key];if(Array.isArray(deflt)?deflt.indexOf(name)>-1:deflt==name)return this.commandKeys[name]=key}for(var _key in keymap.bindings){var bound=keymap.bindings[_key];if(Array.isArray(bound)?bound.indexOf(name)>-1:bound==name)return this.commandKeys[name]=_key}return this.commandKeys[name]=null}},{key:"markRangeDirty",value:function(range){this.ensureOperation();for(var dirty=this.dirtyNodes,from=range.from,to=range.to,depth=0,node=this.doc;;depth++){var fromEnd=depth==from.depth,toEnd=depth==to.depth;if(fromEnd||toEnd||from.path[depth]!=to.path[depth]){var _ret=function(){var start=fromEnd?from.offset:from.path[depth],end=toEnd?to.offset:to.path[depth]+1;if(node.isTextblock)node.forEach(function(child,cStart,cEnd){end>cStart&&cEnd>start&&dirty.set(child,DIRTY_REDRAW)});else for(var i=node.iter(start,end),child=void 0;child=i.next().value;)dirty.set(child,DIRTY_REDRAW);return"break"}();if("break"===_ret)break}else{var child=node.child(from.path[depth]);dirty.has(child)||dirty.set(child,DIRTY_RESCAN),node=child}}}},{key:"selection",get:function(){return this.accurateSelection||this.ensureOperation(),this.sel.range}},{key:"tr",get:function(){return new EditorTransform(this)}},{key:"selectedDoc",get:function(){var sel=this.selection;return this.doc.sliceBetween(sel.from,sel.to)}},{key:"selectedText",get:function(){return(0,_format.toText)(this.selectedDoc)}}]),ProseMirror}();exports.ProseMirror=ProseMirror;var DIRTY_RESCAN=1,DIRTY_REDRAW=2;exports.DIRTY_RESCAN=DIRTY_RESCAN,exports.DIRTY_REDRAW=DIRTY_REDRAW;var nullOptions={};(0,_utilEvent.eventMixin)(ProseMirror);var Operation=function Operation(pm){_classCallCheck(this,Operation),this.doc=pm.doc,this.sel=pm.sel.range,this.scrollIntoView=!1,this.focus=!1,this.composingAtStart=!!pm.input.composing},EditorTransform=function(_Transform){function EditorTransform(pm){_classCallCheck(this,EditorTransform),_get(Object.getPrototypeOf(EditorTransform.prototype),"constructor",this).call(this,pm.doc),this.pm=pm}return _inherits(EditorTransform,_Transform),_createClass(EditorTransform,[{key:"apply",value:function(options){return this.pm.apply(this,options)}},{key:"replaceSelection",value:function(node,inheritMarks){var _selection=this.selection,empty=_selection.empty,from=_selection.from,to=_selection.to,selNode=_selection.node,parent=void 0;if(node&&node.isInline&&inheritMarks!==!1){var marks=empty?this.pm.input.storedMarks:this.doc.marksAt(from);node=node.type.create(node.attrs,node.text,marks)}if(selNode&&selNode.isTextblock&&node&&node.isInline)from=new _model.Pos(from.toPath(),0),to=new _model.Pos(from.path,selNode.size);else if(selNode)for(;from.depth&&0==from.offset&&(parent=this.doc.path(from.path))&&from.offset==parent.size-1&&!parent.type.canBeEmpty&&(!node||!parent.type.canContain(node));)from=from.shorten(),to=to.shorten(null,1);else if(node&&node.isBlock&&this.doc.path(from.path.slice(0,from.depth-1)).type.canContain(node)){this["delete"](from,to);var _parent=this.doc.path(from.path);return from.offset&&from.offset!=_parent.size&&this.split(from),this.insert(from.shorten(null,from.offset?1:0),node)}return node?this.replaceWith(from,to,node):this["delete"](from,to)}},{key:"deleteSelection",value:function(){return this.replaceSelection()}},{key:"typeText",value:function(text){return this.replaceSelection(this.pm.schema.text(text),!0)}},{key:"selection",get:function(){return this.steps.length?this.pm.selection.map(this):this.pm.selection}}]),EditorTransform}(_transform.Transform)},{"../dom":1,"../format":17,"../model":31,"../transform":37,"../util/error":48,"../util/event":49,"../util/map":50,"../util/sortedinsert":51,"./commands":4,"./css":5,"./draw":7,"./history":8,"./input":10,"./options":12,"./range":13,"./selection":14,browserkeymap:52}],12:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function defineOption(name,defaultValue,update,updateOnInit){options[name]=new Option(defaultValue,update,updateOnInit)}function parseOptions(obj){var result=Object.create(null),given=obj?[obj].concat(obj.use||[]):[];outer:for(var opt in options){for(var i=0;i<given.length;i++)if(opt in given[i]){result[opt]=given[i][opt];continue outer}result[opt]=options[opt].defaultValue}return result}function initOptions(pm){for(var opt in options){var desc=options[opt];desc.update&&desc.updateOnInit&&desc.update(pm,pm.options[opt],null,!0)}}function setOption(pm,name,value){var desc=options[name];desc.update===!1&&_utilError.AssertionError.raise("Option '"+name+"' can not be changed");var old=pm.options[name];pm.options[name]=value,desc.update&&desc.update(pm,value,old,!1)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.defineOption=defineOption,exports.parseOptions=parseOptions,exports.initOptions=initOptions,exports.setOption=setOption;var _model=require("../model"),_utilError=require("../util/error"),Option=function Option(defaultValue,update,updateOnInit){_classCallCheck(this,Option),this.defaultValue=defaultValue,this.update=update,this.updateOnInit=updateOnInit!==!1},options=Object.create(null);defineOption("schema",_model.defaultSchema,!1),defineOption("doc",null,function(pm,value){return pm.setDoc(value)},!1),defineOption("docFormat",null),defineOption("place",null),defineOption("historyDepth",100),defineOption("historyEventDelay",500),defineOption("commands",{},function(pm){return pm.updateCommands()},!1),defineOption("include",["default","schema"],function(pm){return pm.updateCommands()},!1),defineOption("commandParamHandler","default"),defineOption("label",null)},{"../model":31,"../util/error":48}],13:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_utilEvent=require("../util/event"),MarkedRange=function(){function MarkedRange(from,to,options){_classCallCheck(this,MarkedRange),this.options=options||{},this.from=from,this.to=to}return _createClass(MarkedRange,[{key:"remove",value:function(){this.signal("removed",this.from,this.to.max(this.from)),this.from=this.to=null}}]),MarkedRange}();exports.MarkedRange=MarkedRange,(0,_utilEvent.eventMixin)(MarkedRange);var RangeSorter=function(){function RangeSorter(){_classCallCheck(this,RangeSorter),this.sorted=[]}return _createClass(RangeSorter,[{key:"find",value:function(at){for(var min=0,max=this.sorted.length;;){if(min+10>max){for(var i=min;max>i;i++)if(this.sorted[i].at.cmp(at)>=0)return i;return max}var mid=min+max>>1;this.sorted[mid].at.cmp(at)>0?max=mid:min=mid}}},{key:"insert",value:function(obj){this.sorted.splice(this.find(obj.at),0,obj)}},{key:"remove",value:function(at,range){for(var pos=this.find(at),dist=0;;dist++){var leftPos=pos-dist-1,rightPos=pos+dist;if(leftPos>=0&&this.sorted[leftPos].range==range)return void this.sorted.splice(leftPos,1);if(rightPos<this.sorted.length&&this.sorted[rightPos].range==range)return void this.sorted.splice(rightPos,1)}}},{key:"resort",value:function(){for(var i=0;i<this.sorted.length;i++)for(var cur=this.sorted[i],at=cur.at="open"==cur.type?cur.range.from:cur.range.to,pos=i;pos>0&&this.sorted[pos-1].at.cmp(at)>0;)this.sorted[pos]=this.sorted[pos-1],this.sorted[--pos]=cur}}]),RangeSorter}(),RangeStore=function(){function RangeStore(pm){_classCallCheck(this,RangeStore),this.pm=pm,this.ranges=[],this.sorted=new RangeSorter}return _createClass(RangeStore,[{key:"addRange",value:function(range){this.ranges.push(range),this.sorted.insert({type:"open",at:range.from,range:range}),this.sorted.insert({type:"close",at:range.to,range:range}),this.pm.markRangeDirty(range)}},{key:"removeRange",value:function(range){var found=this.ranges.indexOf(range);found>-1&&(this.ranges.splice(found,1),this.sorted.remove(range.from,range),this.sorted.remove(range.to,range),this.pm.markRangeDirty(range),range.remove())}},{key:"transform",value:function(mapping){for(var i=0;i<this.ranges.length;i++){var range=this.ranges[i];range.from=mapping.map(range.from,range.options.inclusiveLeft?-1:1).pos,range.to=mapping.map(range.to,range.options.inclusiveRight?1:-1).pos;var diff=range.from.cmp(range.to);range.options.removeWhenEmpty!==!1&&diff>=0?(this.removeRange(range),i--):diff>0&&(range.to=range.from)}this.sorted.resort()}},{key:"activeRangeTracker",value:function(){return new RangeTracker(this.sorted.sorted)}}]),RangeStore}();exports.RangeStore=RangeStore;var RangeTracker=function(){function RangeTracker(sorted){_classCallCheck(this,RangeTracker),this.sorted=sorted,this.pos=0,this.current=[]}return _createClass(RangeTracker,[{key:"advanceTo",value:function(pos){for(var next=void 0;this.pos<this.sorted.length&&(next=this.sorted[this.pos]).at.cmp(pos)<=0;){var className=next.range.options.className;className&&("open"==next.type?this.current.push(className):this.current.splice(this.current.indexOf(className),1),this.pos++)}}},{key:"nextChangeBefore",value:function(pos){for(;;){if(this.pos==this.sorted.length)return null;var next=this.sorted[this.pos];if(next.range.options.className)return next.at.cmp(pos)>=0?null:next.at.offset;this.pos++}}}]),RangeTracker}()},{"../util/event":49}],14:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function clearNodeSelection(dom){dom.classList.remove("ProseMirror-selectednode")}function addNodeSelection(_node,dom){dom.classList.add("ProseMirror-selectednode")}function windowRect(){return{left:0,right:window.innerWidth,top:0,bottom:window.innerHeight}}function pathFromDOM(pm,node){for(var path=[];node!=pm.content;){var attr=node.getAttribute("pm-offset");attr&&path.unshift(+attr),node=node.parentNode}return path}function widthFromDOM(dom){var attr=dom.getAttribute("pm-leaf");return attr&&"true"!=attr?+attr:1}function posFromDOMInner(pm,dom,domOffset,loose){!loose&&pm.operation&&pm.doc!=pm.operation.doc&&_utilError.AssertionError.raise("Fetching a position from an outdated DOM structure");for(var extraOffset=0,tag=void 0;;){var adjust=0;if(3==dom.nodeType)extraOffset+=domOffset;else{if(dom.hasAttribute("pm-offset")||dom==pm.content)break;(tag=dom.getAttribute("pm-inner-offset"))?(extraOffset+=+tag,adjust=-1):domOffset&&domOffset==dom.childNodes.length&&(adjust=1)}var _parent=dom.parentNode;domOffset=0>adjust?0:Array.prototype.indexOf.call(_parent.childNodes,dom)+adjust,dom=_parent}var path=pathFromDOM(pm,dom);if(dom.hasAttribute("pm-leaf"))return _model.Pos.from(path,extraOffset+(domOffset?1:0));for(var offset=0,i=domOffset-1;i>=0;i--){var child=dom.childNodes[i];if(3==child.nodeType)loose&&(extraOffset+=child.nodeValue.length);else{if(tag=child.getAttribute("pm-offset")){offset=+tag+widthFromDOM(child);break}loose&&!child.hasAttribute("pm-ignore")&&(extraOffset+=child.textContent.length)}}return new _model.Pos(path,offset+extraOffset)}function posFromDOM(pm,node,offset){return null==offset&&(offset=Array.prototype.indexOf.call(node.parentNode.childNodes,node),node=node.parentNode),posFromDOMInner(pm,node,offset)}function rangeFromDOMLoose(pm){if(!hasFocus(pm))return null;var sel=getSelection();return new TextSelection(posFromDOMInner(pm,sel.anchorNode,sel.anchorOffset,!0),posFromDOMInner(pm,sel.focusNode,sel.focusOffset,!0))}function findByPath(node,n,fromEnd){for(var ch=fromEnd?node.lastChild:node.firstChild;ch;ch=fromEnd?ch.previousSibling:ch.nextSibling)if(1==ch.nodeType){var offset=ch.getAttribute("pm-offset");if(offset){if(+offset==n)return ch}else{var found=findByPath(ch,n);if(found)return found}}}function resolvePath(parent,path){for(var node=parent,i=0;i<path.length;i++)node=findByPath(node,path[i]),node||SelectionError.raise("Failed to resolve path "+path.join("/"));return node}function findByOffset(node,offset,after){function search(node){for(var ch=node.firstChild,i=0,attr=void 0;ch;ch=ch.nextSibling,i++)if(1==ch.nodeType)if(attr=ch.getAttribute("pm-offset")){var diff=offset-+attr,width=widthFromDOM(ch);if(diff>=0&&(after?width>=diff:width>diff))return{node:ch,offset:i,innerOffset:diff}}else{var result=search(ch);if(result)return result}}return search(node)}function leafAt(node,offset){for(;;){var child=node.firstChild;if(!child)return{node:node,offset:offset};if(1!=child.nodeType)return{node:child,offset:offset};if(child.hasAttribute("pm-inner-offset")){for(var nodeOffset=0;;){var nextSib=child.nextSibling,nextOffset=void 0;if(!nextSib||(nextOffset=+nextSib.getAttribute("pm-inner-offset"))>=offset)break;child=nextSib,nodeOffset=nextOffset}offset-=nodeOffset}node=child}}function DOMFromPos(parent,pos){var dom=resolvePath(parent,pos.path),found=findByOffset(dom,pos.offset,!0),inner=void 0;return found?"true"!=found.node.getAttribute("pm-leaf")&&(inner=leafAt(found.node,found.innerOffset))?inner:{node:found.node.parentNode,offset:found.offset+(found.innerOffset?1:0)}:{node:dom,offset:0}}function hasFocus(pm){var sel=window.getSelection();return sel.rangeCount&&(0,_dom.contains)(pm.content,sel.anchorNode)}function findOffsetInNode(_x4,_x5){for(var _again2=!0;_again2;){var node=_x4,coords=_x5;_again2=!1;for(var closest=void 0,dyClosest=1e8,coordsClosest=void 0,offset=0,child=node.firstChild,i=0;child;child=child.nextSibling,i++){var rects=void 0;if(1==child.nodeType)rects=child.getClientRects();else{if(3!=child.nodeType)continue;rects=textRects(child)}for(var _i=0;_i<rects.length;_i++){var rect=rects[_i];if(rect.left<=coords.left&&rect.right>=coords.left){var dy=rect.top>coords.top?rect.top-coords.top:rect.bottom<coords.top?coords.top-rect.bottom:0;if(dyClosest>dy){closest=child,dyClosest=dy,coordsClosest=dy?{left:coords.left,top:rect.top}:coords,1!=child.nodeType||child.firstChild||(offset=_i+(coords.left>=(rect.left+rect.right)/2?1:0));continue}}!closest&&(coords.top>=rect.bottom||coords.top>=rect.top&&coords.left>=rect.right)&&(offset=_i+1)}}if(!closest)return{node:node,offset:offset};if(3==closest.nodeType)return findOffsetInText(closest,coordsClosest);if(!closest.firstChild)return{node:node,offset:offset
};_x4=closest,_x5=coordsClosest,_again2=!0,closest=dyClosest=coordsClosest=offset=child=i=rects=_i=rect=dy=void 0}}function findOffsetInText(node,coords){for(var len=node.nodeValue.length,range=document.createRange(),i=0;len>i;i++){range.setEnd(node,i+1),range.setStart(node,i);var rect=range.getBoundingClientRect();if(rect.top!=rect.bottom&&rect.left<=coords.left&&rect.right>=coords.left&&rect.top<=coords.top&&rect.bottom>=coords.top)return{node:node,offset:i+(coords.left>=(rect.left+rect.right)/2?1:0)}}return{node:node,offset:0}}function posAtCoords(pm,coords){var elt=document.elementFromPoint(coords.left,coords.top+1);if(!(0,_dom.contains)(pm.content,elt))return null;elt.firstChild||(elt=elt.parentNode);var _findOffsetInNode=findOffsetInNode(elt,coords),node=_findOffsetInNode.node,offset=_findOffsetInNode.offset;return posFromDOM(pm,node,offset)}function textRect(node,from,to){var range=document.createRange();return range.setEnd(node,to),range.setStart(node,from),range.getBoundingClientRect()}function textRects(node){var range=document.createRange();return range.setEnd(node,node.nodeValue.length),range.setStart(node,0),range.getClientRects()}function coordsAtPos(pm,pos){var _DOMFromPos=DOMFromPos(pm.content,pos),node=_DOMFromPos.node,offset=_DOMFromPos.offset,side=void 0,rect=void 0;if(3==node.nodeType)offset<node.nodeValue.length&&(rect=textRect(node,offset,offset+1),side="left"),rect&&rect.left!=rect.right||!offset||(rect=textRect(node,offset-1,offset),side="right");else if(node.firstChild){if(offset<node.childNodes.length){var child=node.childNodes[offset];rect=3==child.nodeType?textRect(child,0,child.nodeValue.length):child.getBoundingClientRect(),side="left"}if((!rect||rect.left==rect.right)&&offset){var child=node.childNodes[offset-1];rect=3==child.nodeType?textRect(child,0,child.nodeValue.length):child.getBoundingClientRect(),side="right"}}else rect=node.getBoundingClientRect(),side="left";var x=rect[side];return{top:rect.top,bottom:rect.bottom,left:x,right:x}}function scrollIntoView(pm,pos){pos||(pos=pm.sel.range.head||pm.sel.range.from);for(var coords=coordsAtPos(pm,pos),_parent2=pm.content;;_parent2=_parent2.parentNode){var atBody=_parent2==document.body,rect=atBody?windowRect():_parent2.getBoundingClientRect(),moveX=0,moveY=0;if(coords.top<rect.top?moveY=-(rect.top-coords.top+scrollMargin):coords.bottom>rect.bottom&&(moveY=coords.bottom-rect.bottom+scrollMargin),coords.left<rect.left?moveX=-(rect.left-coords.left+scrollMargin):coords.right>rect.right&&(moveX=coords.right-rect.right+scrollMargin),moveX||moveY?atBody&&window.scrollBy(moveX,moveY):(moveY&&(_parent2.scrollTop+=moveY),moveX&&(_parent2.scrollLeft+=moveX)),atBody)break}}function findSelectionIn(doc,path,offset,dir,text){var node=doc.path(path);if(node.isTextblock)return new TextSelection(new _model.Pos(path,offset));for(var i=offset+(dir>0?0:-1);dir>0?i<node.size:i>=0;i+=dir){var child=node.child(i);if(!text&&null==child.type.contains&&child.type.selectable)return new NodeSelection(new _model.Pos(path,i),new _model.Pos(path,i+1),child);path.push(i);var inside=findSelectionIn(doc,path,0>dir?child.size:0,dir,text);if(inside)return inside;path.pop()}}function findSelectionFrom(doc,pos,dir,text){for(var path=pos.path.slice(),offset=pos.offset;;){var found=findSelectionIn(doc,path,offset,dir,text);if(found)return found;if(!path.length)break;offset=path.pop()+(dir>0?1:0)}}function findSelectionNear(doc,pos,bias,text){void 0===bias&&(bias=1);var result=findSelectionFrom(doc,pos,bias,text)||findSelectionFrom(doc,pos,-bias,text);return result||SelectionError("Searching for selection in invalid document "+doc),result}function findSelectionAtStart(node,path,text){return void 0===path&&(path=[]),findSelectionIn(node,path.slice(),0,1,text)}function findSelectionAtEnd(node,path,text){return void 0===path&&(path=[]),findSelectionIn(node,path.slice(),node.size,-1,text)}function selectableNodeAbove(pm,dom,coords,liberal){for(;dom&&dom!=pm.content;dom=dom.parentNode)if(dom.hasAttribute("pm-offset")){var path=pathFromDOM(pm,dom),node=pm.doc.path(path);if(node.type.countCoordsAsChild){var result=node.type.countCoordsAsChild(node,path,dom,coords);if(result)return result}if((liberal||null==node.type.contains)&&node.type.selectable)return _model.Pos.from(path);if(!liberal)return null}}function handleNodeClick(pm,event){for(var dom=event.target;dom&&dom!=pm.content;dom=dom.parentNode)if(dom.hasAttribute("pm-offset")){var path=pathFromDOM(pm,dom),node=pm.doc.path(path);return node.type.handleClick&&node.type.handleClick(pm,event,path,node)!==!1}}function verticalMotionLeavesTextblock(pm,pos,dir){for(var dom=resolvePath(pm.content,pos.path),coords=coordsAtPos(pm,pos),child=dom.firstChild;child;child=child.nextSibling)if(1==child.nodeType)for(var boxes=child.getClientRects(),i=0;i<boxes.length;i++){var box=boxes[i];if(0>dir?box.bottom<coords.top:box.top>coords.bottom)return!1}return!0}function setDOMSelectionToPos(pm,pos){var _DOMFromPos2=DOMFromPos(pm.content,pos),node=_DOMFromPos2.node,offset=_DOMFromPos2.offset,range=document.createRange();range.setEnd(node,offset),range.setStart(node,offset);var sel=getSelection();sel.removeAllRanges(),sel.addRange(range)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}};exports.posFromDOM=posFromDOM,exports.rangeFromDOMLoose=rangeFromDOMLoose,exports.findByPath=findByPath,exports.resolvePath=resolvePath,exports.hasFocus=hasFocus,exports.posAtCoords=posAtCoords,exports.coordsAtPos=coordsAtPos,exports.scrollIntoView=scrollIntoView,exports.findSelectionFrom=findSelectionFrom,exports.findSelectionNear=findSelectionNear,exports.findSelectionAtStart=findSelectionAtStart,exports.findSelectionAtEnd=findSelectionAtEnd,exports.selectableNodeAbove=selectableNodeAbove,exports.handleNodeClick=handleNodeClick,exports.verticalMotionLeavesTextblock=verticalMotionLeavesTextblock,exports.setDOMSelectionToPos=setDOMSelectionToPos;var _model=require("../model"),_utilError=require("../util/error"),_dom=require("../dom"),SelectionError=function(_ProseMirrorError){function SelectionError(){_classCallCheck(this,SelectionError),_get(Object.getPrototypeOf(SelectionError.prototype),"constructor",this).apply(this,arguments)}return _inherits(SelectionError,_ProseMirrorError),SelectionError}(_utilError.ProseMirrorError);exports.SelectionError=SelectionError;var SelectionState=function(){function SelectionState(pm){var _this=this;_classCallCheck(this,SelectionState),this.pm=pm,this.range=findSelectionAtStart(pm.doc),this.lastNonNodePos=null,this.pollState=null,this.pollTimeout=null,this.lastAnchorNode=this.lastHeadNode=this.lastAnchorOffset=this.lastHeadOffset=null,this.lastNode=null,pm.content.addEventListener("focus",function(){return _this.receivedFocus()})}return _createClass(SelectionState,[{key:"setAndSignal",value:function(range,clearLast){this.set(range,clearLast),this.pm.signal("selectionChange")}},{key:"set",value:function(range,clearLast){this.range=range,range.node||(this.lastNonNodePos=null),clearLast!==!1&&(this.lastAnchorNode=null)}},{key:"pollForUpdate",value:function(){var _this2=this;if(!this.pm.input.composing){clearTimeout(this.pollTimeout),this.pollState="update";var n=0,check=function check(){_this2.pm.input.composing||(_this2.pm.operation?_this2.pollTimeout=setTimeout(check,20):_this2.readUpdate()||1!=++n?_this2.stopPollingForUpdate():_this2.pollTimeout=setTimeout(check,50))};this.pollTimeout=setTimeout(check,20)}}},{key:"stopPollingForUpdate",value:function(){"update"==this.pollState&&(this.pollState=null,this.pollToSync())}},{key:"domChanged",value:function(){var sel=getSelection();return sel.anchorNode!=this.lastAnchorNode||sel.anchorOffset!=this.lastAnchorOffset||sel.focusNode!=this.lastHeadNode||sel.focusOffset!=this.lastHeadOffset}},{key:"storeDOMState",value:function(){var sel=getSelection();this.lastAnchorNode=sel.anchorNode,this.lastAnchorOffset=sel.anchorOffset,this.lastHeadNode=sel.focusNode,this.lastHeadOffset=sel.focusOffset}},{key:"readUpdate",value:function(){if(this.pm.input.composing||!hasFocus(this.pm)||!this.domChanged())return!1;var sel=getSelection(),doc=this.pm.doc,anchor=posFromDOMInner(this.pm,sel.anchorNode,sel.anchorOffset),head=posFromDOMInner(this.pm,sel.focusNode,sel.focusOffset),newSel=findSelectionNear(doc,head,this.range.head&&this.range.head.cmp(head)<0?-1:1);return newSel instanceof TextSelection&&doc.path(anchor.path).isTextblock&&(newSel=new TextSelection(anchor,newSel.head)),this.setAndSignal(newSel),newSel instanceof NodeSelection||newSel.head.cmp(head)||newSel.anchor.cmp(anchor)?this.toDOM():(this.clearNode(),this.storeDOMState()),!0}},{key:"pollToSync",value:function(){var _this3=this;if(!this.pollState){this.pollState="sync";var sync=function sync(){document.activeElement!=_this3.pm.content?_this3.pollState=null:(_this3.pm.operation||_this3.pm.input.composing||_this3.syncDOM(),_this3.pollTimeout=setTimeout(sync,200))};this.pollTimeout=setTimeout(sync,200)}}},{key:"syncDOM",value:function(){!this.pm.input.composing&&hasFocus(this.pm)&&this.domChanged()&&this.toDOM()}},{key:"toDOM",value:function(takeFocus){this.range instanceof NodeSelection?this.nodeToDOM(takeFocus):this.rangeToDOM(takeFocus)}},{key:"nodeToDOM",value:function(takeFocus){window.getSelection().removeAllRanges(),takeFocus&&this.pm.content.focus();var pos=this.range.from,node=this.range.node,dom=resolvePath(this.pm.content,pos.toPath());dom!=this.lastNode&&(this.clearNode(),addNodeSelection(node,dom),this.lastNode=dom)}},{key:"clearNode",value:function(){return this.lastNode?(clearNodeSelection(this.lastNode),this.lastNode=null,!0):void 0}},{key:"rangeToDOM",value:function(takeFocus){var sel=window.getSelection();if(!this.clearNode()&&!hasFocus(this.pm)){if(!takeFocus)return;_dom.browser.gecko&&this.pm.content.focus()}if(this.domChanged()){var range=document.createRange(),content=this.pm.content,anchor=DOMFromPos(content,this.range.anchor),head=DOMFromPos(content,this.range.head);if(sel.extend)range.setEnd(anchor.node,anchor.offset),range.collapse(!1);else{if(this.range.anchor.cmp(this.range.head)>0){var tmp=anchor;anchor=head,head=tmp}range.setEnd(head.node,head.offset),range.setStart(anchor.node,anchor.offset)}sel.removeAllRanges(),sel.addRange(range),sel.extend&&sel.extend(head.node,head.offset),this.storeDOMState()}}},{key:"receivedFocus",value:function(){this.pollState||this.pollToSync()}},{key:"beforeStartOp",value:function(){"update"==this.pollState&&this.readUpdate()?(clearTimeout(this.pollTimeout),this.stopPollingForUpdate()):this.syncDOM()}}]),SelectionState}();exports.SelectionState=SelectionState;var Selection=function Selection(){_classCallCheck(this,Selection)};exports.Selection=Selection;var TextSelection=function(_Selection){function TextSelection(anchor,head){_classCallCheck(this,TextSelection),_get(Object.getPrototypeOf(TextSelection.prototype),"constructor",this).call(this),this.anchor=anchor,this.head=head||anchor}return _inherits(TextSelection,_Selection),_createClass(TextSelection,[{key:"eq",value:function(other){return other instanceof TextSelection&&!other.head.cmp(this.head)&&!other.anchor.cmp(this.anchor)}},{key:"map",value:function(doc,mapping){var head=mapping.map(this.head).pos;if(!doc.path(head.path).isTextblock)return findSelectionNear(doc,head);var anchor=mapping.map(this.anchor).pos;return new TextSelection(doc.path(anchor.path).isTextblock?anchor:head,head)}},{key:"inverted",get:function(){return this.anchor.cmp(this.head)>0}},{key:"from",get:function(){return this.inverted?this.head:this.anchor}},{key:"to",get:function(){return this.inverted?this.anchor:this.head}},{key:"empty",get:function(){return 0==this.anchor.cmp(this.head)}}]),TextSelection}(Selection);exports.TextSelection=TextSelection;var NodeSelection=function(_Selection2){function NodeSelection(from,to,node){_classCallCheck(this,NodeSelection),_get(Object.getPrototypeOf(NodeSelection.prototype),"constructor",this).call(this),this.from=from,this.to=to,this.node=node}return _inherits(NodeSelection,_Selection2),_createClass(NodeSelection,[{key:"eq",value:function(other){return other instanceof NodeSelection&&!this.from.cmp(other.from)}},{key:"map",value:function(doc,mapping){var from=mapping.map(this.from,1).pos,to=mapping.map(this.to,-1).pos;if(_model.Pos.samePath(from.path,to.path)&&from.offset==to.offset-1){var node=doc.nodeAfter(from);if(node.type.selectable)return new NodeSelection(from,to,node)}return findSelectionNear(doc,from)}},{key:"empty",get:function(){return!1}}]),NodeSelection}(Selection);exports.NodeSelection=NodeSelection;var scrollMargin=5},{"../dom":1,"../model":31,"../util/error":48}],15:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function fromDOM(schema,dom,options){options||(options={});var context=new DOMParseState(schema,options.topNode||schema.node("doc"),options),start=options.from?dom.childNodes[options.from]:dom.firstChild,end=null!=options.to&&dom.childNodes[options.to]||null;context.addAll(start,end,!0);for(var doc=void 0;context.stack.length;)doc=context.leave();return doc}function fromHTML(schema,html,options){var wrap=(options&&options.document||window.document).createElement("div");return wrap.innerHTML=html,fromDOM(schema,wrap,options)}function nodeInfo(schema){return schema.cached.parseDOMNodes||(schema.cached.parseDOMNodes=summarizeNodeInfo(schema))}function summarizeNodeInfo(schema){var tags=Object.create(null);tags._=[],schema.registry("parseDOM",function(info,type){var tag=info.tag||"_",parse=info.parse;"block"==parse?parse=function(dom,state){state.wrapIn(dom,this)}:"mark"==parse&&(parse=function(dom,state){state.wrapMark(dom,this)}),(tags[tag]||(tags[tag]=[])).push({type:type,parse:parse,rank:null==info.rank?50:info.rank})});for(var tag in tags)tags[tag].sort(function(a,b){return a.rank-b.rank});return tags}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();exports.fromDOM=fromDOM,exports.fromHTML=fromHTML;var _model=require("../model"),_register=require("./register");(0,_register.defineSource)("dom",fromDOM),(0,_register.defineSource)("html",fromHTML);var blockElements={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},noMarks=[],DOMParseState=function(){function DOMParseState(schema,topNode,options){_classCallCheck(this,DOMParseState),this.options=options||{},this.schema=schema,this.stack=[],this.marks=noMarks,this.closing=!1,this.enter(topNode.type,topNode.attrs),this.nodeInfo=nodeInfo(schema)}return _createClass(DOMParseState,[{key:"addDOM",value:function(dom){if(3==dom.nodeType){var value=dom.nodeValue,_top=this.top,last=void 0;(/\S/.test(value)||_top.type.isTextblock)&&(value=value.replace(/\s+/g," "),/^\s/.test(value)&&(!(last=_top.content[_top.content.length-1])||"text"==last.type.name&&/\s$/.test(last.text))&&(value=value.slice(1)),value&&this.insertNode(this.schema.text(value,this.marks)))}else if(1!=dom.nodeType||dom.hasAttribute("pm-ignore"));else if(!this.parseNodeType(dom)){this.addAll(dom.firstChild,null);var _name=dom.nodeName.toLowerCase();blockElements.hasOwnProperty(_name)&&this.top.type==this.schema.defaultTextblockType()&&(this.closing=!0)}}},{key:"tryParsers",value:function(parsers,dom){if(parsers)for(var i=0;i<parsers.length;i++){var parser=parsers[i];if(parser.parse.call(parser.type,dom,this)!==!1)return!0}}},{key:"parseNodeType",value:function(dom){return this.tryParsers(this.nodeInfo[dom.nodeName.toLowerCase()],dom)||this.tryParsers(this.nodeInfo._,dom)}},{key:"addAll",value:function(from,to,sync){for(var stack=sync&&this.stack.slice(),dom=from;dom!=to;dom=dom.nextSibling)this.addDOM(dom),sync&&blockElements.hasOwnProperty(dom.nodeName.toLowerCase())&&this.sync(stack)}},{key:"doClose",value:function(){if(this.closing&&!(this.stack.length<2)){var left=this.leave();this.enter(left.type,left.attrs),this.closing=!1}}},{key:"insertNode",value:function(node){if(this.top.type.canContain(node))this.doClose();else for(var i=this.stack.length-1;i>=0;i--){var route=this.stack[i].type.findConnection(node.type);if(route){if(i==this.stack.length-1)this.doClose();else for(;this.stack.length>i+1;)this.leave();for(var j=0;j<route.length;j++)this.enter(route[j]);this.marks.length&&(this.marks=noMarks);break}}return this.top.content.push(node),node}},{key:"insert",value:function(type,attrs,content){return this.insertNode(type.createAutoFill(attrs,content,this.marks))}},{key:"enter",value:function(type,attrs){this.marks.length&&(this.marks=noMarks),this.stack.push({type:type,attrs:attrs,content:[]})}},{key:"leave",value:function(){var top=this.stack.pop(),last=top.content[top.content.length-1];last&&last.isText&&/\s$/.test(last.text)&&(top.content[top.content.length-1]=last.copy(last.text.slice(0,last.text.length-1)));var node=top.type.createAutoFill(top.attrs,top.content);return this.stack.length&&this.insertNode(node),node}},{key:"sync",value:function(stack){for(;this.stack.length>stack.length;)this.leave();for(;;){var n=this.stack.length-1,one=this.stack[n],two=stack[n];if(one.type==two.type&&_model.Node.sameAttrs(one.attrs,two.attrs))break;this.leave()}for(;stack.length>this.stack.length;){var add=stack[this.stack.length];this.enter(add.type,add.attrs)}this.marks.length&&(this.marks=noMarks),this.closing=!1}},{key:"wrapIn",value:function(dom,type,attrs){this.enter(type,attrs),this.addAll(dom.firstChild,null,!0),this.leave()}},{key:"wrapMark",value:function(dom,mark){var old=this.marks;this.marks=(mark.instance||mark).addToSet(old),this.addAll(dom.firstChild,null),this.marks=old}},{key:"top",get:function(){return this.stack[this.stack.length-1]}}]),DOMParseState}();_model.Paragraph.register("parseDOM",{tag:"p",parse:"block"}),_model.BlockQuote.register("parseDOM",{tag:"blockquote",parse:"block"});for(var _loop=function(i){_model.Heading.register("parseDOM",{tag:"h"+i,parse:function(dom,state){state.wrapIn(dom,this,{level:i})}})},i=1;6>=i;i++)_loop(i);_model.HorizontalRule.register("parseDOM",{tag:"hr",parse:"block"}),_model.CodeBlock.register("parseDOM",{tag:"pre",parse:function(dom,state){var params=dom.firstChild&&/^code$/i.test(dom.firstChild.nodeName)&&dom.firstChild.getAttribute("class");if(params&&/fence/.test(params)){for(var found=[],re=/(?:^|\s)lang-(\S+)/g,m=void 0;m=re.test(params);)found.push(m[1]);params=found.join(" ")}else params=null;var text=dom.textContent;state.insert(this,{params:params},text?[state.schema.text(text)]:[])}}),_model.BulletList.register("parseDOM",{tag:"ul",parse:"block"}),_model.OrderedList.register("parseDOM",{tag:"ol",parse:function(dom,state){var attrs={order:dom.getAttribute("start")||1};state.wrapIn(dom,this,attrs)}}),_model.ListItem.register("parseDOM",{tag:"li",parse:"block"}),_model.HardBreak.register("parseDOM",{tag:"br",parse:function(_,state){state.insert(this)}}),_model.Image.register("parseDOM",{tag:"img",parse:function(dom,state){state.insert(this,{src:dom.getAttribute("src"),title:dom.getAttribute("title")||null,alt:dom.getAttribute("alt")||null})}}),_model.LinkMark.register("parseDOM",{tag:"a",parse:function(dom,state){var href=dom.getAttribute("href");return href?void state.wrapMark(dom,this.create({href:href,title:dom.getAttribute("title")})):!1}}),_model.EmMark.register("parseDOM",{tag:"i",parse:"mark"}),_model.EmMark.register("parseDOM",{tag:"em",parse:"mark"}),_model.StrongMark.register("parseDOM",{tag:"b",parse:"mark"}),_model.StrongMark.register("parseDOM",{tag:"strong",parse:"mark"}),_model.CodeMark.register("parseDOM",{tag:"code",parse:"mark"})},{"../model":31,"./register":18}],16:[function(require,module,exports){"use strict";function fromText(schema,text){for(var blocks=text.trim().split(/\n{2,}/),nodes=[],i=0;i<blocks.length;i++){for(var spans=[],parts=blocks[i].split("\n"),j=0;j<parts.length;j++)j&&spans.push(schema.node("hard_break")),parts[j]&&spans.push(schema.text(parts[j]));nodes.push(schema.node("paragraph",null,spans))}return nodes.length||nodes.push(schema.node("paragraph")),schema.node("doc",null,nodes)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.fromText=fromText;var _register=require("./register");(0,_register.defineSource)("text",fromText)},{"./register":18}],17:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _register=require("./register");Object.defineProperty(exports,"serializeTo",{enumerable:!0,get:function(){return _register.serializeTo}}),Object.defineProperty(exports,"knownTarget",{enumerable:!0,get:function(){return _register.knownTarget}}),Object.defineProperty(exports,"defineTarget",{enumerable:!0,get:function(){return _register.defineTarget}}),Object.defineProperty(exports,"parseFrom",{enumerable:!0,get:function(){return _register.parseFrom}}),Object.defineProperty(exports,"knownSource",{enumerable:!0,get:function(){return _register.knownSource}}),Object.defineProperty(exports,"defineSource",{enumerable:!0,get:function(){return _register.defineSource}});var _from_dom=require("./from_dom");Object.defineProperty(exports,"fromDOM",{enumerable:!0,get:function(){return _from_dom.fromDOM}}),Object.defineProperty(exports,"fromHTML",{enumerable:!0,get:function(){return _from_dom.fromHTML}});var _to_dom=require("./to_dom");Object.defineProperty(exports,"toDOM",{enumerable:!0,get:function(){return _to_dom.toDOM}}),Object.defineProperty(exports,"toHTML",{enumerable:!0,get:function(){return _to_dom.toHTML}}),Object.defineProperty(exports,"nodeToDOM",{enumerable:!0,get:function(){return _to_dom.nodeToDOM}});var _from_text=require("./from_text");Object.defineProperty(exports,"fromText",{enumerable:!0,get:function(){return _from_text.fromText}});var _to_text=require("./to_text");Object.defineProperty(exports,"toText",{enumerable:!0,get:function(){return _to_text.toText}})},{"./from_dom":15,"./from_text":16,"./register":18,"./to_dom":19,"./to_text":20}],18:[function(require,module,exports){"use strict";function serializeTo(doc,format,options){var converter=serializers[format];return converter||_utilError.NamespaceError.raise("Target format "+format+" not defined"),converter(doc,options)}function knownTarget(format){return!!serializers[format]}function defineTarget(format,func){serializers[format]=func}function parseFrom(schema,value,format,options){var converter=parsers[format];return converter||_utilError.NamespaceError.raise("Source format "+format+" not defined"),converter(schema,value,options)}function knownSource(format){return!!parsers[format]}function defineSource(format,func){parsers[format]=func}Object.defineProperty(exports,"__esModule",{value:!0}),exports.serializeTo=serializeTo,exports.knownTarget=knownTarget,exports.defineTarget=defineTarget,exports.parseFrom=parseFrom,exports.knownSource=knownSource,exports.defineSource=defineSource;var _utilError=require("../util/error"),serializers=Object.create(null);defineTarget("json",function(doc){return doc.toJSON()});var parsers=Object.create(null);defineSource("json",function(schema,json){return schema.nodeFromJSON(json)})},{"../util/error":48}],19:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function toDOM(node,options){return new DOMSerializer(options).renderContent(node)}function nodeToDOM(node,options,offset){var serializer=new DOMSerializer(options),dom=serializer.renderNode(node,offset);return node.isInline&&(dom=serializer.wrapInlineFlat(dom,node.marks),serializer.options.renderInlineFlat&&(dom=options.renderInlineFlat(node,dom,offset)||dom)),dom}function toHTML(node,options){var serializer=new DOMSerializer(options),wrap=serializer.elt("div");return wrap.appendChild(serializer.renderContent(node)),wrap.innerHTML}function def(cls,method){cls.prototype.serializeDOM=method}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();exports.toDOM=toDOM,exports.nodeToDOM=nodeToDOM,exports.toHTML=toHTML;var _model=require("../model"),_register=require("./register"),DOMSerializer=function(){function DOMSerializer(options){_classCallCheck(this,DOMSerializer),this.options=options||{},this.doc=this.options.document||window.document}return _createClass(DOMSerializer,[{key:"elt",value:function(type,attrs){var result=this.doc.createElement(type);if(attrs)for(var _name in attrs)"style"==_name?result.style.cssText=attrs[_name]:attrs[_name]&&result.setAttribute(_name,attrs[_name]);for(var _len=arguments.length,content=Array(_len>2?_len-2:0),_key=2;_len>_key;_key++)content[_key-2]=arguments[_key];for(var i=0;i<content.length;i++)result.appendChild("string"==typeof content[i]?this.doc.createTextNode(content[i]):content[i]);return result}},{key:"renderNode",value:function(node,offset){var dom=node.type.serializeDOM(node,this);return this.options.onRender&&(dom=this.options.onRender(node,dom,offset)||dom),dom}},{key:"renderContent",value:function(node,where){return where||(where=this.doc.createDocumentFragment()),node.isTextblock?this.options.renderInlineFlat?this.renderInlineFlatInto(node,where):this.renderInlineInto(node,where):this.renderBlocksInto(node,where),where}},{key:"renderBlocksInto",value:function(parent,where){for(var i=parent.iter(),child=void 0;child=i.next().value;)this.options.path&&this.options.path.push(i.offset-child.width),where.appendChild(this.renderNode(child,i.offset-child.width)),this.options.path&&this.options.path.pop()}},{key:"renderInlineInto",value:function(parent,where){var _this=this,top=where,active=[];parent.forEach(function(node,offset){for(var keep=0;keep<Math.min(active.length,node.marks.length)&&node.marks[keep].eq(active[keep]);++keep);for(;keep<active.length;)active.pop(),top=top.parentNode;for(;active.length<node.marks.length;){var add=node.marks[active.length];active.push(add),top=top.appendChild(_this.renderMark(add))}top.appendChild(_this.renderNode(node,offset))})}},{key:"renderInlineFlatInto",value:function(parent,where){var _this2=this;parent.forEach(function(node,start){var dom=_this2.renderNode(node,start);dom=_this2.wrapInlineFlat(dom,node.marks),dom=_this2.options.renderInlineFlat(node,dom,start)||dom,where.appendChild(dom)})}},{key:"renderMark",value:function(mark){return mark.type.serializeDOM(mark,this)}},{key:"wrapInlineFlat",value:function(dom,marks){for(var i=marks.length-1;i>=0;i--){var wrap=this.renderMark(marks[i]);wrap.appendChild(dom),dom=wrap}return dom}},{key:"renderAs",value:function(node,tagName,tagAttrs){return this.renderContent(node,this.elt(tagName,tagAttrs))}}]),DOMSerializer}();(0,_register.defineTarget)("dom",toDOM),(0,_register.defineTarget)("html",toHTML),def(_model.BlockQuote,function(node,s){return s.renderAs(node,"blockquote")}),_model.BlockQuote.prototype.countCoordsAsChild=function(_,path,dom,coords){var childBox=dom.firstChild.getBoundingClientRect();return coords.left<childBox.left-2?_model.Pos.from(path):void 0},def(_model.BulletList,function(node,s){return s.renderAs(node,"ul")}),def(_model.OrderedList,function(node,s){return s.renderAs(node,"ol",{start:"1"!=node.attrs.order&&node.attrs.order})}),_model.OrderedList.prototype.countCoordsAsChild=_model.BulletList.prototype.countCoordsAsChild=function(_,path,dom,coords){for(var i=0;i<dom.childNodes.length;i++){var child=dom.childNodes[i];if(child.hasAttribute("pm-offset")){var childBox=child.getBoundingClientRect();if(coords.left>childBox.left-2)return null;if(childBox.top<=coords.top&&childBox.bottom>=coords.top)return new _model.Pos(path,i)}}},def(_model.ListItem,function(node,s){return s.renderAs(node,"li")}),def(_model.HorizontalRule,function(_,s){return s.elt("hr")}),def(_model.Paragraph,function(node,s){return s.renderAs(node,"p")}),def(_model.Heading,function(node,s){return s.renderAs(node,"h"+node.attrs.level)}),def(_model.CodeBlock,function(node,s){var code=s.renderAs(node,"code");return null!=node.attrs.params&&(code.className="fence "+node.attrs.params.replace(/(^|\s+)/g,"$&lang-")),s.elt("pre",null,code)}),def(_model.Text,function(node,s){return s.doc.createTextNode(node.text)}),def(_model.Image,function(node,s){return s.elt("img",{src:node.attrs.src,alt:node.attrs.alt,title:node.attrs.title})}),def(_model.HardBreak,function(_,s){return s.elt("br")}),def(_model.EmMark,function(_,s){return s.elt("em")}),def(_model.StrongMark,function(_,s){return s.elt("strong")}),def(_model.CodeMark,function(_,s){return s.elt("code")}),def(_model.LinkMark,function(mark,s){return s.elt("a",{href:mark.attrs.href,title:mark.attrs.title})})},{"../model":31,"./register":18}],20:[function(require,module,exports){"use strict";function toText(doc){return doc.type.serializeText(doc).trim()}Object.defineProperty(exports,"__esModule",{value:!0}),exports.toText=toText;var _model=require("../model"),_register=require("./register");_model.Block.prototype.serializeText=function(node){var accum="";return node.forEach(function(child){return accum+=child.type.serializeText(child)}),accum},_model.Textblock.prototype.serializeText=function(node){var text=_model.Block.prototype.serializeText(node);return text&&text+"\n\n"},_model.Inline.prototype.serializeText=function(){return""},_model.HardBreak.prototype.serializeText=function(){return"\n"},_model.Text.prototype.serializeText=function(node){return node.text},(0,_register.defineTarget)("text",toText)},{"../model":31,"./register":18}],21:[function(require,module,exports){"use strict";function defineInputRule(rule){rules[rule.name]=rule}function wrapAndJoin(pm,pos,type){var attrs=arguments.length<=3||void 0===arguments[3]?null:arguments[3],predicate=arguments.length<=4||void 0===arguments[4]?null:arguments[4],before=pos.shorten(),sibling=before.offset>0&&pm.doc.path(before.path).child(before.offset-1),join=sibling&&sibling.type.name==type&&(!predicate||predicate(sibling)),tr=pm.tr.wrap(pos,pos,type,attrs),delPos=tr.map(pos).pos;
tr["delete"](new _model.Pos(delPos.path,0),delPos),join&&tr.join(before),tr.apply()}function setAs(pm,pos,type,attrs){pm.tr.setBlockType(pos,pos,type,attrs)["delete"](new _model.Pos(pos.path,0),pos).apply()}Object.defineProperty(exports,"__esModule",{value:!0}),exports.defineInputRule=defineInputRule;var _model=require("../model"),_edit=require("../edit"),_inputrules=require("./inputrules");(0,_edit.defineOption)("autoInput",!1,function(pm,val){if(pm.mod.autoInput&&(pm.mod.autoInput.forEach(function(name){return(0,_inputrules.removeInputRule)(pm,name)}),pm.mod.autoInput=null),val){pm.mod.autoInput=[],pm.schema.registry("autoInput",function(rule,type,name){var rname="schema:"+name+":"+rule.name,handler=rule.handler;pm.isIncluded(rname)&&(handler.bind&&(handler=handler.bind(type)),(0,_inputrules.addInputRule)(pm,new _inputrules.InputRule(rname,rule.match,rule.filter,handler)),pm.mod.autoInput.push(rname))});for(var _name in rules)if(pm.isIncluded(_name)){var rule=rules[_name];(0,_inputrules.addInputRule)(pm,rule),pm.mod.autoInput.push(rule.name)}}});var rules=Object.create(null);defineInputRule(new _inputrules.InputRule("emDash",/--$/,"-","—")),defineInputRule(new _inputrules.InputRule("openDoubleQuote",/\s(")$/,'"',"“")),defineInputRule(new _inputrules.InputRule("closeDoubleQuote",/"$/,'"',"”")),defineInputRule(new _inputrules.InputRule("openSingleQuote",/\s(')$/,"'","‘")),defineInputRule(new _inputrules.InputRule("closeSingleQuote",/'$/,"'","’")),_model.BlockQuote.register("autoInput",new _inputrules.InputRule("startBlockQuote",/^\s*> $/," ",function(pm,_,pos){wrapAndJoin(pm,pos,this)})),_model.OrderedList.register("autoInput",new _inputrules.InputRule("startOrderedList",/^(\d+)\. $/," ",function(pm,match,pos){var order=+match[1];wrapAndJoin(pm,pos,this,{order:order||null},function(node){return node.size+(node.attrs.order||1)==order})})),_model.BulletList.register("autoInput",new _inputrules.InputRule("startBulletList",/^\s*([-+*]) $/," ",function(pm,match,pos){var bullet=match[1];wrapAndJoin(pm,pos,this,null,function(node){return node.attrs.bullet==bullet})})),_model.CodeBlock.register("autoInput",new _inputrules.InputRule("startCodeBlock",/^```$/,"`",function(pm,_,pos){setAs(pm,pos,this,{params:""})})),_model.Heading.register("autoInput",new _inputrules.InputRule("startHeading",/^(#{1,6}) $/," ",function(pm,match,pos){setAs(pm,pos,this,{level:match[1].length})}))},{"../edit":9,"../model":31,"./inputrules":22}],22:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function addInputRule(pm,rule){pm.mod.interpretInput||(pm.mod.interpretInput=new InputRules(pm)),pm.mod.interpretInput.addRule(rule)}function removeInputRule(pm,name){var ii=pm.mod.interpretInput;ii&&(ii.removeRule(name),0==ii.rules.length&&(ii.unregister(),pm.mod.interpretInput=null))}function getContext(doc,pos){for(var parent=doc.path(pos.path),isCode=parent.type.isCode,textBefore="",i=parent.iter(0,pos.offset),child=void 0;child=i.next().value;)child.isText?textBefore+=child.text:textBefore="",i.atEnd()&&child.marks.some(function(st){return st.type.isCode})&&(isCode=!0);return{textBefore:textBefore,isCode:isCode}}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();exports.addInputRule=addInputRule,exports.removeInputRule=removeInputRule;var _model=require("../model"),_edit=require("../edit"),InputRule=function InputRule(name,match,filter,handler){_classCallCheck(this,InputRule),this.name=name,this.filter=filter,this.match=match,this.handler=handler};exports.InputRule=InputRule;var InputRules=function(){function InputRules(pm){var _this=this;_classCallCheck(this,InputRules),this.pm=pm,this.rules=[],this.cancelVersion=null,pm.on("selectionChange",this.onSelChange=function(){return _this.cancelVersion=null}),pm.on("textInput",this.onTextInput=this.onTextInput.bind(this)),pm.addKeymap(new _edit.Keymap({Backspace:function(pm){return _this.backspace(pm)}},{name:"inputRules"}),20)}return _createClass(InputRules,[{key:"unregister",value:function(){this.pm.off("selectionChange",this.onSelChange),this.pm.off("textInput",this.onTextInput),this.pm.removeKeymap("inputRules")}},{key:"addRule",value:function(rule){this.rules.push(rule)}},{key:"removeRule",value:function(name){for(var i=0;i<this.rules.length;i++)if(this.rules[i].name==name)return this.rules.splice(i,1),!0}},{key:"onTextInput",value:function(text){var pos=this.pm.selection.head;if(pos)for(var textBefore=void 0,isCode=void 0,lastCh=text[text.length-1],i=0;i<this.rules.length;i++){var rule=this.rules[i],match=void 0;if(!rule.filter||rule.filter==lastCh){if(null==textBefore){var _getContext=getContext(this.pm.doc,pos);if(textBefore=_getContext.textBefore,isCode=_getContext.isCode)return}if(match=rule.match.exec(textBefore)){var startVersion=this.pm.history.getVersion();if("string"==typeof rule.handler){var offset=pos.offset-(match[1]||match[0]).length,start=new _model.Pos(pos.path,offset),marks=this.pm.doc.marksAt(pos);this.pm.tr["delete"](start,pos).insert(start,this.pm.schema.text(rule.handler,marks)).apply()}else rule.handler(this.pm,match,pos);return void(this.cancelVersion=startVersion)}}}}},{key:"backspace",value:function(){return this.cancelVersion?(this.pm.history.backToVersion(this.cancelVersion),void(this.cancelVersion=null)):!1}}]),InputRules}()},{"../edit":9,"../model":31}],23:[function(require,module,exports){"use strict";function getIcon(name,data){var node=document.createElement("div");if(node.className=prefix,data.path){svgBuilt[name]||buildSVG(name,data);var svg=node.appendChild(document.createElementNS(SVG,"svg"));svg.style.width=data.width/data.height+"em";var use=svg.appendChild(document.createElementNS(SVG,"use"));use.setAttributeNS(XLINK,"href","#pm-icon-"+name)}else node.appendChild(document.createElement("span")).textContent=data.text,data.css&&(node.firstChild.style.cssText=data.css);return node}function buildSVG(name,data){svgCollection||(svgCollection=document.createElementNS(SVG,"svg"),svgCollection.style.display="none",document.body.insertBefore(svgCollection,document.body.firstChild));var sym=document.createElementNS(SVG,"symbol");sym.id="pm-icon-"+name,sym.setAttribute("viewBox","0 0 "+data.width+" "+data.height);var path=sym.appendChild(document.createElementNS(SVG,"path"));path.setAttribute("d",data.path),svgCollection.appendChild(sym),svgBuilt[name]=!0}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getIcon=getIcon;var _dom=require("../dom"),svgCollection=null,svgBuilt=Object.create(null),SVG="http://www.w3.org/2000/svg",XLINK="http://www.w3.org/1999/xlink",prefix="ProseMirror-icon";(0,_dom.insertCSS)("\n."+prefix+" {\n  display: inline-block;\n  line-height: .8;\n  vertical-align: -2px; /* Compensate for padding */\n  padding: 2px 8px;\n  cursor: pointer;\n}\n\n."+prefix+"-active {\n  background: #666;\n  border-radius: 4px;\n}\n\n."+prefix+" svg {\n  fill: currentColor;\n  height: 1em;\n}\n\n."+prefix+" span {\n  vertical-align: text-top;\n}")},{"../dom":1}],24:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function title(pm,command){var key=pm.keyForCommand(command.name);return key?command.label+" ("+key+")":command.label}function renderIcon(command,menu){var icon=(0,_icons.getIcon)(command.name,command.spec.display);command.active(menu.pm)&&(icon.className+=" ProseMirror-icon-active");var dom=(0,_dom.elt)("span",{"class":"ProseMirror-menuicon",title:title(menu.pm,command)},icon);return dom.addEventListener("mousedown",function(e){e.preventDefault(),e.stopPropagation(),command.params.length?1==command.params.length&&"select"==command.params[0].type?showSelectMenu(menu.pm,command,dom):menu.enter(readParams(command)):(command.exec(menu.pm),menu.reset())}),dom}function renderSelect(item,menu){var param=item.params[0],deflt=paramDefault(param,menu.pm,item);if(null!=deflt)for(var options=param.options.call?param.options(menu.pm):param.options,i=0;i<options.length;i++)if(options[i].value===deflt){deflt=options[i];break}var dom=(0,_dom.elt)("div",{"class":"ProseMirror-select ProseMirror-select-command-"+item.name,title:item.label},deflt?deflt.display?deflt.display(deflt):deflt.label:param.defaultLabel||"Select...");return dom.addEventListener("mousedown",function(e){e.preventDefault(),e.stopPropagation(),showSelectMenu(menu.pm,item,dom)}),dom}function showSelectMenu(pm,item,dom){function finish(){done||(done=!0,document.body.removeEventListener("mousedown",finish),document.body.removeEventListener("keydown",finish),pm.wrapper.removeChild(menu))}var param=item.params[0],options=param.options.call?param.options(pm):param.options,menu=(0,_dom.elt)("div",{"class":"ProseMirror-select-menu"},options.map(function(o){var dom=(0,_dom.elt)("div",null,o.display?o.display(o):o.label);return dom.addEventListener("mousedown",function(e){e.preventDefault(),item.exec(pm,[o.value]),finish()}),dom})),pos=dom.getBoundingClientRect(),box=pm.wrapper.getBoundingClientRect();menu.style.left=pos.left-box.left-2+"px",menu.style.top=pos.top-box.top-2+"px";var done=!1;document.body.addEventListener("mousedown",finish),document.body.addEventListener("keydown",finish),pm.wrapper.appendChild(menu)}function renderItem(item,menu){if(!(item instanceof _edit.Command))return item.display(menu);var display=item.spec.display;return"icon"==display.type?renderIcon(item,menu):"param"==display.type?renderSelect(item,menu):void _utilError.AssertionError.raise("Command "+item.name+" can not be shown in a menu")}function paramDefault(param,pm,command){if(param.prefill){var prefill=param.prefill.call(command.self,pm);if(null!=prefill)return prefill}return param["default"]}function buildParamForm(pm,command){var fields=command.params.map(function(param,i){var field=void 0,name="field_"+i,val=paramDefault(param,pm,command);return"text"==param.type?field=(0,_dom.elt)("input",{name:name,type:"text",placeholder:param.label,value:val,autocomplete:"off"}):"select"==param.type?field=(0,_dom.elt)("select",{name:name},(param.options.call?param.options(pm):param.options).map(function(o){return(0,_dom.elt)("option",{value:o.value,selected:o==val},o.label)})):_utilError.AssertionError.raise("Unsupported parameter type: "+param.type),(0,_dom.elt)("div",null,field)});return(0,_dom.elt)("form",null,fields)}function gatherParams(pm,command,form){var bad=!1,params=command.params.map(function(param,i){var val=form.elements["field_"+i].value;return val?val:null!=param["default"]?paramDefault(param,pm,command):void(bad=!0)});return bad?null:params}function paramForm(pm,command,callback){var form=buildParamForm(pm,command),done=!1,finish=function(result){done||(done=!0,callback(result))},submit=function(){finish(gatherParams(pm,command,form))};return form.addEventListener("submit",function(e){e.preventDefault(),submit()}),form.addEventListener("keydown",function(e){27==e.keyCode?finish(null):13!=e.keyCode||e.ctrlKey||e.metaKey||e.shiftKey||(e.preventDefault(),submit())}),setTimeout(function(){var input=form.querySelector("input, textarea");input&&input.focus()},20),form}function readParams(command){return{display:function(menu){return paramForm(menu.pm,command,function(params){menu.pm.focus(),params?(command.exec(menu.pm,params),menu.reset()):menu.leave()})}}}function menuRank(cmd){var match=/^[^(]+\((\d+)\)$/.exec(cmd.spec.menuGroup);return match?+match[1]:50}function computeMenuGroups(pm){var groups=Object.create(null);for(var _name in pm.commands){var cmd=pm.commands[_name],spec=cmd.spec.menuGroup;if(spec){var _$exec=/^[^(]+/.exec(spec),_$exec2=_slicedToArray(_$exec,1),group=_$exec2[0];(0,_utilSortedinsert2["default"])(groups[group]||(groups[group]=[]),cmd,function(a,b){return menuRank(a)-menuRank(b)})}}pm.mod.menuGroups=groups;var clear=function clear(){pm.mod.menuGroups=null,pm.off("commandsChanging",clear)};return pm.on("commandsChanging",clear),groups}function menuGroups(pm,names){var groups=pm.mod.menuGroups||computeMenuGroups(pm);return names.map(function(group){return groups[group]})}function tooltipParamHandler(pm,command,callback){var tooltip=new _uiTooltip.Tooltip(pm.wrapper,"center");tooltip.open(paramForm(pm,command,function(params){pm.focus(),tooltip.close(),callback(params)}))}Object.defineProperty(exports,"__esModule",{value:!0});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i["return"]&&_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();exports.showSelectMenu=showSelectMenu,exports.readParams=readParams,exports.menuGroups=menuGroups;var _uiTooltip=require("../ui/tooltip"),_dom=require("../dom"),_edit=require("../edit"),_utilSortedinsert=require("../util/sortedinsert"),_utilSortedinsert2=_interopRequireDefault(_utilSortedinsert),_utilError=require("../util/error"),_icons=require("./icons"),Menu=function(){function Menu(pm,display){_classCallCheck(this,Menu),this.display=display,this.stack=[],this.pm=pm}return _createClass(Menu,[{key:"show",value:function(content,displayInfo){this.stack.length=0,this.enter(content,displayInfo)}},{key:"reset",value:function(){this.stack.length=0,this.display.reset()}},{key:"enter",value:function(content,displayInfo){var _this=this,pieces=[],close=!1,explore=function explore(value){if(Array.isArray(value)){for(var i=0;i<value.length;i++)explore(value[i]);close=!0}else(!value.select||value.select(_this.pm))&&(close&&(pieces.push(separator),close=!1),pieces.push(value))};return explore(content),pieces.length?(this.stack.push(pieces),void this.draw(displayInfo)):this.display.clear()}},{key:"draw",value:function(displayInfo){var _this2=this,cur=this.stack[this.stack.length-1],rendered=(0,_dom.elt)("div",{"class":"ProseMirror-menu"},cur.map(function(item){return renderItem(item,_this2)}));this.stack.length>1?this.display.enter(rendered,function(){return _this2.leave()},displayInfo):this.display.show(rendered,displayInfo)}},{key:"leave",value:function(){this.stack.pop(),this.stack.length?this.draw():this.display.reset()}},{key:"active",get:function(){return this.stack.length>1}}]),Menu}();exports.Menu=Menu;var TooltipDisplay=function(){function TooltipDisplay(tooltip,resetFunc){_classCallCheck(this,TooltipDisplay),this.tooltip=tooltip,this.resetFunc=resetFunc}return _createClass(TooltipDisplay,[{key:"clear",value:function(){this.tooltip.close()}},{key:"reset",value:function(){this.resetFunc?this.resetFunc():this.clear()}},{key:"show",value:function(dom,info){this.tooltip.open(dom,info)}},{key:"enter",value:function(dom,back,info){var button=(0,_dom.elt)("div",{"class":"ProseMirror-tooltip-back",title:"Back"});button.addEventListener("mousedown",function(e){e.preventDefault(),e.stopPropagation(),back()}),this.show((0,_dom.elt)("div",{"class":"ProseMirror-tooltip-back-wrapper"},dom,button),info)}}]),TooltipDisplay}();exports.TooltipDisplay=TooltipDisplay;var separator={display:function(){return(0,_dom.elt)("div",{"class":"ProseMirror-menuseparator"})}};(0,_edit.defineParamHandler)("default",tooltipParamHandler),(0,_edit.defineParamHandler)("tooltip",tooltipParamHandler),(0,_dom.insertCSS)('\n\n.ProseMirror-menu {\n  margin: 0 -4px;\n  line-height: 1;\n  white-space: pre;\n}\n.ProseMirror-tooltip .ProseMirror-menu {\n  width: -webkit-fit-content;\n  width: fit-content;\n}\n\n.ProseMirror-tooltip-back-wrapper {\n  padding-left: 12px;\n}\n.ProseMirror-tooltip-back {\n  position: absolute;\n  top: 5px; left: 5px;\n  cursor: pointer;\n}\n.ProseMirror-tooltip-back:after {\n  content: "«";\n}\n\n.ProseMirror-menuicon {\n  margin: 0 7px;\n}\n\n.ProseMirror-menuseparator {\n  display: inline-block;\n}\n.ProseMirror-menuseparator:after {\n  content: "︙";\n  opacity: 0.5;\n  padding: 0 4px;\n}\n\n.ProseMirror-select, .ProseMirror-select-menu {\n  border: 1px solid #777;\n  border-radius: 3px;\n  font-size: 90%;\n}\n\n.ProseMirror-select {\n  padding: 1px 12px 1px 4px;\n  display: inline-block;\n  vertical-align: 1px;\n  position: relative;\n  cursor: pointer;\n  margin: 0 8px;\n}\n\n.ProseMirror-select-command-textblockType {\n  min-width: 3.2em;\n}\n\n.ProseMirror-select:after {\n  content: "▿";\n  color: #777;\n  position: absolute;\n  right: 4px;\n}\n\n.ProseMirror-select-menu {\n  position: absolute;\n  background: #444;\n  color: white;\n  padding: 2px 2px;\n  z-index: 15;\n}\n.ProseMirror-select-menu div {\n  cursor: pointer;\n  padding: 0 1em 0 2px;\n}\n.ProseMirror-select-menu div:hover {\n  background: #777;\n}\n\n')},{"../dom":1,"../edit":9,"../ui/tooltip":46,"../util/error":48,"../util/sortedinsert":51,"./icons":23}],25:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function getItems(pm,items){return Array.isArray(items)?items.map(getItems.bind(null,pm)):pm.commands[items]}function findWrappingScrollable(node){for(var cur=node.parentNode;cur;cur=cur.parentNode)if(cur.scrollHeight>cur.clientHeight)return cur}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_edit=require("../edit"),_dom=require("../dom"),_uiUpdate=require("../ui/update"),_menu=require("./menu"),prefix="ProseMirror-menubar";(0,_edit.defineOption)("menuBar",!1,function(pm,value){pm.mod.menuBar&&pm.mod.menuBar.detach(),pm.mod.menuBar=value?new MenuBar(pm,value):null});var BarDisplay=function(){function BarDisplay(container,resetFunc){_classCallCheck(this,BarDisplay),this.container=container,this.resetFunc=resetFunc}return _createClass(BarDisplay,[{key:"clear",value:function(){this.container.textContent=""}},{key:"reset",value:function(){this.resetFunc()}},{key:"show",value:function(dom){this.clear(),this.container.appendChild(dom)}},{key:"enter",value:function(dom,back){var current=this.container.firstChild;current&&(current.style.position="absolute",current.style.opacity="0.5");var backButton=(0,_dom.elt)("div",{"class":prefix+"-back"});backButton.addEventListener("mousedown",function(e){e.preventDefault(),e.stopPropagation(),back()});var added=(0,_dom.elt)("div",{"class":prefix+"-sliding"},backButton,dom);this.container.appendChild(added),added.getBoundingClientRect(),added.style.left="0",added.addEventListener("transitionend",function(){current&&current.parentNode&&current.parentNode.removeChild(current)})}}]),BarDisplay}(),MenuBar=function(){function MenuBar(pm,config){var _this=this;_classCallCheck(this,MenuBar),this.pm=pm,this.config=config||{},this.menuElt=(0,_dom.elt)("div",{"class":prefix+"-inner"}),this.wrapper=(0,_dom.elt)("div",{"class":prefix},(0,_dom.elt)("div",{"class":"ProseMirror-menu",style:"visibility: hidden"},(0,_dom.elt)("span",{"class":"ProseMirror-menuicon"},(0,_dom.elt)("div",{"class":"ProseMirror-icon"},"x"))),this.menuElt),pm.wrapper.insertBefore(this.wrapper,pm.wrapper.firstChild),this.update=new _uiUpdate.UpdateScheduler(pm,"selectionChange change activeMarkChange commandsChanged",function(){return _this.prepareUpdate()}),this.menu=new _menu.Menu(pm,new BarDisplay(this.menuElt,function(){return _this.resetMenu()})),this.update.force(),this.floating=!1,this.config["float"]&&(this.updateFloat(),this.scrollFunc=function(){document.body.contains(_this.pm.wrapper)?_this.updateFloat():window.removeEventListener("scroll",_this.scrollFunc)},window.addEventListener("scroll",this.scrollFunc))}return _createClass(MenuBar,[{key:"detach",value:function(){this.update.detach(),this.wrapper.parentNode.removeChild(this.wrapper),this.scrollFunc&&window.removeEventListener("scroll",this.scrollFunc)}},{key:"prepareUpdate",value:function(){var _this2=this,scrollCursor=this.prepareScrollCursor();return function(){_this2.menu.active||_this2.resetMenu(),scrollCursor&&scrollCursor()}}},{key:"resetMenu",value:function(){this.menu.show(this.config.items?getItems(this.pm,this.config.items):(0,_menu.menuGroups)(this.pm,this.config.groups||["inline","block","history"]))}},{key:"updateFloat",value:function(){var editorRect=this.pm.wrapper.getBoundingClientRect();if(this.floating)if(editorRect.top>=0||editorRect.bottom<this.menuElt.offsetHeight+10)this.floating=!1,this.menuElt.style.position=this.menuElt.style.left=this.menuElt.style.width="",this.menuElt.style.display="";else{var border=(this.pm.wrapper.offsetWidth-this.pm.wrapper.clientWidth)/2;this.menuElt.style.left=editorRect.left+border+"px",this.menuElt.style.display=editorRect.top>window.innerHeight?"none":""}else if(editorRect.top<0&&editorRect.bottom>=this.menuElt.offsetHeight+10){this.floating=!0;var menuRect=this.menuElt.getBoundingClientRect();this.menuElt.style.left=menuRect.left+"px",this.menuElt.style.width=menuRect.width+"px",this.menuElt.style.position="fixed"}}},{key:"prepareScrollCursor",value:function(){var _this3=this;if(!this.floating)return null;var head=this.pm.selection.head;if(!head)return null;var cursorPos=this.pm.coordsAtPos(head),menuRect=this.menuElt.getBoundingClientRect();if(cursorPos.top<menuRect.bottom&&cursorPos.bottom>menuRect.top){var _ret=function(){var scrollable=findWrappingScrollable(_this3.pm.wrapper);return scrollable?{v:function(){return scrollable.scrollTop-=menuRect.bottom-cursorPos.top}}:void 0}();if("object"==typeof _ret)return _ret.v}}}]),MenuBar}();(0,_dom.insertCSS)("\n."+prefix+" {\n  position: relative;\n  margin-bottom: 3px;\n  border-top-left-radius: inherit;\n  border-top-right-radius: inherit;\n}\n\n."+prefix+"-inner {\n  min-height: 1em;\n  color: #666;\n  padding: 1px 6px;\n  top: 0; left: 0; right: 0;\n  position: absolute;\n  border-bottom: 1px solid silver;\n  background: white;\n  z-index: 10;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box;\n  overflow: hidden;\n  border-top-left-radius: inherit;\n  border-top-right-radius: inherit;\n}\n\n."+prefix+" .ProseMirror-icon-active {\n  background: #eee;\n}\n\n."+prefix+' input[type="text"],\n.'+prefix+" textarea {\n  background: #eee;\n  color: black;\n  border: none;\n  outline: none;\n  width: 100%;\n  box-sizing: -moz-border-box;\n  box-sizing: border-box;\n}\n\n."+prefix+' input[type="text"] {\n  padding: 0 4px;\n}\n\n.'+prefix+" form {\n  position: relative;\n  padding: 2px 4px;\n}\n\n."+prefix+" .ProseMirror-blocktype {\n  border: 1px solid #ccc;\n  min-width: 4em;\n}\n."+prefix+" .ProseMirror-blocktype:after {\n  color: #ccc;\n}\n\n."+prefix+"-sliding {\n  -webkit-transition: left 0.2s ease-out;\n  -moz-transition: left 0.2s ease-out;\n  transition: left 0.2s ease-out;\n  position: relative;\n  left: 100%;\n  width: 100%;\n  box-sizing: -moz-border-box;\n  box-sizing: border-box;\n  padding-left: 16px;\n  background: white;\n}\n\n."+prefix+"-back {\n  position: absolute;\n  height: 100%;\n  margin-top: -1px;\n  padding-bottom: 2px;\n  width: 10px;\n  left: 0;\n  border-right: 1px solid silver;\n  cursor: pointer;\n}\n."+prefix+'-back:after {\n  content: "«";\n}\n\n')},{"../dom":1,"../edit":9,"../ui/update":47,"./menu":24}],26:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function getItems(pm,items){return Array.isArray(items)?items.map(getItems.bind(null,pm)):pm.commands[items]}function topCenterOfSelection(){for(var rects=window.getSelection().getRangeAt(0).getClientRects(),_rects$0=rects[0],left=_rects$0.left,right=_rects$0.right,top=_rects$0.top,i=1;left==right&&rects.length>i;){var _rects=rects[i++];left=_rects.left,right=_rects.right,top=_rects.top}for(;i<rects.length;i++)rects[i].top<rects[0].bottom-1&&(i==rects.length-1||Math.abs(rects[i+1].left-rects[i].left)>1)&&(left=Math.min(left,rects[i].left),right=Math.max(right,rects[i].right),top=Math.min(top,rects[i].top));return{top:top,left:(left+right)/2}}function topOfNodeSelection(pm){var selected=pm.content.querySelector(".ProseMirror-selectednode");if(!selected)return{left:0,top:0};var box=selected.getBoundingClientRect();return{left:Math.min((box.left+box.right)/2,box.left+20),top:box.top}}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_model=require("../model"),_edit=require("../edit"),_dom=require("../dom"),_uiTooltip=require("../ui/tooltip"),_uiUpdate=require("../ui/update"),_menu=require("./menu"),classPrefix="ProseMirror-tooltipmenu";(0,_edit.defineOption)("tooltipMenu",!1,function(pm,value){pm.mod.tooltipMenu&&pm.mod.tooltipMenu.detach(),pm.mod.tooltipMenu=value?new TooltipMenu(pm,value):null});var TooltipMenu=function(){function TooltipMenu(pm,config){var _this=this;_classCallCheck(this,TooltipMenu),this.pm=pm,this.config=config||{},this.showLinks=this.config.showLinks!==!1,this.selectedBlockMenu=this.config.selectedBlockMenu,this.update=new _uiUpdate.UpdateScheduler(pm,"change selectionChange blur commandsChanged",function(){return _this.prepareUpdate()}),this.tooltip=new _uiTooltip.Tooltip(pm.wrapper,"above"),this.menu=new _menu.Menu(pm,new _menu.TooltipDisplay(this.tooltip,function(){return _this.update.force()}))}return _createClass(TooltipMenu,[{key:"detach",value:function(){this.update.detach(),this.tooltip.detach()}},{key:"items",value:function items(inline,block){var items=void 0;return items=inline?this.config.inlineItems?getItems(this.pm,this.config.inlineItems):(0,_menu.menuGroups)(this.pm,this.config.inlineGroups||["inline"]):[],block&&(items=this.config.blockItems?items.concat(getItems(this.pm,this.config.blockItems)):items.concat((0,_menu.menuGroups)(this.pm,this.config.blockGroups||["block"]))),items}},{key:"prepareUpdate",value:function(){var _this2=this;if(this.menu.active)return null;var _pm$selection=this.pm.selection,empty=_pm$selection.empty,node=_pm$selection.node,from=_pm$selection.from,to=_pm$selection.to,link=void 0;if(!this.pm.hasFocus())return function(){return _this2.tooltip.close()};if(node&&node.isBlock){var _ret=function(){var coords=topOfNodeSelection(_this2.pm);return{v:function(){return _this2.menu.show(_this2.items(!1,!0),coords)}}}();if("object"==typeof _ret)return _ret.v}else if(empty)if(this.selectedBlockMenu&&0==this.pm.doc.path(from.path).size){var _ret3=function(){var coords=_this2.pm.coordsAtPos(from);return{v:function(){return _this2.menu.show(_this2.items(!1,!0),coords)}}}();if("object"==typeof _ret3)return _ret3.v}else{if(!this.showLinks||!(link=this.linkUnderCursor()))return function(){return _this2.tooltip.close()};var _ret4=function(){var coords=_this2.pm.coordsAtPos(from);return{v:function(){return _this2.showLink(link,coords)}}}();if("object"==typeof _ret4)return _ret4.v}else{var _ret2=function(){var coords=node?topOfNodeSelection(_this2.pm):topCenterOfSelection(),showBlock=_this2.selectedBlockMenu&&_model.Pos.samePath(from.path,to.path)&&0==from.offset&&to.offset==_this2.pm.doc.path(from.path).size;return{v:function(){return _this2.menu.show(_this2.items(!0,showBlock),coords)}}}();if("object"==typeof _ret2)return _ret2.v}}},{key:"linkUnderCursor",value:function(){var head=this.pm.selection.head;if(!head)return null;var marks=this.pm.doc.marksAt(head);return marks.reduce(function(found,m){return found||"link"==m.type.name&&m},null)}},{key:"showLink",value:function(link,pos){var node=(0,_dom.elt)("div",{"class":classPrefix+"-linktext"},(0,_dom.elt)("a",{href:link.attrs.href,title:link.attrs.title},link.attrs.href));this.tooltip.open(node,pos)}}]),TooltipMenu}();(0,_dom.insertCSS)("\n\n."+classPrefix+"-linktext a {\n  color: white;\n  text-decoration: none;\n  padding: 0 5px;\n}\n\n."+classPrefix+"-linktext a:hover {\n  text-decoration: underline;\n}\n\n")},{"../dom":1,"../edit":9,"../model":31,"../ui/tooltip":46,"../ui/update":47,"./menu":24}],27:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}},_schema=require("./schema"),Doc=function(_Block){function Doc(){_classCallCheck(this,Doc),_get(Object.getPrototypeOf(Doc.prototype),"constructor",this).apply(this,arguments)}return _inherits(Doc,_Block),_createClass(Doc,null,[{key:"kinds",get:function(){return"doc"}}]),Doc}(_schema.Block);exports.Doc=Doc;var BlockQuote=function(_Block2){function BlockQuote(){_classCallCheck(this,BlockQuote),
_get(Object.getPrototypeOf(BlockQuote.prototype),"constructor",this).apply(this,arguments)}return _inherits(BlockQuote,_Block2),BlockQuote}(_schema.Block);exports.BlockQuote=BlockQuote;var OrderedList=function(_Block3){function OrderedList(){_classCallCheck(this,OrderedList),_get(Object.getPrototypeOf(OrderedList.prototype),"constructor",this).apply(this,arguments)}return _inherits(OrderedList,_Block3),_createClass(OrderedList,[{key:"contains",get:function(){return"list_item"}},{key:"isList",get:function(){return!0}},{key:"attrs",get:function(){new _schema.Attribute({"default":"1"})}}]),OrderedList}(_schema.Block);exports.OrderedList=OrderedList;var BulletList=function(_Block4){function BulletList(){_classCallCheck(this,BulletList),_get(Object.getPrototypeOf(BulletList.prototype),"constructor",this).apply(this,arguments)}return _inherits(BulletList,_Block4),_createClass(BulletList,[{key:"contains",get:function(){return"list_item"}},{key:"isList",get:function(){return!0}}]),BulletList}(_schema.Block);exports.BulletList=BulletList;var ListItem=function(_Block5){function ListItem(){_classCallCheck(this,ListItem),_get(Object.getPrototypeOf(ListItem.prototype),"constructor",this).apply(this,arguments)}return _inherits(ListItem,_Block5),_createClass(ListItem,null,[{key:"kinds",get:function(){return"list_item"}}]),ListItem}(_schema.Block);exports.ListItem=ListItem;var HorizontalRule=function(_Block6){function HorizontalRule(){_classCallCheck(this,HorizontalRule),_get(Object.getPrototypeOf(HorizontalRule.prototype),"constructor",this).apply(this,arguments)}return _inherits(HorizontalRule,_Block6),_createClass(HorizontalRule,[{key:"contains",get:function(){return null}}]),HorizontalRule}(_schema.Block);exports.HorizontalRule=HorizontalRule;var Heading=function(_Textblock){function Heading(){_classCallCheck(this,Heading),_get(Object.getPrototypeOf(Heading.prototype),"constructor",this).apply(this,arguments)}return _inherits(Heading,_Textblock),_createClass(Heading,[{key:"attrs",get:function(){return{level:new _schema.Attribute({"default":"1"})}}}]),Heading}(_schema.Textblock);exports.Heading=Heading;var CodeBlock=function(_Textblock2){function CodeBlock(){_classCallCheck(this,CodeBlock),_get(Object.getPrototypeOf(CodeBlock.prototype),"constructor",this).apply(this,arguments)}return _inherits(CodeBlock,_Textblock2),_createClass(CodeBlock,[{key:"contains",get:function(){return"text"}},{key:"containsMarks",get:function(){return!1}},{key:"isCode",get:function(){return!0}}]),CodeBlock}(_schema.Textblock);exports.CodeBlock=CodeBlock;var Paragraph=function(_Textblock3){function Paragraph(){_classCallCheck(this,Paragraph),_get(Object.getPrototypeOf(Paragraph.prototype),"constructor",this).apply(this,arguments)}return _inherits(Paragraph,_Textblock3),_createClass(Paragraph,[{key:"defaultTextblock",get:function(){return!0}}]),Paragraph}(_schema.Textblock);exports.Paragraph=Paragraph;var Image=function(_Inline){function Image(){_classCallCheck(this,Image),_get(Object.getPrototypeOf(Image.prototype),"constructor",this).apply(this,arguments)}return _inherits(Image,_Inline),_createClass(Image,[{key:"attrs",get:function(){return{src:new _schema.Attribute,alt:new _schema.Attribute({"default":""}),title:new _schema.Attribute({"default":""})}}}]),Image}(_schema.Inline);exports.Image=Image;var HardBreak=function(_Inline2){function HardBreak(){_classCallCheck(this,HardBreak),_get(Object.getPrototypeOf(HardBreak.prototype),"constructor",this).apply(this,arguments)}return _inherits(HardBreak,_Inline2),_createClass(HardBreak,[{key:"selectable",get:function(){return!1}},{key:"isBR",get:function(){return!0}}]),HardBreak}(_schema.Inline);exports.HardBreak=HardBreak;var EmMark=function(_MarkType){function EmMark(){_classCallCheck(this,EmMark),_get(Object.getPrototypeOf(EmMark.prototype),"constructor",this).apply(this,arguments)}return _inherits(EmMark,_MarkType),_createClass(EmMark,null,[{key:"rank",get:function(){return 51}}]),EmMark}(_schema.MarkType);exports.EmMark=EmMark;var StrongMark=function(_MarkType2){function StrongMark(){_classCallCheck(this,StrongMark),_get(Object.getPrototypeOf(StrongMark.prototype),"constructor",this).apply(this,arguments)}return _inherits(StrongMark,_MarkType2),_createClass(StrongMark,null,[{key:"rank",get:function(){return 52}}]),StrongMark}(_schema.MarkType);exports.StrongMark=StrongMark;var LinkMark=function(_MarkType3){function LinkMark(){_classCallCheck(this,LinkMark),_get(Object.getPrototypeOf(LinkMark.prototype),"constructor",this).apply(this,arguments)}return _inherits(LinkMark,_MarkType3),_createClass(LinkMark,[{key:"attrs",get:function(){return{href:new _schema.Attribute,title:new _schema.Attribute({"default":""})}}}],[{key:"rank",get:function(){return 53}}]),LinkMark}(_schema.MarkType);exports.LinkMark=LinkMark;var CodeMark=function(_MarkType4){function CodeMark(){_classCallCheck(this,CodeMark),_get(Object.getPrototypeOf(CodeMark.prototype),"constructor",this).apply(this,arguments)}return _inherits(CodeMark,_MarkType4),_createClass(CodeMark,[{key:"isCode",get:function(){return!0}}],[{key:"rank",get:function(){return 101}}]),CodeMark}(_schema.MarkType);exports.CodeMark=CodeMark;var defaultSpec=new _schema.SchemaSpec({doc:Doc,blockquote:BlockQuote,ordered_list:OrderedList,bullet_list:BulletList,list_item:ListItem,horizontal_rule:HorizontalRule,paragraph:Paragraph,heading:Heading,code_block:CodeBlock,text:_schema.Text,image:Image,hard_break:HardBreak},{em:EmMark,strong:StrongMark,link:LinkMark,code:CodeMark}),defaultSchema=new _schema.Schema(defaultSpec);exports.defaultSchema=defaultSchema},{"./schema":35}],28:[function(require,module,exports){"use strict";function findDiffStart(a,b){for(var path=arguments.length<=2||void 0===arguments[2]?[]:arguments[2],iA=a.iter(),iB=b.iter(),offset=0;;){if(iA.atEnd()||iB.atEnd()){if(a.size==b.size)return null;break}var childA=iA.next(),childB=iB.next();if(childA!=childB){if(!childA.sameMarkup(childB))break;if(childA.isText&&childA.text!=childB.text){for(var j=0;childA.text[j]==childB.text[j];j++)offset++;break}if(childA.size||childB.size){path.push(offset);var inner=findDiffStart(childA.content,childB.content,path);if(inner)return inner;path.pop()}offset+=childA.width}else offset+=childA.width}return new _pos.Pos(path,offset)}function findDiffEnd(a,b){for(var pathA=arguments.length<=2||void 0===arguments[2]?[]:arguments[2],pathB=arguments.length<=3||void 0===arguments[3]?[]:arguments[3],iA=a.reverseIter(),iB=b.reverseIter(),offA=a.size,offB=b.size;;){if(iA.atEnd()||iB.atEnd()){if(a.size==b.size)return null;break}var childA=iA.next(),childB=iB.next();if(childA!=childB){if(!childA.sameMarkup(childB))break;if(childA.isText&&childA.text!=childB.text){for(var same=0,minSize=Math.min(childA.text.length,childB.text.length);minSize>same&&childA.text[childA.text.length-same-1]==childB.text[childB.text.length-same-1];)same++,offA--,offB--;break}if(offA-=childA.width,offB-=childB.width,childA.size||childB.size){pathA.push(offA),pathB.push(offB);var inner=findDiffEnd(childA.content,childB.content,pathA,pathB);if(inner)return inner;pathA.pop(),pathB.pop()}}else offA-=childA.width,offB-=childB.width}return{a:new _pos.Pos(pathA,offA),b:new _pos.Pos(pathB,offB)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.findDiffStart=findDiffStart,exports.findDiffEnd=findDiffEnd;var _pos=require("./pos")},{"./pos":34}],29:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _get=function(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}},_utilError=require("../util/error"),ModelError=function(_ProseMirrorError){function ModelError(){_classCallCheck(this,ModelError),_get(Object.getPrototypeOf(ModelError.prototype),"constructor",this).apply(this,arguments)}return _inherits(ModelError,_ProseMirrorError),ModelError}(_utilError.ProseMirrorError);exports.ModelError=ModelError},{"../util/error":48}],30:[function(require,module,exports){"use strict";function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _get=function(_x16,_x17,_x18){for(var _again=!0;_again;){var object=_x16,property=_x17,receiver=_x18;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x16=parent,_x17=property,_x18=receiver,_again=!0,desc=parent=void 0}},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_error=require("./error"),Fragment=function(){function Fragment(){_classCallCheck(this,Fragment)}return _createClass(Fragment,[{key:"append",value:function(other){var joinLeft=arguments.length<=1||void 0===arguments[1]?0:arguments[1],joinRight=arguments.length<=2||void 0===arguments[2]?0:arguments[2];return this.size?other.size?this.appendInner(other,joinLeft,joinRight):joinLeft?this.replace(this.size-1,this.lastChild.close(joinLeft-1,"end")):this:joinRight?other.replace(0,other.firstChild.close(joinRight-1,"start")):other}},{key:"toString",value:function(){var str="";return this.forEach(function(n){return str+=(str?", ":"")+n.toString()}),str}},{key:"toArray",value:function(from,to,f){void 0===from&&(from=0),void 0===to&&(to=this.size);for(var result=[],iter=this.iter(from,to),n=void 0;n=iter.next().value;)result.push(f?f(n):n);return result}},{key:"map",value:function(f){return Fragment.fromArray(this.toArray(void 0,void 0,f))}},{key:"some",value:function(f){for(var iter=this.iter(),n=void 0;n=iter.next().value;)if(f(n))return n}},{key:"close",value:function(depth,side){var child="start"==side?this.firstChild:this.lastChild,closed=child.close(depth-1,side);return closed==child?this:this.replace("start"==side?0:this.size-1,closed)}},{key:"nodesBetween",value:function(from,to,f,path,parent){for(var moreFrom=from&&from.depth>path.length,moreTo=to&&to.depth>path.length,start=moreFrom?from.path[path.length]:from?from.offset:0,end=moreTo?to.path[path.length]+1:to?to.offset:this.size,iter=this.iter(start,end),node=void 0;node=iter.next().value;){var startOffset=iter.offset-node.width;path.push(startOffset),node.nodesBetween(moreFrom&&startOffset==start?from:null,moreTo&&iter.offset==end?to:null,f,path,parent),path.pop()}}},{key:"sliceBetween",value:function(from,to){for(var depth=arguments.length<=2||void 0===arguments[2]?0:arguments[2],moreFrom=from&&from.depth>depth,moreTo=to&&to.depth>depth,start=moreFrom?from.path[depth]:from?from.offset:0,end=moreTo?to.path[depth]+1:to?to.offset:this.size,nodes=[],iter=this.iter(start,end),node=void 0;node=iter.next().value;){var passFrom=moreFrom&&iter.offset-node.width==start?from:null,passTo=moreTo&&iter.offset==end?to:null;(passFrom||passTo)&&(node=node.sliceBetween(passFrom,passTo,depth+1)),nodes.push(node)}return new this.constructor(nodes)}},{key:"textContent",get:function(){var text="";return this.forEach(function(n){return text+=n.textContent}),text}}],[{key:"fromJSON",value:function(schema,value){return value?this.fromArray(value.map(schema.nodeFromJSON)):emptyFragment}},{key:"fromArray",value:function(array){if(!array.length)return emptyFragment;for(var hasText=!1,joined=void 0,i=0;i<array.length;i++){var node=array[i];node.isText&&(hasText=!0,i&&array[i-1].sameMarkup(node))?(joined||(joined=array.slice(0,i)),joined[joined.length-1]=node.copy(joined[joined.length-1].text+node.text)):joined&&joined.push(node)}return hasText?new TextFragment(joined||array):new FlatFragment(array)}},{key:"from",value:function(nodes){return nodes?nodes instanceof Fragment?nodes:this.fromArray(Array.isArray(nodes)?nodes:[nodes]):emptyFragment}}]),Fragment}();exports.Fragment=Fragment;var iterEnd={done:!0},FlatIterator=function(){function FlatIterator(array,pos,end){_classCallCheck(this,FlatIterator),this.array=array,this.pos=pos,this.end=end}return _createClass(FlatIterator,[{key:"copy",value:function(){return new this.constructor(this.array,this.pos,this.end)}},{key:"atEnd",value:function(){return this.pos==this.end}},{key:"next",value:function(){return this.pos==this.end?iterEnd:this.array[this.pos++]}},{key:"offset",get:function(){return this.pos}}]),FlatIterator}(),ReverseFlatIterator=function(_FlatIterator){function ReverseFlatIterator(){_classCallCheck(this,ReverseFlatIterator),_get(Object.getPrototypeOf(ReverseFlatIterator.prototype),"constructor",this).apply(this,arguments)}return _inherits(ReverseFlatIterator,_FlatIterator),_createClass(ReverseFlatIterator,[{key:"next",value:function(){return this.pos==this.end?iterEnd:this.array[--this.pos]}}]),ReverseFlatIterator}(FlatIterator),FlatFragment=function(_Fragment){function FlatFragment(content){_classCallCheck(this,FlatFragment),_get(Object.getPrototypeOf(FlatFragment.prototype),"constructor",this).call(this),this.content=content}return _inherits(FlatFragment,_Fragment),_createClass(FlatFragment,[{key:"iter",value:function(){var start=arguments.length<=0||void 0===arguments[0]?0:arguments[0],end=arguments.length<=1||void 0===arguments[1]?this.size:arguments[1];return new FlatIterator(this.content,start,end)}},{key:"reverseIter",value:function(){var start=arguments.length<=0||void 0===arguments[0]?this.size:arguments[0],end=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return new ReverseFlatIterator(this.content,start,end)}},{key:"child",value:function(off){return(0>off||off>=this.content.length)&&_error.ModelError.raise("Offset "+off+" out of range"),this.content[off]}},{key:"forEach",value:function(f){for(var i=0;i<this.content.length;i++)f(this.content[i],i,i+1)}},{key:"chunkBefore",value:function(off){return{node:this.child(off-1),start:off-1}}},{key:"chunkAfter",value:function(off){return{node:this.child(off),start:off}}},{key:"slice",value:function(from){var to=arguments.length<=1||void 0===arguments[1]?this.size:arguments[1];return from==to?emptyFragment:new FlatFragment(this.content.slice(from,to))}},{key:"replace",value:function(offset,node){node.isText&&_error.ModelError.raise("Argument to replace should be a non-text node");var copy=this.content.slice();return copy[offset]=node,new FlatFragment(copy)}},{key:"appendInner",value:function(other,joinLeft,joinRight){var last=this.content.length-1,content=this.content.slice(0,last),before=this.content[last],after=other.firstChild;return joinLeft>0&&joinRight>0&&before.sameMarkup(after)?content.push(before.append(after.content,joinLeft-1,joinRight-1)):content.push(before.close(joinLeft-1,"end"),after.close(joinRight-1,"start")),Fragment.fromArray(content.concat(other.toArray(after.width)))}},{key:"toJSON",value:function(){return this.content.map(function(n){return n.toJSON()})}},{key:"size",get:function(){return this.content.length}},{key:"firstChild",get:function(){return this.content.length?this.content[0]:null}},{key:"lastChild",get:function(){return this.content.length?this.content[this.content.length-1]:null}}]),FlatFragment}(Fragment),emptyFragment=new FlatFragment([]);exports.emptyFragment=emptyFragment;var TextIterator=function(){function TextIterator(fragment,startOffset,endOffset){var pos=arguments.length<=3||void 0===arguments[3]?-1:arguments[3];_classCallCheck(this,TextIterator),this.frag=fragment,this.offset=startOffset,this.pos=pos,this.endOffset=endOffset}return _createClass(TextIterator,[{key:"copy",value:function(){return new this.constructor(this.frag,this.offset,this.endOffset,this.pos)}},{key:"atEnd",value:function(){return this.offset==this.endOffset}},{key:"next",value:function(){if(-1==this.pos){var start=this.init();if(start)return start}return this.offset==this.endOffset?iterEnd:this.advance()}},{key:"advance",value:function(){var node=this.frag.content[this.pos++],end=this.offset+node.width;return end>this.endOffset?(node=node.copy(node.text.slice(0,this.endOffset-this.offset)),this.offset=this.endOffset,node):(this.offset=end,node)}},{key:"init",value:function(){this.pos=0;for(var offset=0;offset<this.offset;){var node=this.frag.content[this.pos++],end=offset+node.width;if(end==this.offset)break;if(end>this.offset){var sliceEnd=node.width;return end>this.endOffset&&(sliceEnd=this.endOffset-offset,end=this.endOffset),node=node.copy(node.text.slice(this.offset-offset,sliceEnd)),this.offset=end,node}offset=end}}}]),TextIterator}(),ReverseTextIterator=function(_TextIterator){function ReverseTextIterator(){_classCallCheck(this,ReverseTextIterator),_get(Object.getPrototypeOf(ReverseTextIterator.prototype),"constructor",this).apply(this,arguments)}return _inherits(ReverseTextIterator,_TextIterator),_createClass(ReverseTextIterator,[{key:"advance",value:function(){var node=this.frag.content[--this.pos],end=this.offset-node.width;return end<this.endOffset?(node=node.copy(node.text.slice(this.endOffset-end)),this.offset=this.endOffset,node):(this.offset=end,node)}},{key:"init",value:function(){this.pos=this.frag.content.length;for(var offset=this.frag.size;offset>this.offset;){var node=this.frag.content[--this.pos],end=offset-node.width;if(end==this.offset)break;if(end<this.offset)return end<this.endOffset?(node=node.copy(node.text.slice(this.endOffset-end,this.offset-end)),end=this.endOffset):node=node.copy(node.text.slice(0,this.offset-end)),this.offset=end,node;offset=end}}}]),ReverseTextIterator}(TextIterator),TextFragment=function(_Fragment2){function TextFragment(content,size){if(_classCallCheck(this,TextFragment),_get(Object.getPrototypeOf(TextFragment.prototype),"constructor",this).call(this),this.content=content,this.size=size||0,null==size)for(var i=0;i<content.length;i++)this.size+=content[i].width}return _inherits(TextFragment,_Fragment2),_createClass(TextFragment,[{key:"iter",value:function(){var from=arguments.length<=0||void 0===arguments[0]?0:arguments[0],to=arguments.length<=1||void 0===arguments[1]?this.size:arguments[1];return new TextIterator(this,from,to)}},{key:"reverseIter",value:function(){var from=arguments.length<=0||void 0===arguments[0]?this.size:arguments[0],to=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return new ReverseTextIterator(this,from,to)}},{key:"child",value:function child(off){(0>off||off>=this.size)&&_error.ModelError.raise("Offset "+off+" out of range");for(var i=0,curOff=0;i<this.content.length;i++){var child=this.content[i];if(curOff+=child.width,curOff>off)return child}}},{key:"forEach",value:function(f){for(var i=0,off=0;i<this.content.length;i++){var child=this.content[i];f(child,off,off+=child.width)}}},{key:"chunkBefore",value:function(off){off||_error.ModelError.raise("No chunk before start of node");for(var i=0,curOff=0;i<this.content.length;i++){var child=this.content[i],end=curOff+child.width;if(end>=off)return{node:child,start:curOff};curOff=end}}},{key:"chunkAfter",value:function(off){off==this.size&&_error.ModelError.raise("No chunk after end of node");for(var i=0,curOff=0;i<this.content.length;i++){var child=this.content[i],end=curOff+child.width;if(end>off)return{node:child,start:curOff};curOff=end}}},{key:"slice",value:function(){var from=arguments.length<=0||void 0===arguments[0]?0:arguments[0],to=arguments.length<=1||void 0===arguments[1]?this.size:arguments[1];return from==to?emptyFragment:new TextFragment(this.toArray(from,to))}},{key:"replace",value:function(off,node){node.isText&&_error.ModelError.raise("Argument to replace should be a non-text node");for(var curNode=void 0,index=void 0,curOff=0;off>curOff;index++)curNode=this.content[index],curOff+=curNode.width;curNode.isText&&_error.ModelError.raise("Can not replace text content with replace method");var copy=this.content.slice();return copy[index]=node,new TextFragment(copy)}},{key:"appendInner",value:function(other,joinLeft,joinRight){var last=this.content.length-1,content=this.content.slice(0,last),before=this.content[last],after=other.firstChild,same=before.sameMarkup(after);return same&&before.isText?content.push(before.copy(before.text+after.text)):same&&joinLeft>0&&joinRight>0?content.push(before.append(after.content,joinLeft-1,joinRight-1)):content.push(before.close(joinLeft-1,"end"),after.close(joinRight-1,"start")),Fragment.fromArray(content.concat(other.toArray(after.width)))}},{key:"toJSON",value:function(){return this.content.map(function(n){return n.toJSON()})}},{key:"firstChild",get:function(){return this.size?this.content[0]:null}},{key:"lastChild",get:function(){return this.size?this.content[this.content.length-1]:null}}]),TextFragment}(Fragment);"undefined"!=typeof Symbol&&(Fragment.prototype[Symbol.iterator]=function(){return this.iter()},FlatIterator.prototype[Symbol.iterator]=TextIterator.prototype[Symbol.iterator]=function(){return this})},{"./error":29}],31:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _node=require("./node");Object.defineProperty(exports,"Node",{enumerable:!0,get:function(){return _node.Node}});var _fragment=require("./fragment");Object.defineProperty(exports,"Fragment",{enumerable:!0,get:function(){return _fragment.Fragment}}),Object.defineProperty(exports,"emptyFragment",{enumerable:!0,get:function(){return _fragment.emptyFragment}});var _mark=require("./mark");Object.defineProperty(exports,"Mark",{enumerable:!0,get:function(){return _mark.Mark}});var _schema=require("./schema");Object.defineProperty(exports,"SchemaSpec",{enumerable:!0,get:function(){return _schema.SchemaSpec}}),Object.defineProperty(exports,"Schema",{enumerable:!0,get:function(){return _schema.Schema}}),Object.defineProperty(exports,"SchemaError",{enumerable:!0,get:function(){return _schema.SchemaError}}),Object.defineProperty(exports,"NodeType",{enumerable:!0,get:function(){return _schema.NodeType}}),Object.defineProperty(exports,"Block",{enumerable:!0,get:function(){return _schema.Block}}),Object.defineProperty(exports,"Textblock",{enumerable:!0,get:function(){return _schema.Textblock}}),Object.defineProperty(exports,"Inline",{enumerable:!0,get:function(){return _schema.Inline}}),Object.defineProperty(exports,"Text",{enumerable:!0,get:function(){return _schema.Text}}),Object.defineProperty(exports,"MarkType",{enumerable:!0,get:function(){return _schema.MarkType}}),Object.defineProperty(exports,"Attribute",{enumerable:!0,get:function(){return _schema.Attribute}});var _defaultschema=require("./defaultschema");Object.defineProperty(exports,"defaultSchema",{enumerable:!0,get:function(){return _defaultschema.defaultSchema}}),Object.defineProperty(exports,"Doc",{enumerable:!0,get:function(){return _defaultschema.Doc}}),Object.defineProperty(exports,"BlockQuote",{enumerable:!0,get:function(){return _defaultschema.BlockQuote}}),Object.defineProperty(exports,"OrderedList",{enumerable:!0,get:function(){return _defaultschema.OrderedList}}),Object.defineProperty(exports,"BulletList",{enumerable:!0,get:function(){return _defaultschema.BulletList}}),Object.defineProperty(exports,"ListItem",{enumerable:!0,get:function(){return _defaultschema.ListItem}}),Object.defineProperty(exports,"HorizontalRule",{enumerable:!0,get:function(){return _defaultschema.HorizontalRule}}),Object.defineProperty(exports,"Paragraph",{enumerable:!0,get:function(){return _defaultschema.Paragraph}}),Object.defineProperty(exports,"Heading",{enumerable:!0,get:function(){return _defaultschema.Heading}}),Object.defineProperty(exports,"CodeBlock",{enumerable:!0,get:function(){return _defaultschema.CodeBlock}}),Object.defineProperty(exports,"Image",{enumerable:!0,get:function(){return _defaultschema.Image}}),Object.defineProperty(exports,"HardBreak",{enumerable:!0,get:function(){return _defaultschema.HardBreak}}),Object.defineProperty(exports,"CodeMark",{enumerable:!0,get:function(){return _defaultschema.CodeMark}}),Object.defineProperty(exports,"EmMark",{enumerable:!0,get:function(){return _defaultschema.EmMark}}),Object.defineProperty(exports,"StrongMark",{enumerable:!0,get:function(){return _defaultschema.StrongMark}}),Object.defineProperty(exports,"LinkMark",{enumerable:!0,get:function(){return _defaultschema.LinkMark}});var _pos=require("./pos");Object.defineProperty(exports,"Pos",{enumerable:!0,get:function(){return _pos.Pos}});var _diff=require("./diff");Object.defineProperty(exports,"findDiffStart",{enumerable:!0,get:function(){return _diff.findDiffStart}}),Object.defineProperty(exports,"findDiffEnd",{enumerable:!0,get:function(){return _diff.findDiffEnd}});var _error=require("./error");Object.defineProperty(exports,"ModelError",{enumerable:!0,get:function(){return _error.ModelError}})},{"./defaultschema":27,"./diff":28,"./error":29,"./fragment":30,"./mark":32,"./node":33,"./pos":34,"./schema":35}],32:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Mark=function(){function Mark(type,attrs){_classCallCheck(this,Mark),this.type=type,this.attrs=attrs}return _createClass(Mark,[{key:"toJSON",value:function(){if(this.type.instance)return this.type.name;var obj={_:this.type.name};for(var attr in this.attrs)obj[attr]=this.attrs[attr];return obj}},{key:"addToSet",value:function(set){for(var i=0;i<set.length;i++){var other=set[i];if(other.type==this.type)return this.eq(other)?set:set.slice(0,i).concat(this).concat(set.slice(i+1));if(other.type.rank>this.type.rank)return set.slice(0,i).concat(this).concat(set.slice(i))}return set.concat(this)}},{key:"removeFromSet",value:function(set){for(var i=0;i<set.length;i++)if(this.eq(set[i]))return set.slice(0,i).concat(set.slice(i+1));return set}},{key:"isInSet",value:function(set){for(var i=0;i<set.length;i++)if(this.eq(set[i]))return!0;return!1}},{key:"eq",value:function(other){if(this==other)return!0;if(this.type!=other.type)return!1;for(var attr in this.attrs)if(other.attrs[attr]!=this.attrs[attr])return!1;return!0}}],[{key:"sameSet",value:function(a,b){if(a==b)return!0;if(a.length!=b.length)return!1;for(var i=0;i<a.length;i++)if(!a[i].eq(b[i]))return!1;return!0}},{key:"setFrom",value:function(marks){if(!marks||0==marks.length)return empty;if(marks instanceof Mark)return[marks];var copy=marks.slice();return copy.sort(function(a,b){return a.type.rank-b.type.rank}),copy}}]),Mark}();exports.Mark=Mark;var empty=[]},{}],33:[function(require,module,exports){"use strict";function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function wrapMarks(marks,str){for(var i=marks.length-1;i>=0;i--)str=marks[i].type.name+"("+str+")";return str}Object.defineProperty(exports,"__esModule",{value:!0});var _get=function(_x8,_x9,_x10){for(var _again=!0;_again;){var object=_x8,property=_x9,receiver=_x10;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x8=parent,_x9=property,_x10=receiver,_again=!0,desc=parent=void 0}},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_fragment=require("./fragment"),_mark=require("./mark"),_pos=require("./pos"),emptyArray=[],emptyAttrs=Object.create(null),Node=function(){function Node(type,attrs,content,marks){_classCallCheck(this,Node),this.type=type,this.attrs=attrs,this.content=content||_fragment.emptyFragment,this.marks=marks||emptyArray}return _createClass(Node,[{key:"child",value:function(off){return this.content.child(off)}},{key:"iter",value:function(start,end){return this.content.iter(start,end)}},{key:"reverseIter",value:function(start,end){return this.content.reverseIter(start,end)}},{key:"chunkBefore",value:function(off){return this.content.chunkBefore(off)}},{key:"chunkAfter",value:function(off){return this.content.chunkAfter(off)}},{key:"forEach",value:function(f){this.content.forEach(f)}},{key:"sameMarkup",value:function(other){return this.hasMarkup(other.type,other.attrs,other.marks)}},{key:"hasMarkup",value:function(type,attrs,marks){return this.type==type&&Node.sameAttrs(this.attrs,attrs||emptyAttrs)&&_mark.Mark.sameSet(this.marks,marks||emptyArray)}},{key:"copy",value:function(){var content=arguments.length<=0||void 0===arguments[0]?null:arguments[0];return new this.constructor(this.type,this.attrs,content,this.marks)}},{key:"mark",value:function(marks){return new this.constructor(this.type,this.attrs,this.content,marks)}},{key:"slice",value:function(from,to){return this.copy(this.content.slice(from,to))}},{key:"splice",value:function(from,to,replace){return this.copy(this.content.slice(0,from).append(replace).append(this.content.slice(to)));
}},{key:"append",value:function(fragment){var joinLeft=arguments.length<=1||void 0===arguments[1]?0:arguments[1],joinRight=arguments.length<=2||void 0===arguments[2]?0:arguments[2];return this.copy(this.content.append(fragment,joinLeft,joinRight))}},{key:"replace",value:function(pos,node){return this.copy(this.content.replace(pos,node))}},{key:"replaceDeep",value:function(path,node){var depth=arguments.length<=2||void 0===arguments[2]?0:arguments[2];if(depth==path.length)return node;var pos=path[depth];return this.replace(pos,this.child(pos).replaceDeep(path,node,depth+1))}},{key:"close",value:function(depth,side){if(0==depth&&0==this.size&&!this.type.canBeEmpty)return this.copy(this.type.defaultContent());var closedContent=void 0;return depth>0&&(closedContent=this.content.close(depth-1,side))!=this.content?this.copy(closedContent):this}},{key:"path",value:function(_path){for(var i=0,node=this;i<_path.length;node=node.child(_path[i]),i++);return node}},{key:"nodeAfter",value:function(pos){return this.path(pos.path).child(pos.offset)}},{key:"pathNodes",value:function(path){for(var nodes=[],i=0,node=this;nodes.push(node),i!=path.length;i++)node=node.child(path[i]);return nodes}},{key:"isValidPos",value:function(pos,requireTextblock){for(var i=0,node=this;;i++){if(i==pos.path.length)return requireTextblock&&!node.isTextblock?!1:pos.offset<=node.size;var n=pos.path[i];if(n>=node.size)return!1;node=node.child(n)}}},{key:"siblingRange",value:function(from,to){for(var i=0,node=this;;i++){if(node.isTextblock){var path=from.path.slice(0,i-1),offset=from.path[i-1];return{from:new _pos.Pos(path,offset),to:new _pos.Pos(path,offset+1)}}var fromEnd=i==from.path.length,toEnd=i==to.path.length,left=fromEnd?from.offset:from.path[i],right=toEnd?to.offset:to.path[i];if(fromEnd||toEnd||left!=right){var path=from.path.slice(0,i);return{from:new _pos.Pos(path,left),to:new _pos.Pos(path,right+(toEnd?0:1))}}node=node.child(left)}}},{key:"nodesBetween",value:function(from,to,f){var path=arguments.length<=3||void 0===arguments[3]?[]:arguments[3],parent=arguments.length<=4||void 0===arguments[4]?null:arguments[4];f(this,path,parent)!==!1&&this.content.nodesBetween(from,to,f,path,this)}},{key:"inlineNodesBetween",value:function(from,to,f){this.nodesBetween(from,to,function(node,path,parent){if(node.isInline){var last=path.length-1;f(node,path.slice(0,last),path[last],path[last]+node.width,parent)}})}},{key:"sliceBetween",value:function(from,to){var depth=arguments.length<=2||void 0===arguments[2]?0:arguments[2];return this.copy(this.content.sliceBetween(from,to,depth))}},{key:"marksAt",value:function(pos){var parent=this.path(pos.path);return parent.isTextblock&&parent.size?parent.chunkBefore(pos.offset||1).node.marks:emptyArray}},{key:"rangeHasMark",value:function(from,to,type){var found=!1;return this.nodesBetween(from,to,function(node){type.isInSet(node.marks)&&(found=!0)}),found}},{key:"toString",value:function(){var name=this.type.name;return this.content.size&&(name+="("+this.content.toString()+")"),wrapMarks(this.marks,name)}},{key:"toJSON",value:function(){var obj={type:this.type.name};for(var _ in this.attrs){obj.attrs=this.attrs;break}return this.size&&(obj.content=this.content.toJSON()),this.marks.length&&(obj.marks=this.marks.map(function(n){return n.toJSON()})),obj}},{key:"size",get:function(){return this.content.size}},{key:"width",get:function(){return 1}},{key:"textContent",get:function(){return this.content.textContent}},{key:"firstChild",get:function(){return this.content.firstChild}},{key:"lastChild",get:function(){return this.content.lastChild}},{key:"isBlock",get:function(){return this.type.isBlock}},{key:"isTextblock",get:function(){return this.type.isTextblock}},{key:"isInline",get:function(){return this.type.isInline}},{key:"isText",get:function(){return this.type.isText}},{key:"value",get:function(){return this}}],[{key:"sameAttrs",value:function(a,b){if(a==b)return!0;for(var prop in a)if(a[prop]!==b[prop])return!1;return!0}},{key:"fromJSON",value:function(schema,json){var type=schema.nodeType(json.type),content=null!=json.text?json.text:_fragment.Fragment.fromJSON(schema,json.content);return type.create(json.attrs,content,json.marks&&json.marks.map(schema.markFromJSON))}}]),Node}();exports.Node=Node,"undefined"!=typeof Symbol&&(Node.prototype[Symbol.iterator]=function(){return this.iter()});var TextNode=function(_Node){function TextNode(type,attrs,content,marks){_classCallCheck(this,TextNode),_get(Object.getPrototypeOf(TextNode.prototype),"constructor",this).call(this,type,attrs,null,marks),this.text=content}return _inherits(TextNode,_Node),_createClass(TextNode,[{key:"toString",value:function(){return wrapMarks(this.marks,JSON.stringify(this.text))}},{key:"mark",value:function(marks){return new TextNode(this.type,this.attrs,this.text,marks)}},{key:"toJSON",value:function(){var base=_get(Object.getPrototypeOf(TextNode.prototype),"toJSON",this).call(this);return base.text=this.text,base}},{key:"textContent",get:function(){return this.text}},{key:"width",get:function(){return this.text.length}}]),TextNode}(Node);exports.TextNode=TextNode},{"./fragment":30,"./mark":32,"./pos":34}],34:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_error=require("./error"),Pos=function(){function Pos(path,offset){_classCallCheck(this,Pos),this.path=path,this.offset=offset}return _createClass(Pos,[{key:"toString",value:function(){return this.path.join("/")+":"+this.offset}},{key:"max",value:function(other){return this.cmp(other)>0?this:other}},{key:"min",value:function(other){return this.cmp(other)<0?this:other}},{key:"cmp",value:function(other){return other==this?0:Pos.cmp(this.path,this.offset,other.path,other.offset)}},{key:"shorten",value:function(){var to=arguments.length<=0||void 0===arguments[0]?null:arguments[0],offset=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return to>=this.depth?this:Pos.shorten(this.path,to,offset)}},{key:"move",value:function(by){return new Pos(this.path,this.offset+by)}},{key:"toPath",value:function(){var move=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return this.path.concat(this.offset+move)}},{key:"extend",value:function(pos){for(var path=this.path.slice(),add=this.offset,i=0;i<pos.path.length;i++)path.push(pos.path[i]+add),add=0;return new Pos(path,pos.offset+add)}},{key:"toJSON",value:function(){return this}},{key:"depth",get:function(){return this.path.length}}],[{key:"cmp",value:function(pathA,offsetA,pathB,offsetB){for(var lenA=pathA.length,lenB=pathB.length,i=0,end=Math.min(lenA,lenB);end>i;i++){var diff=pathA[i]-pathB[i];if(0!=diff)return diff}return lenA>lenB?offsetB<=pathA[i]?1:-1:lenB>lenA?offsetA<=pathB[i]?-1:1:offsetA-offsetB}},{key:"samePath",value:function(pathA,pathB){if(pathA.length!=pathB.length)return!1;for(var i=0;i<pathA.length;i++)if(pathA[i]!==pathB[i])return!1;return!0}},{key:"shorten",value:function(path){var to=arguments.length<=1||void 0===arguments[1]?null:arguments[1],offset=arguments.length<=2||void 0===arguments[2]?0:arguments[2];return null==to&&(to=path.length-1),new Pos(path.slice(0,to),path[to]+offset)}},{key:"from",value:function(array){var move=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return array.length||_error.ModelError.raise("Can't create a pos from an empty array"),new Pos(array.slice(0,array.length-1),array[array.length-1]+move)}},{key:"fromJSON",value:function(json){return new Pos(json.path,json.offset)}}]),Pos}();exports.Pos=Pos},{"./error":29}],35:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function copyObj(obj,f){var result=Object.create(null);for(var prop in obj)result[prop]=f?f(obj[prop]):obj[prop];return result}function overlayObj(obj,overlay){var copy=copyObj(obj);for(var _name8 in overlay){var value=overlay[_name8];null==value?delete copy[_name8]:copy[_name8]=value}return copy}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function(_x2,_x3,_x4){for(var _again=!0;_again;){var object=_x2,property=_x3,receiver=_x4;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x2=parent,_x3=property,_x4=receiver,_again=!0,desc=parent=void 0}},_node=require("./node"),_fragment=require("./fragment"),_mark=require("./mark"),_utilError=require("../util/error"),SchemaError=function(_ProseMirrorError){function SchemaError(){_classCallCheck(this,SchemaError),_get(Object.getPrototypeOf(SchemaError.prototype),"constructor",this).apply(this,arguments)}return _inherits(SchemaError,_ProseMirrorError),SchemaError}(_utilError.ProseMirrorError);exports.SchemaError=SchemaError;var SchemaItem=function(){function SchemaItem(){_classCallCheck(this,SchemaItem)}return _createClass(SchemaItem,[{key:"getDefaultAttrs",value:function(){var defaults=Object.create(null);for(var attrName in this.attrs){var attr=this.attrs[attrName];if(null==attr["default"])return null;defaults[attrName]=attr["default"]}return defaults}},{key:"computeAttrs",value:function(attrs,arg){var built=Object.create(null);for(var _name in this.attrs){var value=attrs&&attrs[_name];if(null==value){var attr=this.attrs[_name];null!=attr["default"]?value=attr["default"]:attr.compute?value=attr.compute(this,arg):SchemaError.raise("No value supplied for attribute "+_name)}built[_name]=value}return built}},{key:"freezeAttrs",value:function(){var frozen=Object.create(null);for(var _name2 in this.attrs)frozen[_name2]=this.attrs[_name2];Object.defineProperty(this,"attrs",{value:frozen})}},{key:"attrs",get:function(){return{}}}],[{key:"updateAttrs",value:function(attrs){this.prototype.attrs=overlayObj(this.prototype.attrs,attrs)}},{key:"register",value:function(name,value){var registry=this.prototype.hasOwnProperty("registry")?this.prototype.registry:this.prototype.registry=Object.create(null);(registry[name]||(registry[name]=[])).push(value)}}]),SchemaItem}(),NodeType=function(_SchemaItem){function NodeType(name,kind,schema){_classCallCheck(this,NodeType),_get(Object.getPrototypeOf(NodeType.prototype),"constructor",this).call(this),this.name=name,this.kind=kind,this.freezeAttrs(),this.defaultAttrs=this.getDefaultAttrs(),this.schema=schema}return _inherits(NodeType,_SchemaItem),_createClass(NodeType,[{key:"canContainFragment",value:function(fragment){var _this=this,ok=!0;return fragment.forEach(function(n){_this.canContain(n)||(ok=!1)}),ok}},{key:"canContain",value:function(node){if(!this.canContainType(node.type))return!1;for(var i=0;i<node.marks.length;i++)if(!this.canContainMark(node.marks[i]))return!1;return!0}},{key:"canContainMark",value:function(mark){var contains=this.containsMarks;if(contains===!0)return!0;if(contains)for(var i=0;i<contains.length;i++)if(contains[i]==mark.name)return!0;return!1}},{key:"canContainType",value:function(type){return this.schema.subKind(type.kind,this.contains)}},{key:"canContainContent",value:function(type){return this.schema.subKind(type.contains,this.contains)}},{key:"findConnection",value:function(other){if(this.canContainType(other))return[];for(var seen=Object.create(null),active=[{from:this,via:[]}];active.length;){var current=active.shift();for(var _name3 in this.schema.nodes){var type=this.schema.nodes[_name3];if(type.defaultAttrs&&!(type.contains in seen)&&current.from.canContainType(type)){var via=current.via.concat(type);if(type.canContainType(other))return via;active.push({from:type,via:via}),seen[type.contains]=!0}}}}},{key:"computeAttrs",value:function(attrs,content){return!attrs&&this.defaultAttrs?this.defaultAttrs:_get(Object.getPrototypeOf(NodeType.prototype),"computeAttrs",this).call(this,attrs,content)}},{key:"create",value:function(attrs,content,marks){return new _node.Node(this,this.computeAttrs(attrs,content),_fragment.Fragment.from(content),_mark.Mark.setFrom(marks))}},{key:"createAutoFill",value:function(attrs,content,marks){return content&&0!=content.length||this.canBeEmpty||(content=this.defaultContent()),this.create(attrs,content,marks)}},{key:"isBlock",get:function(){return!1}},{key:"isTextblock",get:function(){return!1}},{key:"isInline",get:function(){return!1}},{key:"isText",get:function(){return!1}},{key:"selectable",get:function(){return!0}},{key:"locked",get:function(){return!1}},{key:"contains",get:function(){return null}},{key:"canBeEmpty",get:function(){return!0}},{key:"containsMarks",get:function(){return!1}}],[{key:"compile",value:function(types,schema){var result=Object.create(null);for(var _name4 in types){for(var type=types[_name4],kinds=type.kinds.split(" "),i=0;i<kinds.length;i++)schema.registerKind(kinds[i],i?kinds[i-1]:null);result[_name4]=new type(_name4,kinds[kinds.length-1],schema)}for(var _name5 in result){var contains=result[_name5].contains;!contains||contains in schema.kinds||SchemaError.raise("Node type "+_name5+" is specified to contain non-existing kind "+contains)}return result.doc||SchemaError.raise("Every schema needs a 'doc' type"),result.text||SchemaError.raise("Every schema needs a 'text' type"),result}},{key:"kinds",get:function(){return"node"}}]),NodeType}(SchemaItem);exports.NodeType=NodeType;var Block=function(_NodeType){function Block(){_classCallCheck(this,Block),_get(Object.getPrototypeOf(Block.prototype),"constructor",this).apply(this,arguments)}return _inherits(Block,_NodeType),_createClass(Block,[{key:"defaultContent",value:function(){var inner=this.schema.defaultTextblockType().create(),conn=this.findConnection(inner.type);conn||SchemaError.raise("Can't create default content for "+this.name);for(var i=conn.length-1;i>=0;i--)inner=conn[i].create(null,inner);return _fragment.Fragment.from(inner)}},{key:"contains",get:function(){return"block"}},{key:"isBlock",get:function(){return!0}},{key:"canBeEmpty",get:function(){return null==this.contains}}],[{key:"kinds",get:function(){return"block"}}]),Block}(NodeType);exports.Block=Block;var Textblock=function(_Block){function Textblock(){_classCallCheck(this,Textblock),_get(Object.getPrototypeOf(Textblock.prototype),"constructor",this).apply(this,arguments)}return _inherits(Textblock,_Block),_createClass(Textblock,[{key:"contains",get:function(){return"inline"}},{key:"containsMarks",get:function(){return!0}},{key:"isTextblock",get:function(){return!0}},{key:"canBeEmpty",get:function(){return!0}}]),Textblock}(Block);exports.Textblock=Textblock;var Inline=function(_NodeType2){function Inline(){_classCallCheck(this,Inline),_get(Object.getPrototypeOf(Inline.prototype),"constructor",this).apply(this,arguments)}return _inherits(Inline,_NodeType2),_createClass(Inline,[{key:"isInline",get:function(){return!0}}],[{key:"kinds",get:function(){return"inline"}}]),Inline}(NodeType);exports.Inline=Inline;var Text=function(_Inline){function Text(){_classCallCheck(this,Text),_get(Object.getPrototypeOf(Text.prototype),"constructor",this).apply(this,arguments)}return _inherits(Text,_Inline),_createClass(Text,[{key:"create",value:function(attrs,content,marks){return new _node.TextNode(this,this.computeAttrs(attrs,content),content,marks)}},{key:"selectable",get:function(){return!1}},{key:"isText",get:function(){return!0}}],[{key:"kinds",get:function(){return _get(Object.getPrototypeOf(Text),"kinds",this)+" text"}}]),Text}(Inline);exports.Text=Text;var Attribute=function Attribute(){var options=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,Attribute),this["default"]=options["default"],this.compute=options.compute};exports.Attribute=Attribute;var MarkType=function(_SchemaItem2){function MarkType(name,rank,schema){_classCallCheck(this,MarkType),_get(Object.getPrototypeOf(MarkType.prototype),"constructor",this).call(this),this.name=name,this.freezeAttrs(),this.rank=rank,this.schema=schema;var defaults=this.getDefaultAttrs();this.instance=defaults&&new _mark.Mark(this,defaults)}return _inherits(MarkType,_SchemaItem2),_createClass(MarkType,[{key:"create",value:function(attrs){return!attrs&&this.instance?this.instance:new _mark.Mark(this,this.computeAttrs(attrs))}},{key:"removeFromSet",value:function(set){for(var i=0;i<set.length;i++)if(set[i].type==this)return set.slice(0,i).concat(set.slice(i+1));return set}},{key:"isInSet",value:function(set){for(var i=0;i<set.length;i++)if(set[i].type==this)return set[i]}}],[{key:"getOrder",value:function(marks){var sorted=[];for(var _name6 in marks)sorted.push({name:_name6,rank:marks[_name6].rank});sorted.sort(function(a,b){return a.rank-b.rank});for(var ranks=Object.create(null),i=0;i<sorted.length;i++)ranks[sorted[i].name]=i;return ranks}},{key:"compile",value:function(marks,schema){var order=this.getOrder(marks),result=Object.create(null);for(var _name7 in marks)result[_name7]=new marks[_name7](_name7,order[_name7],schema);return result}},{key:"rank",get:function(){return 50}}]),MarkType}(SchemaItem);exports.MarkType=MarkType;var SchemaSpec=function(){function SchemaSpec(nodes,marks){_classCallCheck(this,SchemaSpec),this.nodes=nodes||{},this.marks=marks||{}}return _createClass(SchemaSpec,[{key:"update",value:function(nodes,marks){return new SchemaSpec(nodes?overlayObj(this.nodes,nodes):this.nodes,marks?overlayObj(this.marks,marks):this.marks)}}]),SchemaSpec}();exports.SchemaSpec=SchemaSpec;var Schema=function(){function Schema(spec){_classCallCheck(this,Schema),this.spec=spec,this.kinds=Object.create(null),this.nodes=NodeType.compile(spec.nodes,this),this.marks=MarkType.compile(spec.marks,this);for(var prop in this.nodes)prop in this.marks&&SchemaError.raise(prop+" can not be both a node and a mark");this.cached=Object.create(null),this.node=this.node.bind(this),this.text=this.text.bind(this),this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this)}return _createClass(Schema,[{key:"node",value:function(type,attrs,content,marks){return"string"==typeof type?type=this.nodeType(type):type instanceof NodeType?type.schema!=this&&SchemaError.raise("Node type from different schema used ("+type.name+")"):SchemaError.raise("Invalid node type: "+type),type.create(attrs,content,marks)}},{key:"text",value:function(_text,marks){return this.nodes.text.create(null,_text,_mark.Mark.setFrom(marks))}},{key:"defaultTextblockType",value:function(){var cached=this.cached.defaultTextblockType;if(void 0!==cached)return cached;for(var _name9 in this.nodes)if(this.nodes[_name9].defaultTextblock)return this.cached.defaultTextblockType=this.nodes[_name9];return this.cached.defaultTextblockType=null}},{key:"mark",value:function(name,attrs){var spec=this.marks[name]||SchemaError.raise("No mark named "+name);return spec.create(attrs)}},{key:"nodeFromJSON",value:function(json){return _node.Node.fromJSON(this,json)}},{key:"markFromJSON",value:function(json){return"string"==typeof json?this.mark(json):this.mark(json._,json)}},{key:"nodeType",value:function(name){return this.nodes[name]||SchemaError.raise("Unknown node type: "+name)}},{key:"registerKind",value:function(kind,sup){if(kind in this.kinds){if(this.kinds[kind]==sup)return;SchemaError.raise("Inconsistent superkinds for kind "+kind+": "+sup+" and "+this.kinds[kind])}this.subKind(kind,sup)&&SchemaError.raise("Conflicting kind hierarchy through "+kind+" and "+sup),this.kinds[kind]=sup}},{key:"subKind",value:function(sub,sup){for(;;){if(sub==sup)return!0;if(sub=this.kinds[sub],!sub)return!1}}},{key:"registry",value:function(name,f){for(var i=0;2>i;i++){var obj=i?this.marks:this.nodes;for(var tname in obj){var type=obj[tname];if(type.constructor.prototype.hasOwnProperty("registry")){var reg=type.registry[name];if(reg)for(var j=0;j<reg.length;j++)f(reg[j],type,tname)}}}}}]),Schema}();exports.Schema=Schema},{"../util/error":48,"./fragment":30,"./mark":32,"./node":33}],36:[function(require,module,exports){"use strict";function canBeLifted(doc,range){for(var content=[doc.path(range.from.path)],unwrap=!1;;){for(var parentDepth=-1,_loop=function(_node,i){content.some(function(inner){return!_node.type.canContainContent(inner.type)})||(parentDepth=i),_node=_node.child(range.from.path[i]),node=_node},node=doc,i=0;i<range.from.path.length;i++)_loop(node,i);if(parentDepth>-1)return{path:range.from.path.slice(0,parentDepth),unwrap:unwrap};if(unwrap||!content[0].isBlock)return null;content=content[0].content.slice(range.from.offset,range.to.offset),unwrap=!0}}function canLift(doc,from,to){var range=doc.siblingRange(from,to||from),found=canBeLifted(doc,range);return found?{found:found,range:range}:void 0}function canWrap(doc,from,to,type){var range=doc.siblingRange(from,to||from);if(range.from.offset==range.to.offset)return null;var parent=doc.path(range.from.path),around=parent.type.findConnection(type),inside=type.findConnection(parent.child(range.from.offset).type);return around&&inside?{range:range,around:around,inside:inside}:void 0}Object.defineProperty(exports,"__esModule",{value:!0}),exports.canLift=canLift,exports.canWrap=canWrap;var _model=require("../model"),_transform=require("./transform"),_step=require("./step"),_tree=require("./tree"),_map=require("./map");_step.Step.define("ancestor",{apply:function(doc,step){var from=step.from,to=step.to;if(!(0,_tree.isFlatRange)(from,to))return null;for(var toParent=from.path,start=from.offset,end=to.offset,_step$param=step.param,_step$param$depth=_step$param.depth,depth=void 0===_step$param$depth?0:_step$param$depth,_step$param$types=_step$param.types,types=void 0===_step$param$types?[]:_step$param$types,_step$param$attrs=_step$param.attrs,attrs=void 0===_step$param$attrs?[]:_step$param$attrs,inner=doc.path(from.path),i=0;depth>i;i++){if(start>0||end<doc.path(toParent).size||0==toParent.length)return null;start=toParent[toParent.length-1],end=start+1,toParent=toParent.slice(0,toParent.length-1)}if(0==depth&&0==types.length)return null;var parent=doc.path(toParent),parentSize=parent.size,newParent=void 0;if(parent.type.locked)return null;if(types.length){var _ret=function(){var lastWrapper=types[types.length-1],content=inner.content.slice(from.offset,to.offset);if(!parent.type.canContainType(types[0])||content.some(function(n){return!lastWrapper.canContain(n)})||!inner.size&&!lastWrapper.canBeEmpty||lastWrapper.locked)return{v:null};for(var node=null,i=types.length-1;i>=0;i--)node=types[i].create(attrs[i],node||content);newParent=parent.splice(start,end,_model.Fragment.from(node))}();if("object"==typeof _ret)return _ret.v}else{if(!parent.type.canContainFragment(inner.content)||!inner.size&&0==start&&end==parent.size&&!parent.type.canBeEmpty)return null;newParent=parent.splice(start,end,inner.content)}for(var copy=doc.replaceDeep(toParent,newParent),toInner=toParent.slice(),i=0;i<types.length;i++)toInner.push(i?0:start);var startOfInner=new _model.Pos(toInner,types.length?0:start),replaced=null,insertedSize=types.length?1:to.offset-from.offset;if(depth!=types.length||depth>1||types.length>1){var posBefore=new _model.Pos(toParent,start),posAfter1=new _model.Pos(toParent,end),posAfter2=new _model.Pos(toParent,start+insertedSize),endOfInner=new _model.Pos(toInner,startOfInner.offset+(to.offset-from.offset));replaced=[new _map.ReplacedRange(posBefore,from,posBefore,startOfInner),new _map.ReplacedRange(to,posAfter1,endOfInner,posAfter2,posAfter1,posAfter2)]}var moved=[new _map.MovedRange(from,to.offset-from.offset,startOfInner)];return end-start!=insertedSize&&moved.push(new _map.MovedRange(new _model.Pos(toParent,end),parentSize-end,new _model.Pos(toParent,start+insertedSize))),new _step.StepResult(copy,new _map.PosMap(moved,replaced))},invert:function(step,oldDoc,map){var types=[],attrs=[];if(step.param.depth)for(var i=0;i<step.param.depth;i++){var _parent=oldDoc.path(step.from.path.slice(0,step.from.path.length-i));types.unshift(_parent.type),attrs.unshift(_parent.attrs)}var newFrom=map.map(step.from).pos,newTo=step.from.cmp(step.to)?map.map(step.to,-1).pos:newFrom;return new _step.Step("ancestor",newFrom,newTo,null,{depth:step.param.types?step.param.types.length:0,types:types,attrs:attrs})},paramToJSON:function(param){return{depth:param.depth,types:param.types&&param.types.map(function(t){return t.name}),attrs:param.attrs}},paramFromJSON:function(schema,json){return{depth:json.depth,types:json.types&&json.types.map(function(n){return schema.nodeType(n)}),attrs:json.attrs}}}),_transform.Transform.prototype.lift=function(from){var to=arguments.length<=1||void 0===arguments[1]?from:arguments[1];return function(){var can=canLift(this.doc,from,to);if(!can)return this;for(var found=can.found,range=can.range,depth=range.from.path.length-found.path.length,rangeNode=found.unwrap&&this.doc.path(range.from.path),d=0,pos=range.to;;d++){if(pos.offset<this.doc.path(pos.path).size){this.split(pos,depth-d);break}if(d==depth-1)break;pos=pos.shorten(null,1)}for(var d=0,pos=range.from;;d++){if(pos.offset>0){this.split(pos,depth-d);for(var cut=range.from.path.length-depth,path=pos.path.slice(0,cut).concat(pos.path[cut]+1);path.length<range.from.path.length;)path.push(0);range={from:new _model.Pos(path,0),to:new _model.Pos(path,range.to.offset-range.from.offset)};break}if(d==depth-1)break;pos=pos.shorten()}if(found.unwrap){for(var i=range.to.offset-1;i>range.from.offset;i--)this.join(new _model.Pos(range.from.path,i));for(var size=0,i=rangeNode.iter(range.from.offset,range.to.offset),child=void 0;child=i.next().value;)size+=child.size;var path=range.from.path.concat(range.from.offset);range={from:new _model.Pos(path,0),to:new _model.Pos(path,size)},++depth}return this.step("ancestor",range.from,range.to,null,{depth:depth}),this}.apply(this,arguments)},_transform.Transform.prototype.wrap=function(from,to,type,wrapAttrs){var can=canWrap(this.doc,from,to,type);if(!can)return this;var range=can.range,around=can.around,inside=can.inside,types=around.concat(type).concat(inside),attrs=around.map(function(){return null}).concat(wrapAttrs).concat(inside.map(function(){return null}));if(this.step("ancestor",range.from,range.to,null,{types:types,attrs:attrs}),inside.length){for(var toInner=range.from.path.slice(),i=0;i<around.length+inside.length+1;i++)toInner.push(i?0:range.from.offset);for(var i=range.to.offset-1-range.from.offset;i>0;i--)this.split(new _model.Pos(toInner,i),inside.length)}return this},_transform.Transform.prototype.setBlockType=function(from,to,type,attrs){var _this=this;return this.doc.nodesBetween(from,to||from,function(node,path){return node.isTextblock&&!node.hasMarkup(type,attrs)?(path=path.slice(),_this.clearMarkup(new _model.Pos(path,0),new _model.Pos(path,node.size),type),_this.step("ancestor",new _model.Pos(path,0),new _model.Pos(path,_this.doc.path(path).size),null,{depth:1,types:[type],attrs:[attrs]}),!1):void 0}),this},_transform.Transform.prototype.setNodeType=function(pos,type,attrs){var node=this.doc.nodeAfter(pos),path=pos.toPath();return this.step("ancestor",new _model.Pos(path,0),new _model.Pos(path,node.size),null,{depth:1,types:[type],attrs:[attrs]}),this}},{"../model":31,"./map":39,"./step":43,"./transform":44,"./tree":45}],37:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),require("./mark"),require("./split"),require("./replace");var _transform=require("./transform");Object.defineProperty(exports,"Transform",{enumerable:!0,get:function(){return _transform.Transform}});var _step=require("./step");Object.defineProperty(exports,"Step",{enumerable:!0,get:function(){return _step.Step}}),Object.defineProperty(exports,"StepResult",{enumerable:!0,get:function(){return _step.StepResult}});var _ancestor=require("./ancestor");Object.defineProperty(exports,"canLift",{enumerable:!0,get:function(){return _ancestor.canLift}}),Object.defineProperty(exports,"canWrap",{enumerable:!0,get:function(){return _ancestor.canWrap}});var _join=require("./join");Object.defineProperty(exports,"joinPoint",{enumerable:!0,get:function(){return _join.joinPoint}}),Object.defineProperty(exports,"joinableBlocks",{enumerable:!0,get:function(){return _join.joinableBlocks}});var _map=require("./map");Object.defineProperty(exports,"PosMap",{enumerable:!0,get:function(){return _map.PosMap}}),Object.defineProperty(exports,"MapResult",{enumerable:!0,get:function(){return _map.MapResult}}),Object.defineProperty(exports,"Remapping",{enumerable:!0,get:function(){return _map.Remapping}})},{"./ancestor":36,"./join":38,"./map":39,"./mark":40,"./replace":41,"./split":42,"./step":43,"./transform":44}],38:[function(require,module,exports){"use strict";function joinableBlocks(doc,pos){if(0==pos.offset)return!1;var parent=doc.path(pos.path);if(parent.isTextblock||pos.offset==parent.size)return!1;var type=parent.child(pos.offset-1).type;return!type.isTextblock&&type.contains&&type==parent.child(pos.offset).type}function joinPoint(doc,pos){for(var dir=arguments.length<=2||void 0===arguments[2]?-1:arguments[2];;){if(joinableBlocks(doc,pos))return pos;if(0==pos.depth)return null;pos=pos.shorten(null,0>dir?0:1)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.joinableBlocks=joinableBlocks,exports.joinPoint=joinPoint;var _model=require("../model"),_transform=require("./transform"),_step=require("./step"),_map=require("./map");_step.Step.define("join",{apply:function(doc,step){var before=doc.path(step.from.path),after=doc.path(step.to.path);if(step.from.offset<before.size||step.to.offset>0||!before.type.canContainFragment(after.content))return null;var pFrom=step.from.path,pTo=step.to.path,last=pFrom.length-1,offset=pFrom[last]+1;if(pFrom.length!=pTo.length||0==pFrom.length||offset!=pTo[last])return null;for(var i=0;last>i;i++)if(pFrom[i]!=pTo[i])return null;var targetPath=pFrom.slice(0,last),target=doc.path(targetPath),oldSize=target.size;if(target.type.locked)return null;var joined=before.append(after.content),copy=doc.replaceDeep(targetPath,target.splice(offset-1,offset+1,_model.Fragment.from(joined))),map=new _map.PosMap([new _map.MovedRange(step.to,after.size,step.from),new _map.MovedRange(new _model.Pos(targetPath,offset+1),oldSize-offset-1,new _model.Pos(targetPath,offset))],[new _map.ReplacedRange(step.from,step.to,step.from,step.from,step.to.shorten())]);return new _step.StepResult(copy,map)},invert:function(step,oldDoc){return new _step.Step("split",null,null,step.from,oldDoc.path(step.to.path).copy());
}}),_transform.Transform.prototype.join=function(at){var parent=this.doc.path(at.path);return 0==at.offset||at.offset==parent.size||parent.isTextblock?this:(this.step("join",new _model.Pos(at.path.concat(at.offset-1),parent.child(at.offset-1).size),new _model.Pos(at.path.concat(at.offset),0)),this)}},{"../model":31,"./map":39,"./step":43,"./transform":44}],39:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function offsetFrom(base,pos){if(pos.path.length>base.path.length){for(var path=[pos.path[base.path.length]-base.offset],i=base.path.length+1;i<pos.path.length;i++)path.push(pos.path[i]);return new _model.Pos(path,pos.offset)}return new _model.Pos([],pos.offset-base.offset)}function mapThrough(map,pos,bias,back){void 0===bias&&(bias=1);for(var i=0;i<map.replaced.length;i++){var range=map.replaced[i],side=back?range.after:range.before,left=void 0,right=void 0;if((left=pos.cmp(side.from))>=0&&(right=pos.cmp(side.to))<=0){var other=back?range.before:range.after;return new MapResult(0>bias?other.from:other.to,!(!left||!right),{rangeID:i,offset:offsetFrom(side.ref,pos)})}}for(var i=0;i<map.moved.length;i++){var range=map.moved[i],start=back?range.dest:range.start;if(pos.cmp(start)>=0&&_model.Pos.cmp(pos.path,pos.offset,start.path,start.offset+range.size)<=0){var dest=back?range.start:range.dest,depth=start.depth;if(pos.depth>depth){var offset=dest.offset+(pos.path[depth]-start.offset);return new MapResult(new _model.Pos(dest.path.concat(offset).concat(pos.path.slice(depth+1)),pos.offset))}return new MapResult(new _model.Pos(dest.path,dest.offset+(pos.offset-start.offset)))}}return new MapResult(pos)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_model=require("../model"),MovedRange=function(){function MovedRange(start,size){var dest=arguments.length<=2||void 0===arguments[2]?null:arguments[2];_classCallCheck(this,MovedRange),this.start=start,this.size=size,this.dest=dest}return _createClass(MovedRange,[{key:"toString",value:function(){return"[moved "+this.start+"+"+this.size+" to "+this.dest+"]"}},{key:"end",get:function(){return new _model.Pos(this.start.path,this.start.offset+this.size)}}]),MovedRange}();exports.MovedRange=MovedRange;var Side=function Side(from,to,ref){_classCallCheck(this,Side),this.from=from,this.to=to,this.ref=ref},ReplacedRange=function(){function ReplacedRange(from,to,newFrom,newTo){var ref=arguments.length<=4||void 0===arguments[4]?from:arguments[4],newRef=arguments.length<=5||void 0===arguments[5]?newFrom:arguments[5];return function(){_classCallCheck(this,ReplacedRange),this.before=new Side(from,to,ref),this.after=new Side(newFrom,newTo,newRef)}.apply(this,arguments)}return _createClass(ReplacedRange,[{key:"toString",value:function(){return"[replaced "+this.before.from+"-"+this.before.to+" with "+this.after.from+"-"+this.after.to+"]"}}]),ReplacedRange}();exports.ReplacedRange=ReplacedRange;var empty=[],PosMap=function(){function PosMap(moved,replaced){_classCallCheck(this,PosMap),this.moved=moved||empty,this.replaced=replaced||empty}return _createClass(PosMap,[{key:"recover",value:function(offset){return this.replaced[offset.rangeID].after.ref.extend(offset.offset)}},{key:"map",value:function(pos,bias){return mapThrough(this,pos,bias,!1)}},{key:"invert",value:function(){return new InvertedPosMap(this)}},{key:"toString",value:function(){return this.moved.concat(this.replaced).join(" ")}}]),PosMap}();exports.PosMap=PosMap;var MapResult=function MapResult(pos){var deleted=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],recover=arguments.length<=2||void 0===arguments[2]?null:arguments[2];_classCallCheck(this,MapResult),this.pos=pos,this.deleted=deleted,this.recover=recover};exports.MapResult=MapResult;var InvertedPosMap=function(){function InvertedPosMap(map){_classCallCheck(this,InvertedPosMap),this.inner=map}return _createClass(InvertedPosMap,[{key:"recover",value:function(offset){return this.inner.replaced[offset.rangeID].before.ref.extend(offset.offset)}},{key:"map",value:function(pos,bias){return mapThrough(this.inner,pos,bias,!0)}},{key:"invert",value:function(){return this.inner}},{key:"toString",value:function(){return"-"+this.inner}}]),InvertedPosMap}(),nullMap=new PosMap;exports.nullMap=nullMap;var Remapping=function(){function Remapping(){var head=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],tail=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],mirror=arguments.length<=2||void 0===arguments[2]?Object.create(null):arguments[2];_classCallCheck(this,Remapping),this.head=head,this.tail=tail,this.mirror=mirror}return _createClass(Remapping,[{key:"addToFront",value:function(map,corr){this.head.push(map);var id=-this.head.length;return null!=corr&&(this.mirror[id]=corr),id}},{key:"addToBack",value:function(map,corr){this.tail.push(map);var id=this.tail.length-1;return null!=corr&&(this.mirror[corr]=id),id}},{key:"get",value:function(id){return 0>id?this.head[-id-1]:this.tail[id]}},{key:"map",value:function map(pos,bias){for(var deleted=!1,i=-this.head.length;i<this.tail.length;i++){var map=this.get(i),result=map.map(pos,bias);if(result.recover){var corr=this.mirror[i];if(null!=corr){i=corr,pos=this.get(corr).recover(result.recover);continue}}result.deleted&&(deleted=!0),pos=result.pos}return new MapResult(pos,deleted)}}]),Remapping}();exports.Remapping=Remapping},{"../model":31}],40:[function(require,module,exports){"use strict";var _model=require("../model"),_transform=require("./transform"),_step=require("./step"),_tree=require("./tree");_step.Step.define("addMark",{apply:function(doc,step){return new _step.StepResult((0,_tree.copyStructure)(doc,step.from,step.to,function(node,from,to){return node.type.canContainMark(step.param)?(0,_tree.copyInline)(node,from,to,function(node){return node.mark(step.param.addToSet(node.marks))}):node}))},invert:function(step,_oldDoc,map){return new _step.Step("removeMark",step.from,map.map(step.to).pos,null,step.param)},paramToJSON:function(param){return param.toJSON()},paramFromJSON:function(schema,json){return schema.markFromJSON(json)}}),_transform.Transform.prototype.addMark=function(from,to,mark){var _this=this,removed=[],added=[],removing=null,adding=null;return this.doc.inlineNodesBetween(from,to,function(_ref,path,start,end,parent){var marks=_ref.marks;if(mark.isInSet(marks)||!parent.type.canContainMark(mark.type))adding=removing=null;else{var rm=mark.type.isInSet(marks);rm?removing&&removing.param.eq(rm)?removing.to=new _model.Pos(path,end):(removing=new _step.Step("removeMark",new _model.Pos(path,start),new _model.Pos(path,end),null,rm),removed.push(removing)):removing&&(removing=null),adding?adding.to=new _model.Pos(path,end):(adding=new _step.Step("addMark",new _model.Pos(path,start),new _model.Pos(path,end),null,mark),added.push(adding))}}),removed.forEach(function(s){return _this.step(s)}),added.forEach(function(s){return _this.step(s)}),this},_step.Step.define("removeMark",{apply:function(doc,step){return new _step.StepResult((0,_tree.copyStructure)(doc,step.from,step.to,function(node,from,to){return(0,_tree.copyInline)(node,from,to,function(node){return node.mark(step.param.removeFromSet(node.marks))})}))},invert:function(step,_oldDoc,map){return new _step.Step("addMark",step.from,map.map(step.to).pos,null,step.param)},paramToJSON:function(param){return param.toJSON()},paramFromJSON:function(schema,json){return schema.markFromJSON(json)}}),_transform.Transform.prototype.removeMark=function(from,to){var _this2=this,mark=arguments.length<=2||void 0===arguments[2]?null:arguments[2],matched=[],step=0;return this.doc.inlineNodesBetween(from,to,function(_ref2,path,start,end){var marks=_ref2.marks;step++;var toRemove=null;if(mark instanceof _model.MarkType){var found=mark.isInSet(marks);found&&(toRemove=[found])}else mark?mark.isInSet(marks)&&(toRemove=[mark]):toRemove=marks;if(toRemove&&toRemove.length){path=path.slice();for(var i=0;i<toRemove.length;i++){for(var rm=toRemove[i],found=void 0,j=0;j<matched.length;j++){var m=matched[j];m.step==step-1&&rm.eq(matched[j].style)&&(found=m)}found?(found.to=new _model.Pos(path,end),found.step=step):matched.push({style:rm,from:new _model.Pos(path,start),to:new _model.Pos(path,end),step:step})}}}),matched.forEach(function(m){return _this2.step("removeMark",m.from,m.to,null,m.style)}),this},_transform.Transform.prototype.clearMarkup=function(from,to,newParent){var _this3=this,delSteps=[];this.doc.inlineNodesBetween(from,to,function(_ref3,path,start,end){var marks=_ref3.marks,type=_ref3.type;if(newParent?!newParent.canContainType(type):!type.isText){path=path.slice();var _from=new _model.Pos(path,start);return void delSteps.push(new _step.Step("replace",_from,new _model.Pos(path,end),_from))}for(var i=0;i<marks.length;i++){var mark=marks[i];newParent&&newParent.canContainMark(mark.type)||(path=path.slice(),_this3.step("removeMark",new _model.Pos(path,start),new _model.Pos(path,end),null,mark))}});for(var i=delSteps.length-1;i>=0;i--)this.step(delSteps[i]);return this}},{"../model":31,"./step":43,"./transform":44,"./tree":45}],41:[function(require,module,exports){"use strict";function findMovedChunks(oldNode,oldPath,newNode,startDepth){for(var moved=[],newPath=oldPath.path.slice(0,startDepth),depth=startDepth;;depth++){var joined=depth==oldPath.depth?0:1,cut=depth==oldPath.depth?oldPath.offset:oldPath.path[depth],afterCut=oldNode.size-cut,newOffset=newNode.size-afterCut,from=oldPath.shorten(depth,joined),to=new _model.Pos(newPath,newOffset+joined);if(from.cmp(to)&&moved.push(new _map.MovedRange(from,afterCut-joined,to)),!joined)return moved;oldNode=oldNode.child(cut),newNode=newNode.child(newOffset),newPath=newPath.concat(newOffset)}}function replace(node,from,to,root,repl){var depth=arguments.length<=5||void 0===arguments[5]?0:arguments[5];if(depth==root.length){var before=node.sliceBetween(null,from,depth),after=node.sliceBetween(to,null,depth),result=void 0;return before.type.canContainFragment(repl.content)?(result=repl.content.size?before.append(repl.content,from.depth-depth,repl.openLeft).append(after.content,repl.openRight,to.depth-depth):before.append(after.content,from.depth-depth,to.depth-depth),result.size||result.type.canBeEmpty||(result=result.copy(result.type.defaultContent())),{doc:result,moved:findMovedChunks(node,to,result,depth)}):null}var pos=root[depth],result=replace(node.child(pos),from,to,root,repl,depth+1);return result?{doc:node.replace(pos,result.doc),moved:result.moved}:null}function shiftFromStack(stack,depth){for(var shifted=stack[depth]=stack[depth].splice(0,1,_model.emptyFragment),i=depth-1;i>=0;i--)shifted=stack[i]=stack[i].replace(0,shifted)}function buildInserted(nodesLeft,source,start,end){for(var sliced=source.sliceBetween(start,end),nodesRight=[],node=sliced,i=0;i<=start.path.length;i++,node=node.firstChild)nodesRight.push(node);var same=(0,_tree.samePathDepth)(start,end),searchLeft=nodesLeft.length-1,searchRight=nodesRight.length-1,result=null,inner=nodesRight[searchRight];for(inner.isTextblock&&inner.size&&nodesLeft[searchLeft].isTextblock&&(result=nodesLeft[searchLeft--].copy(inner.content),--searchRight,shiftFromStack(nodesRight,searchRight));;){for(var node=nodesRight[searchRight],type=node.type,matched=null,outside=same>=searchRight,i=searchLeft;i>=0;i--){var left=nodesLeft[i];if(outside?left.type.canContainContent(node.type):left.type==type){matched=i;break}}if(null!=matched)if(result)for(;searchLeft>=matched;){var wrap=nodesLeft[searchLeft],content=_model.Fragment.from(result);result=wrap.copy(searchLeft==matched?content.append(node.content):content),searchLeft--}else result=nodesLeft[matched].copy(node.content),searchLeft=matched-1;if(null!=matched||0==node.size){if(outside)break;searchRight&&shiftFromStack(nodesRight,searchRight-1)}searchRight--}var repl={content:result?result.content:_model.emptyFragment,openLeft:start.depth-searchRight,openRight:end.depth-searchRight};return{repl:repl,depth:searchLeft+1}}function moveText(tr,doc,before,after){for(var root=(0,_tree.samePathDepth)(before,after),cutAt=after.shorten(null,1);cutAt.path.length>root&&1==doc.path(cutAt.path).size;)cutAt=cutAt.shorten(null,1);tr.split(cutAt,cutAt.path.length-root);for(var start=after,end=new _model.Pos(start.path,doc.path(start.path).size),parent=doc.path(start.path.slice(0,root)),wanted=parent.pathNodes(before.path.slice(root)),existing=parent.pathNodes(start.path.slice(root));wanted.length&&existing.length&&wanted[0].sameMarkup(existing[0]);)wanted.shift(),existing.shift();(existing.length||wanted.length)&&tr.step("ancestor",start,end,null,{depth:existing.length,types:wanted.map(function(n){return n.type}),attrs:wanted.map(function(n){return n.attrs})});for(var i=root;i<before.path.length;i++)tr.join(before.shorten(i,1))}Object.defineProperty(exports,"__esModule",{value:!0}),exports.replace=replace;var _model=require("../model"),_transform=require("./transform"),_step=require("./step"),_map=require("./map"),_tree=require("./tree"),nullRepl={content:_model.emptyFragment,openLeft:0,openRight:0};_step.Step.define("replace",{apply:function(doc,step){var rootPos=step.pos,root=rootPos.path;if(step.from.depth<root.length||step.to.depth<root.length)return null;for(var i=0;i<root.length;i++)if(step.from.path[i]!=root[i]||step.to.path[i]!=root[i])return null;var result=replace(doc,step.from,step.to,rootPos.path,step.param||nullRepl);if(!result)return null;var out=result.doc,moved=result.moved,end=moved.length?moved[moved.length-1].dest:step.to,replaced=new _map.ReplacedRange(step.from,step.to,step.from,end,rootPos,rootPos);return new _step.StepResult(out,new _map.PosMap(moved,[replaced]))},invert:function(step,oldDoc,map){var depth=step.pos.depth;return new _step.Step("replace",step.from,map.map(step.to).pos,step.from.shorten(depth),{content:oldDoc.path(step.pos.path).content.sliceBetween(step.from,step.to,depth),openLeft:step.from.depth-depth,openRight:step.to.depth-depth})},paramToJSON:function(param){return param&&{content:param.content.size&&param.content.toJSON(),openLeft:param.openLeft,openRight:param.openRight}},paramFromJSON:function(schema,json){return json&&{content:_model.Fragment.fromJSON(schema,json.content),openLeft:json.openLeft,openRight:json.openRight}}}),_transform.Transform.prototype["delete"]=function(from,to){return from.cmp(to)&&this.replace(from,to),this},_transform.Transform.prototype.replace=function(from,to,source,start,end){var repl=void 0,depth=void 0,doc=this.doc,maxDepth=(0,_tree.samePathDepth)(from,to);if(source){var _buildInserted=buildInserted(doc.pathNodes(from.path),source,start,end);for(repl=_buildInserted.repl,depth=_buildInserted.depth;depth>maxDepth;)repl.content.size&&(repl={content:_model.Fragment.from(doc.path(from.path.slice(0,depth)).copy(repl.content)),openLeft:repl.openLeft+1,openRight:repl.openRight+1}),depth--}else repl=nullRepl,depth=maxDepth;var root=from.shorten(depth),docAfter=doc,after=to;if(repl.content.size||(0,_tree.replaceHasEffect)(doc,from,to)){var result=this.step("replace",from,to,root,repl);docAfter=result.doc,after=result.map.map(to).pos}if(!doc.path(to.path).isTextblock)return this;if(!(repl.content.size?source.path(end.path).isTextblock:doc.path(from.path).isTextblock))return this;var nodesAfter=doc.path(root.path).pathNodes(to.path.slice(depth)).slice(1),nodesBefore=void 0;if(repl.content.size){var inserted=repl.content;nodesBefore=[];for(var i=0;i<repl.openRight;i++){var last=inserted.child(inserted.size-1);nodesBefore.push(last),inserted=last.content}}else nodesBefore=doc.path(root.path).pathNodes(from.path.slice(depth)).slice(1);if(nodesBefore.length&&(nodesAfter.length!=nodesBefore.length||!nodesAfter.every(function(n,i){return n.sameMarkup(nodesBefore[i])}))){for(var _after$shorten=after.shorten(root.depth),path=_after$shorten.path,offset=_after$shorten.offset,before=void 0,node=docAfter.path(path),i=0;;i++){if(i==nodesBefore.length){before=new _model.Pos(path,offset);break}path.push(offset-1),node=node.child(offset-1),offset=node.size}moveText(this,docAfter,before,after)}return this},_transform.Transform.prototype.replaceWith=function(from,to,content){return content instanceof _model.Fragment||(content=_model.Fragment.from(content)),_model.Pos.samePath(from.path,to.path)?this.step("replace",from,to,from,{content:content,openLeft:0,openRight:0}):this["delete"](from,to).step("replace",from,from,from,{content:content,openLeft:0,openRight:0}),this},_transform.Transform.prototype.insert=function(pos,content){return this.replaceWith(pos,pos,content)},_transform.Transform.prototype.insertText=function(pos,text){return this.insert(pos,this.doc.type.schema.text(text,this.doc.marksAt(pos)))},_transform.Transform.prototype.insertInline=function(pos,node){return this.insert(pos,node.mark(this.doc.marksAt(pos)))}},{"../model":31,"./map":39,"./step":43,"./transform":44,"./tree":45}],42:[function(require,module,exports){"use strict";var _model=require("../model"),_transform=require("./transform"),_step=require("./step"),_map=require("./map");_step.Step.define("split",{apply:function(doc,step){var pos=step.pos;if(0==pos.depth)return null;var _pos$shorten=pos.shorten(),parentPath=_pos$shorten.path,offset=_pos$shorten.offset,parent=doc.path(parentPath),target=parent.child(offset),targetSize=target.size,_ref=step.param||target,typeAfter=_ref.type,attrsAfter=_ref.attrs,splitAt=pos.offset;if(0==splitAt&&!target.type.canBeEmpty||target.type.locked||splitAt==target.size&&!typeAfter.canBeEmpty)return null;var newParent=parent.splice(offset,offset+1,_model.Fragment.from([target.slice(0,splitAt),typeAfter.create(attrsAfter,target.content.slice(splitAt))])),copy=doc.replaceDeep(parentPath,newParent),dest=new _model.Pos(parentPath.concat(offset+1),0),map=new _map.PosMap([new _map.MovedRange(pos,targetSize-pos.offset,dest),new _map.MovedRange(new _model.Pos(parentPath,offset+1),newParent.size-2-offset,new _model.Pos(parentPath,offset+2))],[new _map.ReplacedRange(pos,pos,pos,dest,pos,pos.shorten(null,1))]);return new _step.StepResult(copy,map)},invert:function(step,_oldDoc,map){return new _step.Step("join",step.pos,map.map(step.pos).pos)},paramToJSON:function(param){return param&&{type:param.type.name,attrs:param.attrs}},paramFromJSON:function(schema,json){return json&&{type:schema.nodeType(json.type),attrs:json.attrs}}}),_transform.Transform.prototype.split=function(pos,depth,typeAfter,attrsAfter){if(void 0===depth&&(depth=1),0==depth)return this;for(var i=0;;i++){if(this.step("split",null,null,pos,typeAfter&&{type:typeAfter,attrs:attrsAfter}),i==depth-1)return this;typeAfter=null,pos=pos.shorten(null,1)}},_transform.Transform.prototype.splitIfNeeded=function(pos){for(var depth=arguments.length<=1||void 0===arguments[1]?1:arguments[1],off=0;depth>off;off++){var here=pos.shorten(pos.depth-off);here.offset&&here.offset<this.doc.path(here.path).size&&this.step("split",null,null,here)}return this}},{"../model":31,"./map":39,"./step":43,"./transform":44}],43:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_model=require("../model"),_utilError=require("../util/error"),_map=require("./map"),Step=function(){function Step(type,from,to,pos){var param=arguments.length<=4||void 0===arguments[4]?null:arguments[4];_classCallCheck(this,Step),type in steps||_utilError.NamespaceError.raise("Unknown step type: "+type),this.type=type,this.from=from,this.to=to,this.pos=pos,this.param=param}return _createClass(Step,[{key:"apply",value:function(doc){return steps[this.type].apply(doc,this)}},{key:"invert",value:function(oldDoc,map){return steps[this.type].invert(this,oldDoc,map)}},{key:"map",value:function(remapping){var allDeleted=!0,from=null,to=null,pos=null;if(this.from){var result=remapping.map(this.from,1);from=result.pos,result.deleted||(allDeleted=!1)}if(this.to)if(0==this.to.cmp(this.from))to=from;else{var result=remapping.map(this.to,-1);to=result.pos.max(from),result.deleted||(allDeleted=!1)}if(this.pos)if(from&&0==this.pos.cmp(this.from))pos=from;else if(to&&0==this.pos.cmp(this.to))pos=to;else{var result=remapping.map(this.pos,1);pos=result.pos,result.deleted||(allDeleted=!1)}return allDeleted?null:new Step(this.type,from,to,pos,this.param)}},{key:"toJSON",value:function(){var impl=steps[this.type];return{type:this.type,from:this.from,to:this.to,pos:this.pos,param:impl.paramToJSON?impl.paramToJSON(this.param):this.param}}}],[{key:"fromJSON",value:function(schema,json){var impl=steps[json.type];return new Step(json.type,json.from&&_model.Pos.fromJSON(json.from),json.to&&_model.Pos.fromJSON(json.to),json.pos&&_model.Pos.fromJSON(json.pos),impl.paramFromJSON?impl.paramFromJSON(schema,json.param):json.param)}},{key:"define",value:function(type,implementation){steps[type]=implementation}}]),Step}();exports.Step=Step;var StepResult=function StepResult(doc){var map=arguments.length<=1||void 0===arguments[1]?_map.nullMap:arguments[1];_classCallCheck(this,StepResult),this.doc=doc,this.map=map};exports.StepResult=StepResult;var steps=Object.create(null)},{"../model":31,"../util/error":48,"./map":39}],44:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_step2=require("./step"),_map=require("./map"),Transform=function(){function Transform(doc){_classCallCheck(this,Transform),this.steps=[],this.docs=[doc],this.maps=[]}return _createClass(Transform,[{key:"step",value:function(_step,from,to,pos,param){"string"==typeof _step&&(_step=new _step2.Step(_step,from,to,pos,param));var result=_step.apply(this.doc);return result&&(this.steps.push(_step),this.maps.push(result.map),this.docs.push(result.doc)),result}},{key:"map",value:function(pos,bias){for(var deleted=!1,i=0;i<this.maps.length;i++){var result=this.maps[i].map(pos,bias);pos=result.pos,result.deleted&&(deleted=!0)}return new _map.MapResult(pos,deleted)}},{key:"doc",get:function(){return this.docs[this.docs.length-1]}},{key:"before",get:function(){return this.docs[0]}}]),Transform}();exports.Transform=Transform},{"./map":39,"./step":43}],45:[function(require,module,exports){"use strict";function copyStructure(node,from,to,f){var depth=arguments.length<=4||void 0===arguments[4]?0:arguments[4];if(node.isTextblock)return f(node,from?from.offset:0,to?to.offset:node.size);if(!node.size)return node;for(var start=from?from.path[depth]:0,end=to?to.path[depth]+1:node.size,content=node.content.toArray(0,start),iter=node.iter(start,end),child=void 0;child=iter.next().value;){var passFrom=iter.offset-child.width==start?from:null,passTo=iter.offset==end?to:null;content.push(copyStructure(child,passFrom,passTo,f,depth+1))}return node.copy(_model.Fragment.fromArray(content.concat(node.content.toArray(end))))}function copyInline(node,from,to,f){return node.splice(from,to,node.content.slice(from,to).map(f))}function isFlatRange(from,to){if(from.path.length!=to.path.length)return!1;for(var i=0;i<from.path.length;i++)if(from.path[i]!=to.path[i])return!1;return from.offset<=to.offset}function canBeJoined(node,offset,depth){if(!depth||0==offset||offset==node.size)return!1;var left=node.child(offset-1),right=node.child(offset);return left.sameMarkup(right)}function replaceHasEffect(doc,from,to){for(var depth=0,node=doc;;depth++){var fromEnd=depth==from.depth,toEnd=depth==to.depth;if(fromEnd||toEnd||from.path[depth]!=to.path[depth]){var gapStart=void 0,gapEnd=void 0;if(fromEnd)gapStart=from.offset;else{gapStart=from.path[depth]+1;for(var i=depth+1,n=node.child(gapStart-1);i<=from.path.length;i++)if(i==from.path.length){if(from.offset<n.size)return!0}else{if(from.path[i]+1<n.size)return!0;n=n.child(from.path[i])}}if(toEnd)gapEnd=to.offset;else{gapEnd=to.path[depth];for(var i=depth+1;i<=to.path.length;i++)if((i==to.path.length?to.offset:to.path[i])>0)return!0}return gapStart!=gapEnd?!0:canBeJoined(node,gapStart,Math.min(from.depth,to.depth)-depth)}node=node.child(from.path[depth])}}function samePathDepth(a,b){for(var i=0;;i++)if(i==a.path.length||i==b.path.length||a.path[i]!=b.path[i])return i}Object.defineProperty(exports,"__esModule",{value:!0}),exports.copyStructure=copyStructure,exports.copyInline=copyInline,exports.isFlatRange=isFlatRange,exports.replaceHasEffect=replaceHasEffect,exports.samePathDepth=samePathDepth;var _model=require("../model")},{"../model":31}],46:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_dom=require("../dom"),prefix="ProseMirror-tooltip",Tooltip=function(){function Tooltip(wrapper,dir){var _this=this;_classCallCheck(this,Tooltip),this.wrapper=wrapper,this.dir=dir||"above",this.pointer=wrapper.appendChild((0,_dom.elt)("div",{"class":prefix+"-pointer-"+this.dir+" "+prefix+"-pointer"})),this.pointerWidth=this.pointerHeight=null,this.dom=wrapper.appendChild((0,_dom.elt)("div",{"class":prefix})),this.dom.addEventListener("transitionend",function(){"0"==_this.dom.style.opacity&&(_this.dom.style.display=_this.pointer.style.display="")}),this.isOpen=!1,this.lastLeft=this.lastRight=null}return _createClass(Tooltip,[{key:"detach",value:function(){this.dom.parentNode.removeChild(this.dom),this.pointer.parentNode.removeChild(this.pointer)}},{key:"getSize",value:function(node){var wrap=this.wrapper.appendChild((0,_dom.elt)("div",{"class":prefix,style:"display: block; position: absolute"},node)),size={width:wrap.offsetWidth,height:wrap.offsetHeight};return wrap.parentNode.removeChild(wrap),size}},{key:"open",value:function(node,pos){for(var left=this.lastLeft=pos?pos.left:this.lastLeft,top=this.lastTop=pos?pos.top:this.lastTop,size=this.getSize(node),around=this.wrapper.getBoundingClientRect(),child=this.dom.firstChild,next=void 0;child;child=next)next=child.nextSibling,child!=this.pointer&&this.dom.removeChild(child);this.dom.appendChild(node),this.dom.style.display=this.pointer.style.display="block",null==this.pointerWidth&&(this.pointerWidth=this.pointer.offsetWidth-1,this.pointerHeight=this.pointer.offsetHeight-1),this.dom.style.width=size.width+"px",this.dom.style.height=size.height+"px";var margin=5;if("above"==this.dir||"below"==this.dir){var tipLeft=Math.max(0,Math.min(left-size.width/2,window.innerWidth-size.width));if(this.dom.style.left=tipLeft-around.left+"px",this.pointer.style.left=left-around.left-this.pointerWidth/2+"px","above"==this.dir){var tipTop=top-around.top-margin-this.pointerHeight-size.height;this.dom.style.top=tipTop+"px",this.pointer.style.top=tipTop+size.height+"px"}else{var tipTop=top-around.top+margin;this.pointer.style.top=tipTop+"px",this.dom.style.top=tipTop+this.pointerHeight+"px"}}else if("left"==this.dir||"right"==this.dir)if(this.dom.style.top=top-around.top-size.height/2+"px",this.pointer.style.top=top-this.pointerHeight/2-around.top+"px","left"==this.dir){var pointerLeft=left-around.left-margin-this.pointerWidth;this.dom.style.left=pointerLeft-size.width+"px",this.pointer.style.left=pointerLeft+"px"}else{var pointerLeft=left-around.left+margin;this.dom.style.left=pointerLeft+this.pointerWidth+"px",this.pointer.style.left=pointerLeft+"px"}else if("center"==this.dir){var _top=Math.max(around.top,0),bottom=Math.min(around.bottom,window.innerHeight),fromTop=(bottom-_top-size.height)/2;this.dom.style.left=(around.width-size.width)/2+"px",this.dom.style.top=_top-around.top+fromTop+"px"}getComputedStyle(this.dom).opacity,getComputedStyle(this.pointer).opacity,this.dom.style.opacity=this.pointer.style.opacity=1,this.isOpen=!0}},{key:"close",value:function(){this.isOpen&&(this.isOpen=!1,this.dom.style.opacity=this.pointer.style.opacity=0)}}]),Tooltip}();exports.Tooltip=Tooltip,(0,_dom.insertCSS)("\n\n."+prefix+" {\n  position: absolute;\n  display: none;\n  box-sizing: border-box;\n  -moz-box-sizing: border- box;\n  overflow: hidden;\n\n  -webkit-transition: width 0.4s ease-out, height 0.4s ease-out, left 0.4s ease-out, top 0.4s ease-out, opacity 0.2s;\n  -moz-transition: width 0.4s ease-out, height 0.4s ease-out, left 0.4s ease-out, top 0.4s ease-out, opacity 0.2s;\n  transition: width 0.4s ease-out, height 0.4s ease-out, left 0.4s ease-out, top 0.4s ease-out, opacity 0.2s;\n  opacity: 0;\n\n  border-radius: 5px;\n  padding: 3px 7px;\n  margin: 0;\n  background: #444;\n  border-color: #777;\n  color: white;\n\n  z-index: 11;\n}\n\n."+prefix+'-pointer {\n  content: "";\n  position: absolute;\n  display: none;\n  width: 0; height: 0;\n\n  -webkit-transition: left 0.4s ease-out, top 0.4s ease-out, opacity 0.2s;\n  -moz-transition: left 0.4s ease-out, top 0.4s ease-out, opacity 0.2s;\n  transition: left 0.4s ease-out, top 0.4s ease-out, opacity 0.2s;\n  opacity: 0;\n\n  z-index: 12;\n}\n\n.'+prefix+"-pointer-above {\n  border-left: 6px solid transparent;\n  border-right: 6px solid transparent;\n  border-top: 6px solid #444;\n}\n\n."+prefix+"-pointer-below {\n  border-left: 6px solid transparent;\n  border-right: 6px solid transparent;\n  border-bottom: 6px solid #444;\n}\n\n."+prefix+"-pointer-right {\n  border-top: 6px solid transparent;\n  border-bottom: 6px solid transparent;\n  border-right: 6px solid #444;\n}\n\n."+prefix+"-pointer-left {\n  border-top: 6px solid transparent;\n  border-bottom: 6px solid transparent;\n  border-left: 6px solid #444;\n}\n\n."+prefix+' input[type="text"],\n.'+prefix+" textarea {\n  background: #666;\n  color: white;\n  border: none;\n  outline: none;\n}\n\n."+prefix+' input[type="text"] {\n  padding: 0 4px;\n}\n\n')},{"../dom":1}],47:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function");
}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),MIN_FLUSH_DELAY=200,UPDATE_TIMEOUT=200,UpdateScheduler=function(){function UpdateScheduler(pm,events,prepare){var _this=this;_classCallCheck(this,UpdateScheduler),this.pm=pm,this.prepare=prepare,this.mustUpdate=!1,this.updateInfo=null,this.timeout=null,this.lastFlush=0,this.events=events.split(" "),this.onEvent=this.onEvent.bind(this),this.force=this.force.bind(this),this.events.forEach(function(event){return pm.on(event,_this.onEvent)}),pm.on("flush",this.onFlush=this.onFlush.bind(this)),pm.on("flushed",this.onFlushed=this.onFlushed.bind(this))}return _createClass(UpdateScheduler,[{key:"detach",value:function(){var _this2=this;clearTimeout(this.timeout),this.events.forEach(function(event){return _this2.pm.off(event,_this2.onEvent)}),this.pm.off("flush",this.onFlush),this.pm.off("flushed",this.onFlushed)}},{key:"onFlush",value:function(){var now=Date.now();this.mustUpdate&&now-this.lastFlush>=MIN_FLUSH_DELAY&&(this.lastFlush=now,clearTimeout(this.timeout),this.mustUpdate=!1,this.update=this.prepare())}},{key:"onFlushed",value:function(){this.update&&(this.update(),this.update=null)}},{key:"onEvent",value:function(){this.mustUpdate=!0,clearTimeout(this.timeout),this.timeout=setTimeout(this.force,UPDATE_TIMEOUT)}},{key:"force",value:function(){if(this.pm.operation)this.onEvent();else{this.mustUpdate=!1,this.updateInfo=null,this.lastFlush=Date.now(),clearTimeout(this.timeout);var update=this.prepare();update&&update()}}}]),UpdateScheduler}();exports.UpdateScheduler=UpdateScheduler},{}],48:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function functionName(f){var match=/^function (\w+)/.exec(f.toString());return match&&match[1]}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}},ProseMirrorError=function(_Error){function ProseMirrorError(message){_classCallCheck(this,ProseMirrorError),_get(Object.getPrototypeOf(ProseMirrorError.prototype),"constructor",this).call(this,message),this.message!=message&&(this.message=message,Error.captureStackTrace?Error.captureStackTrace(this,this.name):this.stack=new Error(message).stack)}return _inherits(ProseMirrorError,_Error),_createClass(ProseMirrorError,[{key:"name",get:function(){return this.constructor.name||functionName(this.constructor)||"ProseMirrorError"}}],[{key:"raise",value:function(message){throw new this(message)}}]),ProseMirrorError}(Error);exports.ProseMirrorError=ProseMirrorError;var AssertionError=function(_ProseMirrorError){function AssertionError(){_classCallCheck(this,AssertionError),_get(Object.getPrototypeOf(AssertionError.prototype),"constructor",this).apply(this,arguments)}return _inherits(AssertionError,_ProseMirrorError),AssertionError}(ProseMirrorError);exports.AssertionError=AssertionError;var NamespaceError=function(_ProseMirrorError2){function NamespaceError(){_classCallCheck(this,NamespaceError),_get(Object.getPrototypeOf(NamespaceError.prototype),"constructor",this).apply(this,arguments)}return _inherits(NamespaceError,_ProseMirrorError2),NamespaceError}(ProseMirrorError);exports.NamespaceError=NamespaceError},{}],49:[function(require,module,exports){"use strict";function eventMixin(ctor){var proto=ctor.prototype;for(var prop in methods)methods.hasOwnProperty(prop)&&(proto[prop]=methods[prop])}Object.defineProperty(exports,"__esModule",{value:!0}),exports.eventMixin=eventMixin;var methods={on:function(type,f){var map=this._handlers||(this._handlers={}),arr=map[type]||(map[type]=[]);arr.push(f)},off:function(type,f){var arr=this._handlers&&this._handlers[type];if(arr)for(var i=0;i<arr.length;++i)if(arr[i]==f){arr.splice(i,1);break}},signal:function(type){for(var arr=this._handlers&&this._handlers[type],_len=arguments.length,values=Array(_len>1?_len-1:0),_key=1;_len>_key;_key++)values[_key-1]=arguments[_key];if(arr)for(var i=0;i<arr.length;++i)arr[i].apply(arr,values)},signalHandleable:function(type){var arr=this._handlers&&this._handlers[type];if(arr){for(var _len2=arguments.length,values=Array(_len2>1?_len2-1:0),_key2=1;_len2>_key2;_key2++)values[_key2-1]=arguments[_key2];for(var i=0;i<arr.length;++i){var result=arr[i].apply(arr,values);if(result!==!1)return result}}return!1},hasHandler:function(type){var arr=this._handlers&&this._handlers[type];return arr&&arr.length>0}}},{}],50:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Map=window.Map||function(){function _class(){_classCallCheck(this,_class),this.content=[]}return _createClass(_class,[{key:"set",value:function(key,value){var found=this.find(key);found>-1?this.content[found+1]=value:this.content.push(key,value)}},{key:"get",value:function(key){var found=this.find(key);return-1==found?void 0:this.content[found+1]}},{key:"has",value:function(key){return this.find(key)>-1}},{key:"find",value:function(key){for(var i=0;i<this.content.length;i+=2)if(this.content[i]===key)return i}},{key:"clear",value:function(){this.content.length=0}},{key:"size",get:function(){return this.content.length/2}}]),_class}();exports.Map=Map},{}],51:[function(require,module,exports){"use strict";function sortedInsert(array,elt,compare){for(var i=0;i<array.length&&!(compare(array[i],elt)>0);i++);array.splice(i,0,elt)}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=sortedInsert,module.exports=exports["default"]},{}],52:[function(require,module,exports){!function(mod){if("object"==typeof exports&&"object"==typeof module)module.exports=mod();else{if("function"==typeof define&&define.amd)return define([],mod);(this||window).browserKeymap=mod()}}(function(){"use strict";function keyName(event){if("keypress"==event.type)return"'"+String.fromCharCode(event.charCode)+"'";var base=keyNames[event.keyCode],name=base;return null==name||event.altGraphKey?null:(event.altKey&&"Alt"!=base&&(name="Alt-"+name),event.ctrlKey&&"Ctrl"!=base&&(name="Ctrl-"+name),event.metaKey&&"Cmd"!=base&&(name="Cmd-"+name),event.shiftKey&&"Shift"!=base&&(name="Shift-"+name),name)}function isModifierKey(name){return name=/[^-]*$/.exec(name)[0],"Ctrl"==name||"Alt"==name||"Shift"==name||"Mod"==name}function normalizeKeyName(name){for(var alt,ctrl,shift,cmd,parts=name.split(/-(?!'?$)/),result=parts[parts.length-1],i=0;i<parts.length-1;i++){var mod=parts[i];if(/^(cmd|meta|m)$/i.test(mod))cmd=!0;else if(/^a(lt)?$/i.test(mod))alt=!0;else if(/^(c|ctrl|control)$/i.test(mod))ctrl=!0;else if(/^s(hift)$/i.test(mod))shift=!0;else{if(!/^mod$/i.test(mod))throw new Error("Unrecognized modifier name: "+mod);mac?cmd=!0:ctrl=!0}}return alt&&(result="Alt-"+result),ctrl&&(result="Ctrl-"+result),cmd&&(result="Cmd-"+result),shift&&(result="Shift-"+result),result}function Keymap(keys,options){if(this.options=options||{},this.bindings=Object.create(null),keys)for(var keyname in keys)Object.prototype.hasOwnProperty.call(keys,keyname)&&this.addBinding(keyname,keys[keyname])}for(var mac="undefined"!=typeof navigator?/Mac/.test(navigator.platform):"undefined"!=typeof os?"darwin"==os.platform():!1,keyNames={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},i=0;10>i;i++)keyNames[i+48]=keyNames[i+96]=String(i);for(var i=65;90>=i;i++)keyNames[i]=String.fromCharCode(i);for(var i=1;12>=i;i++)keyNames[i+111]=keyNames[i+63235]="F"+i;return Keymap.prototype={normalize:function(name){return this.options.multi!==!1?name.split(/ +(?!\'$)/).map(normalizeKeyName):[normalizeKeyName(name)]},addBinding:function(keyname,value){for(var keys=this.normalize(keyname),i=0;i<keys.length;i++){var name=keys.slice(0,i+1).join(" "),val=i==keys.length-1?value:"...",prev=this.bindings[name];if(prev){if(prev!=val)throw new Error("Inconsistent bindings for "+name)}else this.bindings[name]=val}},removeBinding:function(keyname){for(var keys=this.normalize(keyname),i=keys.length-1;i>=0;i--){var name=keys.slice(0,i).join(" "),val=this.bindings[name];if("..."==val&&!this.unusedMulti(name))break;val&&delete this.bindings[name]}},unusedMulti:function(name){for(var binding in this.bindings)if(binding.length>name&&0==binding.indexOf(name)&&" "==binding.charAt(name.length))return!1;return!0},lookup:function(key,context){return this.options.call?this.options.call(key,context):this.bindings[key]},constructor:Keymap},Keymap.keyName=keyName,Keymap.isModifierKey=isModifierKey,Keymap.normalizeKeyName=normalizeKeyName,Keymap})},{}],53:[function(require,module,exports){"use strict";var _gitProsemirrorDistEdit=require("../../../git/prosemirror/dist/edit"),_gitProsemirrorDistDom=require("../../../git/prosemirror/dist/dom");require("../../../git/prosemirror/dist/menu/tooltipmenu"),require("../../../git/prosemirror/dist/menu/menubar"),require("../../../git/prosemirror/dist/inputrules/autoinput");var _utils=require("./utils"),_gitProsemirrorDistModel=require("../../../git/prosemirror/dist/model"),_widgets=require("./widgets"),widgetSpec=new _gitProsemirrorDistModel.SchemaSpec({doc:_gitProsemirrorDistModel.Doc,blockquote:_gitProsemirrorDistModel.BlockQuote,ordered_list:_gitProsemirrorDistModel.OrderedList,bullet_list:_gitProsemirrorDistModel.BulletList,list_item:_gitProsemirrorDistModel.ListItem,horizontal_rule:_gitProsemirrorDistModel.HorizontalRule,paragraph:_gitProsemirrorDistModel.Paragraph,heading:_gitProsemirrorDistModel.Heading,text:_gitProsemirrorDistModel.Text,image:_widgets.Image,hard_break:_gitProsemirrorDistModel.HardBreak,input:_widgets.Input,textfield:_widgets.TextField,textarea:_widgets.TextArea,checkbox:_widgets.CheckBox,radiobutton:_widgets.RadioButton,select:_widgets.Select,inlinemath:_widgets.InlineMath,blockmath:_widgets.BlockMath,iframe:_widgets.IFrame,carryforward:_widgets.CarryForward,choice:_widgets.Choice,multiplechoice:_widgets.MultipleChoice,scale:_widgets.Scale,checkitem:_widgets.CheckItem,checklist:_widgets.CheckList,spreadsheet:_widgets.SpreadSheet,widget:_widgets.Widget},{em:_gitProsemirrorDistModel.EmMark,strong:_gitProsemirrorDistModel.StrongMark,link:_gitProsemirrorDistModel.LinkMark,code:_gitProsemirrorDistModel.CodeMark}),widgetSchema=new _gitProsemirrorDistModel.Schema(widgetSpec);window.pm=new _gitProsemirrorDistEdit.ProseMirror({place:document.querySelector("#editor"),menuBar:!0,autoInput:!0,doc:document.querySelector("#content"),docFormat:"dom",schema:widgetSchema,commandParamHandler:"widgetParamHandler"});(0,_utils.defineFileHandler)(function(files){console.log(files)}),(0,_gitProsemirrorDistDom.insertCSS)('\n		\n.ProseMirror {\n	width: 800px;\n	min-height: 200px;\n}\n\ndiv.ProseMirror-select-menu {\n  position: absolute;\n  top: 25px !Important; \n  background: #0191C8;\n  color: white;\n  border-radius: 6px;\n  padding: 2px 2px;\n  z-index: 15;\n}\n\ndiv.ProseMirror-select-menu {\n  cursor: pointer;\n  padding: 0 1em 0 2px;\n}\n\ndiv.ProseMirror-select-menu div:hover {\n  background: #D6F2F8;\n  color: #0191C8;\n}\n\ndiv.ProseMirror-menubar-inner {\n  background: linear-gradient(to bottom, white, #0191C8);\n}\n\ndiv.ProseMirror-menu form {\n	background: linear-gradient(to bottom, white, #0191C8);\n	width: 300px;\n}\n\ndiv.ProseMirror-menu form select {\n	width: 100px;\n	background: white;\n}\n\ndiv.ProseMirror-menu input[type = "text"] {\n	background: white;\n}\n\n')},{"../../../git/prosemirror/dist/dom":1,"../../../git/prosemirror/dist/edit":9,"../../../git/prosemirror/dist/inputrules/autoinput":21,"../../../git/prosemirror/dist/menu/menubar":25,"../../../git/prosemirror/dist/menu/tooltipmenu":26,"../../../git/prosemirror/dist/model":31,"./utils":54,"./widgets":62}],54:[function(require,module,exports){"use strict";function getLastClicked(){return lastClicked}function defParser(type,tag,cls){type.register("parseDOM",{tag:tag,rank:25,parse:function(dom,context,type,attrs){var contains=dom.classList.contains(cls);return contains?void context.insertFrom(dom,type,attrs):!1}})}function selectClickedNode(pm,e){var pos=(0,_gitProsemirrorDistEditSelection.selectableNodeAbove)(pm,e.target,{left:e.clientX,top:e.clientY},!0);if(!pos)return pm.sel.pollForUpdate();var _pm$selection=pm.selection,node=_pm$selection.node,from=_pm$selection.from;if(node&&pos.depth>=from.depth&&0==pos.shorten(from.depth).cmp(from)){if(0==from.depth)return pm.sel.pollForUpdate();pos=from.shorten()}pm.setNodeSelection(pos),e.preventDefault(),lastClicked=e.target}function defParamsClick(type,cmdname){var spots=arguments.length<=2||void 0===arguments[2]?["topleft"]:arguments[2];type.prototype.handleClick=function(pm,e,path,node){var spotClicked=!1;if(spots.forEach(function(loc){var r=e.target.getBoundingClientRect();"all"==loc?spotClicked=!0:"topleft"==loc?spotClicked=spotClicked||e.clientX<r.left+16&&e.clientY<r.top+16:"bottomright"==loc&&(spotClicked=spotClicked||e.clientX>r.right-32&&e.clientY>r.bottom-32)}),spotClicked){var cmd=pm.commands[cmdname];return cmd?(selectClickedNode(pm,e),(0,_params.widgetParamHandler)(pm,cmd),!0):!1}}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getLastClicked=getLastClicked,exports.defParser=defParser,exports.defParamsClick=defParamsClick;var _gitProsemirrorDistEditSelection=require("../../../../git/prosemirror/dist/edit/selection"),_params=require("./params");Object.defineProperty(exports,"widgetParamHandler",{enumerable:!0,get:function(){return _params.widgetParamHandler}}),Object.defineProperty(exports,"defineFileHandler",{enumerable:!0,get:function(){return _params.defineFileHandler}}),Object.defineProperty(exports,"namePattern",{enumerable:!0,get:function(){return _params.namePattern}}),Object.defineProperty(exports,"nameTitle",{enumerable:!0,get:function(){return _params.nameTitle}}),Object.defineProperty(exports,"selectedNodeAttr",{enumerable:!0,get:function(){return _params.selectedNodeAttr}});var andScroll={scrollIntoView:!0};exports.andScroll=andScroll;var lastClicked=null;window.MathJax&&MathJax.Hub.Queue(function(){MathJax.Hub.Config({tex2jax:{displayMath:[["\\[","\\]"]],inlineMath:[["\\(","\\)"]],processEscapes:!0},displayAlign:"left"})})},{"../../../../git/prosemirror/dist/edit/selection":14,"./params":55}],55:[function(require,module,exports){"use strict";function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function defineFileHandler(handler){fhandler=handler}function selectedNodeAttr(pm,type,name){var node=pm.selection.node;return node&&node.type==type?node.attrs[name]:void 0}function paramDefault(param,pm,command){if(param.prefill){var prefill=param.prefill.call(command.self,pm);if(null!=prefill)return prefill}return param["default"]}function buildParamFields(pm,command){var fields=command.params.map(function(param,i){var field=void 0,name="field_"+i,val=paramDefault(param,pm,command),fname=param.name?param.name:param.label,opt=param.options?param.options:{};if(inputTypes.indexOf(param.type)>=0){field=(0,_gitProsemirrorDistDom.elt)("input",{name:name,id:name,type:param.type,placeholder:param.label,value:val,autocomplete:"off",required:!0});for(var prop in opt)field.setAttribute(prop,opt[prop])}else if("file"==param.type){field=(0,_gitProsemirrorDistDom.elt)("input",{name:name,id:name,type:"text",readonly:!0,placeholder:param.label,value:val,autocomplete:"off",required:!0});for(var prop in opt)field.setAttribute(prop,opt[prop])}else{if("select"!=param.type)throw new Error("Unsupported parameter type: "+param.type);field=(0,_gitProsemirrorDistDom.elt)("select",{name:name},(param.options.call?param.options(pm):param.options).map(function(o){return(0,_gitProsemirrorDistDom.elt)("option",{value:o.value},o.label)})),val&&(field.value=val)}var fieldLabel=(0,_gitProsemirrorDistDom.elt)("label",{"for":name},fname);if("file"==param.type){var uploadButton=(0,_gitProsemirrorDistDom.elt)("span",{"class":"widgetUpload"},"Upload");return uploadButton.addEventListener("click",function(e){buildUploadForm(pm,field)}),(0,_gitProsemirrorDistDom.elt)("div",{"class":"widgetField"},fieldLabel,field,uploadButton)}return(0,_gitProsemirrorDistDom.elt)("div",{"class":"widgetField"},fieldLabel,field)});return fields}function gatherParams(pm,command,form){var bad=!1,params=command.params.map(function(param,i){var f=form.elements["field_"+i];if(f.validity.valid){var val=f.value;if(val)return val;if(param["default"])return paramDefault(param,pm,command)}bad=!0});return bad?null:params}function paramDialog(pm,command,callback){var dialog=void 0,form=void 0,finish=function(e){e.preventDefault(),e.stopPropagation();var params=gatherParams(pm,command,form);params&&(pm.wrapper.removeChild(dialog),pm.focus(),callback(params))},fields=buildParamFields(pm,command),save=(0,_gitProsemirrorDistDom.elt)("input",{name:"save",type:"submit",value:"Save"});save.addEventListener("mousedown",function(e){finish(e)});var cancel=(0,_gitProsemirrorDistDom.elt)("input",{name:"cancel",type:"button",value:"Cancel"});cancel.addEventListener("mousedown",function(e){e.preventDefault(),e.stopPropagation(),pm.wrapper.removeChild(dialog),pm.focus()});var buttons=(0,_gitProsemirrorDistDom.elt)("div",{"class":"widgetButtons"},save,cancel);form=(0,_gitProsemirrorDistDom.elt)("form",{"class":"widgetForm"},(0,_gitProsemirrorDistDom.elt)("h4",null,command.label+" Settings"),fields,buttons),form.addEventListener("keypress",function(e){if(13==e.keyCode){e.preventDefault(),e.stopPropagation();for(var i=0;i<form.elements.length;i++)if(!form.elements[i].validity.valid)return;finish(e)}}),dialog=(0,_gitProsemirrorDistDom.elt)("div",null,(0,_gitProsemirrorDistDom.elt)("div",{"class":"widgetDialog"}),form),pm.wrapper.appendChild(dialog),setTimeout(function(){var input=form.querySelector("input, textarea");input&&input.focus()},20)}function FileDragHover(e){e.stopPropagation(),e.preventDefault(),e.target.className="dragover"==e.type?"hover":""}function buildUploadForm(pm,field){var legend=(0,_gitProsemirrorDistDom.elt)("legend",null,"HTML File Upload"),inputHidden=(0,_gitProsemirrorDistDom.elt)("input",{type:"hidden",id:"MAX_FILE_SIZE",name:"MAX_FILE_SIZE",value:"300000"}),label=(0,_gitProsemirrorDistDom.elt)("label",{"for":"fileselect"},"File to upload:"),fileselect=(0,_gitProsemirrorDistDom.elt)("input",{id:"fileselect",type:"file",name:"fileselect[]",multiple:"multiple"}),filedrag=(0,_gitProsemirrorDistDom.elt)("div",{id:"filedrag"},"or drop files here"),cancel=(0,_gitProsemirrorDistDom.elt)("button",{type:"button"},"Cancel");cancel.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),pm.wrapper.removeChild(form)});var saveFile=function(e){e.preventDefault(),e.stopPropagation(),FileDragHover(e);var files=e.target.files||e.dataTransfer.files;files&&(field.value=files[0].name),fhandler&&fhandler(files),pm.wrapper.removeChild(form)};fileselect.addEventListener("change",saveFile);var xhr=new XMLHttpRequest;xhr.upload&&(filedrag.addEventListener("dragover",FileDragHover),filedrag.addEventListener("dragleave",FileDragHover),filedrag.addEventListener("drop",saveFile),filedrag.style.display="block");var form=(0,_gitProsemirrorDistDom.elt)("form",{id:"upload",enctype:"multipart/form-data"},(0,_gitProsemirrorDistDom.elt)("fieldset",null,legend,inputHidden,(0,_gitProsemirrorDistDom.elt)("div",null,label,fileselect,filedrag),(0,_gitProsemirrorDistDom.elt)("div",null,cancel)));pm.wrapper.appendChild(form)}function widgetParamHandler(pm,command,callback){paramDialog(pm,command,function(params){var run=command.spec.run;params&&run&&run.call.apply(run,[command.self,pm].concat(_toConsumableArray(params)))})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.defineFileHandler=defineFileHandler,exports.selectedNodeAttr=selectedNodeAttr,exports.widgetParamHandler=widgetParamHandler;var _gitProsemirrorDistDom=require("../../../../git/prosemirror/dist/dom"),_gitProsemirrorDistEdit=require("../../../../git/prosemirror/dist/edit"),inputTypes=["text","number","range","email","url","date"],fhandler=null,namePattern="[a-z0-9_-]{1,10}";exports.namePattern=namePattern;var nameTitle="Name must be less than 11 lower-case letters,digits,dashes or underscores.";exports.nameTitle=nameTitle,(0,_gitProsemirrorDistEdit.defineParamHandler)("widgetParamHandler",widgetParamHandler),(0,_gitProsemirrorDistDom.insertCSS)('\n\n.widgetDialog {\n	position: absolute;\n	top: 0;\n	left: 0;\n	width: 100%;\n	height: 100%;\n	background: #FFF;\n	z-index: 8888;\n	opacity:0.8;\n	font-family: Helvetica, Arial, Sans-Serif;\n}\n\n.widgetForm {\n	position: absolute;\n	top: 20px;\n	left: 20px;\n	padding: 5px;\n	border-radius: 6px;\n	background: #0191C8;\n	z-index: 9999;\n	display: block;\n}\n\n.widgetForm h4 {\n	color: white;\n	margin: 4px;\n}\n\n.widgetField {\n	display: block;\n	padding: 2px;\n}\n\n.widgetField label {\n	width: 80px;\n	color: white;\n	display: inline-block;\n	padding: 2px;\n	float: left;\n}\n\n.widgetField input {\n	margin: 2px;\n	display: inline;\n}\n\n.widgetField input[type = "number"] {\n	width: 60px;\n	margin: 2px;\n	display: inline;\n}\n.widgetFieldName {\n	color: white;\n	display: inline;\n	padding: 4px;\n}\n\n.widgetButtons {\n	text-align: center;\n	display: inline-block;\n	white-space: nowrap;\n}\n\n.widgetButtons input {\n	margin: 5px;\n}\n\n.widgetUpload {\n	cursor: pointer;\n	color: white;\n	border: 1px solid white;\n	font-size: 80%;\n	border-radius: 4px;\n	padding: 2px;\n}\n\n#upload {\n	position: absolute;\n	top: 40px;\n	left: 40px;\n	padding: 5px;\n	border-radius: 6px;\n	background: #EEE;\n	z-index: 10000;\n	display: block;\n}\n\n#filedrag {\n	display: none;\n	font-weight: bold;\n	text-align: center;\n	padding: 1em 0;\n	margin: 1em 0;\n	color: #555;\n	border: 2px dashed #555;\n	border-radius: 7px;\n	cursor: default;\n}\n\n#filedrag:hover {\n	color: #f00;\n	border-color: #f00;\n	border-style: solid;\n	box-shadow: inset 0 3px 4px #888;\n}\n\n')},{"../../../../git/prosemirror/dist/dom":1,"../../../../git/prosemirror/dist/edit":9}],56:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}},_gitProsemirrorDistModel=require("../../../../git/prosemirror/dist/model"),_gitProsemirrorDistDom=require("../../../../git/prosemirror/dist/dom"),_utils=require("../utils"),BlockMath=function(_Block){function BlockMath(){_classCallCheck(this,BlockMath),_get(Object.getPrototypeOf(BlockMath.prototype),"constructor",this).apply(this,arguments)}return _inherits(BlockMath,_Block),_createClass(BlockMath,[{key:"attrs",get:function(){return{tex:new _gitProsemirrorDistModel.Attribute({"default":""})}}},{key:"contains",get:function(){return null}}]),BlockMath}(_gitProsemirrorDistModel.Block);exports.BlockMath=BlockMath,(0,_utils.defParser)(BlockMath,"div","widgets-blockmath"),BlockMath.prototype.serializeDOM=function(node){return node.rendered?node.rendered=node.rendered.cloneNode(!0):(node.rendered=(0,_gitProsemirrorDistDom.elt)("div",{"class":"widgets-blockmath widgets-edit"},"\\["+node.attrs.tex+"\\]"),MathJax.Hub.Queue(["Delay",MathJax.Callback,100],["Typeset",MathJax.Hub,node.rendered])),node.rendered},BlockMath.register("command",{name:"insertBlockMath",label:"BlockMath",run:function(pm,tex){return pm.tr.replaceSelection(this.create({tex:tex})).apply(_utils.andScroll)},params:[{name:"Latex",label:"Latex Expression",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"tex")}}]}),(0,_utils.defParamsClick)(BlockMath,"schema:blockmath:insertBlockMath"),(0,_gitProsemirrorDistDom.insertCSS)("\n\n.ProseMirror .widgets-blockmath {}\n\n")},{"../../../../git/prosemirror/dist/dom":1,"../../../../git/prosemirror/dist/model":31,"../utils":54}],57:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function getCarryOptions(names){return names.map(function(w){return{value:w,label:w}})}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}},_gitProsemirrorDistModel=require("../../../../git/prosemirror/dist/model"),_gitProsemirrorDistDom=require("../../../../git/prosemirror/dist/dom"),_utils=require("../utils"),CarryForward=function(_Inline){function CarryForward(){_classCallCheck(this,CarryForward),_get(Object.getPrototypeOf(CarryForward.prototype),"constructor",this).apply(this,arguments)}return _inherits(CarryForward,_Inline),_createClass(CarryForward,[{key:"attrs",get:function(){return{name:new _gitProsemirrorDistModel.Attribute,model:new _gitProsemirrorDistModel.Attribute({"default":"user_response"}),type:new _gitProsemirrorDistModel.Attribute({"default":"carry_forward"})}}}]),CarryForward}(_gitProsemirrorDistModel.Inline);exports.CarryForward=CarryForward,(0,_utils.defParser)(CarryForward,"thinkspace","widgets-carryforward"),CarryForward.prototype.serializeDOM=function(node){return(0,_gitProsemirrorDistDom.elt)("thinkspace",{"class":"widgets-carryforward",name:node.attrs.name},(0,_gitProsemirrorDistDom.elt)("img",{src:"forward.png",width:16,height:16,title:"Carry forward "+node.attrs.name}))},CarryForward.register("command",{name:"insertCarryForward",label:"CarryForward",run:function(pm,name){return pm.tr.replaceSelection(this.create({name:name})).apply(_utils.andScroll)},params:[{name:"Name",label:"Element name",type:"select",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"name")},options:function(){return getCarryOptions(["test1","test2"])}}]}),(0,_utils.defParamsClick)(CarryForward,"schema:carryforward:insertCarryForward",["all"]),(0,_gitProsemirrorDistDom.insertCSS)("\n\n.ProseMirror .widgets-carryforward img:hover {\n	cursor: pointer;\n}\n\n")},{"../../../../git/prosemirror/dist/dom":1,"../../../../git/prosemirror/dist/model":31,"../utils":54}],58:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);
subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}},_gitProsemirrorDistModel=require("../../../../git/prosemirror/dist/model"),_gitProsemirrorDistDom=require("../../../../git/prosemirror/dist/dom"),_input=require("./input"),_utils=require("../utils"),CheckBox=function(_Input){function CheckBox(){_classCallCheck(this,CheckBox),_get(Object.getPrototypeOf(CheckBox.prototype),"constructor",this).apply(this,arguments)}return _inherits(CheckBox,_Input),_createClass(CheckBox,[{key:"attrs",get:function(){return{name:new _gitProsemirrorDistModel.Attribute,type:new _gitProsemirrorDistModel.Attribute({"default":"checkbox"}),value:new _gitProsemirrorDistModel.Attribute({"default":"1"}),"class":new _gitProsemirrorDistModel.Attribute({"default":"widgets-checkbox"})}}},{key:"contains",get:function(){return null}}]),CheckBox}(_input.Input);exports.CheckBox=CheckBox,(0,_utils.defParser)(CheckBox,"input","widgets-checkbox"),CheckBox.prototype.serializeDOM=function(node,s){return s.renderAs(node,"input",node.attrs)},CheckBox.register("command",{name:"insertCheckBox",label:"CheckBox",run:function(pm,name){return pm.tr.replaceSelection(this.create({name:name})).apply(_utils.andScroll)},params:[{name:"Name",label:"Short ID",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"name")},options:{pattern:_utils.namePattern,size:10,title:_utils.nameTitle}}]}),(0,_utils.defParamsClick)(CheckBox,"schema:checkbox:insertCheckBox",["all"]),(0,_gitProsemirrorDistDom.insertCSS)("\n\n.ProseMirror .widgets-checkbox:hover {\n	cursor: pointer;\n}\n\n")},{"../../../../git/prosemirror/dist/dom":1,"../../../../git/prosemirror/dist/model":31,"../utils":54,"./input":64}],59:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}},_gitProsemirrorDistModel=require("../../../../git/prosemirror/dist/model"),_gitProsemirrorDistDom=require("../../../../git/prosemirror/dist/dom"),_utils=require("../utils"),CheckItem=function(_Block){function CheckItem(){_classCallCheck(this,CheckItem),_get(Object.getPrototypeOf(CheckItem.prototype),"constructor",this).apply(this,arguments)}return _inherits(CheckItem,_Block),_createClass(CheckItem,[{key:"create",value:function(attrs,content,marks){var para=content?content=content.firstChild:pm.schema.defaultTextblockType().create(null);return _get(Object.getPrototypeOf(CheckItem.prototype),"create",this).call(this,attrs,[this.schema.node("checkbox",attrs),para],marks)}},{key:"isTextblock",get:function(){return!0}},{key:"attrs",get:function(){return{name:new _gitProsemirrorDistModel.Attribute,value:new _gitProsemirrorDistModel.Attribute,"class":new _gitProsemirrorDistModel.Attribute({"default":"widgets-checkitem"})}}}],[{key:"kinds",get:function(){return"checkitem"}}]),CheckItem}(_gitProsemirrorDistModel.Block);exports.CheckItem=CheckItem;var CheckList=function(_Block2){function CheckList(){_classCallCheck(this,CheckList),_get(Object.getPrototypeOf(CheckList.prototype),"constructor",this).apply(this,arguments)}return _inherits(CheckList,_Block2),_createClass(CheckList,[{key:"attrs",get:function(){return{name:new _gitProsemirrorDistModel.Attribute,title:new _gitProsemirrorDistModel.Attribute,layout:new _gitProsemirrorDistModel.Attribute({"default":"vertical"}),"class":new _gitProsemirrorDistModel.Attribute({"default":"widgets-checklist widgets-edit"})}}},{key:"isList",get:function(){return!0}}],[{key:"contains",get:function(){return"checkitem"}}]),CheckList}(_gitProsemirrorDistModel.Block);exports.CheckList=CheckList,(0,_utils.defParser)(CheckItem,"div","widgets-checkitem"),(0,_utils.defParser)(CheckList,"div","widgets-checklist"),CheckItem.prototype.serializeDOM=function(node,s){return s.renderAs(node,"div",node.attrs)},CheckList.prototype.serializeDOM=function(node,s){return s.renderAs(node,"div",node.attrs)},CheckItem.register("command",{name:"splitCheckitem",label:"Split the current checkitem",run:function(pm){var _pm$selection=pm.selection,from=_pm$selection.from,to=_pm$selection.to,node=_pm$selection.node;if(node&&node.isBlock||from.path.length<2||!_gitProsemirrorDistModel.Pos.samePath(from.path,to.path))return!1;var toParent=from.shorten(),parent=pm.doc.path(toParent.path);if(parent.type!=this)return!1;var nextType=to.offset==parent.child(toParent.offset).size?pm.schema.defaultTextblockType():null;return pm.tr["delete"](from,to).split(from,2,nextType).apply(_utils.andScroll)},keys:["Enter(19)"]}),CheckItem.register("command",{name:"deleteCheckItem",label:"delete this checkitem or checklist",run:function(pm){var _pm$selection2=pm.selection,from=_pm$selection2.from,to=_pm$selection2.to;return pm.tr["delete"](from.move(-1),to).apply(_utils.andScroll)},keys:["Backspace(50)","Mod-Backspace(50)"]}),CheckList.register("command",{name:"insertCheckList",label:"CheckList",run:function(pm,name,title,layout){var cl=this.create({name:name,title:title,layout:layout},pm.schema.node("checkitem",{name:name,value:0})),tr=pm.tr.replaceSelection(cl).apply(_utils.andScroll);return tr},select:function(pm){return pm.doc.path(pm.selection.from.path).type.canContainType(this)},params:[{name:"Name",label:"Short ID",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"name")},options:{pattern:_utils.namePattern,size:10,title:_utils.nameTitle}},{name:"Title",label:"Title",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"title")}},{name:"Layout",label:"vertical or horizontal",type:"select",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"layout")},options:[{value:"horizontal",label:"horizontal"},{value:"vertical",label:"vertical"}]}]}),(0,_utils.defParamsClick)(CheckList,"schema:checklist:insertCheckList"),(0,_gitProsemirrorDistDom.insertCSS)("\n\n.ProseMirror .widgets-checkitem {\n	float: left;\n}\n\ndiv.widgets-checkitem:first-child input {\n	display: none;\n}\n\n.ProseMirror .widgets-checkitem:hover {\n	cursor: text;\n}\n\n.widgets-checklist:before {\n	content: attr(title);\n	color: black;\n	font-size: 14px;\n	font-weight: bold;\n}\n\n.ProseMirror .widgets-checklist {}\n\n")},{"../../../../git/prosemirror/dist/dom":1,"../../../../git/prosemirror/dist/model":31,"../utils":54}],60:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}},_gitProsemirrorDistModel=require("../../../../git/prosemirror/dist/model"),_gitProsemirrorDistDom=require("../../../../git/prosemirror/dist/dom"),_utils=require("../utils"),IFrame=function(_Block){function IFrame(){_classCallCheck(this,IFrame),_get(Object.getPrototypeOf(IFrame.prototype),"constructor",this).apply(this,arguments)}return _inherits(IFrame,_Block),_createClass(IFrame,[{key:"attrs",get:function(){return{src:new _gitProsemirrorDistModel.Attribute,width:new _gitProsemirrorDistModel.Attribute({"default":200}),height:new _gitProsemirrorDistModel.Attribute({"default":200})}}},{key:"contains",get:function(){return null}}]),IFrame}(_gitProsemirrorDistModel.Block);exports.IFrame=IFrame,(0,_utils.defParser)(IFrame,"iframe","widgets-iframe"),IFrame.prototype.serializeDOM=function(node,s){return s.renderAs(node,"iframe",{src:node.attrs.src,width:node.attrs.width,height:node.attrs.height,content:"text/html;charset=UTF-8","class":"widgets-iframe widgets-edit",frameborder:"1",allowfullscreen:"1"})},IFrame.register("command",{name:"insertIFrame",label:"IFrame",run:function(pm,src,width,height){return pm.tr.replaceSelection(this.create({src:src,width:width,height:height})).apply(_utils.andScroll)},params:[{name:"URL",label:"Link to website, youTube, Google Maps ...",type:"url","default":"http://www.iastate.edu",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"src")}},{name:"Width",label:"Width in pixels",type:"number","default":200,prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"width")},options:{min:50,height:800}},{name:"Height",label:"Height in pixels",type:"number","default":200,prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"height")},options:{min:50,height:800}}]}),(0,_utils.defParamsClick)(IFrame,"schema:iframe:insertIFrame"),(0,_gitProsemirrorDistDom.insertCSS)("\n\n.ProseMirror .widgets-iframe:hover {\n	padding-left: 16px;\n    padding-top: 16px;\n}\n\n")},{"../../../../git/prosemirror/dist/dom":1,"../../../../git/prosemirror/dist/model":31,"../utils":54}],61:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}},_gitProsemirrorDistModel=require("../../../../git/prosemirror/dist/model"),_gitProsemirrorDistDom=require("../../../../git/prosemirror/dist/dom"),_utils=require("../utils"),Image=function(_Inline){function Image(){_classCallCheck(this,Image),_get(Object.getPrototypeOf(Image.prototype),"constructor",this).apply(this,arguments)}return _inherits(Image,_Inline),_createClass(Image,[{key:"attrs",get:function(){return{src:new _gitProsemirrorDistModel.Attribute,alt:new _gitProsemirrorDistModel.Attribute,title:new _gitProsemirrorDistModel.Attribute,"class":new _gitProsemirrorDistModel.Attribute({"default":"widgets-img widgets-edit"})}}}]),Image}(_gitProsemirrorDistModel.Inline);exports.Image=Image,(0,_utils.defParser)(Image,"img","widgets-img"),Image.prototype.serializeDOM=function(node,s){return s.renderAs(node,"img",node.attrs)},Image.register("command",{name:"insertImage",label:"Image",run:function(pm,src,alt,title){return pm.tr.replaceSelection(this.create({src:src,title:title,alt:alt})).apply(_utils.andScroll)},params:[{name:"File",label:"Image File",type:"file","default":"img.png",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"src")}},{name:"Description",label:"Description / alternative text",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"alt")}},{name:"Title",label:"Title",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"tex")}}],select:function(pm){return pm.doc.path(pm.selection.from.path).type.canContainType(this)}}),(0,_utils.defParamsClick)(Image,"schema:image:insertImage",["all"]),(0,_gitProsemirrorDistDom.insertCSS)("\n\n.ProseMirror .widgets-img {}\n\n")},{"../../../../git/prosemirror/dist/dom":1,"../../../../git/prosemirror/dist/model":31,"../utils":54}],62:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _blockmath=require("./blockmath");Object.defineProperty(exports,"BlockMath",{enumerable:!0,get:function(){return _blockmath.BlockMath}});var _checkbox=require("./checkbox");Object.defineProperty(exports,"CheckBox",{enumerable:!0,get:function(){return _checkbox.CheckBox}});var _checklist=require("./checklist");Object.defineProperty(exports,"CheckList",{enumerable:!0,get:function(){return _checklist.CheckList}}),Object.defineProperty(exports,"CheckItem",{enumerable:!0,get:function(){return _checklist.CheckItem}});var _iframe=require("./iframe");Object.defineProperty(exports,"IFrame",{enumerable:!0,get:function(){return _iframe.IFrame}});var _inlinemath=require("./inlinemath");Object.defineProperty(exports,"InlineMath",{enumerable:!0,get:function(){return _inlinemath.InlineMath}});var _input=require("./input");Object.defineProperty(exports,"Input",{enumerable:!0,get:function(){return _input.Input}});var _multiplechoice=require("./multiplechoice");Object.defineProperty(exports,"MultipleChoice",{enumerable:!0,get:function(){return _multiplechoice.MultipleChoice}}),Object.defineProperty(exports,"Choice",{enumerable:!0,get:function(){return _multiplechoice.Choice}});var _radiobutton=require("./radiobutton");Object.defineProperty(exports,"RadioButton",{enumerable:!0,get:function(){return _radiobutton.RadioButton}});var _scale=require("./scale");Object.defineProperty(exports,"Scale",{enumerable:!0,get:function(){return _scale.Scale}});var _select=require("./select");Object.defineProperty(exports,"Select",{enumerable:!0,get:function(){return _select.Select}});var _textarea=require("./textarea");Object.defineProperty(exports,"TextArea",{enumerable:!0,get:function(){return _textarea.TextArea}});var _textfield=require("./textfield");Object.defineProperty(exports,"TextField",{enumerable:!0,get:function(){return _textfield.TextField}});var _image=require("./image");Object.defineProperty(exports,"Image",{enumerable:!0,get:function(){return _image.Image}});var _spreadsheet=require("./spreadsheet");Object.defineProperty(exports,"SpreadSheet",{enumerable:!0,get:function(){return _spreadsheet.SpreadSheet}});var _carryforward=require("./carryforward");Object.defineProperty(exports,"CarryForward",{enumerable:!0,get:function(){return _carryforward.CarryForward}});var _widget=require("./widget");Object.defineProperty(exports,"Widget",{enumerable:!0,get:function(){return _widget.Widget}})},{"./blockmath":56,"./carryforward":57,"./checkbox":58,"./checklist":59,"./iframe":60,"./image":61,"./inlinemath":63,"./input":64,"./multiplechoice":65,"./radiobutton":66,"./scale":67,"./select":68,"./spreadsheet":69,"./textarea":70,"./textfield":71,"./widget":72}],63:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}},_gitProsemirrorDistModel=require("../../../../git/prosemirror/dist/model"),_gitProsemirrorDistDom=require("../../../../git/prosemirror/dist/dom"),_utils=require("../utils"),InlineMath=function(_Inline){function InlineMath(){_classCallCheck(this,InlineMath),_get(Object.getPrototypeOf(InlineMath.prototype),"constructor",this).apply(this,arguments)}return _inherits(InlineMath,_Inline),_createClass(InlineMath,[{key:"attrs",get:function(){return{tex:new _gitProsemirrorDistModel.Attribute}}},{key:"contains",get:function(){return null}}]),InlineMath}(_gitProsemirrorDistModel.Inline);exports.InlineMath=InlineMath,(0,_utils.defParser)(InlineMath,"span","widgets-inlinemath"),InlineMath.prototype.serializeDOM=function(node){return node.rendered?node.rendered=node.rendered.cloneNode(!0):(node.rendered=(0,_gitProsemirrorDistDom.elt)("span",{"class":"widgets-inlinemath widgets-edit"}," \\("+node.attrs.tex+"\\) "),MathJax.Hub.Queue(["Delay",MathJax.Callback,100],["Typeset",MathJax.Hub,node.rendered])),node.rendered},InlineMath.register("command",{name:"insertInlineMath",label:"InlineMath",run:function(pm,tex){return pm.tr.replaceSelection(this.create({tex:tex})).apply(_utils.andScroll)},params:[{name:"Latex",label:"Latex Expression",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"tex")}}]}),(0,_utils.defParamsClick)(InlineMath,"schema:inlinemath:insertInlineMath"),(0,_gitProsemirrorDistDom.insertCSS)("\n\n.ProseMirror .widgets-inlinemath {}\n\n")},{"../../../../git/prosemirror/dist/dom":1,"../../../../git/prosemirror/dist/model":31,"../utils":54}],64:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}},_gitProsemirrorDistModel=require("../../../../git/prosemirror/dist/model"),_gitProsemirrorDistDom=require("../../../../git/prosemirror/dist/dom"),_utils=require("../utils"),Input=function(_Inline){function Input(){_classCallCheck(this,Input),_get(Object.getPrototypeOf(Input.prototype),"constructor",this).apply(this,arguments)}return _inherits(Input,_Inline),_createClass(Input,[{key:"contains",get:function(){return null}},{key:"attrs",get:function(){return{name:new _gitProsemirrorDistModel.Attribute,type:new _gitProsemirrorDistModel.Attribute({"default":"text"}),value:new _gitProsemirrorDistModel.Attribute}}}]),Input}(_gitProsemirrorDistModel.Inline);exports.Input=Input,(0,_utils.defParser)(Input,"widgets-input"),Input.prototype.serializeDOM=function(node,s){return s.renderAs(node,"input",node.attrs)},(0,_gitProsemirrorDistDom.insertCSS)("\n		\n.widgets-input {}\n\n")},{"../../../../git/prosemirror/dist/dom":1,"../../../../git/prosemirror/dist/model":31,"../utils":54}],65:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}},_gitProsemirrorDistModel=require("../../../../git/prosemirror/dist/model"),_gitProsemirrorDistDom=require("../../../../git/prosemirror/dist/dom"),_utils=require("../utils"),Choice=function(_Block){function Choice(){_classCallCheck(this,Choice),_get(Object.getPrototypeOf(Choice.prototype),"constructor",this).apply(this,arguments)}return _inherits(Choice,_Block),_createClass(Choice,[{key:"create",value:function(attrs,content,marks){var para=content?content.firstChild:pm.schema.defaultTextblockType().create(null);return _get(Object.getPrototypeOf(Choice.prototype),"create",this).call(this,attrs,[this.schema.node("radiobutton",attrs),para],marks)}},{key:"isTextblock",get:function(){return!0}},{key:"attrs",get:function(){return{name:new _gitProsemirrorDistModel.Attribute,value:new _gitProsemirrorDistModel.Attribute,"class":new _gitProsemirrorDistModel.Attribute({"default":"widgets-choice"})}}}],[{key:"kinds",get:function(){return"choice"}}]),Choice}(_gitProsemirrorDistModel.Block);exports.Choice=Choice;var MultipleChoice=function(_Block2){function MultipleChoice(){_classCallCheck(this,MultipleChoice),_get(Object.getPrototypeOf(MultipleChoice.prototype),"constructor",this).apply(this,arguments)}return _inherits(MultipleChoice,_Block2),_createClass(MultipleChoice,[{key:"attrs",get:function(){return{name:new _gitProsemirrorDistModel.Attribute,title:new _gitProsemirrorDistModel.Attribute,"class":new _gitProsemirrorDistModel.Attribute({"default":"widgets-multiplechoice widgets-edit"})}}},{key:"isList",get:function(){return!0}}],[{key:"contains",get:function(){return"choice"}}]),MultipleChoice}(_gitProsemirrorDistModel.Block);exports.MultipleChoice=MultipleChoice,(0,_utils.defParser)(Choice,"div","widgets-choice"),(0,_utils.defParser)(MultipleChoice,"div","widgets-multiplechoice"),Choice.prototype.serializeDOM=function(node,s){return s.renderAs(node,"div",node.attrs)},MultipleChoice.prototype.serializeDOM=function(node,s){return s.renderAs(node,"div",node.attrs)},Choice.register("command",{name:"splitChoice",label:"Split the current choice",run:function(pm){var _pm$selection=pm.selection,from=_pm$selection.from,to=_pm$selection.to,node=_pm$selection.node;if(node&&node.isBlock||from.path.length<2||!_gitProsemirrorDistModel.Pos.samePath(from.path,to.path))return!1;var toParent=from.shorten(),parent=pm.doc.path(toParent.path);if(parent.type!=this)return!1;var nextType=to.offset==parent.child(toParent.offset).size?pm.schema.defaultTextblockType():null;return pm.tr["delete"](from,to).split(from,2,nextType).apply(_utils.andScroll)},keys:["Enter(19)"]}),Choice.register("command",{name:"deleteChoice",label:"delete this choice or multiplechoice",run:function(pm){var _pm$selection2=pm.selection,from=_pm$selection2.from,to=_pm$selection2.to;return pm.tr["delete"](from.move(-1),to).apply(_utils.andScroll)},keys:["Backspace(20)","Mod-Backspace(20)"]}),MultipleChoice.register("command",{name:"insertMultipleChoice",label:"MultipleChoice",run:function(pm,name,title){var mc=this.create({name:name,title:title},pm.schema.node("choice",{name:name,value:0})),tr=pm.tr.replaceSelection(mc).apply(_utils.andScroll);return tr},select:function(pm){return!0},params:[{name:"Name",label:"Short ID",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"name")},options:{pattern:_utils.namePattern,size:10,title:_utils.nameTitle}},{name:"Title",label:"Description",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"title")}}]}),(0,_utils.defParamsClick)(MultipleChoice,"schema:multiplechoice:insertMultipleChoice"),(0,_gitProsemirrorDistDom.insertCSS)("\n\n.widgets-choice input {\n	float: left;\n}\n\ndiv.widgets-choice:first-child input {\n	display: none;\n}\n\n.widgets-multiplechoice:before {\n	content: attr(title);\n	color: black;\n	font-size: 14px;\n	font-weight: bold;\n}\n\n.ProseMirror .widgets-choice:hover {\n	cursor: text;\n}\n\n.ProseMirror .widgets-multiplechoice {}\n\n")},{"../../../../git/prosemirror/dist/dom":1,"../../../../git/prosemirror/dist/model":31,"../utils":54}],66:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,
_again=!0,desc=parent=void 0}},_gitProsemirrorDistModel=require("../../../../git/prosemirror/dist/model"),_gitProsemirrorDistDom=require("../../../../git/prosemirror/dist/dom"),_utils=require("../utils"),_input=require("./input"),RadioButton=function(_Input){function RadioButton(){_classCallCheck(this,RadioButton),_get(Object.getPrototypeOf(RadioButton.prototype),"constructor",this).apply(this,arguments)}return _inherits(RadioButton,_Input),_createClass(RadioButton,[{key:"attrs",get:function(){return{name:new _gitProsemirrorDistModel.Attribute,type:new _gitProsemirrorDistModel.Attribute({"default":"radio"}),value:new _gitProsemirrorDistModel.Attribute,"class":new _gitProsemirrorDistModel.Attribute({"default":"widgets-radiobutton"})}}},{key:"selectable",get:function(){return!0}},{key:"contains",get:function(){return null}}]),RadioButton}(_input.Input);exports.RadioButton=RadioButton,(0,_utils.defParser)(RadioButton,"input","widgets-radiobutton"),RadioButton.prototype.serializeDOM=function(node,s){return s.renderAs(node,"input",node.attrs)},(0,_gitProsemirrorDistDom.insertCSS)("\n\n.widgets-radiobutton {}\n\n")},{"../../../../git/prosemirror/dist/dom":1,"../../../../git/prosemirror/dist/model":31,"../utils":54,"./input":64}],67:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}},_gitProsemirrorDistModel=require("../../../../git/prosemirror/dist/model"),_gitProsemirrorDistDom=require("../../../../git/prosemirror/dist/dom"),_utils=require("../utils"),Scale=function(_Block){function Scale(){_classCallCheck(this,Scale),_get(Object.getPrototypeOf(Scale.prototype),"constructor",this).apply(this,arguments)}return _inherits(Scale,_Block),_createClass(Scale,[{key:"attrs",get:function(){return{name:new _gitProsemirrorDistModel.Attribute,title:new _gitProsemirrorDistModel.Attribute,startvalue:new _gitProsemirrorDistModel.Attribute({"default":"1"}),startlabel:new _gitProsemirrorDistModel.Attribute({"default":"low"}),endvalue:new _gitProsemirrorDistModel.Attribute({"default":"10"}),endlabel:new _gitProsemirrorDistModel.Attribute({"default":"high"})}}}],[{key:"contains",get:function(){return"paragraph"}}]),Scale}(_gitProsemirrorDistModel.Block);exports.Scale=Scale,(0,_utils.defParser)(Scale,"div","widgets-scale"),Scale.prototype.serializeDOM=function(node,s){var dom=s.renderAs(node,"div",{"class":"widgets-scale widgets-edit",title:node.attrs.title,contenteditable:!1}),para=(0,_gitProsemirrorDistDom.elt)("p");dom.appendChild(para),para.appendChild((0,_gitProsemirrorDistDom.elt)("span",null,node.attrs.startlabel+" "));var startVal=Number(node.attrs.startvalue),endVal=Number(node.attrs.endvalue);if(endVal>startVal)for(var i=startVal;endVal>=i;i++){var _name=node.attrs.name+i;para.appendChild((0,_gitProsemirrorDistDom.elt)("span",{"class":"widgets-scaleitem"},(0,_gitProsemirrorDistDom.elt)("label",{"for":_name},i.toString()),(0,_gitProsemirrorDistDom.elt)("input",{id:_name,name:node.attrs.name,type:"radio",value:i})))}else for(var i=startVal;i>=endVal;i--)para.appendChild((0,_gitProsemirrorDistDom.elt)("span",{"class":"widgets-scaleitem"},(0,_gitProsemirrorDistDom.elt)("label",{"for":name},i.toString()),(0,_gitProsemirrorDistDom.elt)("input",{id:name,name:node.attrs.name,type:"radio",value:i})));return para.appendChild((0,_gitProsemirrorDistDom.elt)("span",null," "+node.attrs.endlabel)),dom},Scale.register("command",{name:"insertScale",label:"Scale",run:function(pm,name,title,startvalue,startlabel,endvalue,endlabel){var para=pm.schema.node("paragraph");return pm.tr.replaceSelection(this.create({name:name,title:title,startvalue:startvalue,startlabel:startlabel,endvalue:endvalue,endlabel:endlabel},para)).apply(_utils.andScroll)},params:[{name:"Name",label:"Short ID",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"name")},options:{pattern:_utils.namePattern,size:10,title:_utils.nameTitle}},{name:"Title",label:"Scale Title",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"title")}},{label:"Start value",type:"number","default":1,prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"startvalue")}},{name:"Start Label",label:"Text on left",type:"text","default":"low",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"startlabel")}},{label:"End value",type:"number","default":10,prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"endvalue")}},{name:"End Label",label:"Text on right",type:"text","default":"high",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"endlabel")}}]}),(0,_utils.defParamsClick)(Scale,"schema:scale:insertScale"),(0,_gitProsemirrorDistDom.insertCSS)("\n\n.widgets-scaleitem {\n	display: inline-block;\n	text-align: center;\n}\n\n.widgets-scaleitem input {\n	display: block;\n}\n\n.widgets-scale:before {\n	content: attr(title);\n	color: black;\n	font-size: 14px;\n	font-weight: bold;\n	display: block;\n}\n\n.widgets-scale span {\n	vertical-align: middle;\n	font-weight: normal;\n}\n\n.ProseMirror .widgets-scale:hover {}\n\n")},{"../../../../git/prosemirror/dist/dom":1,"../../../../git/prosemirror/dist/model":31,"../utils":54}],68:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}},_gitProsemirrorDistModel=require("../../../../git/prosemirror/dist/model"),_gitProsemirrorDistDom=require("../../../../git/prosemirror/dist/dom"),_utils=require("../utils"),Select=function(_Inline){function Select(){_classCallCheck(this,Select),_get(Object.getPrototypeOf(Select.prototype),"constructor",this).apply(this,arguments)}return _inherits(Select,_Inline),_createClass(Select,[{key:"contains",get:function(){return null}},{key:"attrs",get:function(){return{name:new _gitProsemirrorDistModel.Attribute,options:new _gitProsemirrorDistModel.Attribute,multiple:new _gitProsemirrorDistModel.Attribute({"default":"single"})}}}]),Select}(_gitProsemirrorDistModel.Inline);exports.Select=Select,(0,_utils.defParser)(Select,"select","widgets-select"),Select.prototype.serializeDOM=function(node){var selection="multiple"==node.attrs.multiple,select=(0,_gitProsemirrorDistDom.elt)("select",{name:node.attrs.name,"class":"widgets-select widgets-edit",size:1,multiple:selection});return node.attrs.options.split(",").map(function(option){select.appendChild((0,_gitProsemirrorDistDom.elt)("option",{value:option.trim()},option))}),select},Select.register("command",{name:"insertSelect",label:"Select",run:function(pm,name,options,multiple){return pm.tr.replaceSelection(this.create({name:name,options:options,multiple:multiple})).apply(_utils.andScroll)},params:[{name:"Name",label:"Short ID",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"name")},options:{pattern:_utils.namePattern,size:10,title:_utils.nameTitle}},{name:"Options",label:"comma separated names",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"options")}},{name:"Selection",label:"Selection (single or multiple)",type:"select",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"multiple")},options:[{value:"multiple",label:"multiple"},{value:"single",label:"single"}]}]}),(0,_utils.defParamsClick)(Select,"schema:select:insertSelect"),(0,_gitProsemirrorDistDom.insertCSS)("\n\n.ProseMirror .widgets-select {}\n\n")},{"../../../../git/prosemirror/dist/dom":1,"../../../../git/prosemirror/dist/model":31,"../utils":54}],69:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}},_gitProsemirrorDistModel=require("../../../../git/prosemirror/dist/model"),_gitProsemirrorDistDom=require("../../../../git/prosemirror/dist/dom"),_utils=require("../utils"),SpreadSheet=function(_Block){function SpreadSheet(){_classCallCheck(this,SpreadSheet),_get(Object.getPrototypeOf(SpreadSheet.prototype),"constructor",this).apply(this,arguments)}return _inherits(SpreadSheet,_Block),_createClass(SpreadSheet,[{key:"attrs",get:function(){return{data:new _gitProsemirrorDistModel.Attribute}}},{key:"contains",get:function(){return null}}]),SpreadSheet}(_gitProsemirrorDistModel.Block);exports.SpreadSheet=SpreadSheet,(0,_utils.defParser)(SpreadSheet,"div","widgets-spreadsheet"),SpreadSheet.prototype.serializeDOM=function(node){return node.rendered?node.rendered=node.rendered.cloneNode(!0):(node.rendered=(0,_gitProsemirrorDistDom.elt)("div",{"class":"widgets-spreadsheet widgets-edit"}),window.setTimeout(function(){var data=[["","Ford","Volvo","Toyota","Honda"],["2014",10,11,12,13],["2015",20,11,14,13],["2016",30,15,12,13]];new Handsontable(node.rendered,{data:data,minSpareRows:1,rowHeaders:!0,colHeaders:!0,contextMenu:!0})},100)),node.rendered},SpreadSheet.register("command",{name:"insertSpreadSheet",label:"SpreadSheet",run:function(pm,data){return pm.tr.replaceSelection(this.create({data:data})).apply(_utils.andScroll)},params:[{name:"Data Link",label:"Link to data CSV (fixed for demo)",type:"text","default":"cars.csv",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"data")}}]}),(0,_utils.defParamsClick)(SpreadSheet,"schema:spreadsheet:insertSpreadSheet",["all"]),(0,_gitProsemirrorDistDom.insertCSS)("\n\n.ProseMirror .widgets-spreadsheet {\n}\n\n")},{"../../../../git/prosemirror/dist/dom":1,"../../../../git/prosemirror/dist/model":31,"../utils":54}],70:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}},_gitProsemirrorDistModel=require("../../../../git/prosemirror/dist/model"),_gitProsemirrorDistDom=require("../../../../git/prosemirror/dist/dom"),_utils=require("../utils"),TextArea=function(_Block){function TextArea(){_classCallCheck(this,TextArea),_get(Object.getPrototypeOf(TextArea.prototype),"constructor",this).apply(this,arguments)}return _inherits(TextArea,_Block),_createClass(TextArea,[{key:"attrs",get:function(){return{name:new _gitProsemirrorDistModel.Attribute,rows:new _gitProsemirrorDistModel.Attribute,cols:new _gitProsemirrorDistModel.Attribute,"class":new _gitProsemirrorDistModel.Attribute({"default":"widgets-textarea widgets-edit"})}}},{key:"contains",get:function(){return null}}]),TextArea}(_gitProsemirrorDistModel.Block);exports.TextArea=TextArea,(0,_utils.defParser)(TextArea,"input","widgets-textarea"),TextArea.prototype.serializeDOM=function(node,s){return s.renderAs(node,"textarea",{name:node.attrs.name,rows:node.attrs.rows,cols:node.attrs.cols,"class":"widgets-textarea widgets-edit"})},TextArea.register("command",{name:"insertTextArea",label:"TextArea",run:function(pm,name,rows,cols){return pm.tr.replaceSelection(this.create({name:name,rows:rows,cols:cols})).apply(_utils.andScroll)},params:[{name:"Name",label:"Short ID",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"name")},options:{pattern:_utils.namePattern,size:10,title:_utils.nameTitle}},{name:"Rows",label:"In lines lines",type:"number","default":"4",options:{min:2,max:24},prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"rows")}},{name:"Columns",label:"In characters",type:"number","default":"40",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"cols")},options:{min:2,max:80}}]}),(0,_utils.defParamsClick)(TextArea,"schema:textarea:insertTextArea"),(0,_gitProsemirrorDistDom.insertCSS)("\n\n.ProseMirror .widgets-textarea {\n	resize: none;\n}\n\n")},{"../../../../git/prosemirror/dist/dom":1,"../../../../git/prosemirror/dist/model":31,"../utils":54}],71:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}},_gitProsemirrorDistModel=require("../../../../git/prosemirror/dist/model"),_gitProsemirrorDistDom=require("../../../../git/prosemirror/dist/dom"),_input=require("./input"),_utils=require("../utils"),TextField=function(_Input){function TextField(){_classCallCheck(this,TextField),_get(Object.getPrototypeOf(TextField.prototype),"constructor",this).apply(this,arguments)}return _inherits(TextField,_Input),_createClass(TextField,[{key:"attrs",get:function(){return{name:new _gitProsemirrorDistModel.Attribute,type:new _gitProsemirrorDistModel.Attribute({"default":"text"}),size:new _gitProsemirrorDistModel.Attribute({"default":"20"}),"class":new _gitProsemirrorDistModel.Attribute({"default":"widgets-textfield widgets-edit"})}}},{key:"contains",get:function(){return null}}]),TextField}(_input.Input);exports.TextField=TextField,(0,_utils.defParser)(TextField,"input","widgets-textfield"),TextField.prototype.serializeDOM=function(node,s){return s.renderAs(node,"input",node.attrs)},TextField.register("command",{name:"insertTextField",label:"TextField",run:function(pm,name,size){return pm.tr.replaceSelection(this.create({name:name,size:size})).apply(_utils.andScroll)},params:[{name:"Name",label:"Short ID",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"name")},options:{pattern:_utils.namePattern,size:10,title:_utils.nameTitle}},{name:"Size",label:"Size in characters",type:"number","default":"20",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"size")},options:{min:1,max:80}}]}),(0,_utils.defParamsClick)(TextField,"schema:textfield:insertTextField"),(0,_gitProsemirrorDistDom.insertCSS)("\n\n.ProseMirror .widgets-textfield {\n	resize: horizontal;\n	overflow: auto;\n}\n\n")},{"../../../../git/prosemirror/dist/dom":1,"../../../../git/prosemirror/dist/model":31,"../utils":54,"./input":64}],72:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _get=function(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;if(void 0===getter)return;return getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return;_x=parent,_x2=property,_x3=receiver,_again=!0,desc=parent=void 0}},_gitProsemirrorDistModel=require("../../../../git/prosemirror/dist/model"),_gitProsemirrorDistDom=require("../../../../git/prosemirror/dist/dom"),_gitProsemirrorDistEdit=require("../../../../git/prosemirror/dist/edit"),_utils=require("../utils"),inlineWidgets=["Image","TextField","CheckBox","Select","CarryForward","InlineMath"],insertInlineWidget=inlineWidgets.map(function(w){return{value:"insert"+w,display:function(){return(0,_gitProsemirrorDistDom.elt)("span",null,w)}}}),blockWidgets=["TextArea","BlockMath","IFrame","SpreadSheet","MultipleChoice","Scale","CheckList"],insertBlockWidget=blockWidgets.map(function(w){return{value:"insert"+w,display:function(){return(0,_gitProsemirrorDistDom.elt)("span",null,w)}}}),Widget=function(_Textblock){function Widget(){_classCallCheck(this,Widget),_get(Object.getPrototypeOf(Widget.prototype),"constructor",this).apply(this,arguments)}return _inherits(Widget,_Textblock),Widget}(_gitProsemirrorDistModel.Textblock);exports.Widget=Widget,(0,_gitProsemirrorDistEdit.defineCommand)({name:"insertInlineWidget",label:"Insert Inline Widget",select:function(pm){return"inline"==pm.doc.path(pm.selection.from.path).type.contains},params:[{name:"Widget type",type:"select",options:insertInlineWidget,defaultLabel:(0,_gitProsemirrorDistDom.elt)("img",{src:"icons/insert.png",width:"16px",height:"16px",alt:" Insert inline widget",title:"Insert inline widget"})}],run:function(pm,type){if(!type.startsWith("insert"))return!1;var tname="schema:"+type.split("insert")[1].toLowerCase()+":"+type,cmd=pm.commands[tname];cmd&&(0,_utils.widgetParamHandler)(pm,cmd)},display:{type:"param"},menuGroup:"inline(99)"}),(0,_gitProsemirrorDistEdit.defineCommand)({name:"insertBlockWidget",label:"Insert Block Widget",select:function(pm){return"inline"==pm.doc.path(pm.selection.from.path).type.contains},params:[{name:"Widget type",type:"select",options:insertBlockWidget,defaultLabel:(0,_gitProsemirrorDistDom.elt)("img",{src:"icons/insert.png",width:"16px",height:"16px",alt:" Insert block widget",title:"Insert block widget"})}],run:function(pm,type){if(!type.startsWith("insert"))return!1;var tname="schema:"+type.split("insert")[1].toLowerCase()+":"+type,cmd=pm.commands[tname];cmd&&(0,_utils.widgetParamHandler)(pm,cmd)},display:{type:"param"},menuGroup:"block(99)"}),(0,_gitProsemirrorDistDom.insertCSS)("\n\n.ProseMirror .widgets-edit:hover {\n	background-image: url('icons/edit45.png');\n	background-repeat: no-repeat;\n	background-position: top left;\n	cursor: pointer;\n }\n\n\n")},{"../../../../git/prosemirror/dist/dom":1,"../../../../git/prosemirror/dist/edit":9,"../../../../git/prosemirror/dist/model":31,"../utils":54}]},{},[53]);