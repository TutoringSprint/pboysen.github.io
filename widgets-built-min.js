!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";function elt(tag,attrs){var result=document.createElement(tag);if(attrs)for(var name in attrs)"style"==name?result.style.cssText=attrs[name]:null!=attrs[name]&&result.setAttribute(name,attrs[name]);for(var _len=arguments.length,args=Array(_len>2?_len-2:0),_key=2;_len>_key;_key++)args[_key-2]=arguments[_key];for(var i=0;i<args.length;i++)add(args[i],result);return result}function add(value,target){if("string"==typeof value&&(value=document.createTextNode(value)),Array.isArray(value))for(var i=0;i<value.length;i++)add(value[i],target);else target.appendChild(value)}function requestAnimationFrame(f){reqFrame?reqFrame(f):setTimeout(f,10)}function contains(parent,child){return 1!=child.nodeType&&(child=child.parentNode),child&&parent.contains(child)}function insertCSS(css){cssNode?cssNode.textContent+=css:accumulatedCSS+=css}function ensureCSSAdded(){cssNode||(cssNode=document.createElement("style"),cssNode.textContent="/* ProseMirror CSS */\n"+accumulatedCSS,document.head.insertBefore(cssNode,document.head.firstChild))}Object.defineProperty(exports,"__esModule",{value:!0}),exports.elt=elt,exports.requestAnimationFrame=requestAnimationFrame,exports.contains=contains,exports.insertCSS=insertCSS,exports.ensureCSSAdded=ensureCSSAdded;var reqFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,ie_upto10=/MSIE \d/.test(navigator.userAgent),ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),accumulatedCSS=(exports.browser={mac:/Mac/.test(navigator.platform),ie_upto10:ie_upto10,ie_11up:ie_11up,ie:ie_upto10||ie_11up,gecko:/gecko\/\d/i.test(navigator.userAgent)},""),cssNode=null},{}],2:[function(require,module,exports){"use strict";function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function moveBackward(parent,offset,by){"char"!=by&&"word"!=by&&_error.AssertionError.raise("Unknown motion unit: "+by);for(var cat=null,counted=0;;){if(0==offset)return offset;var _parent$chunkBefore=parent.chunkBefore(offset),start=_parent$chunkBefore.start,node=_parent$chunkBefore.node;if(!node.isText)return cat?offset:offset-1;if("char"==by)for(var i=offset-start;i>0;i--){if(!(0,_char.isExtendingChar)(node.text.charAt(i-1)))return offset-1;offset--}else if("word"==by)for(var i=offset-start;i>0;i--){var nextCharCat=(0,_char.charCategory)(node.text.charAt(i-1));if(null==cat||1==counted&&"space"==cat)cat=nextCharCat;else if(cat!=nextCharCat)return offset;offset--,counted++}}}function deleteBarrier(pm,cut){var around=pm.doc.path(cut.path),before=around.child(cut.offset-1),after=around.child(cut.offset);if(!before.type.canContainContent(after.type)||pm.tr.join(cut).apply(pm.apply.scroll)===!1){var conn=void 0;if(after.isTextblock&&(conn=before.type.findConnection(after.type))){var tr=pm.tr,end=cut.move(1);if(tr.step("ancestor",cut,end,null,{types:[before.type].concat(_toConsumableArray(conn)),attrs:[before.attrs].concat(_toConsumableArray(conn.map(function(){return null})))}),tr.join(end),tr.join(cut),tr.apply(pm.apply.scroll)!==!1)return}var selAfter=(0,_selection.findSelectionFrom)(pm.doc,cut,1);return pm.tr.lift(selAfter.from,selAfter.to).apply(pm.apply.scroll)}}function moveForward(parent,offset,by){"char"!=by&&"word"!=by&&_error.AssertionError.raise("Unknown motion unit: "+by);for(var cat=null,counted=0;;){if(offset==parent.size)return offset;var _parent$chunkAfter=parent.chunkAfter(offset),start=_parent$chunkAfter.start,node=_parent$chunkAfter.node;if(!node.isText)return cat?offset:offset+1;if("char"==by)for(var i=offset-start;i<node.text.length;i++){if(!(0,_char.isExtendingChar)(node.text.charAt(i+1)))return offset+1;offset++}else if("word"==by)for(var i=offset-start;i<node.text.length;i++){var nextCharCat=(0,_char.charCategory)(node.text.charAt(i));if(null==cat||1==counted&&"space"==cat)cat=nextCharCat;else if(cat!=nextCharCat)return offset;offset++,counted++}}}function joinPointAbove(pm){var _pm$selection7=pm.selection,node=_pm$selection7.node,from=_pm$selection7.from;return node?(0,_transform.joinableBlocks)(pm.doc,from)?from:null:(0,_transform.joinPoint)(pm.doc,from,-1)}function joinPointBelow(pm){var _pm$selection8=pm.selection,node=_pm$selection8.node,to=_pm$selection8.to;return node?(0,_transform.joinableBlocks)(pm.doc,to)?to:null:(0,_transform.joinPoint)(pm.doc,to,1)}function nodeAboveSelection(pm){var sel=pm.selection,i=0;if(sel.node)return!!sel.from.depth&&sel.from.shorten();for(;i<sel.head.depth&&i<sel.anchor.depth&&sel.head.path[i]==sel.anchor.path[i];i++);return 0==i?!1:sel.head.shorten(i-1)}function moveSelectionBlock(pm,dir){var _pm$selection15=pm.selection,from=_pm$selection15.from,to=_pm$selection15.to,node=_pm$selection15.node,side=dir>0?to:from;return(0,_selection.findSelectionFrom)(pm.doc,node&&node.isBlock?side:side.shorten(null,dir>0?1:0),dir)}function selectNodeHorizontally(pm,dir){var _pm$selection16=pm.selection,empty=_pm$selection16.empty,node=_pm$selection16.node,from=_pm$selection16.from,to=_pm$selection16.to;if(!empty&&!node)return!1;if(node&&node.isInline)return pm.setTextSelection(dir>0?to:from),!0;var parent=void 0;if(!node&&(parent=pm.doc.path(from.path))&&(dir>0?from.offset<parent.size:from.offset)){var _ref=dir>0?parent.chunkAfter(from.offset):parent.chunkBefore(from.offset),nextNode=_ref.node,start=_ref.start;return nextNode.type.selectable&&start==from.offset-(dir>0?0:1)?(pm.setNodeSelection(0>dir?from.move(-1):from),!0):!1}var next=moveSelectionBlock(pm,dir);return next&&(next instanceof _selection.NodeSelection||node)?(pm.setSelectionDirect(next),!0):!1}function selectNodeVertically(pm,dir){var _pm$selection17=pm.selection,empty=_pm$selection17.empty,node=_pm$selection17.node,from=_pm$selection17.from,to=_pm$selection17.to;if(!empty&&!node)return!1;var leavingTextblock=!0;if((!node||node.isInline)&&(leavingTextblock=(0,_selection.verticalMotionLeavesTextblock)(pm,dir>0?to:from,dir)),leavingTextblock){var next=moveSelectionBlock(pm,dir);if(next&&next instanceof _selection.NodeSelection)return pm.setSelectionDirect(next),node||(pm.sel.lastNonNodePos=from),!0}if(!node)return!1;if(node.isInline)return(0,_dompos.setDOMSelectionToPos)(pm,from),!1;var last=pm.sel.lastNonNodePos,beyond=(0,_selection.findSelectionFrom)(pm.doc,0>dir?from:to,dir);return last&&beyond&&_model.Pos.samePath(last.path,beyond.from.path)?((0,_dompos.setDOMSelectionToPos)(pm,last),!1):(pm.setSelectionDirect(beyond),!0)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.baseCommands=void 0;var _model=require("../model"),_transform=require("../transform"),_error=require("../util/error"),_char=require("./char"),_selection=require("./selection"),_dompos=require("./dompos"),baseCommands=exports.baseCommands=Object.create(null);baseCommands.deleteSelection={label:"Delete the selection",run:function(pm){return pm.tr.replaceSelection().apply(pm.apply.scroll)},keys:{all:["Backspace(10)","Delete(10)","Mod-Backspace(10)","Mod-Delete(10)"],mac:["Ctrl-H(10)","Alt-Backspace(10)","Ctrl-D(10)","Ctrl-Alt-Backspace(10)","Alt-Delete(10)","Alt-D(10)"]}},baseCommands.joinBackward={label:"Join with the block above",run:function(pm){var _pm$selection=pm.selection,head=_pm$selection.head,empty=_pm$selection.empty;if(!empty||head.offset>0)return!1;for(var before=void 0,cut=void 0,i=head.path.length-1;!before&&i>=0;i--)head.path[i]>0&&(cut=head.shorten(i),before=pm.doc.path(cut.path).child(cut.offset-1));return before?null==before.type.contains?pm.tr["delete"](cut.move(-1),cut).apply(pm.apply.scroll):deleteBarrier(pm,cut):pm.tr.lift(head).apply(pm.apply.scroll)},keys:["Backspace(30)","Mod-Backspace(30)"]},baseCommands.deleteCharBefore={label:"Delete a character before the cursor",run:function(pm){var _pm$selection2=pm.selection,head=_pm$selection2.head,empty=_pm$selection2.empty;if(!empty||0==head.offset)return!1;var from=moveBackward(pm.doc.path(head.path),head.offset,"char");return pm.tr["delete"](new _model.Pos(head.path,from),head).apply(pm.apply.scroll)},keys:{all:["Backspace(60)"],mac:["Ctrl-H(40)"]}},baseCommands.deleteWordBefore={label:"Delete the word before the cursor",run:function(pm){var _pm$selection3=pm.selection,head=_pm$selection3.head,empty=_pm$selection3.empty;if(!empty||0==head.offset)return!1;var from=moveBackward(pm.doc.path(head.path),head.offset,"word");return pm.tr["delete"](new _model.Pos(head.path,from),head).apply(pm.apply.scroll)},keys:{all:["Mod-Backspace(40)"],mac:["Alt-Backspace(40)"]}},baseCommands.joinForward={label:"Join with the block below",run:function(pm){var _pm$selection4=pm.selection,head=_pm$selection4.head,empty=_pm$selection4.empty;if(!empty||head.offset<pm.doc.path(head.path).size)return!1;for(var after=void 0,cut=void 0,i=head.path.length-1;!after&&i>=0;i--){cut=head.shorten(i,1);var parent=pm.doc.path(cut.path);cut.offset<parent.size&&(after=parent.child(cut.offset))}return after?null==after.type.contains?pm.tr["delete"](cut,cut.move(1)).apply(pm.apply.scroll):deleteBarrier(pm,cut):!1},keys:["Delete(30)","Mod-Delete(30)"]},baseCommands.deleteCharAfter={label:"Delete a character after the cursor",run:function(pm){var _pm$selection5=pm.selection,head=_pm$selection5.head,empty=_pm$selection5.empty;if(!empty||head.offset==pm.doc.path(head.path).size)return!1;var to=moveForward(pm.doc.path(head.path),head.offset,"char");return pm.tr["delete"](head,new _model.Pos(head.path,to)).apply(pm.apply.scroll)},keys:{all:["Delete(60)"],mac:["Ctrl-D(60)"]}},baseCommands.deleteWordAfter={label:"Delete a word after the cursor",run:function(pm){var _pm$selection6=pm.selection,head=_pm$selection6.head,empty=_pm$selection6.empty;if(!empty||head.offset==pm.doc.path(head.path).size)return!1;var to=moveForward(pm.doc.path(head.path),head.offset,"word");return pm.tr["delete"](head,new _model.Pos(head.path,to)).apply(pm.apply.scroll)},keys:{all:["Mod-Delete(40)"],mac:["Ctrl-Alt-Backspace(40)","Alt-Delete(40)","Alt-D(40)"]}},baseCommands.joinUp={label:"Join with above block",run:function(pm){var point=joinPointAbove(pm),isNode=pm.selection.node;return point?(pm.tr.join(point).apply(),void(isNode&&pm.setNodeSelection(point.move(-1)))):!1},select:function(pm){return joinPointAbove(pm)},menu:{group:"block",rank:80,display:{type:"icon",width:800,height:900,path:"M0 75h800v125h-800z M0 825h800v-125h-800z M250 400h100v-100h100v100h100v100h-100v100h-100v-100h-100z"}},keys:["Alt-Up"]},baseCommands.joinDown={label:"Join with below block",run:function(pm){var node=pm.selection.node,point=joinPointBelow(pm);return point?(pm.tr.join(point).apply(),void(node&&pm.setNodeSelection(point.move(-1)))):!1},select:function(pm){return joinPointBelow(pm)},keys:["Alt-Down"]},baseCommands.lift={label:"Lift out of enclosing block",run:function(pm){var _pm$selection9=pm.selection,from=_pm$selection9.from,to=_pm$selection9.to;return pm.tr.lift(from,to).apply(pm.apply.scroll)},select:function(pm){var _pm$selection10=pm.selection,from=_pm$selection10.from,to=_pm$selection10.to;return(0,_transform.canLift)(pm.doc,from,to)},menu:{group:"block",rank:75,display:{type:"icon",width:1024,height:1024,path:"M219 310v329q0 7-5 12t-12 5q-8 0-13-5l-164-164q-5-5-5-13t5-13l164-164q5-5 13-5 7 0 12 5t5 12zM1024 749v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12zM1024 530v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 310v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 91v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12z"}},keys:["Alt-Left"]},baseCommands.newlineInCode={label:"Insert newline",run:function(pm){var _pm$selection11=pm.selection,from=_pm$selection11.from,to=_pm$selection11.to,node=_pm$selection11.node,block=void 0;return!node&&_model.Pos.samePath(from.path,to.path)&&(block=pm.doc.path(from.path)).type.isCode&&to.offset<block.size?pm.tr.typeText("\n").apply(pm.apply.scroll):!1},keys:["Enter(10)"]},baseCommands.createParagraphNear={label:"Create a paragraph near the selected leaf block",run:function(pm){var _pm$selection12=pm.selection,from=_pm$selection12.from,to=_pm$selection12.to,node=_pm$selection12.node;if(!node||!node.isBlock||node.type.contains)return!1;var side=from.offset?to:from;pm.tr.insert(side,pm.schema.defaultTextblockType().create()).apply(pm.apply.scroll),pm.setTextSelection(new _model.Pos(side.toPath(),0))},keys:["Enter(20)"]},baseCommands.liftEmptyBlock={label:"Move current block up",run:function(pm){var _pm$selection13=pm.selection,head=_pm$selection13.head,empty=_pm$selection13.empty;if(!empty||head.offset>0||pm.doc.path(head.path).size)return!1;if(head.depth>1){var shorter=head.shorten();if(shorter.offset>0&&shorter.offset<pm.doc.path(shorter.path).size-1&&pm.tr.split(shorter).apply()!==!1)return}return pm.tr.lift(head).apply(pm.apply.scroll)},keys:["Enter(30)"]},baseCommands.splitBlock={label:"Split the current block",run:function(pm){var _pm$selection14=pm.selection,from=_pm$selection14.from,to=_pm$selection14.to,node=_pm$selection14.node,block=pm.doc.path(to.path);if(node&&node.isBlock)return from.offset?pm.tr.split(from).apply(pm.apply.scroll):!1;var deflt=pm.schema.defaultTextblockType(),type=to.offset==block.size?deflt:null,tr=pm.tr["delete"](from,to).split(from,1,type);return to.offset<block.size&&!from.offset&&pm.doc.path(from.path).type!=deflt&&tr.setNodeType(from.shorten(),deflt),tr.apply(pm.apply.scroll)},keys:["Enter(60)"]},baseCommands.selectParentNode={label:"Select parent node",run:function(pm){var node=nodeAboveSelection(pm);return node?void pm.setNodeSelection(node):!1},select:function(pm){return nodeAboveSelection(pm)},menu:{group:"block",rank:90,display:{type:"icon",text:"⬚",style:"font-weight: bold; vertical-align: 20%"}},keys:["Esc"]},baseCommands.selectNodeLeft={label:"Move the selection onto or out of the block to the left",run:function(pm){var done=selectNodeHorizontally(pm,-1);return done&&pm.scrollIntoView(),done},keys:["Left","Mod-Left"]},baseCommands.selectNodeRight={label:"Move the selection onto or out of the block to the right",run:function(pm){var done=selectNodeHorizontally(pm,1);return done&&pm.scrollIntoView(),done},keys:["Right","Mod-Right"]},baseCommands.selectNodeUp={label:"Move the selection onto or out of the block above",run:function(pm){var done=selectNodeVertically(pm,-1);return done!==!1&&pm.scrollIntoView(),done},keys:["Up"]},baseCommands.selectNodeDown={label:"Move the selection onto or out of the block below",run:function(pm){var done=selectNodeVertically(pm,1);return done!==!1&&pm.scrollIntoView(),done},keys:["Down"]},baseCommands.undo={label:"Undo last change",run:function(pm){return pm.scrollIntoView(),pm.history.undo()},select:function(pm){return pm.history.undoDepth>0},menu:{group:"history",rank:10,display:{type:"icon",width:1024,height:1024,path:"M761 1024c113-206 132-520-313-509v253l-384-384 384-384v248c534-13 594 472 313 775z"}},keys:["Mod-Z"]},baseCommands.redo={label:"Redo last undone change",run:function(pm){return pm.scrollIntoView(),pm.history.redo()},select:function(pm){return pm.history.redoDepth>0},menu:{group:"history",rank:20,display:{type:"icon",width:1024,height:1024,path:"M576 248v-248l384 384-384 384v-253c-446-10-427 303-313 509-280-303-221-789 313-775z"}},keys:["Mod-Y","Shift-Mod-Z"]}},{"../model":34,"../transform":40,"../util/error":52,"./char":4,"./dompos":8,"./selection":17}],3:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function nothing(){}function ensureSelection(pm){if(pm.selection.node){var found=(0,_selection.findSelectionNear)(pm.doc,pm.selection.from,1,!0);found&&(0,_dompos.setDOMSelectionToPos)(pm,found.head)}return!1}Object.defineProperty(exports,"__esModule",{value:!0}),exports.captureKeys=void 0;var _browserkeymap=require("browserkeymap"),_browserkeymap2=_interopRequireDefault(_browserkeymap),_selection=require("./selection"),_dompos=require("./dompos"),_dom=require("../dom"),keys={Esc:nothing,Enter:nothing,"Mod-Enter":nothing,"Shift-Enter":nothing,Backspace:nothing,Delete:nothing,"Mod-B":nothing,"Mod-I":nothing,"Mod-Backspace":nothing,"Mod-Delete":nothing,"Shift-Backspace":nothing,"Shift-Delete":nothing,"Shift-Mod-Backspace":nothing,"Shift-Mod-Delete":nothing,"Mod-Z":nothing,"Mod-Y":nothing,"Shift-Mod-Z":nothing,"Ctrl-D":nothing,"Ctrl-H":nothing,"Ctrl-Alt-Backspace":nothing,"Alt-D":nothing,"Alt-Delete":nothing,"Alt-Backspace":nothing,"Mod-A":ensureSelection};["Left","Right","Up","Down","Home","End","PageUp","PageDown"].forEach(function(key){keys[key]=keys["Shift-"+key]=keys["Mod-"+key]=keys["Shift-Mod-"+key]=keys["Alt-"+key]=keys["Shift-Alt-"+key]=ensureSelection}),["Left","Mod-Left","Right","Mod-Right","Up","Down"].forEach(function(key){return delete keys[key]}),_dom.browser.mac&&(keys["Ctrl-F"]=keys["Ctrl-B"]=keys["Ctrl-P"]=keys["Ctrl-N"]=keys["Alt-F"]=keys["Alt-B"]=keys["Ctrl-A"]=keys["Ctrl-E"]=keys["Ctrl-V"]=keys.goPageUp=ensureSelection);exports.captureKeys=new _browserkeymap2["default"](keys)},{"../dom":1,"./dompos":8,"./selection":17,browserkeymap:57}],4:[function(require,module,exports){"use strict";function isWordChar(ch){return/\w/.test(ch)||isExtendingChar(ch)||ch>""&&(ch.toUpperCase()!=ch.toLowerCase()||nonASCIISingleCaseWordChar.test(ch))}function charCategory(ch){return/\s/.test(ch)?"space":isWordChar(ch)?"word":"other"}function isExtendingChar(ch){return ch.charCodeAt(0)>=768&&extendingChar.test(ch)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isWordChar=isWordChar,exports.charCategory=charCategory,exports.isExtendingChar=isExtendingChar;var nonASCIISingleCaseWordChar=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,extendingChar=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/},{}],5:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function deriveCommandSpec(type,spec,name){if(!spec.derive)return spec;var conf="object"==_typeof(spec.derive)?spec.derive:{},dname=conf.name||name,derive=type.constructor.deriveableCommands[dname];derive||_error.AssertionError.raise("Don't know how to derive command "+dname);var derived=derive.call(type,conf);for(var prop in spec)"derive"!=prop&&(derived[prop]=spec[prop]);return derived}function deriveKeymap(pm){function add(command,keys){for(var i=0;i<keys.length;i++){var _$exec=/^(.+?)(?:\((\d+)\))?$/.exec(keys[i]),_$exec2=_slicedToArray(_$exec,3),name=(_$exec2[0],_$exec2[1]),_$exec2$=_$exec2[2],rank=void 0===_$exec2$?50:_$exec2$;(0,_sortedinsert2["default"])(bindings[name]||(bindings[name]=[]),{command:command,rank:rank},function(a,b){return a.rank-b.rank})}}var bindings={},platform=_dom.browser.mac?"mac":"pc";for(var name in pm.commands){var cmd=pm.commands[name],keys=cmd.spec.keys;keys&&(Array.isArray(keys)&&add(cmd,keys),keys.all&&add(cmd,keys.all),keys[platform]&&add(cmd,keys[platform]))}for(var key in bindings)bindings[key]=bindings[key].map(function(b){return b.command.name});return new _browserkeymap2["default"](bindings)}function updateCommands(pm,set){pm.signal("commandsChanging"),pm.commands=set.derive(pm.schema),pm.input.baseKeymap=deriveKeymap(pm),pm.commandKeys=Object.create(null),pm.signal("commandsChanged")}function markActive(pm,type){var sel=pm.selection;return sel.empty?type.isInSet(pm.activeMarks()):pm.doc.rangeHasMark(sel.from,sel.to,type)}function canAddInline(pm,type){var _pm$selection=pm.selection,from=_pm$selection.from,to=_pm$selection.to,empty=_pm$selection.empty;if(empty)return!type.isInSet(pm.activeMarks())&&pm.doc.path(from.path).type.canContainMark(type);var can=!1;return pm.doc.nodesBetween(from,to,function(node){return can||node.isTextblock&&!node.type.canContainMark(type)?!1:void(node.isInline&&!type.isInSet(node.marks)&&(can=!0))}),can}function markApplies(pm,type){var _pm$selection2=pm.selection,from=_pm$selection2.from,to=_pm$selection2.to,relevant=!1;return pm.doc.nodesBetween(from,to,function(node){return node.isTextblock?(node.type.canContainMark(type)&&(relevant=!0),!1):void 0}),relevant}function selectedMarkAttr(pm,type,attr){var _pm$selection3=pm.selection,from=_pm$selection3.from,to=_pm$selection3.to,empty=_pm$selection3.empty,start=void 0,end=void 0;if(empty)start=end=type.isInSet(pm.activeMarks());else{var startParent=pm.doc.path(from.path),startChunk=startParent.size>from.offset&&startParent.chunkAfter(from.offset);start=startChunk?type.isInSet(startChunk.node.marks):null,end=type.isInSet(pm.doc.marksAt(to))}return start&&end&&start.attrs[attr]==end.attrs[attr]?start.attrs[attr]:void 0}function selectedNodeAttr(pm,type,name){var node=pm.selection.node;return node&&node.type==type?node.attrs[name]:void 0}function deriveParams(type,params){return params&&params.map(function(param){var attr=type.attrs[param.attr],obj={type:"text","default":attr["default"],prefill:type instanceof _model.NodeType?function(pm){return selectedNodeAttr(pm,this,param.attr)}:function(pm){return selectedMarkAttr(pm,this,param.attr)}};for(var prop in param)obj[prop]=param[prop];return obj})}function fillAttrs(conf,givenParams){var attrs=conf.attrs;return conf.params&&!function(){var filled=Object.create(null);if(attrs)for(var name in attrs)filled[name]=attrs[name];conf.params.forEach(function(param,i){return filled[param.attr]=givenParams[i]}),attrs=filled}(),attrs}function isAtTopOfListItem(doc,from,to,listType){return _model.Pos.samePath(from.path,to.path)&&from.path.length>=2&&0==from.path[from.path.length-1]&&listType.canContain(doc.path(from.path.slice(0,from.path.length-1)))}function alreadyHasBlockType(doc,from,to,type,attrs){var found=!1;return attrs||(attrs={}),doc.nodesBetween(from,to||from,function(node){return node.isTextblock?(node.hasMarkup(type,attrs)&&(found=!0),!1):void 0}),found}function activeTextblockIs(pm,type,attrs){var _pm$selection6=pm.selection,from=_pm$selection6.from,to=_pm$selection6.to,node=_pm$selection6.node;if(!node||node.isInline){if(!_model.Pos.samePath(from.path,to.path))return!1;node=pm.doc.path(from.path)}else if(!node.isTextblock)return!1;return node.hasMarkup(type,attrs)}var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i["return"]&&_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.CommandSet=exports.Command=void 0,exports.updateCommands=updateCommands,exports.selectedNodeAttr=selectedNodeAttr;var _browserkeymap=require("browserkeymap"),_browserkeymap2=_interopRequireDefault(_browserkeymap),_model=require("../model"),_transform=require("../transform"),_dom=require("../dom"),_sortedinsert=require("../util/sortedinsert"),_sortedinsert2=_interopRequireDefault(_sortedinsert),_error=require("../util/error"),_obj=require("../util/obj"),_base_commands=require("./base_commands"),Command=exports.Command=function(){function Command(spec,self,name){_classCallCheck(this,Command),this.name=name,this.name||_error.NamespaceError.raise("Trying to define a command without a name"),this.spec=spec,this.self=self}return _createClass(Command,[{key:"exec",value:function(pm,params){var run=this.spec.run;return params?(this.params.length!=(params?params.length:0)&&_error.AssertionError.raise("Invalid amount of parameters for command "+this.name),run.call.apply(run,[this.self,pm].concat(_toConsumableArray(params)))):this.params.length?new pm.options.commandParamPrompt(pm,this).open():run.call(this.self,pm)}},{key:"select",value:function(pm){var f=this.spec.select;return f?f.call(this.self,pm):!0}},{key:"active",value:function(pm){var f=this.spec.active;return f?f.call(this.self,pm):!1}},{key:"params",get:function(){return this.spec.params||empty}},{key:"label",get:function(){return this.spec.label||this.name}}]),Command}(),empty=[],CommandSet=function(){function CommandSet(base,op){_classCallCheck(this,CommandSet),this.base=base,this.op=op}return _createClass(CommandSet,[{key:"add",value:function(set,filter){return new CommandSet(this,function(commands,schema){function add(name,spec,self){(!filter||filter(name,spec))&&(commands[name]&&_error.AssertionError.raise("Duplicate definition of command "+name),commands[name]=new Command(spec,self,name))}if("schema"===set)schema.registry("command",function(name,spec,type,typeName){add(typeName+":"+name,deriveCommandSpec(type,spec,name),type)});else for(var name in set)add(name,set[name])})}},{key:"update",value:function(_update){return new CommandSet(this,function(commands){for(var name in _update){var spec=_update[name];if(spec)if(spec.run)commands[name]=new Command(spec,null,name);else{var known=commands[name];known&&(commands[name]=new Command((0,_obj.copyObj)(spec,(0,_obj.copyObj)(known.spec)),known.self,name))}else delete commands[name]}})}},{key:"derive",value:function(schema){var commands=this.base?this.base.derive(schema):Object.create(null);return this.op(commands,schema),commands}}]),CommandSet}();exports.CommandSet=CommandSet,CommandSet.empty=new CommandSet(null,function(){return null}),CommandSet["default"]=CommandSet.empty.add("schema").add(_base_commands.baseCommands),_model.NodeType.deriveableCommands=Object.create(null),_model.MarkType.deriveableCommands=Object.create(null),_model.MarkType.deriveableCommands.set=function(conf){return{run:function(pm){for(var _len=arguments.length,params=Array(_len>1?_len-1:0),_key=1;_len>_key;_key++)params[_key-1]=arguments[_key];pm.setMark(this,!0,fillAttrs(conf,params))},select:function(pm){return conf.inverseSelect?markApplies(pm,this)&&!markActive(pm,this):canAddInline(pm,this)},params:deriveParams(this,conf.params)}},_model.MarkType.deriveableCommands.unset=function(){return{run:function(pm){pm.setMark(this,!1)},select:function(pm){return markActive(pm,this)}}},_model.MarkType.deriveableCommands.toggle=function(){return{run:function(pm){pm.setMark(this,null)},active:function(pm){return markActive(pm,this)},select:function(pm){return markApplies(pm,this)}}},_model.NodeType.deriveableCommands.wrap=function(conf){return{run:function(pm){var _pm$selection4=pm.selection,from=_pm$selection4.from,to=_pm$selection4.to,head=_pm$selection4.head,doJoin=!1;if(conf.list&&head&&isAtTopOfListItem(pm.doc,from,to,this)){if(0==from.path[from.path.length-2])return!1;doJoin=!0}for(var _len2=arguments.length,params=Array(_len2>1?_len2-1:0),_key2=1;_len2>_key2;_key2++)params[_key2-1]=arguments[_key2];var tr=pm.tr.wrap(from,to,this,fillAttrs(conf,params));return doJoin&&tr.join(from.shorten(from.depth-2)),tr.apply(pm.apply.scroll)},select:function(pm){var _pm$selection5=pm.selection,from=_pm$selection5.from,to=_pm$selection5.to,head=_pm$selection5.head;return conf.list&&head&&isAtTopOfListItem(pm.doc,from,to,this)&&0==from.path[from.path.length-2]?!1:(0,_transform.canWrap)(pm.doc,from,to,this,conf.attrs)},params:deriveParams(this,conf.params)}},_model.NodeType.deriveableCommands.make=function(conf){return{run:function(pm){var _pm$selection7=pm.selection,from=_pm$selection7.from,to=_pm$selection7.to;return pm.tr.setBlockType(from,to,this,conf.attrs).apply(pm.apply.scroll)},select:function(pm){var _pm$selection8=pm.selection,from=_pm$selection8.from,to=_pm$selection8.to,node=_pm$selection8.node;return node?node.isTextblock&&!node.hasMarkup(this,conf.attrs):!alreadyHasBlockType(pm.doc,from,to,this,conf.attrs)},active:function(pm){return activeTextblockIs(pm,this,conf.attrs)}}},_model.NodeType.deriveableCommands.insert=function(conf){return{run:function(pm){for(var _len3=arguments.length,params=Array(_len3>1?_len3-1:0),_key3=1;_len3>_key3;_key3++)params[_key3-1]=arguments[_key3];return pm.tr.replaceSelection(this.create(fillAttrs(conf,params))).apply(pm.apply.scroll)},select:this.isInline?function(pm){return pm.doc.path(pm.selection.from.path).type.canContainType(this)}:null,params:deriveParams(this,conf.params)}}},{"../dom":1,"../model":34,"../transform":40,"../util/error":52,"../util/obj":55,"../util/sortedinsert":56,"./base_commands":2,browserkeymap:57}],6:[function(require,module,exports){"use strict";var _dom=require("../dom");(0,_dom.insertCSS)('\n\n.ProseMirror {\n  border: 1px solid silver;\n  position: relative;\n}\n\n.ProseMirror-content {\n  padding: 4px 8px 4px 14px;\n  white-space: pre-wrap;\n  line-height: 1.2;\n}\n\n.ProseMirror-drop-target {\n  position: absolute;\n  width: 1px;\n  background: #666;\n  display: none;\n}\n\n.ProseMirror-content ul.tight p, .ProseMirror-content ol.tight p {\n  margin: 0;\n}\n\n.ProseMirror-content ul, .ProseMirror-content ol {\n  padding-left: 30px;\n  cursor: default;\n}\n\n.ProseMirror-content blockquote {\n  padding-left: 1em;\n  border-left: 3px solid #eee;\n  margin-left: 0; margin-right: 0;\n}\n\n.ProseMirror-content pre {\n  white-space: pre-wrap;\n}\n\n.ProseMirror-selectednode {\n  outline: 2px solid #8cf;\n}\n\n.ProseMirror-nodeselection *::selection {\n  background: transparent;\n}\n\n.ProseMirror-content p:first-child,\n.ProseMirror-content h1:first-child,\n.ProseMirror-content h2:first-child,\n.ProseMirror-content h3:first-child,\n.ProseMirror-content h4:first-child,\n.ProseMirror-content h5:first-child,\n.ProseMirror-content h6:first-child {\n  margin-top: .3em;\n}\n\n/* Add space around the hr to make clicking it easier */\n\n.ProseMirror-content hr {\n  position: relative;\n  height: 6px;\n  border: none;\n}\n\n.ProseMirror-content hr:after {\n  content: "";\n  position: absolute;\n  left: 10px;\n  right: 10px;\n  top: 2px;\n  border-top: 2px solid silver;\n}\n\n.ProseMirror-content img {\n  cursor: default;\n}\n\n/* Make sure li selections wrap around markers */\n\n.ProseMirror-content li {\n  position: relative;\n  pointer-events: none; /* Don\'t do weird stuff with marker clicks */\n}\n.ProseMirror-content li > * {\n  pointer-events: auto;\n}\n\nli.ProseMirror-selectednode {\n  outline: none;\n}\n\nli.ProseMirror-selectednode:after {\n  content: "";\n  position: absolute;\n  left: -32px;\n  right: -2px; top: -2px; bottom: -2px;\n  border: 2px solid #8cf;\n  pointer-events: none;\n}\n\n');
},{"../dom":1}],7:[function(require,module,exports){"use strict";function isAtEnd(node,pos,depth){for(var i=depth||0;i<pos.path.length;i++){var n=pos.path[depth];if(n<node.size-1)return!1;node=node.child(n)}return pos.offset==node.size}function isAtStart(pos,depth){if(pos.offset>0)return!1;for(var i=depth||0;i<pos.path.length;i++)if(pos.path[depth]>0)return!1;return!0}function parseNearSelection(pm){for(var dom=pm.content,node=pm.doc,_pm$selection=pm.selection,from=_pm$selection.from,to=_pm$selection.to,depth=0;;depth++){var toNode=node.child(to.path[depth]),fromStart=isAtStart(from,depth+1),toEnd=isAtEnd(toNode,to,depth+1);if(fromStart||toEnd||from.path[depth]!=to.path[depth]||toNode.isTextblock){var startOffset=depth==from.depth?from.offset:from.path[depth];fromStart&&startOffset>0&&startOffset--;var endOffset=depth==to.depth?to.offset:to.path[depth]+1;toEnd&&endOffset<node.size-1&&endOffset++;var parsed=(0,_format.fromDOM)(pm.schema,dom,{topNode:node.copy(),from:startOffset,to:dom.childNodes.length-(node.size-endOffset),preserveWhitespace:!0});parsed=parsed.copy(node.content.slice(0,startOffset).append(parsed.content).append(node.content.slice(endOffset)));for(var i=depth-1;i>=0;i--){var wrap=pm.doc.path(from.path.slice(0,i));parsed=wrap.replace(from.path[i],parsed)}return parsed}node=toNode,dom=(0,_dompos.findByPath)(dom,from.path[depth],!1)}}function applyDOMChange(pm){var updated=parseNearSelection(pm),changeStart=(0,_model.findDiffStart)(pm.doc.content,updated.content);if(changeStart){var changeEnd=findDiffEndConstrained(pm.doc.content,updated.content,changeStart);return markDirtyFor(pm,changeStart,changeEnd),pm.tr.replace(changeStart,changeEnd.a,updated,changeStart,changeEnd.b).apply(),!0}return!1}function offsetBy(first,second,pos){var same=(0,_tree.samePathDepth)(first,second),firstEnd=same==first.depth,secondEnd=same==second.depth,off=(secondEnd?second.offset:second.path[same])-(firstEnd?first.offset:first.path[same]),shorter=firstEnd?pos.move(off):pos.shorten(same,off);return secondEnd?shorter:shorter.extend(new _model.Pos(second.path.slice(same),second.offset))}function findDiffEndConstrained(a,b,start){var end=(0,_model.findDiffEnd)(a,b);return end?end.a.cmp(start)<0?{a:start,b:offsetBy(end.a,start,end.b)}:end.b.cmp(start)<0?{a:offsetBy(end.b,start,end.a),b:start}:end:end}function sameDepth(a,b){for(var max=Math.min(a.depth,b.depth),i=0;max>i;i++)if(a.path[i]!=b.path[i])return i;return max}function markDirtyFor(pm,start,end){var depth=Math.min(sameDepth(start,end.a),sameDepth(start,end.b));if(0==depth)pm.markAllDirty();else{var pos=_model.Pos.from(start.path.slice(0,depth));pm.markRangeDirty({from:pos,to:pos.move(1)})}}function textContext(data){var range=window.getSelection().getRangeAt(0),start=range.startContainer,end=range.endContainer;if(start==end&&3==start.nodeType){var value=start.nodeValue,lead=range.startOffset,_end=range.endOffset;return data&&_end>=data.length&&value.slice(_end-data.length,_end)==data&&(lead=_end-data.length),{inside:start,lead:lead,trail:value.length-_end}}for(var sizeBefore=null,sizeAfter=null,before=start.childNodes[range.startOffset-1]||nodeBefore(start);before.lastChild;)before=before.lastChild;if(before&&3==before.nodeType){var value=before.nodeValue;sizeBefore=value.length,data&&value.slice(value.length-data.length)==data&&(sizeBefore-=data.length)}for(var after=end.childNodes[range.endOffset]||nodeAfter(end);after.firstChild;)after=after.firstChild;return after&&3==after.nodeType&&(sizeAfter=after.nodeValue.length),{before:before,sizeBefore:sizeBefore,after:after,sizeAfter:sizeAfter}}function textInContext(context,deflt){if(context.inside){var _val=context.inside.nodeValue;return _val.slice(context.lead,_val.length-context.trail)}var before=context.before,after=context.after,val="";if(!before)return deflt;3==before.nodeType&&(val=before.nodeValue.slice(context.sizeBefore));var scan=scanText(before,after);if(null==scan)return deflt;if(val+=scan,after&&3==after.nodeType){var valAfter=after.nodeValue;val+=valAfter.slice(0,valAfter.length-context.sizeAfter)}return val}function nodeAfter(node){for(;;){var next=node.nextSibling;if(next){for(;next.firstChild;)next=next.firstChild;return next}if(!(node=node.parentElement))return null}}function nodeBefore(node){for(;;){var prev=node.previousSibling;if(prev){for(;prev.lastChild;)prev=prev.lastChild;return prev}if(!(node=node.parentElement))return null}}function scanText(start,end){for(var text="",cur=nodeAfter(start);;){if(cur==end)return text;if(!cur)return null;3==cur.nodeType&&(text+=cur.nodeValue),cur=cur.firstChild||nodeAfter(cur)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.applyDOMChange=applyDOMChange,exports.textContext=textContext,exports.textInContext=textInContext;var _model=require("../model"),_format=require("../format"),_tree=require("../transform/tree"),_dompos=require("./dompos")},{"../format":20,"../model":34,"../transform/tree":48,"./dompos":8}],8:[function(require,module,exports){"use strict";function pathFromDOM(pm,node){for(var path=[];node!=pm.content;){var attr=node.getAttribute("pm-offset");attr&&path.unshift(+attr),node=node.parentNode}return path}function widthFromDOM(dom){var attr=dom.getAttribute("pm-leaf");return attr&&"true"!=attr?+attr:1}function posFromDOM(pm,dom,domOffset,loose){!loose&&pm.operation&&pm.doc!=pm.operation.doc&&_error.AssertionError.raise("Fetching a position from an outdated DOM structure"),null==domOffset&&(domOffset=Array.prototype.indexOf.call(dom.parentNode.childNodes,dom),dom=dom.parentNode);for(var extraOffset=0,tag=void 0;;){var adjust=0;if(3==dom.nodeType)extraOffset+=domOffset;else{if(dom.hasAttribute("pm-container"))break;(tag=dom.getAttribute("pm-inner-offset"))?(extraOffset+=+tag,adjust=-1):domOffset&&domOffset==dom.childNodes.length&&(adjust=1)}var parent=dom.parentNode;domOffset=0>adjust?0:Array.prototype.indexOf.call(parent.childNodes,dom)+adjust,dom=parent}var path=pathFromDOM(pm,dom);if(dom.hasAttribute("pm-leaf"))return _model.Pos.from(path,extraOffset+(domOffset?1:0));for(var offset=0,i=domOffset-1;i>=0;i--){var child=dom.childNodes[i];if(3==child.nodeType)loose&&(extraOffset+=child.nodeValue.length);else{if(tag=child.getAttribute("pm-offset")){offset=+tag+widthFromDOM(child);break}loose&&!child.hasAttribute("pm-ignore")&&(extraOffset+=child.textContent.length)}}return new _model.Pos(path,offset+extraOffset)}function findByPath(node,n,fromEnd){for(var container=childContainer(node),ch=fromEnd?container.lastChild:container.firstChild;ch;ch=fromEnd?ch.previousSibling:ch.nextSibling)if(1==ch.nodeType){var offset=ch.getAttribute("pm-offset");if(offset&&+offset==n)return ch}}function pathToDOM(parent,path){for(var node=parent,i=0;i<path.length;i++)node=findByPath(node,path[i]),node||_error.AssertionError.raise("Failed to resolve path "+path.join("/"));return node}function childContainer(dom){return dom.hasAttribute("pm-container")?dom:dom.querySelector("[pm-container]")}function findByOffset(node,offset,after){for(var attr,ch=node.firstChild,i=0;ch;ch=ch.nextSibling,i++)if(1==ch.nodeType&&(attr=ch.getAttribute("pm-offset"))){var diff=offset-+attr,width=widthFromDOM(ch);if(diff>=0&&(after?width>=diff:width>diff))return{node:ch,offset:i,innerOffset:diff}}}function leafAt(node,offset){for(;;){var child=node.firstChild;if(!child)return{node:node,offset:offset};if(1!=child.nodeType)return{node:child,offset:offset};if(child.hasAttribute("pm-inner-offset")){for(var nodeOffset=0;;){var nextSib=child.nextSibling,nextOffset=void 0;if(!nextSib||(nextOffset=+nextSib.getAttribute("pm-inner-offset"))>=offset)break;child=nextSib,nodeOffset=nextOffset}offset-=nodeOffset}node=child}}function DOMFromPos(parent,pos){var dom=childContainer(pathToDOM(parent,pos.path)),found=findByOffset(dom,pos.offset,!0),inner=void 0;return found?"true"!=found.node.getAttribute("pm-leaf")&&(inner=leafAt(found.node,found.innerOffset))?inner:{node:found.node.parentNode,offset:found.offset+(found.innerOffset?1:0)}:{node:dom,offset:0}}function windowRect(){return{left:0,right:window.innerWidth,top:0,bottom:window.innerHeight}}function scrollIntoView(pm,pos){pos||(pos=pm.sel.range.head||pm.sel.range.from);for(var coords=coordsAtPos(pm,pos),parent=pm.content;;parent=parent.parentNode){var atBody=parent==document.body,rect=atBody?windowRect():parent.getBoundingClientRect(),moveX=0,moveY=0;if(coords.top<rect.top?moveY=-(rect.top-coords.top+scrollMargin):coords.bottom>rect.bottom&&(moveY=coords.bottom-rect.bottom+scrollMargin),coords.left<rect.left?moveX=-(rect.left-coords.left+scrollMargin):coords.right>rect.right&&(moveX=coords.right-rect.right+scrollMargin),moveX||moveY?atBody&&window.scrollBy(moveX,moveY):(moveY&&(parent.scrollTop+=moveY),moveX&&(parent.scrollLeft+=moveX)),atBody)break}}function findOffsetInNode(node,coords){for(var closest=void 0,dyClosest=1e8,coordsClosest=void 0,offset=0,child=node.firstChild;child;child=child.nextSibling){var rects=void 0;if(1==child.nodeType)rects=child.getClientRects();else{if(3!=child.nodeType)continue;rects=textRects(child)}for(var i=0;i<rects.length;i++){var rect=rects[i];if(rect.left<=coords.left&&rect.right>=coords.left){var dy=rect.top>coords.top?rect.top-coords.top:rect.bottom<coords.top?coords.top-rect.bottom:0;if(dyClosest>dy){closest=child,dyClosest=dy,coordsClosest=dy?{left:coords.left,top:rect.top}:coords,1!=child.nodeType||child.firstChild||(offset=i+(coords.left>=(rect.left+rect.right)/2?1:0));continue}}!closest&&(coords.top>=rect.bottom||coords.top>=rect.top&&coords.left>=rect.right)&&(offset=i+1)}}return closest?3==closest.nodeType?findOffsetInText(closest,coordsClosest):closest.firstChild?findOffsetInNode(closest,coordsClosest):{node:node,offset:offset}:{node:node,offset:offset}}function findOffsetInText(node,coords){for(var len=node.nodeValue.length,range=document.createRange(),i=0;len>i;i++){range.setEnd(node,i+1),range.setStart(node,i);var rect=range.getBoundingClientRect();if(rect.top!=rect.bottom&&rect.left<=coords.left&&rect.right>=coords.left&&rect.top<=coords.top&&rect.bottom>=coords.top)return{node:node,offset:i+(coords.left>=(rect.left+rect.right)/2?1:0)}}return{node:node,offset:0}}function posAtCoords(pm,coords){var elt=document.elementFromPoint(coords.left,coords.top+1);if(!(0,_dom.contains)(pm.content,elt))return null;elt.firstChild||(elt=elt.parentNode);var _findOffsetInNode=findOffsetInNode(elt,coords),node=_findOffsetInNode.node,offset=_findOffsetInNode.offset;return posFromDOM(pm,node,offset)}function textRect(node,from,to){var range=document.createRange();return range.setEnd(node,to),range.setStart(node,from),range.getBoundingClientRect()}function textRects(node){var range=document.createRange();return range.setEnd(node,node.nodeValue.length),range.setStart(node,0),range.getClientRects()}function coordsAtPos(pm,pos){var _DOMFromPos=DOMFromPos(pm.content,pos),node=_DOMFromPos.node,offset=_DOMFromPos.offset,side=void 0,rect=void 0;if(3==node.nodeType)offset<node.nodeValue.length&&(rect=textRect(node,offset,offset+1),side="left"),rect&&rect.left!=rect.right||!offset||(rect=textRect(node,offset-1,offset),side="right");else if(node.firstChild){if(offset<node.childNodes.length){var child=node.childNodes[offset];rect=3==child.nodeType?textRect(child,0,child.nodeValue.length):child.getBoundingClientRect(),side="left"}if((!rect||rect.left==rect.right)&&offset){var child=node.childNodes[offset-1];rect=3==child.nodeType?textRect(child,0,child.nodeValue.length):child.getBoundingClientRect(),side="right"}}else rect=node.getBoundingClientRect(),side="left";var x=rect[side];return{top:rect.top,bottom:rect.bottom,left:x,right:x}}function setDOMSelectionToPos(pm,pos){var _DOMFromPos2=DOMFromPos(pm.content,pos),node=_DOMFromPos2.node,offset=_DOMFromPos2.offset,range=document.createRange();range.setEnd(node,offset),range.setStart(node,offset);var sel=window.getSelection();sel.removeAllRanges(),sel.addRange(range)}function selectableNodeAbove(pm,dom,coords,liberal){for(;dom&&dom!=pm.content;dom=dom.parentNode)if(dom.hasAttribute("pm-offset")){var path=pathFromDOM(pm,dom),node=pm.doc.path(path);if(node.type.countCoordsAsChild){var result=node.type.countCoordsAsChild(node,path,dom,coords);if(result)return result}if((liberal||null==node.type.contains)&&node.type.selectable)return _model.Pos.from(path);if(!liberal)return null}}function handleNodeClick(pm,type,event,direct){for(var dom=event.target;dom&&dom!=pm.content;dom=dom.parentNode)if(dom.hasAttribute("pm-offset")){var path=pathFromDOM(pm,dom),node=pm.doc.path(path),handled=node.type[type]&&node.type[type](pm,event,path,node)!==!1;if(direct||handled)return handled}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.pathFromDOM=pathFromDOM,exports.widthFromDOM=widthFromDOM,exports.posFromDOM=posFromDOM,exports.findByPath=findByPath,exports.pathToDOM=pathToDOM,exports.childContainer=childContainer,exports.DOMFromPos=DOMFromPos,exports.scrollIntoView=scrollIntoView,exports.posAtCoords=posAtCoords,exports.coordsAtPos=coordsAtPos,exports.setDOMSelectionToPos=setDOMSelectionToPos,exports.selectableNodeAbove=selectableNodeAbove,exports.handleNodeClick=handleNodeClick;var _model=require("../model"),_dom=require("../dom"),_error=require("../util/error"),scrollMargin=5},{"../dom":1,"../model":34,"../util/error":52}],9:[function(require,module,exports){"use strict";function options(path,ranges){return{onRender:function(node,dom,offset){return node.isText||null!=node.type.contains||(dom.contentEditable=!1,node.isBlock&&dom.setAttribute("pm-leaf","true")),node.isBlock&&null!=offset&&dom.setAttribute("pm-offset",offset),node.isTextblock&&adjustTrailingHacks(dom,node),dom},onContainer:function(node){node.setAttribute("pm-container",!0)},renderInlineFlat:function(node,dom,offset){ranges.advanceTo(new _model.Pos(path,offset));for(var end=new _model.Pos(path,offset+node.width),nextCut=ranges.nextChangeBefore(end),inner=dom,wrapped=void 0,i=0;i<node.marks.length;i++)inner=inner.firstChild;1!=dom.nodeType&&(dom=(0,_dom.elt)("span",null,dom),nextCut||(wrapped=dom)),wrapped||!nextCut&&!ranges.current.length||(wrapped=inner==dom?dom=(0,_dom.elt)("span",null,inner):inner.parentNode.appendChild((0,_dom.elt)("span",null,inner))),dom.setAttribute("pm-offset",offset),null==node.type.contains&&dom.setAttribute("pm-leaf",node.isText?node.width:"true");for(var inlineOffset=0;nextCut;){var size=nextCut-offset,split=splitSpan(wrapped,size);ranges.current.length&&(split.className=ranges.current.join(" ")),split.setAttribute("pm-inner-offset",inlineOffset),inlineOffset+=size,offset+=size,ranges.advanceTo(new _model.Pos(path,offset)),(nextCut=ranges.nextChangeBefore(end))||wrapped.setAttribute("pm-inner-offset",inlineOffset)}return ranges.current.length&&(wrapped.className=ranges.current.join(" ")),dom},document:document,path:path}}function splitSpan(span,at){var textNode=span.firstChild,text=textNode.nodeValue,newNode=span.parentNode.insertBefore((0,_dom.elt)("span",null,text.slice(0,at)),span);return textNode.nodeValue=text.slice(at),newNode}function draw(pm,doc){pm.content.textContent="",pm.content.appendChild((0,_format.toDOM)(doc,options([],pm.ranges.activeRangeTracker())))}function adjustTrailingHacks(dom,node){var needs=0==node.size||node.lastChild.type.isBR||node.type.isCode&&node.lastChild.isText&&/\n$/.test(node.lastChild.text)?"br":node.lastChild.isText||null!=node.lastChild.type.contains?null:"text",last=dom.lastChild,has=last&&1==last.nodeType&&last.hasAttribute("pm-ignore")?"BR"==last.nodeName?"br":"text":null;needs!=has&&(has&&dom.removeChild(last),needs&&dom.appendChild("br"==needs?(0,_dom.elt)("br",{"pm-ignore":"trailing-break"}):(0,_dom.elt)("span",{"pm-ignore":"cursor-text"},"")))}function findNodeIn(iter,node){for(var child,copy=iter.copy();child=copy.next().value;)if(child==node)return child}function movePast(dom){var next=dom.nextSibling;return dom.parentNode.removeChild(dom),next}function redraw(pm,dirty,doc,prev){function scan(dom,node,prev){for(var child,iNode=node.iter(),iPrev=prev.iter(),pChild=iPrev.next().value,domPos=dom.firstChild;child=iNode.next().value;){var offset=iNode.offset-child.width,matching=void 0,reuseDOM=void 0;if(node.isTextblock||opts.path.push(offset),pChild==child)matching=pChild;else if(matching=findNodeIn(iPrev,child))for(;pChild!=matching;)pChild=iPrev.next().value,domPos=movePast(domPos);if(matching&&!dirty.get(matching))reuseDOM=!0;else if(pChild&&!child.isText&&child.sameMarkup(pChild)&&dirty.get(pChild)!=_main.DIRTY_REDRAW)reuseDOM=!0,pChild.type.contains&&scan((0,_dompos.childContainer)(domPos),child,pChild);else{var rendered=(0,_format.nodeToDOM)(child,opts,offset);dom.insertBefore(rendered,domPos),reuseDOM=!1}reuseDOM&&(domPos.setAttribute("pm-offset",offset),domPos=domPos.nextSibling,pChild=iPrev.next().value),node.isTextblock||opts.path.pop()}for(;pChild;)domPos=movePast(domPos),pChild=iPrev.next().value;node.isTextblock&&adjustTrailingHacks(dom,node)}if(dirty.get(prev)==_main.DIRTY_REDRAW)return draw(pm,doc);var opts=options([],pm.ranges.activeRangeTracker());scan(pm.content,doc,prev)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.draw=draw,exports.redraw=redraw;var _model=require("../model"),_format=require("../format"),_dom=require("../dom"),_main=require("./main"),_dompos=require("./dompos")},{"../dom":1,"../format":20,"../model":34,"./dompos":8,"./main":13}],10:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function isDelStep(step){return"replace"==step.type&&step.from.offset<step.to.offset&&_model.Pos.samePath(step.from.path,step.to.path)&&(!step.param||0==step.param.content.size)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.History=void 0;var _model=require("../model"),_transform=require("../transform"),InvertedStep=function InvertedStep(step,version,id){_classCallCheck(this,InvertedStep),this.step=step,this.version=version,this.id=id},BranchRemapping=function(){function BranchRemapping(branch){_classCallCheck(this,BranchRemapping),this.branch=branch,this.remap=new _transform.Remapping,this.version=branch.version,this.mirrorBuffer=Object.create(null)}return _createClass(BranchRemapping,[{key:"moveToVersion",value:function(version){for(;this.version>version;)this.addNextMap()}},{key:"addNextMap",value:function(){var found=this.branch.mirror[this.version],mapOffset=this.branch.maps.length-(this.branch.version-this.version)-1,id=this.remap.addToFront(this.branch.maps[mapOffset],this.mirrorBuffer[this.version]);return--this.version,null!=found&&(this.mirrorBuffer[found]=id),id}},{key:"movePastStep",value:function(result){var id=this.addNextMap();result&&this.remap.addToBack(result.map,id)}}]),BranchRemapping}(),workTime=100,pauseTime=150,CompressionWorker=function(){function CompressionWorker(doc,branch,callback){_classCallCheck(this,CompressionWorker),this.branch=branch,this.callback=callback,this.remap=new BranchRemapping(branch),this.doc=doc,this.events=[],this.maps=[],this.version=this.startVersion=branch.version,this.i=branch.events.length,this.timeout=null,this.aborted=!1}return _createClass(CompressionWorker,[{key:"work",value:function(){var _this=this;if(!this.aborted)for(var endTime=Date.now()+workTime;;){if(0==this.i)return this.finish();for(var event=this.branch.events[--this.i],outEvent=[],j=event.length-1;j>=0;j--){var _event$j=event[j],step=_event$j.step,stepVersion=_event$j.version,stepID=_event$j.id;this.remap.moveToVersion(stepVersion);var mappedStep=step.map(this.remap.remap);if(mappedStep&&isDelStep(step)){for(var extra=0,start=step.from;j>0;){var next=event[j-1];if(next.version!=stepVersion-1||!isDelStep(next.step)||start.cmp(next.step.to))break;extra+=next.step.to.offset-next.step.from.offset,start=next.step.from,stepVersion--,j--,this.remap.addNextMap()}if(extra>0){var _start=mappedStep.from.move(-extra);mappedStep=new _transform.Step("replace",_start,mappedStep.to,_start)}}var result=mappedStep&&mappedStep.apply(this.doc);result&&(this.doc=result.doc,this.maps.push(result.map.invert()),outEvent.push(new InvertedStep(mappedStep,this.version,stepID)),this.version--),this.remap.movePastStep(result)}if(outEvent.length&&(outEvent.reverse(),this.events.push(outEvent)),Date.now()>endTime)return void(this.timeout=window.setTimeout(function(){return _this.work()},pauseTime))}}},{key:"finish",value:function(){this.aborted||(this.events.reverse(),this.maps.reverse(),this.callback(this.maps.concat(this.branch.maps.slice(this.branch.maps.length-(this.branch.version-this.startVersion))),this.events))}},{key:"abort",value:function(){this.aborted=!0,window.clearTimeout(this.timeout)}}]),CompressionWorker}(),compressStepCount=150,Branch=function(){function Branch(maxDepth){_classCallCheck(this,Branch),this.maxDepth=maxDepth,this.version=0,this.nextStepID=1,this.maps=[],this.mirror=Object.create(null),this.events=[],this.stepsSinceCompress=0,this.compressing=null,this.compressTimeout=null}return _createClass(Branch,[{key:"clear",value:function(force){(force||!this.empty())&&(this.maps.length=this.events.length=this.stepsSinceCompress=0,this.mirror=Object.create(null),this.abortCompression())}},{key:"newEvent",value:function(){for(this.abortCompression(),this.events.push([]);this.events.length>this.maxDepth;)this.events.shift()}},{key:"addMap",value:function(map){return this.empty()?void 0:(this.maps.push(map),this.version++,this.stepsSinceCompress++,!0)}},{key:"empty",value:function(){return 0==this.events.length}},{key:"addStep",value:function(step,map,id){this.addMap(map),null==id&&(id=this.nextStepID++),this.events[this.events.length-1].push(new InvertedStep(step,this.version,id))}},{key:"addTransform",value:function(transform,ids){this.abortCompression();for(var i=0;i<transform.steps.length;i++){var inverted=transform.steps[i].invert(transform.docs[i],transform.maps[i]);this.addStep(inverted,transform.maps[i],ids&&ids[i])}}},{key:"popEvent",value:function(doc,allowCollapsing){this.abortCompression();var event=this.events.pop();if(!event)return null;for(var remap=new BranchRemapping(this),collapsing=allowCollapsing,tr=new _transform.Transform(doc),ids=[],i=event.length-1;i>=0;i--){var invertedStep=event[i],step=invertedStep.step;if(collapsing&&invertedStep.version==remap.version)this.version--,delete this.mirror[this.version],this.maps.pop(),tr.step(step),ids.push(invertedStep.id),--remap.version;else{collapsing=!1,remap.moveToVersion(invertedStep.version),step=step.map(remap.remap);var result=step&&tr.step(step);result&&(ids.push(invertedStep.id),this.addMap(result.map)&&(this.mirror[this.version]=invertedStep.version)),i>0&&remap.movePastStep(result)}}return this.empty()&&this.clear(!0),{transform:tr,ids:ids}}},{key:"lastStep",value:function(){for(var i=this.events.length-1;i>=0;i--){var event=this.events[i];if(event.length)return event[event.length-1]}}},{key:"getVersion",value:function(){var step=this.lastStep();return{lastID:step&&step.id,version:this.version}}},{key:"isAtVersion",value:function(version){var step=this.lastStep();return this.version==version.version&&(step&&step.id)==version.lastID}},{key:"findVersion",value:function(version){for(var i=this.events.length-1;i>=0;i--)for(var event=this.events[i],j=event.length-1;j>=0;j--)if(event[j].id<=version.lastID)return{event:i,step:j+1}}},{key:"rebased",value:function(newMaps,rebasedTransform,positions){if(!this.empty()){this.abortCompression();var startVersion=this.version-positions.length;out:for(var i=this.events.length-1;i>=0;i--)for(var event=this.events[i],j=event.length-1;j>=0;j--){var step=event[j];if(step.version<=startVersion)break out;var off=positions[step.version-startVersion-1];if(-1==off)event.splice(j--,1);else{var inv=rebasedTransform.steps[off].invert(rebasedTransform.docs[off],rebasedTransform.maps[off]);event[j]=new InvertedStep(inv,startVersion+newMaps.length+off+1,step.id)}}this.maps.length>positions.length?this.maps=this.maps.slice(0,this.maps.length-positions.length).concat(newMaps).concat(rebasedTransform.maps):this.maps=rebasedTransform.maps.slice(),this.version=startVersion+newMaps.length+rebasedTransform.maps.length,this.stepsSinceCompress+=newMaps.length+rebasedTransform.steps.length-positions.length}}},{key:"abortCompression",value:function(){this.compressing&&(this.compressing.abort(),this.compressing=null)}},{key:"needsCompression",value:function(){return this.stepsSinceCompress>compressStepCount&&!this.compressing}},{key:"startCompression",value:function(doc){var _this2=this;this.compressing=new CompressionWorker(doc,this,function(maps,events){_this2.maps=maps,_this2.events=events,_this2.mirror=Object.create(null),_this2.compressing=null,_this2.stepsSinceCompress=0}),this.compressing.work()}}]),Branch}(),compressDelay=750;exports.History=function(){function History(pm){var _this3=this;_classCallCheck(this,History),this.pm=pm,this.done=new Branch(pm.options.historyDepth),this.undone=new Branch(pm.options.historyDepth),this.lastAddedAt=0,this.ignoreTransform=!1,this.allowCollapsing=!0,pm.on("transform",function(transform,options){return _this3.recordTransform(transform,options)})}return _createClass(History,[{key:"recordTransform",value:function(transform,options){if(!this.ignoreTransform){if(0==options.addToHistory)for(var i=0;i<transform.maps.length;i++){var map=transform.maps[i];this.done.addMap(map),this.undone.addMap(map)}else{this.undone.clear();var now=Date.now();now>this.lastAddedAt+this.pm.options.historyEventDelay&&this.done.newEvent(),this.done.addTransform(transform),this.lastAddedAt=now}this.maybeScheduleCompression()}}},{key:"undo",value:function(){return this.shift(this.done,this.undone)}},{key:"redo",value:function(){return this.shift(this.undone,this.done)}},{key:"shift",value:function(from,to){var event=from.popEvent(this.pm.doc,this.allowCollapsing);if(!event)return!1;var transform=event.transform,ids=event.ids;return this.ignoreTransform=!0,this.pm.apply(transform),this.ignoreTransform=!1,transform.steps.length?(to&&(to.newEvent(),to.addTransform(transform,ids)),this.lastAddedAt=0,!0):this.shift(from,to)}},{key:"getVersion",value:function(){return this.done.getVersion()}},{key:"isAtVersion",value:function(version){return this.done.isAtVersion(version)}},{key:"backToVersion",value:function(version){var found=this.done.findVersion(version);if(!found)return!1;var event=this.done.events[found.event];if(found.event==this.done.events.length-1&&found.step==event.length)return!0;var combined=this.done.events.slice(found.event+1).reduce(function(comb,arr){return comb.concat(arr)},event.slice(found.step));return this.done.events.length=found.event+((event.length=found.step)?1:0),this.done.events.push(combined),this.shift(this.done),!0}},{key:"rebased",value:function(newMaps,rebasedTransform,positions){this.done.rebased(newMaps,rebasedTransform,positions),this.undone.rebased(newMaps,rebasedTransform,positions),this.maybeScheduleCompression()}},{key:"maybeScheduleCompression",value:function(){this.maybeScheduleCompressionForBranch(this.done),this.maybeScheduleCompressionForBranch(this.undone)}},{key:"maybeScheduleCompressionForBranch",value:function(branch){var _this4=this;window.clearTimeout(branch.compressTimeout),branch.needsCompression()&&(branch.compressTimeout=window.setTimeout(function(){branch.needsCompression()&&branch.startCompression(_this4.pm.doc)},compressDelay))}},{key:"undoDepth",get:function(){return this.done.events.length}},{key:"redoDepth",get:function(){return this.undone.events.length}}]),History}()},{"../model":34,"../transform":40}],11:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Keymap=exports.baseCommands=exports.Command=exports.CommandSet=exports.MarkedRange=exports.SelectionError=exports.Range=exports.defineOption=exports.ProseMirror=void 0;var _main=require("./main");Object.defineProperty(exports,"ProseMirror",{enumerable:!0,get:function(){return _main.ProseMirror}});var _options=require("./options");Object.defineProperty(exports,"defineOption",{enumerable:!0,get:function(){return _options.defineOption}});var _selection=require("./selection");Object.defineProperty(exports,"Range",{enumerable:!0,get:function(){return _selection.Range}}),Object.defineProperty(exports,"SelectionError",{enumerable:!0,get:function(){return _selection.SelectionError}});var _range=require("./range");Object.defineProperty(exports,"MarkedRange",{enumerable:!0,get:function(){return _range.MarkedRange}});var _command=require("./command");Object.defineProperty(exports,"CommandSet",{enumerable:!0,get:function(){return _command.CommandSet}}),Object.defineProperty(exports,"Command",{enumerable:!0,get:function(){return _command.Command}});var _base_commands=require("./base_commands");Object.defineProperty(exports,"baseCommands",{enumerable:!0,get:function(){return _base_commands.baseCommands}}),require("./schema_commands");var _browserkeymap=require("browserkeymap"),_browserkeymap2=_interopRequireDefault(_browserkeymap);exports.Keymap=_browserkeymap2["default"]},{"./base_commands":2,"./command":5,"./main":13,"./options":14,"./range":15,"./schema_commands":16,"./selection":17,browserkeymap:57}],12:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function dispatchKey(pm,name,e){var seq=pm.input.keySeq;if(seq){if(_browserkeymap2["default"].isModifierKey(name))return!0;clearTimeout(stopSeq),stopSeq=setTimeout(function(){pm.input.keySeq==seq&&(pm.input.keySeq=null)},50),name=seq+" "+name}for(var handle=function handle(bound){if(bound===!1)return"nothing";if("..."==bound)return"multi";if(null==bound)return!1;var result=!1;if(Array.isArray(bound))for(var i=0;result===!1&&i<bound.length;i++)result=handle(bound[i]);else result="string"==typeof bound?pm.execCommand(bound):bound(pm);return 0==result?!1:"handled"},result=void 0,i=0;!result&&i<pm.input.keymaps.length;i++)result=handle(pm.input.keymaps[i].map.lookup(name,pm));return result||(result=handle(pm.input.baseKeymap.lookup(name,pm))||handle(_capturekeys.captureKeys.lookup(name))),"multi"==result&&(pm.input.keySeq=name),("handled"==result||"multi"==result)&&e.preventDefault(),seq&&!result&&/\'$/.test(name)?(e.preventDefault(),!0):!!result}function inputText(pm,range,text){if(range.empty&&!text)return!1;var marks=pm.input.storedMarks||pm.doc.marksAt(range.from);pm.tr.replaceWith(range.from,range.to,pm.schema.text(text,marks)).apply({scrollIntoView:!0}),pm.signal("textInput",text)}function selectClickedNode(pm,e){var pos=(0,_dompos.selectableNodeAbove)(pm,e.target,{left:e.clientX,top:e.clientY},!0);if(!pos)return pm.sel.fastPoll();var _pm$selection=pm.selection,node=_pm$selection.node,from=_pm$selection.from;if(node&&pos.depth>=from.depth&&0==pos.shorten(from.depth).cmp(from)){if(0==from.depth)return pm.sel.fastPoll();pos=from.shorten()}pm.setNodeSelection(pos),pm.focus(),e.preventDefault()}function handleTripleClick(pm,e){e.preventDefault();var pos=(0,_dompos.selectableNodeAbove)(pm,e.target,{left:e.clientX,top:e.clientY},!0);if(pos){var node=pm.doc.nodeAfter(pos);if(node.isBlock&&!node.isTextblock)pm.setNodeSelection(pos);else{var path=node.isInline?pos.path:pos.toPath();
node.isInline&&(node=pm.doc.path(path)),pm.setTextSelection(new _model.Pos(path,0),new _model.Pos(path,node.size))}pm.focus()}}function finishComposing(pm){var info=pm.input.composing,text=(0,_domchange.textInContext)(info.context,info.endData),range=(0,_selection.rangeFromDOMLoose)(pm);pm.ensureOperation(),pm.input.composing=null,text!=info.data&&inputText(pm,info.range,text),range&&!range.eq(pm.sel.range)&&pm.setSelectionDirect(range)}function toClipboard(doc,from,to,dataTransfer){var fragment=doc.sliceBetween(from,to),html='<div pm-sides="'+from.depth+" "+to.depth+'">'+(0,_format.toHTML)(fragment)+"</div>";dataTransfer.clearData(),dataTransfer.setData("text/html",html),dataTransfer.setData("text/plain",(0,_format.toText)(fragment))}function fromClipboard(pm,dataTransfer,plainText){var txt=dataTransfer.getData("text/plain"),html=dataTransfer.getData("text/html");if(!html&&!txt)return null;var doc=void 0,from=void 0,to=void 0;if(!plainText&&html||!txt){var dom=document.createElement("div");dom.innerHTML=pm.signalPipelined("transformPastedHTML",html);var wrap=dom.querySelector("[pm-sides]"),depths=void 0;wrap&&(depths=/^(\d+) (\d+)$/.exec(wrap.getAttribute("pm-sides")))?(doc=(0,_format.fromDOM)(pm.schema,wrap),from=posAtLeft(doc,+depths[1]),to=posAtRight(doc,+depths[2])):doc=(0,_format.fromDOM)(pm.schema,dom)}else doc=(0,_format.parseFrom)(pm.schema,pm.signalPipelined("transformPastedText",txt),!plainText&&(0,_format.knownSource)("markdown")?"markdown":"text");return{doc:doc,from:from||(0,_selection.findSelectionAtStart)(doc).from,to:to||(0,_selection.findSelectionAtEnd)(doc).to}}function posAtLeft(doc,depth){for(var path=[],i=0,node=doc;depth>i&&(node=node.firstChild);i++)path.push(0);return new _model.Pos(path,0)}function posAtRight(doc,depth){for(var path=[],node=doc,i=0;depth>i&&node.size;i++)path.push(node.size-1),node=node.lastChild;return new _model.Pos(path,node.size)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.Input=void 0,exports.dispatchKey=dispatchKey;var _browserkeymap=require("browserkeymap"),_browserkeymap2=_interopRequireDefault(_browserkeymap),_model=require("../model"),_format=require("../format"),_capturekeys=require("./capturekeys"),_dom=require("../dom"),_domchange=require("./domchange"),_selection=require("./selection"),_dompos=require("./dompos"),stopSeq=null,handlers={};exports.Input=function(){function Input(pm){var _this=this;_classCallCheck(this,Input),this.pm=pm,this.baseKeymap=null,this.keySeq=null,this.composing=null,this.mouseDown=null,this.shiftKey=this.updatingComposition=!1,this.skipInput=0,this.draggingFrom=!1,this.keymaps=[],this.defaultKeymap=null,this.storedMarks=null,this.dropTarget=pm.wrapper.appendChild((0,_dom.elt)("div",{"class":"ProseMirror-drop-target"}));var _loop=function(event){var handler=handlers[event];pm.content.addEventListener(event,function(e){return handler(pm,e)})};for(var event in handlers)_loop(event);pm.on("selectionChange",function(){return _this.storedMarks=null})}return _createClass(Input,[{key:"maybeAbortComposition",value:function(){if(this.composing&&!this.updatingComposition){if(this.composing.finished)finishComposing(this.pm);else{this.composing=null,this.skipInput++;var sel=window.getSelection();if(sel.rangeCount){var range=sel.getRangeAt(0);sel.removeAllRanges(),sel.addRange(range)}}return!0}}}]),Input}();handlers.keydown=function(pm,e){if(pm.signal("interaction"),16==e.keyCode&&(pm.input.shiftKey=!0),!pm.input.composing){var name=_browserkeymap2["default"].keyName(e);name&&dispatchKey(pm,name,e)||pm.sel.fastPoll()}},handlers.keyup=function(pm,e){16==e.keyCode&&(pm.input.shiftKey=!1)},handlers.keypress=function(pm,e){if(!(pm.input.composing||!e.charCode||e.ctrlKey&&!e.altKey||_dom.browser.mac&&e.metaKey||dispatchKey(pm,_browserkeymap2["default"].keyName(e),e))){var sel=pm.selection;sel.node&&null==sel.node.contains&&(pm.tr["delete"](sel.from,sel.to).apply(),sel=pm.selection),inputText(pm,sel,String.fromCharCode(e.charCode)),e.preventDefault()}};var lastClick=0,oneButLastClick=0;handlers.mousedown=function(pm,e){pm.signal("interaction");var now=Date.now(),doubleClick=500>now-lastClick,tripleClick=600>now-oneButLastClick;oneButLastClick=lastClick,lastClick=now,tripleClick?handleTripleClick(pm,e):pm.input.mouseDown=new MouseDown(pm,e,doubleClick)};var MouseDown=function(){function MouseDown(pm,event,doubleClick){_classCallCheck(this,MouseDown),this.pm=pm,this.event=event,this.leaveToBrowser=pm.input.shiftKey||doubleClick;var path=(0,_dompos.pathFromDOM)(pm,event.target),node=pm.doc.path(path);this.mightDrag=node.type.draggable||node==pm.sel.range.node?path:null,this.mightDrag&&(event.target.draggable=!0,_dom.browser.gecko&&(this.setContentEditable=!event.target.hasAttribute("contentEditable"))&&event.target.setAttribute("contentEditable","false")),this.x=event.clientX,this.y=event.clientY,window.addEventListener("mouseup",this.up=this.up.bind(this)),window.addEventListener("mousemove",this.move=this.move.bind(this)),pm.sel.fastPoll()}return _createClass(MouseDown,[{key:"done",value:function(){window.removeEventListener("mouseup",this.up),window.removeEventListener("mousemove",this.move),this.mightDrag&&(this.event.target.draggable=!1,_dom.browser.gecko&&this.setContentEditable&&this.event.target.removeAttribute("contentEditable"))}},{key:"up",value:function(){if(this.done(),this.leaveToBrowser)this.pm.sel.fastPoll();else if(this.event.ctrlKey)selectClickedNode(this.pm,this.event);else if(!(0,_dompos.handleNodeClick)(this.pm,"handleClick",this.event,!0)){var pos=(0,_dompos.selectableNodeAbove)(this.pm,this.event.target,{left:this.x,top:this.y});pos?(this.pm.setNodeSelection(pos),this.pm.focus()):this.pm.sel.fastPoll()}}},{key:"move",value:function(event){!this.leaveToBrowser&&(Math.abs(this.x-event.clientX)>4||Math.abs(this.y-event.clientY)>4)&&(this.leaveToBrowser=!0),this.pm.sel.fastPoll()}}]),MouseDown}();handlers.touchdown=function(pm){pm.sel.fastPoll()},handlers.contextmenu=function(pm,e){(0,_dompos.handleNodeClick)(pm,"handleContextMenu",e,!1)};var Composing=function Composing(pm,data){_classCallCheck(this,Composing),this.finished=!1,this.context=(0,_domchange.textContext)(data),this.data=data,this.endData=null;var range=pm.selection;if(data){var path=range.head.path,line=pm.doc.path(path).textContent,found=line.indexOf(data,range.head.offset-data.length);found>-1&&found<=range.head.offset+data.length&&(range=new _selection.TextSelection(new _model.Pos(path,found),new _model.Pos(path,found+data.length)))}this.range=range};handlers.compositionstart=function(pm,e){if(!pm.input.maybeAbortComposition()){pm.flush(),pm.input.composing=new Composing(pm,e.data);var above=pm.selection.head.shorten();pm.markRangeDirty({from:above,to:above.move(1)})}},handlers.compositionupdate=function(pm,e){var info=pm.input.composing;info&&info.data!=e.data&&(info.data=e.data,pm.input.updatingComposition=!0,inputText(pm,info.range,info.data),pm.input.updatingComposition=!1,info.range=new _selection.TextSelection(info.range.from,info.range.from.move(info.data.length)))},handlers.compositionend=function(pm,e){var info=pm.input.composing;info&&(pm.input.composing.finished=!0,pm.input.composing.endData=e.data,setTimeout(function(){pm.input.composing==info&&finishComposing(pm)},20))},handlers.input=function(pm){return pm.input.skipInput?--pm.input.skipInput:pm.input.composing?void(pm.input.composing.finished&&finishComposing(pm)):(pm.startOperation({readSelection:!1}),(0,_domchange.applyDOMChange)(pm),void pm.scrollIntoView())},handlers.copy=handlers.cut=function(pm,e){var _pm$selection2=pm.selection,from=_pm$selection2.from,to=_pm$selection2.to,empty=_pm$selection2.empty;!empty&&e.clipboardData&&(toClipboard(pm.doc,from,to,e.clipboardData),e.preventDefault(),"cut"!=e.type||empty||pm.tr["delete"](from,to).apply())},handlers.paste=function(pm,e){if(e.clipboardData){var sel=pm.selection,fragment=fromClipboard(pm,e.clipboardData,pm.input.shiftKey);fragment&&(e.preventDefault(),pm.tr.replace(sel.from,sel.to,fragment.doc,fragment.from,fragment.to).apply(),pm.scrollIntoView())}},handlers.dragstart=function(pm,e){var mouseDown=pm.input.mouseDown;if(mouseDown&&mouseDown.done(),e.dataTransfer){var _pm$selection3=pm.selection,from=_pm$selection3.from,to=_pm$selection3.to,empty=_pm$selection3.empty,fragment=void 0,pos=!empty&&pm.posAtCoords({left:e.clientX,top:e.clientY});if(pos&&pos.cmp(from)>=0&&pos.cmp(to)<=0)fragment={from:from,to:to};else if(mouseDown&&mouseDown.mightDrag){var _pos=_model.Pos.from(mouseDown.mightDrag);fragment={from:_pos,to:_pos.move(1)}}fragment&&(pm.input.draggingFrom=fragment,toClipboard(pm.doc,fragment.from,fragment.to,e.dataTransfer))}},handlers.dragend=function(pm){return window.setTimeout(function(){return pm.input.draggingFrom=!1},50)},handlers.dragover=handlers.dragenter=function(pm,e){e.preventDefault();var cursorPos=pm.posAtCoords({left:e.clientX,top:e.clientY});if(cursorPos){var coords=(0,_dompos.coordsAtPos)(pm,cursorPos),rect=pm.wrapper.getBoundingClientRect();coords.top-=rect.top,coords.right-=rect.left,coords.bottom-=rect.top,coords.left-=rect.left;var target=pm.input.dropTarget;target.style.display="block",target.style.left=coords.left-1+"px",target.style.top=coords.top+"px",target.style.height=coords.bottom-coords.top+"px"}},handlers.dragleave=function(pm){return pm.input.dropTarget.style.display=""},handlers.drop=function(pm,e){if(pm.input.dropTarget.style.display="",e.dataTransfer&&!pm.signalDOM(e)){var fragment=fromClipboard(pm,e.dataTransfer);if(fragment){e.preventDefault();var insertPos=pm.posAtCoords({left:e.clientX,top:e.clientY}),origPos=insertPos;if(!insertPos)return;var tr=pm.tr;pm.input.draggingFrom&&!e.ctrlKey&&(tr["delete"](pm.input.draggingFrom.from,pm.input.draggingFrom.to),insertPos=tr.map(insertPos).pos),tr.replace(insertPos,insertPos,fragment.doc,fragment.from,fragment.to).apply();var posAfter=tr.map(origPos).pos;_model.Pos.samePath(insertPos.path,posAfter.path)&&posAfter.offset==insertPos.offset+1&&pm.doc.nodeAfter(insertPos).type.selectable?pm.setNodeSelection(insertPos):pm.setTextSelection(insertPos,posAfter),pm.focus()}}},handlers.focus=function(pm){pm.wrapper.classList.add("ProseMirror-focused"),pm.signal("focus")},handlers.blur=function(pm){pm.wrapper.classList.remove("ProseMirror-focused"),pm.signal("blur")}},{"../dom":1,"../format":20,"../model":34,"./capturekeys":3,"./domchange":7,"./dompos":8,"./selection":17,browserkeymap:57}],13:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.DIRTY_REDRAW=exports.DIRTY_RESCAN=exports.ProseMirror=void 0,require("./css");var _browserkeymap=require("browserkeymap"),_browserkeymap2=_interopRequireDefault(_browserkeymap),_model=require("../model"),_transform=require("../transform"),_sortedinsert=require("../util/sortedinsert"),_sortedinsert2=_interopRequireDefault(_sortedinsert),_error=require("../util/error"),_map=require("../util/map"),_event=require("../util/event"),_dom=require("../dom"),_format=require("../format"),_options=require("./options"),_selection2=require("./selection"),_dompos=require("./dompos"),_draw=require("./draw"),_input=require("./input"),_history=require("./history"),_range=require("./range"),ProseMirror=exports.ProseMirror=function(){function ProseMirror(opts){_classCallCheck(this,ProseMirror),(0,_dom.ensureCSSAdded)(),opts=this.options=(0,_options.parseOptions)(opts),this.schema=opts.schema,null==opts.doc&&(opts.doc=this.schema.node("doc",null,[this.schema.node("paragraph")])),this.content=(0,_dom.elt)("div",{"class":"ProseMirror-content","pm-container":!0}),this.wrapper=(0,_dom.elt)("div",{"class":"ProseMirror"},this.content),this.wrapper.ProseMirror=this,opts.place&&opts.place.appendChild?opts.place.appendChild(this.wrapper):opts.place&&opts.place(this.wrapper),this.setDocInner(opts.docFormat?(0,_format.parseFrom)(this.schema,opts.doc,opts.docFormat):opts.doc),(0,_draw.draw)(this,this.doc),this.content.contentEditable=!0,opts.label&&this.content.setAttribute("aria-label",opts.label),this.mod=Object.create(null),this.cached=Object.create(null),this.operation=null,this.dirtyNodes=new _map.Map,this.flushScheduled=!1,this.sel=new _selection2.SelectionState(this,(0,_selection2.findSelectionAtStart)(this.doc)),this.accurateSelection=!1,this.input=new _input.Input(this),this.commands=null,this.commandKeys=null,(0,_options.initOptions)(this)}return _createClass(ProseMirror,[{key:"setOption",value:function(name,value){(0,_options.setOption)(this,name,value),this.signal("optionChanged",name,value)}},{key:"getOption",value:function(name){return this.options[name]}},{key:"setTextSelection",value:function(anchor,head){this.setSelection(new _selection2.TextSelection(anchor,head))}},{key:"setNodeSelection",value:function(pos){this.checkPos(pos,!1);var parent=this.doc.path(pos.path);pos.offset>=parent.size&&_selection2.SelectionError.raise("Trying to set a node selection at the end of a node");var node=parent.child(pos.offset);node.type.selectable||_selection2.SelectionError.raise("Trying to select a non-selectable node"),this.input.maybeAbortComposition(),this.sel.setAndSignal(new _selection2.NodeSelection(pos,pos.move(1),node))}},{key:"setSelection",value:function(selection){selection instanceof _selection2.TextSelection?(this.checkPos(selection.head,!0),selection.empty||this.checkPos(selection.anchor,!0)):this.checkPos(selection.to,!1),this.setSelectionDirect(selection)}},{key:"setSelectionDirect",value:function(selection){this.ensureOperation(),this.input.maybeAbortComposition(),selection.eq(this.sel.range)||this.sel.setAndSignal(selection)}},{key:"setContent",value:function(value,format){format&&(value=(0,_format.parseFrom)(this.schema,value,format)),this.setDoc(value)}},{key:"getContent",value:function(format){return format?(0,_format.serializeTo)(this.doc,format):this.doc}},{key:"setDocInner",value:function(doc){doc.type!=this.schema.nodes.doc&&_error.AssertionError.raise("Trying to set a document with a different schema"),this.doc=doc,this.ranges=new _range.RangeStore(this),this.history=new _history.History(this)}},{key:"setDoc",value:function(doc,sel){sel||(sel=(0,_selection2.findSelectionAtStart)(doc)),this.signal("beforeSetDoc",doc,sel),this.ensureOperation(),this.setDocInner(doc),this.sel.set(sel,!0),this.signal("setDoc",doc,sel)}},{key:"updateDoc",value:function(doc,mapping,selection){this.ensureOperation(),this.input.maybeAbortComposition(),this.ranges.transform(mapping),this.doc=doc,this.sel.setAndSignal(selection||this.sel.range.map(doc,mapping)),this.signal("change")}},{key:"apply",value:function(transform){var options=arguments.length<=1||void 0===arguments[1]?nullOptions:arguments[1];return transform.doc==this.doc?!1:(transform.docs[0]!=this.doc&&(0,_model.findDiffStart)(transform.docs[0],this.doc)&&_error.AssertionError.raise("Applying a transform that does not start with the current document"),this.updateDoc(transform.doc,transform,options.selection),this.signal("transform",transform,options),options.scrollIntoView&&this.scrollIntoView(),transform)}},{key:"checkPos",value:function(pos,textblock){pos.isValid(this.doc,textblock)||_error.AssertionError.raise("Position "+pos+" is not valid in current document")}},{key:"ensureOperation",value:function(){return this.operation||this.startOperation()}},{key:"startOperation",value:function(options){var _this=this;return this.operation=new Operation(this),options&&options.readSelection===!1||!this.sel.readFromDOM()||(this.operation.sel=this.sel.range),this.flushScheduled||((0,_dom.requestAnimationFrame)(function(){_this.flushScheduled=!1,_this.flush()}),this.flushScheduled=!0),this.operation}},{key:"flush",value:function(){if(document.body.contains(this.wrapper)&&this.operation){this.signal("flushing");var op=this.operation;if(op){this.operation=null,this.accurateSelection=!0;var docChanged=op.doc!=this.doc||this.dirtyNodes.size,redrawn=!1;this.input.composing||!docChanged&&!op.composingAtStart||((0,_draw.redraw)(this,this.dirtyNodes,this.doc,op.doc),this.dirtyNodes.clear(),redrawn=!0),((redrawn||!op.sel.eq(this.sel.range))&&!this.input.composing||op.focus)&&this.sel.toDOM(op.focus),op.scrollIntoView!==!1&&(0,_dompos.scrollIntoView)(this,op.scrollIntoView),docChanged&&this.signal("draw"),this.signal("flush"),this.accurateSelection=!1}}}},{key:"addKeymap",value:function(map){var rank=arguments.length<=1||void 0===arguments[1]?50:arguments[1];(0,_sortedinsert2["default"])(this.input.keymaps,{map:map,rank:rank},function(a,b){return a.rank-b.rank})}},{key:"removeKeymap",value:function(map){for(var maps=this.input.keymaps,i=0;i<maps.length;++i)if(maps[i].map==map||maps[i].map.options.name==map)return maps.splice(i,1),!0}},{key:"markRange",value:function(from,to,options){this.checkPos(from),this.checkPos(to);var range=new _range.MarkedRange(from,to,options);return this.ranges.addRange(range),range}},{key:"removeRange",value:function(range){this.ranges.removeRange(range)}},{key:"setMark",value:function(type,to,attrs){var sel=this.selection;if(sel.empty){var marks=this.activeMarks();if(null==to&&(to=!type.isInSet(marks)),to&&!this.doc.path(sel.head.path).type.canContainMark(type))return;this.input.storedMarks=to?type.create(attrs).addToSet(marks):type.removeFromSet(marks),this.signal("activeMarkChange")}else(null!=to?to:!this.doc.rangeHasMark(sel.from,sel.to,type))?this.apply(this.tr.addMark(sel.from,sel.to,type.create(attrs))):this.apply(this.tr.removeMark(sel.from,sel.to,type))}},{key:"activeMarks",value:function(){var head;return this.input.storedMarks||((head=this.selection.head)?this.doc.marksAt(head):[])}},{key:"focus",value:function(){this.operation?this.operation.focus=!0:this.sel.toDOM(!0)}},{key:"hasFocus",value:function(){return this.sel.range instanceof _selection2.NodeSelection?document.activeElement==this.content:(0,_selection2.hasFocus)(this)}},{key:"posAtCoords",value:function(coords){return(0,_dompos.posAtCoords)(this,coords)}},{key:"coordsAtPos",value:function(pos){return this.checkPos(pos),(0,_dompos.coordsAtPos)(this,pos)}},{key:"scrollIntoView",value:function(){var pos=arguments.length<=0||void 0===arguments[0]?null:arguments[0];pos&&this.checkPos(pos),this.ensureOperation(),this.operation.scrollIntoView=pos}},{key:"execCommand",value:function(name,params){var cmd=this.commands[name];return!(!cmd||cmd.exec(this,params)===!1)}},{key:"keyForCommand",value:function(name){var cached=this.commandKeys[name];if(void 0!==cached)return cached;var cmd=this.commands[name],keymap=this.input.baseKeymap;if(!cmd)return this.commandKeys[name]=null;var key=cmd.spec.key||(_dom.browser.mac?cmd.spec.macKey:cmd.spec.pcKey);if(key){key=_browserkeymap2["default"].normalizeKeyName(Array.isArray(key)?key[0]:key);var deflt=keymap.bindings[key];if(Array.isArray(deflt)?deflt.indexOf(name)>-1:deflt==name)return this.commandKeys[name]=key}for(var _key in keymap.bindings){var bound=keymap.bindings[_key];if(Array.isArray(bound)?bound.indexOf(name)>-1:bound==name)return this.commandKeys[name]=_key}return this.commandKeys[name]=null}},{key:"markRangeDirty",value:function(range){this.ensureOperation();for(var dirty=this.dirtyNodes,from=range.from,to=range.to,depth=0,node=this.doc;;depth++){var fromEnd=depth==from.depth,toEnd=depth==to.depth;if(fromEnd||toEnd||from.path[depth]!=to.path[depth]){var _ret=function(){var start=fromEnd?from.offset:from.path[depth],end=toEnd?to.offset:to.path[depth]+1;if(node.isTextblock)node.forEach(function(child,cStart,cEnd){end>cStart&&cEnd>start&&dirty.set(child,DIRTY_REDRAW)});else for(var child,i=node.iter(start,end);child=i.next().value;)dirty.set(child,DIRTY_REDRAW);return"break"}();if("break"===_ret)break}else{var child=node.child(from.path[depth]);dirty.has(child)||dirty.set(child,DIRTY_RESCAN),node=child}}}},{key:"markAllDirty",value:function(){this.dirtyNodes.set(this.doc,DIRTY_REDRAW)}},{key:"selection",get:function(){return this.accurateSelection||this.ensureOperation(),this.sel.range}},{key:"tr",get:function(){return new EditorTransform(this)}}]),ProseMirror}();ProseMirror.prototype.apply.scroll={scrollIntoView:!0};var DIRTY_RESCAN=exports.DIRTY_RESCAN=1,DIRTY_REDRAW=exports.DIRTY_REDRAW=2,nullOptions={};(0,_event.eventMixin)(ProseMirror);var Operation=function Operation(pm){_classCallCheck(this,Operation),this.doc=pm.doc,this.sel=pm.sel.range,this.scrollIntoView=!1,this.focus=!1,this.composingAtStart=!!pm.input.composing},EditorTransform=function(_Transform){function EditorTransform(pm){_classCallCheck(this,EditorTransform);var _this2=_possibleConstructorReturn(this,Object.getPrototypeOf(EditorTransform).call(this,pm.doc));return _this2.pm=pm,_this2}return _inherits(EditorTransform,_Transform),_createClass(EditorTransform,[{key:"apply",value:function(options){return this.pm.apply(this,options)}},{key:"replaceSelection",value:function(node,inheritMarks){var _selection=this.selection,empty=_selection.empty,from=_selection.from,to=_selection.to,selNode=_selection.node,parent=void 0;if(node&&node.isInline&&inheritMarks!==!1){var marks=empty?this.pm.input.storedMarks:this.doc.marksAt(from);node=node.type.create(node.attrs,node.text,marks)}if(selNode&&selNode.isTextblock&&node&&node.isInline)from=new _model.Pos(from.toPath(),0),to=new _model.Pos(from.path,selNode.size);else if(selNode)for(;from.depth&&0==from.offset&&(parent=this.doc.path(from.path))&&from.offset==parent.size-1&&!parent.type.canBeEmpty&&(!node||!parent.type.canContain(node));)from=from.shorten(),to=to.shorten(null,1);else if(node&&node.isBlock&&this.doc.path(from.path.slice(0,from.depth-1)).type.canContain(node)){this["delete"](from,to);var _parent=this.doc.path(from.path);return from.offset&&from.offset!=_parent.size&&this.split(from),this.insert(from.shorten(null,from.offset?1:0),node)}return node?this.replaceWith(from,to,node):this["delete"](from,to)}},{key:"deleteSelection",value:function(){return this.replaceSelection()}},{key:"typeText",value:function(text){return this.replaceSelection(this.pm.schema.text(text),!0)}},{key:"selection",get:function(){return this.steps.length?this.pm.selection.map(this):this.pm.selection}}]),EditorTransform}(_transform.Transform)},{"../dom":1,"../format":20,"../model":34,"../transform":40,"../util/error":52,"../util/event":53,"../util/map":54,"../util/sortedinsert":56,"./css":6,"./dompos":8,"./draw":9,"./history":10,"./input":12,"./options":14,"./range":15,"./selection":17,browserkeymap:57}],14:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function defineOption(name,defaultValue,update,updateOnInit){options[name]=new Option(defaultValue,update,updateOnInit)}function parseOptions(obj){var result=Object.create(null),given=obj?[obj].concat(obj.use||[]):[];outer:for(var opt in options){for(var i=0;i<given.length;i++)if(opt in given[i]){result[opt]=given[i][opt];continue outer}result[opt]=options[opt].defaultValue}return result}function initOptions(pm){for(var opt in options){var desc=options[opt];desc.update&&desc.updateOnInit&&desc.update(pm,pm.options[opt],null,!0)}}function setOption(pm,name,value){var desc=options[name];void 0===desc&&_error.AssertionError.raise("Option '"+name+"' is not defined"),desc.update===!1&&_error.AssertionError.raise("Option '"+name+"' can not be changed");var old=pm.options[name];pm.options[name]=value,desc.update&&desc.update(pm,value,old,!1)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.defineOption=defineOption,exports.parseOptions=parseOptions,exports.initOptions=initOptions,exports.setOption=setOption;var _model=require("../model"),_error=require("../util/error"),_prompt=require("../ui/prompt"),_command=require("./command"),Option=function Option(defaultValue,update,updateOnInit){_classCallCheck(this,Option),this.defaultValue=defaultValue,this.update=update,this.updateOnInit=updateOnInit!==!1},options=Object.create(null);defineOption("schema",_model.defaultSchema,!1),defineOption("doc",null,function(pm,value){return pm.setDoc(value)},!1),defineOption("docFormat",null),defineOption("place",null),defineOption("historyDepth",100),defineOption("historyEventDelay",500),defineOption("commands",_command.CommandSet["default"],_command.updateCommands),defineOption("commandParamPrompt",_prompt.ParamPrompt),defineOption("label",null)},{"../model":34,"../ui/prompt":49,"../util/error":52,"./command":5}],15:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.RangeStore=exports.MarkedRange=void 0;var _event=require("../util/event"),MarkedRange=exports.MarkedRange=function(){function MarkedRange(from,to,options){_classCallCheck(this,MarkedRange),this.options=options||{},this.from=from,this.to=to}return _createClass(MarkedRange,[{key:"remove",value:function(){this.signal("removed",this.from,this.to.max(this.from)),this.from=this.to=null}}]),MarkedRange}();(0,_event.eventMixin)(MarkedRange);var RangeSorter=function(){function RangeSorter(){_classCallCheck(this,RangeSorter),this.sorted=[]}return _createClass(RangeSorter,[{key:"find",value:function(at){for(var min=0,max=this.sorted.length;;){if(min+10>max){for(var i=min;max>i;i++)if(this.sorted[i].at.cmp(at)>=0)return i;return max}var mid=min+max>>1;this.sorted[mid].at.cmp(at)>0?max=mid:min=mid}}},{key:"insert",value:function(obj){this.sorted.splice(this.find(obj.at),0,obj)}},{key:"remove",value:function(at,range){for(var pos=this.find(at),dist=0;;dist++){var leftPos=pos-dist-1,rightPos=pos+dist;if(leftPos>=0&&this.sorted[leftPos].range==range)return void this.sorted.splice(leftPos,1);if(rightPos<this.sorted.length&&this.sorted[rightPos].range==range)return void this.sorted.splice(rightPos,1)}}},{key:"resort",value:function(){for(var i=0;i<this.sorted.length;i++)for(var cur=this.sorted[i],at=cur.at="open"==cur.type?cur.range.from:cur.range.to,pos=i;pos>0&&this.sorted[pos-1].at.cmp(at)>0;)this.sorted[pos]=this.sorted[pos-1],this.sorted[--pos]=cur}}]),RangeSorter}(),RangeTracker=(exports.RangeStore=function(){function RangeStore(pm){_classCallCheck(this,RangeStore),this.pm=pm,this.ranges=[],this.sorted=new RangeSorter}return _createClass(RangeStore,[{key:"addRange",value:function(range){this.ranges.push(range),this.sorted.insert({type:"open",at:range.from,range:range}),this.sorted.insert({type:"close",at:range.to,range:range}),this.pm.markRangeDirty(range)}},{key:"removeRange",value:function(range){var found=this.ranges.indexOf(range);found>-1&&(this.ranges.splice(found,1),this.sorted.remove(range.from,range),this.sorted.remove(range.to,range),this.pm.markRangeDirty(range),range.remove())}},{key:"transform",value:function(mapping){for(var i=0;i<this.ranges.length;i++){var range=this.ranges[i];range.from=mapping.map(range.from,range.options.inclusiveLeft?-1:1).pos,range.to=mapping.map(range.to,range.options.inclusiveRight?1:-1).pos;var diff=range.from.cmp(range.to);range.options.removeWhenEmpty!==!1&&diff>=0?(this.removeRange(range),i--):diff>0&&(range.to=range.from)}this.sorted.resort()}},{key:"activeRangeTracker",value:function(){return new RangeTracker(this.sorted.sorted)}}]),RangeStore}(),function(){function RangeTracker(sorted){_classCallCheck(this,RangeTracker),this.sorted=sorted,this.pos=0,this.current=[]}return _createClass(RangeTracker,[{key:"advanceTo",value:function(pos){for(var next=void 0;this.pos<this.sorted.length&&(next=this.sorted[this.pos]).at.cmp(pos)<=0;){var className=next.range.options.className;className&&("open"==next.type?this.current.push(className):this.current.splice(this.current.indexOf(className),1)),this.pos++}}},{key:"nextChangeBefore",value:function(pos){for(;;){if(this.pos==this.sorted.length)return null;var next=this.sorted[this.pos];if(next.range.options.className)return next.at.cmp(pos)>=0?null:next.at.offset;this.pos++}}}]),RangeTracker}())},{"../util/event":53}],16:[function(require,module,exports){"use strict";var _model=require("../model"),_command=require("./command"),_format=require("../format");_model.StrongMark.register("command","set",{derive:!0,label:"Set strong"}),_model.StrongMark.register("command","unset",{derive:!0,label:"Unset strong"}),_model.StrongMark.register("command","toggle",{derive:!0,label:"Toggle strong",menu:{group:"inline",rank:20,display:{type:"icon",width:805,height:1024,path:"M317 869q42 18 80 18 214 0 214-191 0-65-23-102-15-25-35-42t-38-26-46-14-48-6-54-1q-41 0-57 5 0 30-0 90t-0 90q0 4-0 38t-0 55 2 47 6 38zM309 442q24 4 62 4 46 0 81-7t62-25 42-51 14-81q0-40-16-70t-45-46-61-24-70-8q-28 0-74 7 0 28 2 86t2 86q0 15-0 45t-0 45q0 26 0 39zM0 950l1-53q8-2 48-9t60-15q4-6 7-15t4-19 3-18 1-21 0-19v-37q0-561-12-585-2-4-12-8t-25-6-28-4-27-2-17-1l-2-47q56-1 194-6t213-5q13 0 39 0t38 0q40 0 78 7t73 24 61 40 42 59 16 78q0 29-9 54t-22 41-36 32-41 25-48 22q88 20 146 76t58 141q0 57-20 102t-53 74-78 48-93 27-100 8q-25 0-75-1t-75-1q-60 0-175 6t-132 6z"}},keys:["Mod-B"]}),_model.EmMark.register("command","set",{derive:!0,label:"Add emphasis"}),_model.EmMark.register("command","unset",{derive:!0,label:"Remove emphasis"}),_model.EmMark.register("command","toggle",{derive:!0,label:"Toggle emphasis",menu:{group:"inline",rank:21,display:{type:"icon",width:585,height:1024,path:"M0 949l9-48q3-1 46-12t63-21q16-20 23-57 0-4 35-165t65-310 29-169v-14q-13-7-31-10t-39-4-33-3l10-58q18 1 68 3t85 4 68 1q27 0 56-1t69-4 56-3q-2 22-10 50-17 5-58 16t-62 19q-4 10-8 24t-5 22-4 26-3 24q-15 84-50 239t-44 203q-1 5-7 33t-11 51-9 47-3 32l0 10q9 2 105 17-1 25-9 56-6 0-18 0t-18 0q-16 0-49-5t-49-5q-78-1-117-1-29 0-81 5t-69 6z"
}},keys:["Mod-I"]}),_model.CodeMark.register("command","set",{derive:!0,label:"Set code style"}),_model.CodeMark.register("command","unset",{derive:!0,label:"Remove code style"}),_model.CodeMark.register("command","toggle",{derive:!0,label:"Toggle code style",menu:{group:"inline",rank:22,display:{type:"icon",width:896,height:1024,path:"M608 192l-96 96 224 224-224 224 96 96 288-320-288-320zM288 192l-288 320 288 320 96-96-224-224 224-224-96-96z"}},keys:["Mod-`"]});var linkIcon={type:"icon",width:951,height:1024,path:"M832 694q0-22-16-38l-118-118q-16-16-38-16-24 0-41 18 1 1 10 10t12 12 8 10 7 14 2 15q0 22-16 38t-38 16q-8 0-15-2t-14-7-10-8-12-12-10-10q-18 17-18 41 0 22 16 38l117 118q15 15 38 15 22 0 38-14l84-83q16-16 16-38zM430 292q0-22-16-38l-117-118q-16-16-38-16-22 0-38 15l-84 83q-16 16-16 38 0 22 16 38l118 118q15 15 38 15 24 0 41-17-1-1-10-10t-12-12-8-10-7-14-2-15q0-22 16-38t38-16q8 0 15 2t14 7 10 8 12 12 10 10q18-17 18-41zM941 694q0 68-48 116l-84 83q-47 47-116 47-69 0-116-48l-117-118q-47-47-47-116 0-70 50-119l-50-50q-49 50-118 50-68 0-116-48l-118-118q-48-48-48-116t48-116l84-83q47-47 116-47 69 0 116 48l117 118q47 47 47 116 0 70-50 119l50 50q49-50 118-50 68 0 116 48l118 118q48 48 48 116z"};_model.LinkMark.register("command","unset",{derive:!0,label:"Unlink",menu:{group:"inline",rank:30,display:linkIcon},active:function(){return!0}}),_model.LinkMark.register("command","set",{derive:{inverseSelect:!0,params:[{label:"Target",attr:"href"},{label:"Title",attr:"title"}]},label:"Add link",menu:{group:"inline",rank:30,display:linkIcon}}),_model.Image.register("command","insert",{derive:{params:[{label:"Image URL",attr:"src"},{label:"Description / alternative text",attr:"alt",prefill:function(pm){return(0,_command.selectedNodeAttr)(pm,this,"alt")||(0,_format.toText)(pm.doc.sliceBetween(pm.selection.from,pm.selection.to))}},{label:"Title",attr:"title"}]},label:"Insert image",menu:{group:"insert",rank:20,display:{type:"label",label:"Image"}}}),_model.BulletList.register("command","wrap",{derive:{list:!0},label:"Wrap the selection in a bullet list",menu:{group:"block",rank:40,display:{type:"icon",width:768,height:896,path:"M0 512h128v-128h-128v128zM0 256h128v-128h-128v128zM0 768h128v-128h-128v128zM256 512h512v-128h-512v128zM256 256h512v-128h-512v128zM256 768h512v-128h-512v128z"}},keys:["Alt-Right '*'","Alt-Right '-'"]}),_model.OrderedList.register("command","wrap",{derive:{list:!0},label:"Wrap the selection in an ordered list",menu:{group:"block",rank:41,display:{type:"icon",width:768,height:896,path:"M320 512h448v-128h-448v128zM320 768h448v-128h-448v128zM320 128v128h448v-128h-448zM79 384h78v-256h-36l-85 23v50l43-2v185zM189 590c0-36-12-78-96-78-33 0-64 6-83 16l1 66c21-10 42-15 67-15s32 11 32 28c0 26-30 58-110 112v50h192v-67l-91 2c49-30 87-66 87-113l1-1z"}},keys:["Alt-Right '1'"]}),_model.BlockQuote.register("command","wrap",{derive:!0,label:"Wrap the selection in a block quote",menu:{group:"block",rank:45,display:{type:"icon",width:640,height:896,path:"M0 448v256h256v-256h-128c0 0 0-128 128-128v-128c0 0-256 0-256 256zM640 320v-128c0 0-256 0-256 256v256h256v-256h-128c0 0 0-128 128-128z"}},keys:["Alt-Right '>'","Alt-Right '\"'"]}),_model.HardBreak.register("command","insert",{label:"Insert hard break",run:function(pm){var _pm$selection=pm.selection,node=_pm$selection.node,from=_pm$selection.from;return node&&node.isBlock?!1:pm.doc.path(from.path).type.isCode?pm.tr.typeText("\n").apply(pm.apply.scroll):pm.tr.replaceSelection(this.create()).apply(pm.apply.scroll)},keys:["Mod-Enter","Shift-Enter"]}),_model.ListItem.register("command","split",{label:"Split the current list item",run:function(pm){var _pm$selection2=pm.selection,from=_pm$selection2.from,to=_pm$selection2.to,node=_pm$selection2.node;if(node&&node.isBlock||from.path.length<2||!_model.Pos.samePath(from.path,to.path))return!1;var toParent=from.shorten(),grandParent=pm.doc.path(toParent.path);if(grandParent.type!=this)return!1;var nextType=to.offset==grandParent.child(toParent.offset).size?pm.schema.defaultTextblockType():null;return pm.tr["delete"](from,to).split(from,2,nextType).apply(pm.apply.scroll)},keys:["Enter(50)"]});for(var _loop=function(i){_model.Heading.registerComputed("command","make"+i,function(type){return i<=type.maxLevel?{derive:{name:"make",attrs:{level:i}},label:"Change to heading "+i,keys:["Mod-H '"+i+"'"],menu:{group:"textblockHeading",rank:30+i,display:{type:"label",label:"Level "+i},activeDisplay:"Head "+i}}:void 0})},i=1;10>=i;i++)_loop(i);_model.Paragraph.register("command","make",{derive:!0,label:"Change to paragraph",keys:["Mod-P"],menu:{group:"textblock",rank:10,display:{type:"label",label:"Plain"},activeDisplay:"Plain"}}),_model.CodeBlock.register("command","make",{derive:!0,label:"Change to code block",keys:["Mod-\\"],menu:{group:"textblock",rank:20,display:{type:"label",label:"Code"},activeDisplay:"Code"}}),_model.HorizontalRule.register("command","insert",{derive:!0,label:"Insert horizontal rule",keys:["Mod-Shift--"],menu:{group:"insert",rank:70,display:{type:"label",label:"Horizontal rule"}}})},{"../format":20,"../model":34,"./command":5}],17:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function rangeFromDOMLoose(pm){if(!hasFocus(pm))return null;var sel=window.getSelection();return new TextSelection((0,_dompos.posFromDOM)(pm,sel.anchorNode,sel.anchorOffset,!0),(0,_dompos.posFromDOM)(pm,sel.focusNode,sel.focusOffset,!0))}function hasFocus(pm){var sel=window.getSelection();return sel.rangeCount&&(0,_dom.contains)(pm.content,sel.anchorNode)}function findSelectionIn(doc,path,offset,dir,text){var node=doc.path(path);if(node.isTextblock)return new TextSelection(new _model.Pos(path,offset));for(var i=offset+(dir>0?0:-1);dir>0?i<node.size:i>=0;i+=dir){var child=node.child(i);if(!text&&null==child.type.contains&&child.type.selectable)return new NodeSelection(new _model.Pos(path,i),new _model.Pos(path,i+1),child);path.push(i);var inside=findSelectionIn(doc,path,0>dir?child.size:0,dir,text);if(inside)return inside;path.pop()}}function findSelectionFrom(doc,pos,dir,text){for(var path=pos.path.slice(),offset=pos.offset;;){var found=findSelectionIn(doc,path,offset,dir,text);if(found)return found;if(!path.length)break;offset=path.pop()+(dir>0?1:0)}}function findSelectionNear(doc,pos){var bias=arguments.length<=2||void 0===arguments[2]?1:arguments[2],text=arguments[3],result=findSelectionFrom(doc,pos,bias,text)||findSelectionFrom(doc,pos,-bias,text);return result||SelectionError("Searching for selection in invalid document "+doc),result}function findSelectionAtStart(node){var path=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],text=arguments[2];return findSelectionIn(node,path.slice(),0,1,text)}function findSelectionAtEnd(node){var path=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],text=arguments[2];return findSelectionIn(node,path.slice(),node.size,-1,text)}function verticalMotionLeavesTextblock(pm,pos,dir){for(var dom=(0,_dompos.pathToDOM)(pm.content,pos.path),coords=(0,_dompos.coordsAtPos)(pm,pos),child=dom.firstChild;child;child=child.nextSibling)if(1==child.nodeType)for(var boxes=child.getClientRects(),i=0;i<boxes.length;i++){var box=boxes[i];if(0>dir?box.bottom<coords.top:box.top>coords.bottom)return!1}return!0}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.NodeSelection=exports.TextSelection=exports.Selection=exports.SelectionState=exports.SelectionError=void 0,exports.rangeFromDOMLoose=rangeFromDOMLoose,exports.hasFocus=hasFocus,exports.findSelectionFrom=findSelectionFrom,exports.findSelectionNear=findSelectionNear,exports.findSelectionAtStart=findSelectionAtStart,exports.findSelectionAtEnd=findSelectionAtEnd,exports.verticalMotionLeavesTextblock=verticalMotionLeavesTextblock;var _model=require("../model"),_error=require("../util/error"),_dom=require("../dom"),_dompos=require("./dompos"),SelectionError=exports.SelectionError=function(_ProseMirrorError){function SelectionError(){return _classCallCheck(this,SelectionError),_possibleConstructorReturn(this,Object.getPrototypeOf(SelectionError).apply(this,arguments))}return _inherits(SelectionError,_ProseMirrorError),SelectionError}(_error.ProseMirrorError),Selection=(exports.SelectionState=function(){function SelectionState(pm,range){var _this2=this;_classCallCheck(this,SelectionState),this.pm=pm,this.range=range,this.lastNonNodePos=null,this.polling=null,this.lastAnchorNode=this.lastHeadNode=this.lastAnchorOffset=this.lastHeadOffset=null,this.lastNode=null,pm.content.addEventListener("focus",function(){return _this2.receivedFocus()}),this.poller=this.poller.bind(this)}return _createClass(SelectionState,[{key:"setAndSignal",value:function(range,clearLast){this.set(range,clearLast),this.pm.signal("selectionChange")}},{key:"set",value:function(range,clearLast){this.range=range,range.node||(this.lastNonNodePos=null),clearLast!==!1&&(this.lastAnchorNode=null)}},{key:"poller",value:function(){hasFocus(this.pm)?(this.pm.operation||this.readFromDOM(),this.polling=setTimeout(this.poller,100)):this.polling=null}},{key:"startPolling",value:function(){clearTimeout(this.polling),this.polling=setTimeout(this.poller,50)}},{key:"fastPoll",value:function(){this.startPolling()}},{key:"stopPolling",value:function(){clearTimeout(this.polling),this.polling=null}},{key:"domChanged",value:function(){var sel=window.getSelection();return sel.anchorNode!=this.lastAnchorNode||sel.anchorOffset!=this.lastAnchorOffset||sel.focusNode!=this.lastHeadNode||sel.focusOffset!=this.lastHeadOffset}},{key:"storeDOMState",value:function(){var sel=window.getSelection();this.lastAnchorNode=sel.anchorNode,this.lastAnchorOffset=sel.anchorOffset,this.lastHeadNode=sel.focusNode,this.lastHeadOffset=sel.focusOffset}},{key:"readFromDOM",value:function(){if(this.pm.input.composing||!hasFocus(this.pm)||!this.domChanged())return!1;var sel=window.getSelection(),doc=this.pm.doc,anchor=(0,_dompos.posFromDOM)(this.pm,sel.anchorNode,sel.anchorOffset),head=sel.isCollapsed?anchor:(0,_dompos.posFromDOM)(this.pm,sel.focusNode,sel.focusOffset),newRange=findSelectionNear(doc,head,this.range.head&&this.range.head.cmp(head)<0?-1:1);return newRange instanceof TextSelection&&doc.path(anchor.path).isTextblock&&(newRange=new TextSelection(anchor,newRange.head)),this.setAndSignal(newRange),newRange instanceof NodeSelection||newRange.head.cmp(head)||newRange.anchor.cmp(anchor)?this.toDOM():(this.clearNode(),this.storeDOMState()),!0}},{key:"toDOM",value:function(takeFocus){if(!hasFocus(this.pm)){if(!takeFocus)return;_dom.browser.gecko&&this.pm.content.focus()}this.range instanceof NodeSelection?this.nodeToDOM():this.rangeToDOM()}},{key:"nodeToDOM",value:function(){var dom=(0,_dompos.pathToDOM)(this.pm.content,this.range.from.toPath());dom!=this.lastNode&&(this.clearNode(),dom.classList.add("ProseMirror-selectednode"),this.pm.content.classList.add("ProseMirror-nodeselection"),this.lastNode=dom);var range=document.createRange(),sel=window.getSelection();range.selectNode(dom),sel.removeAllRanges(),sel.addRange(range),this.storeDOMState()}},{key:"rangeToDOM",value:function(){this.clearNode();var anchor=(0,_dompos.DOMFromPos)(this.pm.content,this.range.anchor),head=(0,_dompos.DOMFromPos)(this.pm.content,this.range.head),sel=window.getSelection(),range=document.createRange();if(sel.extend)range.setEnd(anchor.node,anchor.offset),range.collapse(!1);else{if(this.range.anchor.cmp(this.range.head)>0){var tmp=anchor;anchor=head,head=tmp}range.setEnd(head.node,head.offset),range.setStart(anchor.node,anchor.offset)}sel.removeAllRanges(),sel.addRange(range),sel.extend&&sel.extend(head.node,head.offset),this.storeDOMState()}},{key:"clearNode",value:function(){return this.lastNode?(this.lastNode.classList.remove("ProseMirror-selectednode"),this.pm.content.classList.remove("ProseMirror-nodeselection"),this.lastNode=null,!0):void 0}},{key:"receivedFocus",value:function(){null==this.polling&&this.startPolling()}}]),SelectionState}(),exports.Selection=function Selection(){_classCallCheck(this,Selection)}),TextSelection=exports.TextSelection=function(_Selection){function TextSelection(anchor,head){_classCallCheck(this,TextSelection);var _this3=_possibleConstructorReturn(this,Object.getPrototypeOf(TextSelection).call(this));return _this3.anchor=anchor,_this3.head=head||anchor,_this3}return _inherits(TextSelection,_Selection),_createClass(TextSelection,[{key:"eq",value:function(other){return other instanceof TextSelection&&!other.head.cmp(this.head)&&!other.anchor.cmp(this.anchor)}},{key:"map",value:function(doc,mapping){var head=mapping.map(this.head).pos;if(!doc.path(head.path).isTextblock)return findSelectionNear(doc,head);var anchor=mapping.map(this.anchor).pos;return new TextSelection(doc.path(anchor.path).isTextblock?anchor:head,head)}},{key:"inverted",get:function(){return this.anchor.cmp(this.head)>0}},{key:"from",get:function(){return this.inverted?this.head:this.anchor}},{key:"to",get:function(){return this.inverted?this.anchor:this.head}},{key:"empty",get:function(){return 0==this.anchor.cmp(this.head)}}]),TextSelection}(Selection),NodeSelection=exports.NodeSelection=function(_Selection2){function NodeSelection(from,to,node){_classCallCheck(this,NodeSelection);var _this4=_possibleConstructorReturn(this,Object.getPrototypeOf(NodeSelection).call(this));return _this4.from=from,_this4.to=to,_this4.node=node,_this4}return _inherits(NodeSelection,_Selection2),_createClass(NodeSelection,[{key:"eq",value:function(other){return other instanceof NodeSelection&&!this.from.cmp(other.from)}},{key:"map",value:function(doc,mapping){var from=mapping.map(this.from,1).pos,to=mapping.map(this.to,-1).pos;if(_model.Pos.samePath(from.path,to.path)&&from.offset==to.offset-1){var node=doc.nodeAfter(from);if(node.type.selectable)return new NodeSelection(from,to,node)}return findSelectionNear(doc,from)}},{key:"empty",get:function(){return!1}}]),NodeSelection}(Selection)},{"../dom":1,"../model":34,"../util/error":52,"./dompos":8}],18:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function fromDOM(schema,dom,options){options||(options={});var context=new DOMParseState(schema,options.topNode||schema.node("doc"),options),start=options.from?dom.childNodes[options.from]:dom.firstChild,end=null!=options.to&&dom.childNodes[options.to]||null;context.addAll(start,end,!0);var doc=void 0;do doc=context.leave();while(context.stack.length);return doc}function fromHTML(schema,html,options){var wrap=(options&&options.document||window.document).createElement("div");return wrap.innerHTML=html,fromDOM(schema,wrap,options)}function parseStyles(style){for(var re=/\s*([\w-]+)\s*:\s*([^;]+)/g,m=void 0,result=[];m=re.exec(style);)result.push(m[1],m[2].trim());return result}function schemaInfo(schema){return schema.cached.parseDOMInfo||(schema.cached.parseDOMInfo=summarizeSchemaInfo(schema))}function summarizeSchemaInfo(schema){var tags=Object.create(null),styles=Object.create(null);return tags._=[],schema.registry("parseDOM",function(tag,info,type){var parse=info.parse;"block"==parse?parse=function(dom,state){state.wrapIn(dom,this)}:"mark"==parse&&(parse=function(dom,state){state.wrapMark(dom,this)}),(0,_sortedinsert2["default"])(tags[tag]||(tags[tag]=[]),{type:type,parse:parse,rank:null==info.rank?50:info.rank},function(a,b){return a.rank-b.rank})}),schema.registry("parseDOMStyle",function(style,info,type){(0,_sortedinsert2["default"])(styles[style]||(styles[style]=[]),{type:type,parse:info.parse,rank:null==info.rank?50:info.rank},function(a,b){return a.rank-b.rank})}),{tags:tags,styles:styles}}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.fromDOM=fromDOM,exports.fromHTML=fromHTML;var _model=require("../model"),_sortedinsert=require("../util/sortedinsert"),_sortedinsert2=_interopRequireDefault(_sortedinsert),_register=require("./register");(0,_register.defineSource)("dom",fromDOM),(0,_register.defineSource)("html",fromHTML);var blockElements={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},ignoreElements={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},noMarks=[],DOMParseState=function(){function DOMParseState(schema,topNode,options){_classCallCheck(this,DOMParseState),this.options=options||{},this.schema=schema,this.stack=[],this.marks=noMarks,this.closing=!1,this.enter(topNode.type,topNode.attrs);var info=schemaInfo(schema);this.tagInfo=info.tags,this.styleInfo=info.styles}return _createClass(DOMParseState,[{key:"addDOM",value:function(dom){if(3==dom.nodeType){var value=dom.nodeValue,top=this.top,last=void 0;(/\S/.test(value)||top.type.isTextblock)&&(this.options.preserveWhitespace||(value=value.replace(/\s+/g," "),/^\s/.test(value)&&(!(last=top.content[top.content.length-1])||"text"==last.type.name&&/\s$/.test(last.text))&&(value=value.slice(1))),value&&this.insertNode(this.schema.text(value,this.marks)))}else if(1!=dom.nodeType||dom.hasAttribute("pm-ignore"));else{var style=dom.getAttribute("style");style?this.addElementWithStyles(parseStyles(style),dom):this.addElement(dom)}}},{key:"addElement",value:function(dom){var name=dom.nodeName.toLowerCase();this.parseNodeType(name,dom)||ignoreElements.hasOwnProperty(name)||(this.addAll(dom.firstChild,null),blockElements.hasOwnProperty(name)&&this.top.type==this.schema.defaultTextblockType()&&(this.closing=!0))}},{key:"addElementWithStyles",value:function(styles,dom){for(var _this=this,wrappers=[],i=0;i<styles.length;i+=2){var parsers=this.styleInfo[styles[i]],value=styles[i+1];if(parsers)for(var j=0;j<parsers.length;j++)wrappers.push(parsers[j],value)}var next=function next(i){if(i==wrappers.length)_this.addElement(dom);else{var parser=wrappers[i];parser.parse.call(parser.type,wrappers[i+1],_this,next.bind(null,i+2))}};next(0)}},{key:"tryParsers",value:function(parsers,dom){if(parsers)for(var i=0;i<parsers.length;i++){var parser=parsers[i];if(parser.parse.call(parser.type,dom,this)!==!1)return!0}}},{key:"parseNodeType",value:function(name,dom){return this.tryParsers(this.tagInfo[name],dom)||this.tryParsers(this.tagInfo._,dom)}},{key:"addAll",value:function(from,to,sync){for(var stack=sync&&this.stack.slice(),dom=from;dom!=to;dom=dom.nextSibling)this.addDOM(dom),sync&&blockElements.hasOwnProperty(dom.nodeName.toLowerCase())&&this.sync(stack)}},{key:"doClose",value:function(){if(this.closing&&!(this.stack.length<2)){var left=this.leave();this.enter(left.type,left.attrs),this.closing=!1}}},{key:"insertNode",value:function(node){if(this.top.type.canContain(node))this.doClose();else for(var i=this.stack.length-1;i>=0;i--){var route=this.stack[i].type.findConnection(node.type);if(route){if(i==this.stack.length-1)this.doClose();else for(;this.stack.length>i+1;)this.leave();for(var j=0;j<route.length;j++)this.enter(route[j]);this.marks.length&&(this.marks=noMarks);break}}return this.top.content.push(node),node}},{key:"insert",value:function(type,attrs,content){return this.insertNode(type.createAutoFill(attrs,content,this.marks))}},{key:"enter",value:function(type,attrs){this.stack.push({type:type,attrs:attrs,content:[]})}},{key:"leave",value:function(){this.marks.length&&(this.marks=noMarks);var top=this.stack.pop(),last=top.content[top.content.length-1];!this.options.preserveWhitespace&&last&&last.isText&&/\s$/.test(last.text)&&(top.content[top.content.length-1]=last.copy(last.text.slice(0,last.text.length-1)));var node=top.type.createAutoFill(top.attrs,top.content);return this.stack.length&&this.insertNode(node),node}},{key:"sync",value:function(stack){for(;this.stack.length>stack.length;)this.leave();for(;;){var n=this.stack.length-1,one=this.stack[n],two=stack[n];if(one.type==two.type&&_model.Node.sameAttrs(one.attrs,two.attrs))break;this.leave()}for(;stack.length>this.stack.length;){var add=stack[this.stack.length];this.enter(add.type,add.attrs)}this.marks.length&&(this.marks=noMarks),this.closing=!1}},{key:"wrapIn",value:function(dom,type,attrs){this.enter(type,attrs),this.addAll(dom.firstChild,null,!0),this.leave()}},{key:"wrapMark",value:function(inner,mark){var old=this.marks;this.marks=(mark.instance||mark).addToSet(old),inner.call?inner():this.addAll(inner.firstChild,null),this.marks=old}},{key:"top",get:function(){return this.stack[this.stack.length-1]}}]),DOMParseState}();_model.Paragraph.register("parseDOM","p",{parse:"block"}),_model.BlockQuote.register("parseDOM","blockquote",{parse:"block"});for(var _loop=function(i){_model.Heading.registerComputed("parseDOM","h"+i,function(type){return i<=type.maxLevel?{parse:function(dom,state){state.wrapIn(dom,this,{level:i})}}:void 0})},i=1;6>=i;i++)_loop(i);_model.HorizontalRule.register("parseDOM","hr",{parse:"block"}),_model.CodeBlock.register("parseDOM","pre",{parse:function(dom,state){var params=dom.firstChild&&/^code$/i.test(dom.firstChild.nodeName)&&dom.firstChild.getAttribute("class");if(params&&/fence/.test(params)){for(var found=[],re=/(?:^|\s)lang-(\S+)/g,m=void 0;m=re.exec(params);)found.push(m[1]);params=found.join(" ")}else params=null;var text=dom.textContent;state.insert(this,{params:params},text?[state.schema.text(text)]:[])}}),_model.BulletList.register("parseDOM","ul",{parse:"block"}),_model.OrderedList.register("parseDOM","ol",{parse:function(dom,state){var attrs={order:dom.getAttribute("start")||1};state.wrapIn(dom,this,attrs)}}),_model.ListItem.register("parseDOM","li",{parse:"block"}),_model.HardBreak.register("parseDOM","br",{parse:function(_,state){state.insert(this)}}),_model.Image.register("parseDOM","img",{parse:function(dom,state){state.insert(this,{src:dom.getAttribute("src"),title:dom.getAttribute("title")||null,alt:dom.getAttribute("alt")||null})}}),_model.LinkMark.register("parseDOM","a",{parse:function(dom,state){var href=dom.getAttribute("href");return href?void state.wrapMark(dom,this.create({href:href,title:dom.getAttribute("title")})):!1}}),_model.EmMark.register("parseDOM","i",{parse:"mark"}),_model.EmMark.register("parseDOM","em",{parse:"mark"}),_model.StrongMark.register("parseDOMStyle","font-style",{parse:function(value,state,inner){"italic"==value?state.wrapMark(inner,this):inner()}}),_model.StrongMark.register("parseDOM","b",{parse:"mark"}),_model.StrongMark.register("parseDOM","strong",{parse:"mark"}),_model.StrongMark.register("parseDOMStyle","font-weight",{parse:function(value,state,inner){"bold"==value||"bolder"==value||!/\D/.test(value)&&+value>=500?state.wrapMark(inner,this):inner()}}),_model.CodeMark.register("parseDOM","code",{parse:"mark"})},{"../model":34,"../util/sortedinsert":56,"./register":21}],19:[function(require,module,exports){"use strict";function fromText(schema,text){for(var blocks=text.trim().split(/\n{2,}/),nodes=[],i=0;i<blocks.length;i++){for(var spans=[],parts=blocks[i].split("\n"),j=0;j<parts.length;j++)j&&spans.push(schema.node("hard_break")),parts[j]&&spans.push(schema.text(parts[j]));nodes.push(schema.node("paragraph",null,spans))}return nodes.length||nodes.push(schema.node("paragraph")),schema.node("doc",null,nodes)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.fromText=fromText;var _register=require("./register");(0,_register.defineSource)("text",fromText)},{"./register":21}],20:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _register=require("./register");Object.defineProperty(exports,"serializeTo",{enumerable:!0,get:function(){return _register.serializeTo}}),Object.defineProperty(exports,"knownTarget",{enumerable:!0,get:function(){return _register.knownTarget}}),Object.defineProperty(exports,"defineTarget",{enumerable:!0,get:function(){return _register.defineTarget}}),Object.defineProperty(exports,"parseFrom",{enumerable:!0,get:function(){return _register.parseFrom}}),Object.defineProperty(exports,"knownSource",{enumerable:!0,get:function(){return _register.knownSource}}),Object.defineProperty(exports,"defineSource",{enumerable:!0,get:function(){return _register.defineSource}});var _from_dom=require("./from_dom");Object.defineProperty(exports,"fromDOM",{enumerable:!0,get:function(){return _from_dom.fromDOM}}),Object.defineProperty(exports,"fromHTML",{enumerable:!0,get:function(){return _from_dom.fromHTML}});var _to_dom=require("./to_dom");Object.defineProperty(exports,"toDOM",{enumerable:!0,get:function(){return _to_dom.toDOM}}),Object.defineProperty(exports,"toHTML",{enumerable:!0,get:function(){return _to_dom.toHTML}}),Object.defineProperty(exports,"nodeToDOM",{enumerable:!0,get:function(){return _to_dom.nodeToDOM}});var _from_text=require("./from_text");Object.defineProperty(exports,"fromText",{enumerable:!0,get:function(){return _from_text.fromText}});var _to_text=require("./to_text");Object.defineProperty(exports,"toText",{enumerable:!0,get:function(){return _to_text.toText}})},{"./from_dom":18,"./from_text":19,"./register":21,"./to_dom":22,"./to_text":23}],21:[function(require,module,exports){"use strict";function serializeTo(doc,format,options){var converter=serializers[format];return converter||_error.NamespaceError.raise("Target format "+format+" not defined"),converter(doc,options)}function knownTarget(format){return!!serializers[format]}function defineTarget(format,func){serializers[format]=func}function parseFrom(schema,value,format,options){var converter=parsers[format];return converter||_error.NamespaceError.raise("Source format "+format+" not defined"),converter(schema,value,options)}function knownSource(format){return!!parsers[format]}function defineSource(format,func){parsers[format]=func}Object.defineProperty(exports,"__esModule",{value:!0}),exports.serializeTo=serializeTo,exports.knownTarget=knownTarget,exports.defineTarget=defineTarget,exports.parseFrom=parseFrom,exports.knownSource=knownSource,exports.defineSource=defineSource;var _error=require("../util/error"),serializers=Object.create(null);defineTarget("json",function(doc){return doc.toJSON()});var parsers=Object.create(null);defineSource("json",function(schema,json){return schema.nodeFromJSON(json)})},{"../util/error":52}],22:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function toDOM(node,options){return new DOMSerializer(options).renderContent(node)}function nodeToDOM(node,options,offset){var serializer=new DOMSerializer(options),dom=serializer.renderNode(node,offset);return node.isInline&&(dom=serializer.wrapInlineFlat(dom,node.marks),serializer.options.renderInlineFlat&&(dom=options.renderInlineFlat(node,dom,offset)||dom)),dom}function toHTML(node,options){var serializer=new DOMSerializer(options),wrap=serializer.elt("div");return wrap.appendChild(serializer.renderContent(node)),wrap.innerHTML}function def(cls,method){cls.prototype.serializeDOM=method}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.toDOM=toDOM,exports.nodeToDOM=nodeToDOM,exports.toHTML=toHTML;var _model=require("../model"),_register=require("./register"),DOMSerializer=function(){function DOMSerializer(options){_classCallCheck(this,DOMSerializer),this.options=options||{},this.doc=this.options.document||window.document}return _createClass(DOMSerializer,[{key:"elt",value:function(type,attrs){var result=this.doc.createElement(type);if(attrs)for(var name in attrs)"style"==name?result.style.cssText=attrs[name]:attrs[name]&&result.setAttribute(name,attrs[name]);for(var _len=arguments.length,content=Array(_len>2?_len-2:0),_key=2;_len>_key;_key++)content[_key-2]=arguments[_key];for(var i=0;i<content.length;i++)result.appendChild("string"==typeof content[i]?this.doc.createTextNode(content[i]):content[i]);return result}},{key:"renderNode",value:function(node,offset){var dom=node.type.serializeDOM(node,this);return this.options.onRender&&(dom=this.options.onRender(node,dom,offset)||dom),dom}},{key:"renderContent",value:function(node,where){return where||(where=this.doc.createDocumentFragment()),node.isTextblock?this.options.renderInlineFlat?this.renderInlineFlatInto(node,where):this.renderInlineInto(node,where):this.renderBlocksInto(node,where),where}},{key:"renderBlocksInto",value:function(parent,where){for(var child,i=parent.iter();child=i.next().value;)this.options.path&&this.options.path.push(i.offset-child.width),where.appendChild(this.renderNode(child,i.offset-child.width)),this.options.path&&this.options.path.pop()}},{key:"renderInlineInto",value:function(parent,where){var _this=this,top=where,active=[];parent.forEach(function(node,offset){for(var keep=0;keep<Math.min(active.length,node.marks.length)&&node.marks[keep].eq(active[keep]);++keep);for(;keep<active.length;)active.pop(),top=top.parentNode;for(;active.length<node.marks.length;){var add=node.marks[active.length];active.push(add),top=top.appendChild(_this.renderMark(add))}top.appendChild(_this.renderNode(node,offset))})}},{key:"renderInlineFlatInto",value:function(parent,where){var _this2=this;parent.forEach(function(node,start){var dom=_this2.renderNode(node,start);dom=_this2.wrapInlineFlat(dom,node.marks),dom=_this2.options.renderInlineFlat(node,dom,start)||dom,where.appendChild(dom)})}},{key:"renderMark",value:function(mark){return mark.type.serializeDOM(mark,this)}},{key:"wrapInlineFlat",value:function(dom,marks){for(var i=marks.length-1;i>=0;i--){var wrap=this.renderMark(marks[i]);wrap.appendChild(dom),dom=wrap}return dom}},{key:"renderAs",value:function(node,tagName,tagAttrs){
var dom=this.renderContent(node,this.elt(tagName,tagAttrs));return this.options.onContainer&&this.options.onContainer(dom),dom}}]),DOMSerializer}();(0,_register.defineTarget)("dom",toDOM),(0,_register.defineTarget)("html",toHTML),def(_model.BlockQuote,function(node,s){return s.renderAs(node,"blockquote")}),_model.BlockQuote.prototype.countCoordsAsChild=function(_,path,dom,coords){var childBox=dom.firstChild.getBoundingClientRect();return coords.left<childBox.left-2?_model.Pos.from(path):void 0},def(_model.BulletList,function(node,s){return s.renderAs(node,"ul")}),def(_model.OrderedList,function(node,s){return s.renderAs(node,"ol",{start:"1"!=node.attrs.order&&node.attrs.order})}),_model.OrderedList.prototype.countCoordsAsChild=_model.BulletList.prototype.countCoordsAsChild=function(_,path,dom,coords){for(var i=0;i<dom.childNodes.length;i++){var child=dom.childNodes[i];if(child.hasAttribute("pm-offset")){var childBox=child.getBoundingClientRect();if(coords.left>childBox.left-2)return null;if(childBox.top<=coords.top&&childBox.bottom>=coords.top)return new _model.Pos(path,i)}}},def(_model.ListItem,function(node,s){return s.renderAs(node,"li")}),def(_model.HorizontalRule,function(_,s){return s.elt("hr")}),def(_model.Paragraph,function(node,s){return s.renderAs(node,"p")}),def(_model.Heading,function(node,s){return s.renderAs(node,"h"+node.attrs.level)}),def(_model.CodeBlock,function(node,s){var code=s.renderAs(node,"code");return null!=node.attrs.params&&(code.className="fence "+node.attrs.params.replace(/(^|\s+)/g,"$&lang-")),s.elt("pre",null,code)}),def(_model.Text,function(node,s){return s.doc.createTextNode(node.text)}),def(_model.Image,function(node,s){return s.elt("img",{src:node.attrs.src,alt:node.attrs.alt,title:node.attrs.title})}),def(_model.HardBreak,function(_,s){return s.elt("br")}),def(_model.EmMark,function(_,s){return s.elt("em")}),def(_model.StrongMark,function(_,s){return s.elt("strong")}),def(_model.CodeMark,function(_,s){return s.elt("code")}),def(_model.LinkMark,function(mark,s){return s.elt("a",{href:mark.attrs.href,title:mark.attrs.title})})},{"../model":34,"./register":21}],23:[function(require,module,exports){"use strict";function toText(doc){return doc.type.serializeText(doc).trim()}Object.defineProperty(exports,"__esModule",{value:!0}),exports.toText=toText;var _model=require("../model"),_register=require("./register");_model.Block.prototype.serializeText=function(node){var accum="";return node.forEach(function(child){return accum+=child.type.serializeText(child)}),accum},_model.Textblock.prototype.serializeText=function(node){var text=_model.Block.prototype.serializeText(node);return text&&text+"\n\n"},_model.Inline.prototype.serializeText=function(){return""},_model.HardBreak.prototype.serializeText=function(){return"\n"},_model.Text.prototype.serializeText=function(node){return node.text},(0,_register.defineTarget)("text",toText)},{"../model":34,"./register":21}],24:[function(require,module,exports){"use strict";function wrapAndJoin(pm,pos,type){var attrs=arguments.length<=3||void 0===arguments[3]?null:arguments[3],predicate=arguments.length<=4||void 0===arguments[4]?null:arguments[4],before=pos.shorten(),sibling=before.offset>0&&pm.doc.path(before.path).child(before.offset-1),join=sibling&&sibling.type.name==type&&(!predicate||predicate(sibling)),tr=pm.tr.wrap(pos,pos,type,attrs),delPos=tr.map(pos).pos;tr["delete"](new _model.Pos(delPos.path,0),delPos),join&&tr.join(before),tr.apply()}function setAs(pm,pos,type,attrs){pm.tr.setBlockType(pos,pos,type,attrs)["delete"](new _model.Pos(pos.path,0),pos).apply()}Object.defineProperty(exports,"__esModule",{value:!0}),exports.autoInputRules=void 0;var _model=require("../model"),_edit=require("../edit"),_inputrules=require("./inputrules"),autoInputRules=exports.autoInputRules=Object.create(null);(0,_edit.defineOption)("autoInput",!1,function(pm,val){pm.mod.autoInput&&(pm.mod.autoInput.forEach(function(rule){return(0,_inputrules.removeInputRule)(pm,rule)}),pm.mod.autoInput=null),val&&!function(){val===!0&&(val=["schema",autoInputRules]);var rules=Object.create(null),list=pm.mod.autoInput=[];val.forEach(function(spec){if("schema"===spec)pm.schema.registry("autoInput",function(name,rule,type,typeName){var rname=typeName+":"+name,handler=rule.handler;handler.bind&&(handler=handler.bind(type)),rules[rname]=new _inputrules.InputRule(rule.match,rule.filter,handler)});else for(var name in spec){var _val=spec[name];null==_val?delete rules[name]:rules[name]=_val}});for(var name in rules)(0,_inputrules.addInputRule)(pm,rules[name]),list.push(rules[name])}()}),autoInputRules.emDash=new _inputrules.InputRule(/--$/,"-","—"),autoInputRules.openDoubleQuote=new _inputrules.InputRule(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,'"',"“"),autoInputRules.closeDoubleQuote=new _inputrules.InputRule(/"$/,'"',"”"),autoInputRules.openSingleQuote=new _inputrules.InputRule(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"'","‘"),autoInputRules.closeSingleQuote=new _inputrules.InputRule(/'$/,"'","’"),_model.BlockQuote.register("autoInput","startBlockQuote",new _inputrules.InputRule(/^\s*> $/," ",function(pm,_,pos){wrapAndJoin(pm,pos,this)})),_model.OrderedList.register("autoInput","startOrderedList",new _inputrules.InputRule(/^(\d+)\. $/," ",function(pm,match,pos){var order=+match[1];wrapAndJoin(pm,pos,this,{order:order||null},function(node){return node.size+(node.attrs.order||1)==order})})),_model.BulletList.register("autoInput","startBulletList",new _inputrules.InputRule(/^\s*([-+*]) $/," ",function(pm,match,pos){var bullet=match[1];wrapAndJoin(pm,pos,this,null,function(node){return node.attrs.bullet==bullet})})),_model.CodeBlock.register("autoInput","startCodeBlock",new _inputrules.InputRule(/^```$/,"`",function(pm,_,pos){setAs(pm,pos,this,{params:""})})),_model.Heading.registerComputed("autoInput","startHeading",function(type){var re=new RegExp("^(#{1,"+type.maxLevel+"}) $");return new _inputrules.InputRule(re," ",function(pm,match,pos){setAs(pm,pos,this,{level:match[1].length})})})},{"../edit":11,"../model":34,"./inputrules":25}],25:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function addInputRule(pm,rule){pm.mod.interpretInput||(pm.mod.interpretInput=new InputRules(pm)),pm.mod.interpretInput.addRule(rule)}function removeInputRule(pm,rule){var ii=pm.mod.interpretInput;ii&&(ii.removeRule(rule),0==ii.rules.length&&(ii.unregister(),pm.mod.interpretInput=null))}function getContext(doc,pos){for(var child,parent=doc.path(pos.path),isCode=parent.type.isCode,textBefore="",i=parent.iter(0,pos.offset);child=i.next().value;)child.isText?textBefore+=child.text:textBefore="",i.atEnd()&&child.marks.some(function(st){return st.type.isCode})&&(isCode=!0);return{textBefore:textBefore,isCode:isCode}}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.InputRule=void 0,exports.addInputRule=addInputRule,exports.removeInputRule=removeInputRule;var _model=require("../model"),_edit=require("../edit"),InputRules=(exports.InputRule=function InputRule(match,filter,handler){_classCallCheck(this,InputRule),this.filter=filter,this.match=match,this.handler=handler},function(){function InputRules(pm){var _this=this;_classCallCheck(this,InputRules),this.pm=pm,this.rules=[],this.cancelVersion=null,pm.on("selectionChange",this.onSelChange=function(){return _this.cancelVersion=null}),pm.on("textInput",this.onTextInput=this.onTextInput.bind(this)),pm.addKeymap(new _edit.Keymap({Backspace:function(pm){return _this.backspace(pm)}},{name:"inputRules"}),20)}return _createClass(InputRules,[{key:"unregister",value:function(){this.pm.off("selectionChange",this.onSelChange),this.pm.off("textInput",this.onTextInput),this.pm.removeKeymap("inputRules")}},{key:"addRule",value:function(rule){this.rules.push(rule)}},{key:"removeRule",value:function(rule){var found=this.rules.indexOf(rule);return found>-1?(this.rules.splice(found,1),!0):void 0}},{key:"onTextInput",value:function(text){var pos=this.pm.selection.head;if(pos)for(var textBefore=void 0,isCode=void 0,lastCh=text[text.length-1],i=0;i<this.rules.length;i++){var rule=this.rules[i],match=void 0;if(!rule.filter||rule.filter==lastCh){if(null==textBefore){var _getContext=getContext(this.pm.doc,pos);if(textBefore=_getContext.textBefore,isCode=_getContext.isCode)return}if(match=rule.match.exec(textBefore)){var startVersion=this.pm.history.getVersion();if("string"==typeof rule.handler){var offset=pos.offset-(match[1]||match[0]).length,start=new _model.Pos(pos.path,offset),marks=this.pm.doc.marksAt(pos);this.pm.tr["delete"](start,pos).insert(start,this.pm.schema.text(rule.handler,marks)).apply()}else rule.handler(this.pm,match,pos);return void(this.cancelVersion=startVersion)}}}}},{key:"backspace",value:function(){return this.cancelVersion?(this.pm.history.backToVersion(this.cancelVersion),void(this.cancelVersion=null)):!1}}]),InputRules}())},{"../edit":11,"../model":34}],26:[function(require,module,exports){"use strict";function getIcon(name,data){var node=document.createElement("div");if(node.className=prefix,data.path){svgBuilt[name]||buildSVG(name,data);var svg=node.appendChild(document.createElementNS(SVG,"svg"));svg.style.width=data.width/data.height+"em";var use=svg.appendChild(document.createElementNS(SVG,"use"));use.setAttributeNS(XLINK,"href","#pm-icon-"+name)}else node.appendChild(document.createElement("span")).textContent=data.text||"",data.css&&(node.firstChild.style.cssText=data.css);return node}function buildSVG(name,data){svgCollection||(svgCollection=document.createElementNS(SVG,"svg"),svgCollection.style.display="none",document.body.insertBefore(svgCollection,document.body.firstChild));var sym=document.createElementNS(SVG,"symbol");sym.id="pm-icon-"+name,sym.setAttribute("viewBox","0 0 "+data.width+" "+data.height);var path=sym.appendChild(document.createElementNS(SVG,"path"));path.setAttribute("d",data.path),svgCollection.appendChild(sym),svgBuilt[name]=!0}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getIcon=getIcon;var _dom=require("../dom"),svgCollection=null,svgBuilt=Object.create(null),SVG="http://www.w3.org/2000/svg",XLINK="http://www.w3.org/1999/xlink",prefix="ProseMirror-icon";(0,_dom.insertCSS)("\n."+prefix+" {\n  display: inline-block;\n  line-height: .8;\n  vertical-align: -2px; /* Compensate for padding */\n  padding: 2px 8px;\n  cursor: pointer;\n}\n\n."+prefix+" svg {\n  fill: currentColor;\n  height: 1em;\n}\n\n."+prefix+" span {\n  vertical-align: text-top;\n}")},{"../dom":1}],27:[function(require,module,exports){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function title(pm,command){if(!command.label)return null;var key=command.name&&pm.keyForCommand(command.name);return key?command.label+" ("+key+")":command.label}function renderDropdownItems(items,pm){for(var rendered=[],i=0;i<items.length;i++){var inner=items[i].render(pm);inner&&rendered.push((0,_dom.elt)("div",{"class":prefix+"-dropdown-item"},inner))}return rendered.length||rendered.push((0,_dom.elt)("div",{"class":prefix+"-dropdown-empty"},"(empty)")),rendered}function resolveGroup(pm,content){for(var result=void 0,isArray=Array.isArray(content),i=0;i<(isArray?content.length:1);i++){var cur=isArray?content[i]:content;if(cur instanceof MenuCommandGroup){var elts=cur.get(pm);if(!isArray||1==content.length)return elts;result=(result||content.slice(0,i)).concat(elts)}else result&&result.push(cur)}return result||(isArray?content:[content])}function renderGrouped(pm,content){for(var result=document.createDocumentFragment(),needSep=!1,i=0;i<content.length;i++){for(var items=resolveGroup(pm,content[i]),added=!1,j=0;j<items.length;j++){var rendered=items[j].render(pm);rendered&&(!added&&needSep&&result.appendChild(separator()),result.appendChild((0,_dom.elt)("span",{"class":prefix+"item"},rendered)),added=!0)}added&&(needSep=!0)}return result}function separator(){return(0,_dom.elt)("span",{"class":prefix+"separator"})}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.historyGroup=exports.blockGroup=exports.textblockMenu=exports.insertMenu=exports.inlineGroup=exports.DropdownSubmenu=exports.Dropdown=exports.MenuCommandGroup=exports.MenuCommand=void 0,exports.resolveGroup=resolveGroup,exports.renderGrouped=renderGrouped;var _dom=require("../dom"),_sortedinsert=require("../util/sortedinsert"),_sortedinsert2=_interopRequireDefault(_sortedinsert),_obj=require("../util/obj"),_error=require("../util/error"),_icons=require("./icons"),prefix="ProseMirror-menu",MenuCommand=exports.MenuCommand=function(){function MenuCommand(command,options){_classCallCheck(this,MenuCommand),this.command_=command,this.options=options}return _createClass(MenuCommand,[{key:"command",value:function(pm){return"string"==typeof this.command_?pm.commands[this.command_]:this.command_}},{key:"render",value:function(pm){var cmd=this.command(pm),disabled=!1;if(cmd){if("ignore"!=this.options.select&&!cmd.select(pm)){if(null==this.options.select||"hide"==this.options.select)return null;"disable"==this.options.select&&(disabled=!0)}var disp=this.options.display;disp||_error.AssertionError.raise("No display style defined for menu command "+cmd.name);var dom=void 0;return disp.render?dom=disp.render(cmd,pm):"icon"==disp.type?(dom=(0,_icons.getIcon)(cmd.name,disp),!disabled&&cmd.active(pm)&&dom.classList.add(prefix+"-active")):"label"==disp.type?dom=(0,_dom.elt)("div",null,disp.label||cmd.spec.label):_error.AssertionError.raise("Unsupported command display style: "+disp.type),dom.setAttribute("title",title(pm,cmd)),this.options["class"]&&dom.classList.add(this.options["class"]),disabled&&dom.classList.add(prefix+"-disabled"),this.options.css&&(dom.style.cssText+=this.options.css),dom.addEventListener("mousedown",function(e){e.preventDefault(),e.stopPropagation(),pm.signal("interaction"),cmd.exec(pm,null,dom)}),dom}}}]),MenuCommand}(),MenuCommandGroup=exports.MenuCommandGroup=function(){function MenuCommandGroup(name,options){_classCallCheck(this,MenuCommandGroup),this.name=name,this.options=options}return _createClass(MenuCommandGroup,[{key:"collect",value:function(pm){var _this=this,result=[];for(var name in pm.commands){var cmd=pm.commands[name],spec=cmd.spec.menu;spec&&spec.group==this.name&&(0,_sortedinsert2["default"])(result,{cmd:cmd,rank:null==spec.rank?50:spec.rank},function(a,b){return a.rank-b.rank})}return result.map(function(o){var spec=o.cmd.spec.menu;return _this.options&&(spec=(0,_obj.copyObj)(_this.options,(0,_obj.copyObj)(spec))),new MenuCommand(o.cmd,spec)})}},{key:"get",value:function(pm){var groups=pm.mod.menuGroups||this.startGroups(pm);return groups[this.name]||(groups[this.name]=this.collect(pm))}},{key:"startGroups",value:function(pm){var clear=function clear(){pm.mod.menuGroups=null,pm.off("commandsChanging",clear)};return pm.on("commandsChanging",clear),pm.mod.menuGroups=Object.create(null)}}]),MenuCommandGroup}(),Dropdown=exports.Dropdown=function(){function Dropdown(options,content){_classCallCheck(this,Dropdown),this.options=options||{},this.content=content}return _createClass(Dropdown,[{key:"render",value:function(pm){var _this2=this;if(0!=resolveGroup(pm,this.content).length){var label=this.options.activeLabel&&this.findActiveIn(this,pm)||this.options.label,dom=(0,_dom.elt)("div",{"class":prefix+"-dropdown "+(this.options["class"]||""),style:this.options.css,title:this.options.title},label),open=null;return dom.addEventListener("mousedown",function(e){e.preventDefault(),e.stopPropagation(),open=open&&open()?null:_this2.expand(pm,dom)}),dom}}},{key:"expand",value:function(pm,dom){function finish(){return done?void 0:(done=!0,pm.off("interaction",finish),pm.wrapper.removeChild(menuDOM),!0)}var rendered=renderDropdownItems(resolveGroup(pm,this.content),pm),box=dom.getBoundingClientRect(),outer=pm.wrapper.getBoundingClientRect(),menuDOM=(0,_dom.elt)("div",{"class":prefix+"-dropdown-menu "+(this.options["class"]||""),style:"left: "+(box.left-outer.left)+"px; top: "+(box.bottom-outer.top)+"px"},rendered),done=!1;return pm.signal("interaction"),pm.wrapper.appendChild(menuDOM),pm.on("interaction",finish),finish}},{key:"findActiveIn",value:function(element,pm){for(var items=resolveGroup(pm,element.content),i=0;i<items.length;i++){var cur=items[i];if(cur instanceof MenuCommand){var active=cur.command(pm).active(pm);if(active)return cur.options.activeLabel}else if(cur instanceof DropdownSubmenu){var found=this.findActiveIn(cur,pm);if(found)return found}}}}]),Dropdown}(),DropdownSubmenu=exports.DropdownSubmenu=function(){function DropdownSubmenu(options,content){_classCallCheck(this,DropdownSubmenu),this.options=options||{},this.content=content}return _createClass(DropdownSubmenu,[{key:"render",value:function(pm){var items=resolveGroup(pm,this.content);if(items.length){var label=(0,_dom.elt)("div",{"class":prefix+"-submenu-label"},this.options.label),wrap=(0,_dom.elt)("div",{"class":prefix+"-submenu-wrap"},label,(0,_dom.elt)("div",{"class":prefix+"-submenu"},renderDropdownItems(items,pm)));return label.addEventListener("mousedown",function(e){e.preventDefault(),e.stopPropagation(),wrap.classList.toggle(prefix+"-submenu-wrap-active")}),wrap}}}]),DropdownSubmenu}();exports.inlineGroup=new MenuCommandGroup("inline"),exports.insertMenu=new Dropdown({label:"Insert"},new MenuCommandGroup("insert")),exports.textblockMenu=new Dropdown({label:"Type..",displayActive:!0,"class":"ProseMirror-textblock-dropdown"},[new MenuCommandGroup("textblock"),new DropdownSubmenu({label:"Heading"},new MenuCommandGroup("textblockHeading"))]),exports.blockGroup=new MenuCommandGroup("block"),exports.historyGroup=new MenuCommandGroup("history");(0,_dom.insertCSS)("\n\n.ProseMirror-textblock-dropdown {\n  min-width: 3em;\n}\n\n."+prefix+" {\n  margin: 0 -4px;\n  line-height: 1;\n}\n\n.ProseMirror-tooltip ."+prefix+" {\n  width: -webkit-fit-content;\n  width: fit-content;\n  white-space: pre;\n}\n\n."+prefix+"item {\n  margin-right: 3px;\n  display: inline-block;\n}\n\n."+prefix+"separator {\n  border-right: 1px solid #ddd;\n  margin-right: 3px;\n}\n\n."+prefix+"-dropdown, ."+prefix+"-dropdown-menu {\n  font-size: 90%;\n  white-space: nowrap;\n}\n\n."+prefix+"-dropdown {\n  padding: 1px 14px 1px 4px;\n  display: inline-block;\n  vertical-align: 1px;\n  position: relative;\n  cursor: pointer;\n}\n\n."+prefix+'-dropdown:after {\n  content: "";\n  border-left: 4px solid transparent;\n  border-right: 4px solid transparent;\n  border-top: 4px solid currentColor;\n  opacity: .6;\n  position: absolute;\n  right: 2px;\n  top: calc(50% - 2px);\n}\n\n.'+prefix+"-dropdown-menu, ."+prefix+"-submenu {\n  position: absolute;\n  background: white;\n  color: #666;\n  border: 1px solid #aaa;\n  padding: 2px;\n}\n\n."+prefix+"-dropdown-menu {\n  z-index: 15;\n  min-width: 6em;\n}\n\n."+prefix+"-dropdown-item {\n  cursor: pointer;\n  padding: 2px 8px 2px 4px;\n}\n\n."+prefix+"-dropdown-item:hover {\n  background: #f2f2f2;\n}\n\n."+prefix+"-dropdown-empty {\n  opacity: 0.4;\n}\n\n."+prefix+"-submenu-wrap {\n  position: relative;\n  margin-right: -4px;\n}\n\n."+prefix+'-submenu-label:after {\n  content: "";\n  border-top: 4px solid transparent;\n  border-bottom: 4px solid transparent;\n  border-left: 4px solid currentColor;\n  opacity: .6;\n  position: absolute;\n  right: 4px;\n  top: calc(50% - 4px);\n}\n\n.'+prefix+"-submenu {\n  display: none;\n  min-width: 4em;\n  left: 100%;\n  top: -3px;\n}\n\n."+prefix+"-active {\n  background: #eee;\n  border-radius: 4px;\n}\n\n."+prefix+"-active {\n  background: #eee;\n  border-radius: 4px;\n}\n\n."+prefix+"-disabled {\n  opacity: .3;\n}\n\n."+prefix+"-submenu-wrap:hover ."+prefix+"-submenu, ."+prefix+"-submenu-wrap-active ."+prefix+"-submenu {\n  display: block;\n}\n")},{"../dom":1,"../util/error":52,"../util/obj":55,"../util/sortedinsert":56,"./icons":26}],28:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function findWrappingScrollable(node){for(var cur=node.parentNode;cur;cur=cur.parentNode)if(cur.scrollHeight>cur.clientHeight)return cur}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_edit=require("../edit"),_dom=require("../dom"),_update=require("../ui/update"),_menu=require("./menu"),prefix="ProseMirror-menubar";(0,_edit.defineOption)("menuBar",!1,function(pm,value){pm.mod.menuBar&&pm.mod.menuBar.detach(),pm.mod.menuBar=value?new MenuBar(pm,value):null});var defaultMenu=[_menu.inlineGroup,_menu.insertMenu,[_menu.textblockMenu,_menu.blockGroup],_menu.historyGroup],MenuBar=function(){function MenuBar(pm,config){var _this=this;_classCallCheck(this,MenuBar),this.pm=pm,this.config=config||{},this.wrapper=pm.wrapper.insertBefore((0,_dom.elt)("div",{"class":prefix}),pm.wrapper.firstChild),this.spacer=null,this.maxHeight=0,this.widthForMaxHeight=0,this.updater=new _update.UpdateScheduler(pm,"selectionChange change activeMarkChange commandsChanged",function(){return _this.update()}),this.content=config.content||defaultMenu,this.updater.force(),this.floating=!1,this.config["float"]&&(this.updateFloat(),this.scrollFunc=function(){document.body.contains(_this.pm.wrapper)?_this.updateFloat():window.removeEventListener("scroll",_this.scrollFunc)},window.addEventListener("scroll",this.scrollFunc))}return _createClass(MenuBar,[{key:"detach",value:function(){this.updater.detach(),this.wrapper.parentNode.removeChild(this.wrapper),this.scrollFunc&&window.removeEventListener("scroll",this.scrollFunc)}},{key:"update",value:function(){var _this2=this;return this.wrapper.textContent="",this.wrapper.appendChild((0,_menu.renderGrouped)(this.pm,this.content)),this["float"]?this.updateScrollCursor():function(){return _this2.wrapper.offsetWidth!=_this2.widthForMaxHeight&&(_this2.widthForMaxHeight=_this2.wrapper.offsetWidth,_this2.maxHeight=0),_this2.wrapper.offsetHeight>_this2.maxHeight?(_this2.maxHeight=_this2.wrapper.offsetHeight,function(){_this2.wrapper.style.minHeight=_this2.maxHeight+"px"}):void 0}}},{key:"updateFloat",value:function(){var editorRect=this.pm.wrapper.getBoundingClientRect();if(this.floating)if(editorRect.top>=0||editorRect.bottom<this.wrapper.offsetHeight+10)this.floating=!1,this.wrapper.style.position=this.wrapper.style.left=this.wrapper.style.width="",this.wrapper.style.display="",this.spacer.parentNode.removeChild(this.spacer),this.spacer=null;else{var border=(this.pm.wrapper.offsetWidth-this.pm.wrapper.clientWidth)/2;this.wrapper.style.left=editorRect.left+border+"px",this.wrapper.style.display=editorRect.top>window.innerHeight?"none":""}else if(editorRect.top<0&&editorRect.bottom>=this.wrapper.offsetHeight+10){this.floating=!0;var menuRect=this.wrapper.getBoundingClientRect();this.wrapper.style.left=menuRect.left+"px",this.wrapper.style.width=menuRect.width+"px",this.wrapper.style.position="fixed",this.spacer=(0,_dom.elt)("div",{"class":prefix+"-spacer",style:"height: "+menuRect.height+"px"}),this.pm.wrapper.insertBefore(this.spacer,this.wrapper)}}},{key:"updateScrollCursor",value:function(){var _this3=this;if(!this.floating)return null;var head=this.pm.selection.head;return head?function(){var cursorPos=_this3.pm.coordsAtPos(head),menuRect=_this3.wrapper.getBoundingClientRect();if(cursorPos.top<menuRect.bottom&&cursorPos.bottom>menuRect.top){var _ret=function(){var scrollable=findWrappingScrollable(_this3.pm.wrapper);return scrollable?{v:function(){scrollable.scrollTop-=menuRect.bottom-cursorPos.top}}:void 0}();if("object"===("undefined"==typeof _ret?"undefined":_typeof(_ret)))return _ret.v}}:null}}]),MenuBar}();(0,_dom.insertCSS)("\n."+prefix+" {\n  border-top-left-radius: inherit;\n  border-top-right-radius: inherit;\n  position: relative;\n  min-height: 1em;\n  color: #666;\n  padding: 1px 6px;\n  top: 0; left: 0; right: 0;\n  border-bottom: 1px solid silver;\n  background: white;\n  z-index: 10;\n  -moz-box-sizing: border-box;\n  box-sizing: border-box;\n  overflow: visible;\n}\n")},{"../dom":1,"../edit":11,"../ui/update":51,"./menu":27}],29:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function topCenterOfSelection(){var range=window.getSelection().getRangeAt(0),rects=range.getClientRects();if(!rects.length)return range.getBoundingClientRect();for(var _rects$=rects[0],left=_rects$.left,right=_rects$.right,top=_rects$.top,i=1;left==right&&rects.length>i;){var _rects=rects[i++];left=_rects.left,right=_rects.right,top=_rects.top}for(;i<rects.length;i++)rects[i].top<rects[0].bottom-1&&(i==rects.length-1||Math.abs(rects[i+1].left-rects[i].left)>1)&&(left=Math.min(left,rects[i].left),right=Math.max(right,rects[i].right),top=Math.min(top,rects[i].top));return{top:top,left:(left+right)/2}}function topOfNodeSelection(pm){var selected=pm.content.querySelector(".ProseMirror-selectednode");if(!selected)return{left:0,top:0};var box=selected.getBoundingClientRect();return{left:Math.min((box.left+box.right)/2,box.left+20),top:box.top}}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_model=require("../model"),_edit=require("../edit"),_dom=require("../dom"),_tooltip=require("../ui/tooltip"),_update=require("../ui/update"),_menu=require("./menu"),classPrefix="ProseMirror-tooltipmenu";(0,_edit.defineOption)("tooltipMenu",!1,function(pm,value){pm.mod.tooltipMenu&&pm.mod.tooltipMenu.detach(),pm.mod.tooltipMenu=value?new TooltipMenu(pm,value):null});var defaultInline=[_menu.inlineGroup,_menu.insertMenu],defaultBlock=[[_menu.textblockMenu,_menu.blockGroup]],TooltipMenu=function(){function TooltipMenu(pm,config){var _this=this;_classCallCheck(this,TooltipMenu),this.pm=pm,this.config=config||{},this.showLinks=this.config.showLinks!==!1,this.selectedBlockMenu=this.config.selectedBlockMenu,this.updater=new _update.UpdateScheduler(pm,"change selectionChange blur commandsChanged",function(){return _this.update()}),this.onContextMenu=this.onContextMenu.bind(this),pm.content.addEventListener("contextmenu",this.onContextMenu),this.tooltip=new _tooltip.Tooltip(pm.wrapper,"above"),this.inlineContent=this.config.inlineContent||defaultInline,this.blockContent=this.config.blockContent||defaultBlock,this.selectedBlockContent=this.config.selectedBlockContent||this.inlineContent.concat(this.blockContent)}return _createClass(TooltipMenu,[{key:"detach",value:function(){this.updater.detach(),this.tooltip.detach(),this.pm.content.removeEventListener("contextmenu",this.onContextMenu)}},{key:"show",value:function(content,coords){this.tooltip.open((0,_dom.elt)("div",null,(0,_menu.renderGrouped)(this.pm,content)),coords)}},{key:"update",value:function(){var _this2=this,_pm$selection=this.pm.selection,empty=_pm$selection.empty,node=_pm$selection.node,from=_pm$selection.from,to=_pm$selection.to,link=void 0;if(this.pm.hasFocus()){if(node&&node.isBlock)return function(){var coords=topOfNodeSelection(_this2.pm);return function(){return _this2.show(_this2.blockContent,coords)}};if(!empty)return function(){var coords=node?topOfNodeSelection(_this2.pm):topCenterOfSelection(),showBlock=_this2.selectedBlockMenu&&_model.Pos.samePath(from.path,to.path)&&0==from.offset&&to.offset==_this2.pm.doc.path(from.path).size;return function(){return _this2.show(showBlock?_this2.selectedBlockContent:_this2.inlineContent,coords)}};if(this.selectedBlockMenu&&0==this.pm.doc.path(from.path).size)return function(){var coords=_this2.pm.coordsAtPos(from);return function(){return _this2.show(_this2.blockContent,coords)}};if(this.showLinks&&(link=this.linkUnderCursor()))return function(){var coords=_this2.pm.coordsAtPos(from);return function(){return _this2.showLink(link,coords)}};this.tooltip.close()}else this.tooltip.close()}},{key:"linkUnderCursor",value:function(){var head=this.pm.selection.head;if(!head)return null;var marks=this.pm.doc.marksAt(head);return marks.reduce(function(found,m){return found||"link"==m.type.name&&m},null)}},{key:"showLink",value:function(link,pos){var node=(0,_dom.elt)("div",{"class":classPrefix+"-linktext"},(0,_dom.elt)("a",{href:link.attrs.href,title:link.attrs.title},link.attrs.href));this.tooltip.open(node,pos)}},{key:"onContextMenu",value:function(e){if(this.pm.selection.empty){var pos=this.pm.posAtCoords({left:e.clientX,top:e.clientY});pos&&pos.isValid(this.pm.doc,!0)&&(this.pm.setTextSelection(pos,pos),this.pm.flush(),this.show(this.inlineContent,topCenterOfSelection()))}}}]),TooltipMenu}();(0,_dom.insertCSS)("\n\n."+classPrefix+"-linktext a {\n  color: #444;\n  text-decoration: none;\n  padding: 0 5px;\n}\n\n."+classPrefix+"-linktext a:hover {\n  text-decoration: underline;\n}\n\n")},{"../dom":1,"../edit":11,"../model":34,"../ui/tooltip":50,"../ui/update":51,"./menu":27}],30:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _createClass=function(){function defineProperties(target,props){
for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.defaultSchema=exports.CodeMark=exports.LinkMark=exports.StrongMark=exports.EmMark=exports.HardBreak=exports.Image=exports.Paragraph=exports.CodeBlock=exports.Heading=exports.HorizontalRule=exports.ListItem=exports.BulletList=exports.OrderedList=exports.BlockQuote=exports.Doc=void 0;var _schema=require("./schema"),Doc=exports.Doc=function(_Block){function Doc(){return _classCallCheck(this,Doc),_possibleConstructorReturn(this,Object.getPrototypeOf(Doc).apply(this,arguments))}return _inherits(Doc,_Block),_createClass(Doc,null,[{key:"kinds",get:function(){return"doc"}}]),Doc}(_schema.Block),BlockQuote=exports.BlockQuote=function(_Block2){function BlockQuote(){return _classCallCheck(this,BlockQuote),_possibleConstructorReturn(this,Object.getPrototypeOf(BlockQuote).apply(this,arguments))}return _inherits(BlockQuote,_Block2),BlockQuote}(_schema.Block),OrderedList=exports.OrderedList=function(_Block3){function OrderedList(){return _classCallCheck(this,OrderedList),_possibleConstructorReturn(this,Object.getPrototypeOf(OrderedList).apply(this,arguments))}return _inherits(OrderedList,_Block3),_createClass(OrderedList,[{key:"contains",get:function(){return"list_item"}},{key:"attrs",get:function(){return{order:new _schema.Attribute({"default":"1"})}}}]),OrderedList}(_schema.Block),BulletList=exports.BulletList=function(_Block4){function BulletList(){return _classCallCheck(this,BulletList),_possibleConstructorReturn(this,Object.getPrototypeOf(BulletList).apply(this,arguments))}return _inherits(BulletList,_Block4),_createClass(BulletList,[{key:"contains",get:function(){return"list_item"}}]),BulletList}(_schema.Block),ListItem=exports.ListItem=function(_Block5){function ListItem(){return _classCallCheck(this,ListItem),_possibleConstructorReturn(this,Object.getPrototypeOf(ListItem).apply(this,arguments))}return _inherits(ListItem,_Block5),_createClass(ListItem,null,[{key:"kinds",get:function(){return"list_item"}}]),ListItem}(_schema.Block),HorizontalRule=exports.HorizontalRule=function(_Block6){function HorizontalRule(){return _classCallCheck(this,HorizontalRule),_possibleConstructorReturn(this,Object.getPrototypeOf(HorizontalRule).apply(this,arguments))}return _inherits(HorizontalRule,_Block6),_createClass(HorizontalRule,[{key:"contains",get:function(){return null}}]),HorizontalRule}(_schema.Block),Heading=exports.Heading=function(_Textblock){function Heading(){return _classCallCheck(this,Heading),_possibleConstructorReturn(this,Object.getPrototypeOf(Heading).apply(this,arguments))}return _inherits(Heading,_Textblock),_createClass(Heading,[{key:"attrs",get:function(){return{level:new _schema.Attribute({"default":"1"})}}},{key:"maxLevel",get:function(){return 6}}]),Heading}(_schema.Textblock),CodeBlock=exports.CodeBlock=function(_Textblock2){function CodeBlock(){return _classCallCheck(this,CodeBlock),_possibleConstructorReturn(this,Object.getPrototypeOf(CodeBlock).apply(this,arguments))}return _inherits(CodeBlock,_Textblock2),_createClass(CodeBlock,[{key:"contains",get:function(){return"text"}},{key:"containsMarks",get:function(){return!1}},{key:"isCode",get:function(){return!0}}]),CodeBlock}(_schema.Textblock),Paragraph=exports.Paragraph=function(_Textblock3){function Paragraph(){return _classCallCheck(this,Paragraph),_possibleConstructorReturn(this,Object.getPrototypeOf(Paragraph).apply(this,arguments))}return _inherits(Paragraph,_Textblock3),_createClass(Paragraph,[{key:"defaultTextblock",get:function(){return!0}}]),Paragraph}(_schema.Textblock),Image=exports.Image=function(_Inline){function Image(){return _classCallCheck(this,Image),_possibleConstructorReturn(this,Object.getPrototypeOf(Image).apply(this,arguments))}return _inherits(Image,_Inline),_createClass(Image,[{key:"attrs",get:function(){return{src:new _schema.Attribute,alt:new _schema.Attribute({"default":""}),title:new _schema.Attribute({"default":""})}}},{key:"draggable",get:function(){return!0}}]),Image}(_schema.Inline),HardBreak=exports.HardBreak=function(_Inline2){function HardBreak(){return _classCallCheck(this,HardBreak),_possibleConstructorReturn(this,Object.getPrototypeOf(HardBreak).apply(this,arguments))}return _inherits(HardBreak,_Inline2),_createClass(HardBreak,[{key:"selectable",get:function(){return!1}},{key:"isBR",get:function(){return!0}}]),HardBreak}(_schema.Inline),EmMark=exports.EmMark=function(_MarkType){function EmMark(){return _classCallCheck(this,EmMark),_possibleConstructorReturn(this,Object.getPrototypeOf(EmMark).apply(this,arguments))}return _inherits(EmMark,_MarkType),_createClass(EmMark,null,[{key:"rank",get:function(){return 51}}]),EmMark}(_schema.MarkType),StrongMark=exports.StrongMark=function(_MarkType2){function StrongMark(){return _classCallCheck(this,StrongMark),_possibleConstructorReturn(this,Object.getPrototypeOf(StrongMark).apply(this,arguments))}return _inherits(StrongMark,_MarkType2),_createClass(StrongMark,null,[{key:"rank",get:function(){return 52}}]),StrongMark}(_schema.MarkType),LinkMark=exports.LinkMark=function(_MarkType3){function LinkMark(){return _classCallCheck(this,LinkMark),_possibleConstructorReturn(this,Object.getPrototypeOf(LinkMark).apply(this,arguments))}return _inherits(LinkMark,_MarkType3),_createClass(LinkMark,[{key:"attrs",get:function(){return{href:new _schema.Attribute,title:new _schema.Attribute({"default":""})}}}],[{key:"rank",get:function(){return 25}}]),LinkMark}(_schema.MarkType),CodeMark=exports.CodeMark=function(_MarkType4){function CodeMark(){return _classCallCheck(this,CodeMark),_possibleConstructorReturn(this,Object.getPrototypeOf(CodeMark).apply(this,arguments))}return _inherits(CodeMark,_MarkType4),_createClass(CodeMark,[{key:"isCode",get:function(){return!0}}],[{key:"rank",get:function(){return 101}}]),CodeMark}(_schema.MarkType),defaultSpec=new _schema.SchemaSpec({doc:Doc,blockquote:BlockQuote,ordered_list:OrderedList,bullet_list:BulletList,list_item:ListItem,horizontal_rule:HorizontalRule,paragraph:Paragraph,heading:Heading,code_block:CodeBlock,text:_schema.Text,image:Image,hard_break:HardBreak},{em:EmMark,strong:StrongMark,link:LinkMark,code:CodeMark});exports.defaultSchema=new _schema.Schema(defaultSpec)},{"./schema":38}],31:[function(require,module,exports){"use strict";function findDiffStart(a,b){for(var path=arguments.length<=2||void 0===arguments[2]?[]:arguments[2],iA=a.iter(),iB=b.iter(),offset=0;;){if(iA.atEnd()||iB.atEnd()){if(a.size==b.size)return null;break}var childA=iA.next(),childB=iB.next();if(childA!=childB){if(!childA.sameMarkup(childB))break;if(childA.isText&&childA.text!=childB.text){for(var j=0;childA.text[j]==childB.text[j];j++)offset++;break}if(childA.size||childB.size){path.push(offset);var inner=findDiffStart(childA.content,childB.content,path);if(inner)return inner;path.pop()}offset+=childA.width}else offset+=childA.width}return new _pos.Pos(path,offset)}function findDiffEnd(a,b){for(var pathA=arguments.length<=2||void 0===arguments[2]?[]:arguments[2],pathB=arguments.length<=3||void 0===arguments[3]?[]:arguments[3],iA=a.reverseIter(),iB=b.reverseIter(),offA=a.size,offB=b.size;;){if(iA.atEnd()||iB.atEnd()){if(a.size==b.size)return null;break}var childA=iA.next(),childB=iB.next();if(childA!=childB){if(!childA.sameMarkup(childB))break;if(childA.isText&&childA.text!=childB.text){for(var same=0,minSize=Math.min(childA.text.length,childB.text.length);minSize>same&&childA.text[childA.text.length-same-1]==childB.text[childB.text.length-same-1];)same++,offA--,offB--;break}if(offA-=childA.width,offB-=childB.width,childA.size||childB.size){pathA.push(offA),pathB.push(offB);var inner=findDiffEnd(childA.content,childB.content,pathA,pathB);if(inner)return inner;pathA.pop(),pathB.pop()}}else offA-=childA.width,offB-=childB.width}return{a:new _pos.Pos(pathA,offA),b:new _pos.Pos(pathB,offB)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.findDiffStart=findDiffStart,exports.findDiffEnd=findDiffEnd;var _pos=require("./pos")},{"./pos":37}],32:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ModelError=void 0;var _error=require("../util/error");exports.ModelError=function(_ProseMirrorError){function ModelError(){return _classCallCheck(this,ModelError),_possibleConstructorReturn(this,Object.getPrototypeOf(ModelError).apply(this,arguments))}return _inherits(ModelError,_ProseMirrorError),ModelError}(_error.ProseMirrorError)},{"../util/error":52}],33:[function(require,module,exports){"use strict";function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.emptyFragment=exports.Fragment=void 0;var _error=require("./error"),Fragment=exports.Fragment=function(){function Fragment(){_classCallCheck(this,Fragment)}return _createClass(Fragment,[{key:"append",value:function(other){var joinLeft=arguments.length<=1||void 0===arguments[1]?0:arguments[1],joinRight=arguments.length<=2||void 0===arguments[2]?0:arguments[2];return this.size?other.size?this.appendInner(other,joinLeft,joinRight):joinLeft?this.replace(this.size-1,this.lastChild.close(joinLeft-1,"end")):this:joinRight?other.replace(0,other.firstChild.close(joinRight-1,"start")):other}},{key:"toString",value:function(){var str="";return this.forEach(function(n){return str+=(str?", ":"")+n.toString()}),str}},{key:"toArray",value:function(){for(var n,from=arguments.length<=0||void 0===arguments[0]?0:arguments[0],to=arguments.length<=1||void 0===arguments[1]?this.size:arguments[1],f=arguments[2],result=[],iter=this.iter(from,to);n=iter.next().value;)result.push(f?f(n):n);return result}},{key:"map",value:function(f){return Fragment.fromArray(this.toArray(void 0,void 0,f))}},{key:"some",value:function(f){for(var n,iter=this.iter();n=iter.next().value;)if(f(n))return n}},{key:"close",value:function(depth,side){var child="start"==side?this.firstChild:this.lastChild,closed=child.close(depth-1,side);return closed==child?this:this.replace("start"==side?0:this.size-1,closed)}},{key:"nodesBetween",value:function(from,to,f,path,parent){for(var node,moreFrom=from&&from.depth>path.length,moreTo=to&&to.depth>path.length,start=moreFrom?from.path[path.length]:from?from.offset:0,end=moreTo?to.path[path.length]+1:to?to.offset:this.size,iter=this.iter(start,end);node=iter.next().value;){var startOffset=iter.offset-node.width;path.push(startOffset),node.nodesBetween(moreFrom&&startOffset==start?from:null,moreTo&&iter.offset==end?to:null,f,path,parent),path.pop()}}},{key:"sliceBetween",value:function(from,to){for(var node,depth=arguments.length<=2||void 0===arguments[2]?0:arguments[2],moreFrom=from&&from.depth>depth,moreTo=to&&to.depth>depth,start=moreFrom?from.path[depth]:from?from.offset:0,end=moreTo?to.path[depth]+1:to?to.offset:this.size,nodes=[],iter=this.iter(start,end);node=iter.next().value;){var passFrom=moreFrom&&iter.offset-node.width==start?from:null,passTo=moreTo&&iter.offset==end?to:null;(passFrom||passTo)&&(node=node.sliceBetween(passFrom,passTo,depth+1)),nodes.push(node)}return new this.constructor(nodes)}},{key:"textContent",get:function(){var text="";return this.forEach(function(n){return text+=n.textContent}),text}}],[{key:"fromJSON",value:function(schema,value){return value?this.fromArray(value.map(schema.nodeFromJSON)):emptyFragment}},{key:"fromArray",value:function(array){if(!array.length)return emptyFragment;for(var hasText=!1,joined=void 0,i=0;i<array.length;i++){var node=array[i];node.isText&&(hasText=!0,i&&array[i-1].sameMarkup(node))?(joined||(joined=array.slice(0,i)),joined[joined.length-1]=node.copy(joined[joined.length-1].text+node.text)):joined&&joined.push(node)}return hasText?new TextFragment(joined||array):new FlatFragment(array)}},{key:"from",value:function(nodes){return nodes?nodes instanceof Fragment?nodes:this.fromArray(Array.isArray(nodes)?nodes:[nodes]):emptyFragment}}]),Fragment}(),iterEnd={done:!0},FlatIterator=function(){function FlatIterator(array,pos,end){_classCallCheck(this,FlatIterator),this.array=array,this.pos=pos,this.end=end}return _createClass(FlatIterator,[{key:"copy",value:function(){return new this.constructor(this.array,this.pos,this.end)}},{key:"atEnd",value:function(){return this.pos==this.end}},{key:"next",value:function(){return this.pos==this.end?iterEnd:this.array[this.pos++]}},{key:"offset",get:function(){return this.pos}}]),FlatIterator}(),ReverseFlatIterator=function(_FlatIterator){function ReverseFlatIterator(){return _classCallCheck(this,ReverseFlatIterator),_possibleConstructorReturn(this,Object.getPrototypeOf(ReverseFlatIterator).apply(this,arguments))}return _inherits(ReverseFlatIterator,_FlatIterator),_createClass(ReverseFlatIterator,[{key:"next",value:function(){return this.pos==this.end?iterEnd:this.array[--this.pos]}}]),ReverseFlatIterator}(FlatIterator),FlatFragment=function(_Fragment){function FlatFragment(content){_classCallCheck(this,FlatFragment);var _this2=_possibleConstructorReturn(this,Object.getPrototypeOf(FlatFragment).call(this));return _this2.content=content,_this2}return _inherits(FlatFragment,_Fragment),_createClass(FlatFragment,[{key:"iter",value:function(){var start=arguments.length<=0||void 0===arguments[0]?0:arguments[0],end=arguments.length<=1||void 0===arguments[1]?this.size:arguments[1];return new FlatIterator(this.content,start,end)}},{key:"reverseIter",value:function(){var start=arguments.length<=0||void 0===arguments[0]?this.size:arguments[0],end=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return new ReverseFlatIterator(this.content,start,end)}},{key:"child",value:function(off){return(0>off||off>=this.content.length)&&_error.ModelError.raise("Offset "+off+" out of range"),this.content[off]}},{key:"forEach",value:function(f){for(var i=0;i<this.content.length;i++)f(this.content[i],i,i+1)}},{key:"chunkBefore",value:function(off){return{node:this.child(off-1),start:off-1}}},{key:"chunkAfter",value:function(off){return{node:this.child(off),start:off}}},{key:"slice",value:function(from){var to=arguments.length<=1||void 0===arguments[1]?this.size:arguments[1];return from==to?emptyFragment:new FlatFragment(this.content.slice(from,to))}},{key:"replace",value:function(offset,node){node.isText&&_error.ModelError.raise("Argument to replace should be a non-text node");var copy=this.content.slice();return copy[offset]=node,new FlatFragment(copy)}},{key:"appendInner",value:function(other,joinLeft,joinRight){var last=this.content.length-1,content=this.content.slice(0,last),before=this.content[last],after=other.firstChild;return joinLeft>0&&joinRight>0&&before.sameMarkup(after)?content.push(before.append(after.content,joinLeft-1,joinRight-1)):content.push(before.close(joinLeft-1,"end"),after.close(joinRight-1,"start")),Fragment.fromArray(content.concat(other.toArray(after.width)))}},{key:"toJSON",value:function(){return this.content.map(function(n){return n.toJSON()})}},{key:"size",get:function(){return this.content.length}},{key:"firstChild",get:function(){return this.content.length?this.content[0]:null}},{key:"lastChild",get:function(){return this.content.length?this.content[this.content.length-1]:null}}]),FlatFragment}(Fragment),emptyFragment=exports.emptyFragment=new FlatFragment([]),TextIterator=function(){function TextIterator(fragment,startOffset,endOffset){var pos=arguments.length<=3||void 0===arguments[3]?-1:arguments[3];_classCallCheck(this,TextIterator),this.frag=fragment,this.offset=startOffset,this.pos=pos,this.endOffset=endOffset}return _createClass(TextIterator,[{key:"copy",value:function(){return new this.constructor(this.frag,this.offset,this.endOffset,this.pos)}},{key:"atEnd",value:function(){return this.offset==this.endOffset}},{key:"next",value:function(){if(-1==this.pos){var start=this.init();if(start)return start}return this.offset==this.endOffset?iterEnd:this.advance()}},{key:"advance",value:function(){var node=this.frag.content[this.pos++],end=this.offset+node.width;return end>this.endOffset?(node=node.copy(node.text.slice(0,this.endOffset-this.offset)),this.offset=this.endOffset,node):(this.offset=end,node)}},{key:"init",value:function(){this.pos=0;for(var offset=0;offset<this.offset;){var node=this.frag.content[this.pos++],end=offset+node.width;if(end==this.offset)break;if(end>this.offset){var sliceEnd=node.width;return end>this.endOffset&&(sliceEnd=this.endOffset-offset,end=this.endOffset),node=node.copy(node.text.slice(this.offset-offset,sliceEnd)),this.offset=end,node}offset=end}}}]),TextIterator}(),ReverseTextIterator=function(_TextIterator){function ReverseTextIterator(){return _classCallCheck(this,ReverseTextIterator),_possibleConstructorReturn(this,Object.getPrototypeOf(ReverseTextIterator).apply(this,arguments))}return _inherits(ReverseTextIterator,_TextIterator),_createClass(ReverseTextIterator,[{key:"advance",value:function(){var node=this.frag.content[--this.pos],end=this.offset-node.width;return end<this.endOffset?(node=node.copy(node.text.slice(this.endOffset-end)),this.offset=this.endOffset,node):(this.offset=end,node)}},{key:"init",value:function(){this.pos=this.frag.content.length;for(var offset=this.frag.size;offset>this.offset;){var node=this.frag.content[--this.pos],end=offset-node.width;if(end==this.offset)break;if(end<this.offset)return end<this.endOffset?(node=node.copy(node.text.slice(this.endOffset-end,this.offset-end)),end=this.endOffset):node=node.copy(node.text.slice(0,this.offset-end)),this.offset=end,node;offset=end}}}]),ReverseTextIterator}(TextIterator),TextFragment=function(_Fragment2){function TextFragment(content,size){_classCallCheck(this,TextFragment);var _this4=_possibleConstructorReturn(this,Object.getPrototypeOf(TextFragment).call(this));if(_this4.content=content,_this4.size=size||0,null==size)for(var i=0;i<content.length;i++)_this4.size+=content[i].width;return _this4}return _inherits(TextFragment,_Fragment2),_createClass(TextFragment,[{key:"iter",value:function(){var from=arguments.length<=0||void 0===arguments[0]?0:arguments[0],to=arguments.length<=1||void 0===arguments[1]?this.size:arguments[1];return new TextIterator(this,from,to)}},{key:"reverseIter",value:function(){var from=arguments.length<=0||void 0===arguments[0]?this.size:arguments[0],to=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return new ReverseTextIterator(this,from,to)}},{key:"child",value:function child(off){(0>off||off>=this.size)&&_error.ModelError.raise("Offset "+off+" out of range");for(var i=0,curOff=0;i<this.content.length;i++){var child=this.content[i];if(curOff+=child.width,curOff>off)return child}}},{key:"forEach",value:function(f){for(var i=0,off=0;i<this.content.length;i++){var child=this.content[i];f(child,off,off+=child.width)}}},{key:"chunkBefore",value:function(off){off||_error.ModelError.raise("No chunk before start of node");for(var i=0,curOff=0;i<this.content.length;i++){var child=this.content[i],end=curOff+child.width;if(end>=off)return{node:child,start:curOff};curOff=end}}},{key:"chunkAfter",value:function(off){off==this.size&&_error.ModelError.raise("No chunk after end of node");for(var i=0,curOff=0;i<this.content.length;i++){var child=this.content[i],end=curOff+child.width;if(end>off)return{node:child,start:curOff};curOff=end}}},{key:"slice",value:function(){var from=arguments.length<=0||void 0===arguments[0]?0:arguments[0],to=arguments.length<=1||void 0===arguments[1]?this.size:arguments[1];return from==to?emptyFragment:new TextFragment(this.toArray(from,to))}},{key:"replace",value:function(off,node){node.isText&&_error.ModelError.raise("Argument to replace should be a non-text node");for(var curNode=void 0,index=void 0,curOff=0;off>curOff;index++)curNode=this.content[index],curOff+=curNode.width;curNode.isText&&_error.ModelError.raise("Can not replace text content with replace method");var copy=this.content.slice();return copy[index]=node,new TextFragment(copy)}},{key:"appendInner",value:function(other,joinLeft,joinRight){var last=this.content.length-1,content=this.content.slice(0,last),before=this.content[last],after=other.firstChild,same=before.sameMarkup(after);return same&&before.isText?content.push(before.copy(before.text+after.text)):same&&joinLeft>0&&joinRight>0?content.push(before.append(after.content,joinLeft-1,joinRight-1)):content.push(before.close(joinLeft-1,"end"),after.close(joinRight-1,"start")),Fragment.fromArray(content.concat(other.toArray(after.width)))}},{key:"toJSON",value:function(){return this.content.map(function(n){return n.toJSON()})}},{key:"firstChild",get:function(){return this.size?this.content[0]:null}},{key:"lastChild",get:function(){return this.size?this.content[this.content.length-1]:null}}]),TextFragment}(Fragment);"undefined"!=typeof Symbol&&(Fragment.prototype[Symbol.iterator]=function(){return this.iter()},FlatIterator.prototype[Symbol.iterator]=TextIterator.prototype[Symbol.iterator]=function(){return this})},{"./error":32}],34:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _node=require("./node");Object.defineProperty(exports,"Node",{enumerable:!0,get:function(){return _node.Node}});var _fragment=require("./fragment");Object.defineProperty(exports,"Fragment",{enumerable:!0,get:function(){return _fragment.Fragment}}),Object.defineProperty(exports,"emptyFragment",{enumerable:!0,get:function(){return _fragment.emptyFragment}});var _mark=require("./mark");Object.defineProperty(exports,"Mark",{enumerable:!0,get:function(){return _mark.Mark}});var _schema=require("./schema");Object.defineProperty(exports,"SchemaSpec",{enumerable:!0,get:function(){return _schema.SchemaSpec}}),Object.defineProperty(exports,"Schema",{enumerable:!0,get:function(){return _schema.Schema}}),Object.defineProperty(exports,"SchemaError",{enumerable:!0,get:function(){return _schema.SchemaError}}),Object.defineProperty(exports,"NodeType",{enumerable:!0,get:function(){return _schema.NodeType}}),Object.defineProperty(exports,"Block",{enumerable:!0,get:function(){return _schema.Block}}),Object.defineProperty(exports,"Textblock",{enumerable:!0,get:function(){return _schema.Textblock}}),Object.defineProperty(exports,"Inline",{enumerable:!0,get:function(){return _schema.Inline}}),Object.defineProperty(exports,"Text",{enumerable:!0,get:function(){return _schema.Text}}),Object.defineProperty(exports,"MarkType",{enumerable:!0,get:function(){return _schema.MarkType}}),Object.defineProperty(exports,"Attribute",{enumerable:!0,get:function(){return _schema.Attribute}});var _defaultschema=require("./defaultschema");Object.defineProperty(exports,"defaultSchema",{enumerable:!0,get:function(){return _defaultschema.defaultSchema}}),Object.defineProperty(exports,"Doc",{enumerable:!0,get:function(){return _defaultschema.Doc}}),Object.defineProperty(exports,"BlockQuote",{enumerable:!0,get:function(){return _defaultschema.BlockQuote}}),Object.defineProperty(exports,"OrderedList",{enumerable:!0,get:function(){return _defaultschema.OrderedList}}),Object.defineProperty(exports,"BulletList",{enumerable:!0,get:function(){return _defaultschema.BulletList}}),Object.defineProperty(exports,"ListItem",{enumerable:!0,get:function(){return _defaultschema.ListItem}}),Object.defineProperty(exports,"HorizontalRule",{enumerable:!0,get:function(){return _defaultschema.HorizontalRule}}),Object.defineProperty(exports,"Paragraph",{enumerable:!0,get:function(){return _defaultschema.Paragraph}}),Object.defineProperty(exports,"Heading",{enumerable:!0,get:function(){return _defaultschema.Heading}}),Object.defineProperty(exports,"CodeBlock",{enumerable:!0,get:function(){return _defaultschema.CodeBlock}}),Object.defineProperty(exports,"Image",{enumerable:!0,get:function(){return _defaultschema.Image}}),Object.defineProperty(exports,"HardBreak",{enumerable:!0,get:function(){return _defaultschema.HardBreak}}),Object.defineProperty(exports,"CodeMark",{enumerable:!0,get:function(){return _defaultschema.CodeMark}}),Object.defineProperty(exports,"EmMark",{enumerable:!0,get:function(){return _defaultschema.EmMark}}),Object.defineProperty(exports,"StrongMark",{enumerable:!0,get:function(){return _defaultschema.StrongMark}}),Object.defineProperty(exports,"LinkMark",{enumerable:!0,get:function(){return _defaultschema.LinkMark}});var _pos=require("./pos");Object.defineProperty(exports,"Pos",{enumerable:!0,get:function(){return _pos.Pos}});var _diff=require("./diff");Object.defineProperty(exports,"findDiffStart",{enumerable:!0,get:function(){return _diff.findDiffStart}}),Object.defineProperty(exports,"findDiffEnd",{enumerable:!0,get:function(){return _diff.findDiffEnd}});var _error=require("./error");Object.defineProperty(exports,"ModelError",{enumerable:!0,get:function(){return _error.ModelError}})},{"./defaultschema":30,"./diff":31,"./error":32,"./fragment":33,"./mark":35,"./node":36,"./pos":37,"./schema":38}],35:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0});var empty=(exports.Mark=function(){function Mark(type,attrs){_classCallCheck(this,Mark),this.type=type,this.attrs=attrs}return _createClass(Mark,[{key:"toJSON",value:function(){var obj={_:this.type.name};for(var attr in this.attrs)obj[attr]=this.attrs[attr];return obj}},{key:"addToSet",value:function(set){for(var i=0;i<set.length;i++){var other=set[i];if(other.type==this.type)return this.eq(other)?set:set.slice(0,i).concat(this).concat(set.slice(i+1));if(other.type.rank>this.type.rank)return set.slice(0,i).concat(this).concat(set.slice(i))}return set.concat(this)}},{key:"removeFromSet",value:function(set){for(var i=0;i<set.length;i++)if(this.eq(set[i]))return set.slice(0,i).concat(set.slice(i+1));return set}},{key:"isInSet",value:function(set){for(var i=0;i<set.length;i++)if(this.eq(set[i]))return!0;return!1}},{key:"eq",value:function(other){if(this==other)return!0;if(this.type!=other.type)return!1;for(var attr in this.attrs)if(other.attrs[attr]!=this.attrs[attr])return!1;return!0}}],[{key:"sameSet",value:function(a,b){if(a==b)return!0;if(a.length!=b.length)return!1;for(var i=0;i<a.length;i++)if(!a[i].eq(b[i]))return!1;return!0}},{key:"setFrom",value:function(marks){if(!marks||0==marks.length)return empty;if(marks instanceof Mark)return[marks];var copy=marks.slice();return copy.sort(function(a,b){return a.type.rank-b.type.rank}),copy}}]),Mark}(),[])},{}],36:[function(require,module,exports){"use strict";function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function wrapMarks(marks,str){for(var i=marks.length-1;i>=0;i--)str=marks[i].type.name+"("+str+")";return str}var _get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;if(void 0!==getter)return getter.call(receiver)},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextNode=exports.Node=void 0;var _fragment=require("./fragment"),_mark=require("./mark"),_pos=require("./pos"),emptyArray=[],emptyAttrs=Object.create(null),Node=function(){function Node(type,attrs,content,marks){_classCallCheck(this,Node),this.type=type,this.attrs=attrs,this.content=content||_fragment.emptyFragment,this.marks=marks||emptyArray}return _createClass(Node,[{key:"child",value:function(off){return this.content.child(off)}},{key:"iter",value:function(start,end){return this.content.iter(start,end)}},{key:"reverseIter",value:function(start,end){return this.content.reverseIter(start,end)}},{key:"chunkBefore",value:function(off){return this.content.chunkBefore(off)}},{key:"chunkAfter",value:function(off){return this.content.chunkAfter(off);
}},{key:"forEach",value:function(f){this.content.forEach(f)}},{key:"sameMarkup",value:function(other){return this.hasMarkup(other.type,other.attrs,other.marks)}},{key:"hasMarkup",value:function(type,attrs,marks){return this.type==type&&Node.sameAttrs(this.attrs,attrs||emptyAttrs)&&_mark.Mark.sameSet(this.marks,marks||emptyArray)}},{key:"copy",value:function(){var content=arguments.length<=0||void 0===arguments[0]?null:arguments[0];return new this.constructor(this.type,this.attrs,content,this.marks)}},{key:"mark",value:function(marks){return new this.constructor(this.type,this.attrs,this.content,marks)}},{key:"slice",value:function(from,to){return this.copy(this.content.slice(from,to))}},{key:"splice",value:function(from,to,replace){return this.copy(this.content.slice(0,from).append(replace).append(this.content.slice(to)))}},{key:"append",value:function(fragment){var joinLeft=arguments.length<=1||void 0===arguments[1]?0:arguments[1],joinRight=arguments.length<=2||void 0===arguments[2]?0:arguments[2];return this.copy(this.content.append(fragment,joinLeft,joinRight))}},{key:"replace",value:function(pos,node){return this.copy(this.content.replace(pos,node))}},{key:"replaceDeep",value:function(path,node){var depth=arguments.length<=2||void 0===arguments[2]?0:arguments[2];if(depth==path.length)return node;var pos=path[depth];return this.replace(pos,this.child(pos).replaceDeep(path,node,depth+1))}},{key:"close",value:function(depth,side){if(0==depth&&0==this.size&&!this.type.canBeEmpty)return this.copy(this.type.defaultContent());var closedContent=void 0;return depth>0&&(closedContent=this.content.close(depth-1,side))!=this.content?this.copy(closedContent):this}},{key:"path",value:function(_path){for(var i=0,node=this;i<_path.length;node=node.child(_path[i]),i++);return node}},{key:"nodeAfter",value:function(pos){var parent=this.path(pos.path);return pos.offset<parent.size?parent.child(pos.offset):null}},{key:"pathNodes",value:function(path){for(var nodes=[],i=0,node=this;nodes.push(node),i!=path.length;i++)node=node.child(path[i]);return nodes}},{key:"siblingRange",value:function(from,to){for(var i=0,node=this;;i++){if(node.isTextblock){var path=from.path.slice(0,i-1),offset=from.path[i-1];return{from:new _pos.Pos(path,offset),to:new _pos.Pos(path,offset+1)}}var fromEnd=i==from.path.length,toEnd=i==to.path.length,left=fromEnd?from.offset:from.path[i],right=toEnd?to.offset:to.path[i];if(fromEnd||toEnd||left!=right){var path=from.path.slice(0,i);return{from:new _pos.Pos(path,left),to:new _pos.Pos(path,right+(toEnd?0:1))}}node=node.child(left)}}},{key:"nodesBetween",value:function(from,to,f){var path=arguments.length<=3||void 0===arguments[3]?[]:arguments[3],parent=arguments.length<=4||void 0===arguments[4]?null:arguments[4];f(this,path,parent)!==!1&&this.content.nodesBetween(from,to,f,path,this)}},{key:"inlineNodesBetween",value:function(from,to,f){this.nodesBetween(from,to,function(node,path,parent){if(node.isInline){var last=path.length-1;f(node,path.slice(0,last),path[last],path[last]+node.width,parent)}})}},{key:"sliceBetween",value:function(from,to){var depth=arguments.length<=2||void 0===arguments[2]?0:arguments[2];return this.copy(this.content.sliceBetween(from,to,depth))}},{key:"marksAt",value:function(pos){var parent=this.path(pos.path);return parent.isTextblock&&parent.size?parent.chunkBefore(pos.offset||1).node.marks:emptyArray}},{key:"rangeHasMark",value:function(from,to,type){var found=!1;return this.nodesBetween(from,to,function(node){type.isInSet(node.marks)&&(found=!0)}),found}},{key:"toString",value:function(){var name=this.type.name;return this.content.size&&(name+="("+this.content.toString()+")"),wrapMarks(this.marks,name)}},{key:"toJSON",value:function(){var obj={type:this.type.name};for(var _ in this.attrs){obj.attrs=this.attrs;break}return this.size&&(obj.content=this.content.toJSON()),this.marks.length&&(obj.marks=this.marks.map(function(n){return n.toJSON()})),obj}},{key:"size",get:function(){return this.content.size}},{key:"width",get:function(){return 1}},{key:"textContent",get:function(){return this.content.textContent}},{key:"firstChild",get:function(){return this.content.firstChild}},{key:"lastChild",get:function(){return this.content.lastChild}},{key:"isBlock",get:function(){return this.type.isBlock}},{key:"isTextblock",get:function(){return this.type.isTextblock}},{key:"isInline",get:function(){return this.type.isInline}},{key:"isText",get:function(){return this.type.isText}},{key:"value",get:function(){return this}}],[{key:"sameAttrs",value:function(a,b){if(a==b)return!0;for(var prop in a)if(a[prop]!==b[prop])return!1;return!0}},{key:"fromJSON",value:function(schema,json){var type=schema.nodeType(json.type),content=null!=json.text?json.text:_fragment.Fragment.fromJSON(schema,json.content);return type.create(json.attrs,content,json.marks&&json.marks.map(schema.markFromJSON))}}]),Node}();exports.Node=Node,"undefined"!=typeof Symbol&&(Node.prototype[Symbol.iterator]=function(){return this.iter()});exports.TextNode=function(_Node){function TextNode(type,attrs,content,marks){_classCallCheck(this,TextNode);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(TextNode).call(this,type,attrs,null,marks));return _this.text=content,_this}return _inherits(TextNode,_Node),_createClass(TextNode,[{key:"toString",value:function(){return wrapMarks(this.marks,JSON.stringify(this.text))}},{key:"mark",value:function(marks){return new TextNode(this.type,this.attrs,this.text,marks)}},{key:"toJSON",value:function(){var base=_get(Object.getPrototypeOf(TextNode.prototype),"toJSON",this).call(this);return base.text=this.text,base}},{key:"textContent",get:function(){return this.text}},{key:"width",get:function(){return this.text.length}}]),TextNode}(Node)},{"./fragment":33,"./mark":35,"./pos":37}],37:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.Pos=void 0;var _error=require("./error");exports.Pos=function(){function Pos(path,offset){_classCallCheck(this,Pos),this.path=path,this.offset=offset}return _createClass(Pos,[{key:"toString",value:function(){return this.path.join("/")+":"+this.offset}},{key:"max",value:function(other){return this.cmp(other)>0?this:other}},{key:"min",value:function(other){return this.cmp(other)<0?this:other}},{key:"cmp",value:function(other){return other==this?0:Pos.cmp(this.path,this.offset,other.path,other.offset)}},{key:"shorten",value:function(){var to=arguments.length<=0||void 0===arguments[0]?null:arguments[0],offset=arguments.length<=1||void 0===arguments[1]?0:arguments[1];if(to>=this.depth){if(to==this.depth&&!offset)return new Pos(this.path,this.offset+offset);_error.ModelError.raise("Invalid shorten depth "+to+" for "+this)}return Pos.shorten(this.path,to,offset)}},{key:"move",value:function(by){return new Pos(this.path,this.offset+by)}},{key:"toPath",value:function(){var move=arguments.length<=0||void 0===arguments[0]?0:arguments[0];return this.path.concat(this.offset+move)}},{key:"extend",value:function(pos){for(var path=this.path.slice(),add=this.offset,i=0;i<pos.path.length;i++)path.push(pos.path[i]+add),add=0;return new Pos(path,pos.offset+add)}},{key:"isValid",value:function(doc,requireTextblock){for(var i=0,node=doc;;i++){if(i==this.path.length)return requireTextblock&&!node.isTextblock?!1:this.offset<=node.size;var n=this.path[i];if(n>=node.size)return!1;node=node.child(n)}}},{key:"toJSON",value:function(){return this}},{key:"depth",get:function(){return this.path.length}}],[{key:"cmp",value:function(pathA,offsetA,pathB,offsetB){for(var lenA=pathA.length,lenB=pathB.length,i=0,end=Math.min(lenA,lenB);end>i;i++){var diff=pathA[i]-pathB[i];if(0!=diff)return diff}return lenA>lenB?offsetB<=pathA[i]?1:-1:lenB>lenA?offsetA<=pathB[i]?-1:1:offsetA-offsetB}},{key:"samePath",value:function(pathA,pathB){if(pathA.length!=pathB.length)return!1;for(var i=0;i<pathA.length;i++)if(pathA[i]!==pathB[i])return!1;return!0}},{key:"shorten",value:function(path){var to=arguments.length<=1||void 0===arguments[1]?null:arguments[1],offset=arguments.length<=2||void 0===arguments[2]?0:arguments[2];return null==to&&(to=path.length-1),new Pos(path.slice(0,to),path[to]+offset)}},{key:"from",value:function(array){var move=arguments.length<=1||void 0===arguments[1]?0:arguments[1];return array.length||_error.ModelError.raise("Can't create a pos from an empty array"),new Pos(array.slice(0,array.length-1),array[array.length-1]+move)}},{key:"fromJSON",value:function(json){return new Pos(json.path,json.offset)}}]),Pos}()},{"./error":32}],38:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function overlayObj(base,update){var copy=(0,_obj.copyObj)(base);for(var name in update){var value=update[name];null==value?delete copy[name]:copy[name]=value}return copy}var _get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;if(void 0!==getter)return getter.call(receiver)},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.Schema=exports.SchemaSpec=exports.MarkType=exports.Attribute=exports.Text=exports.Inline=exports.Textblock=exports.Block=exports.NodeType=exports.SchemaError=void 0;var _node=require("./node"),_fragment=require("./fragment"),_mark=require("./mark"),_obj=require("../util/obj"),_error=require("../util/error"),SchemaError=exports.SchemaError=function(_ProseMirrorError){function SchemaError(){return _classCallCheck(this,SchemaError),_possibleConstructorReturn(this,Object.getPrototypeOf(SchemaError).apply(this,arguments))}return _inherits(SchemaError,_ProseMirrorError),SchemaError}(_error.ProseMirrorError),SchemaItem=function(){function SchemaItem(){_classCallCheck(this,SchemaItem)}return _createClass(SchemaItem,[{key:"getDefaultAttrs",value:function(){var defaults=Object.create(null);for(var attrName in this.attrs){var attr=this.attrs[attrName];if(null==attr["default"])return null;defaults[attrName]=attr["default"]}return defaults}},{key:"computeAttrs",value:function(attrs,arg){var built=Object.create(null);for(var name in this.attrs){var value=attrs&&attrs[name];if(null==value){var attr=this.attrs[name];null!=attr["default"]?value=attr["default"]:attr.compute?value=attr.compute(this,arg):SchemaError.raise("No value supplied for attribute "+name)}built[name]=value}return built}},{key:"freezeAttrs",value:function(){var frozen=Object.create(null);for(var name in this.attrs)frozen[name]=this.attrs[name];Object.defineProperty(this,"attrs",{value:frozen})}},{key:"attrs",get:function(){return{}}}],[{key:"updateAttrs",value:function(attrs){Object.defineProperty(this.prototype,"attrs",{value:overlayObj(this.prototype.attrs,attrs)})}},{key:"getRegistry",value:function(){return this==SchemaItem?null:(this.prototype.hasOwnProperty("registry")||(this.prototype.registry=Object.create(Object.getPrototypeOf(this).getRegistry())),this.prototype.registry)}},{key:"getNamespace",value:function(name){if(this==SchemaItem)return null;var reg=this.getRegistry();return Object.prototype.hasOwnProperty.call(reg,name)||(reg[name]=Object.create(Object.getPrototypeOf(this).getNamespace(name))),reg[name]}},{key:"register",value:function(namespace,name,value){this.getNamespace(namespace)[name]=function(){return value}}},{key:"registerComputed",value:function(namespace,name,f){this.getNamespace(namespace)[name]=f}},{key:"cleanNamespace",value:function(namespace){this.getNamespace(namespace).__proto__=null}}]),SchemaItem}(),NodeType=exports.NodeType=function(_SchemaItem){function NodeType(name,kind,schema){_classCallCheck(this,NodeType);var _this2=_possibleConstructorReturn(this,Object.getPrototypeOf(NodeType).call(this));return _this2.name=name,_this2.kind=kind,_this2.freezeAttrs(),_this2.defaultAttrs=_this2.getDefaultAttrs(),_this2.schema=schema,_this2}return _inherits(NodeType,_SchemaItem),_createClass(NodeType,[{key:"canContainFragment",value:function(fragment){var _this3=this,ok=!0;return fragment.forEach(function(n){_this3.canContain(n)||(ok=!1)}),ok}},{key:"canContain",value:function(node){if(!this.canContainType(node.type))return!1;for(var i=0;i<node.marks.length;i++)if(!this.canContainMark(node.marks[i]))return!1;return!0}},{key:"canContainMark",value:function(mark){var contains=this.containsMarks;if(contains===!0)return!0;if(contains)for(var i=0;i<contains.length;i++)if(contains[i]==mark.name)return!0;return!1}},{key:"canContainType",value:function(type){return this.schema.subKind(type.kind,this.contains)}},{key:"canContainContent",value:function(type){return this.schema.subKind(type.contains,this.contains)}},{key:"findConnection",value:function(other){if(this.canContainType(other))return[];for(var seen=Object.create(null),active=[{from:this,via:[]}];active.length;){var current=active.shift();for(var name in this.schema.nodes){var type=this.schema.nodes[name];if(type.defaultAttrs&&!(type.contains in seen)&&current.from.canContainType(type)){var via=current.via.concat(type);if(type.canContainType(other))return via;active.push({from:type,via:via}),seen[type.contains]=!0}}}}},{key:"computeAttrs",value:function(attrs,content){return!attrs&&this.defaultAttrs?this.defaultAttrs:_get(Object.getPrototypeOf(NodeType.prototype),"computeAttrs",this).call(this,attrs,content)}},{key:"create",value:function(attrs,content,marks){return new _node.Node(this,this.computeAttrs(attrs,content),_fragment.Fragment.from(content),_mark.Mark.setFrom(marks))}},{key:"createAutoFill",value:function(attrs,content,marks){return content&&0!=content.length||this.canBeEmpty||(content=this.defaultContent()),this.create(attrs,content,marks)}},{key:"isBlock",get:function(){return!1}},{key:"isTextblock",get:function(){return!1}},{key:"isInline",get:function(){return!1}},{key:"isText",get:function(){return!1}},{key:"selectable",get:function(){return!0}},{key:"draggable",get:function(){return!1}},{key:"locked",get:function(){return!1}},{key:"contains",get:function(){return null}},{key:"canBeEmpty",get:function(){return!0}},{key:"containsMarks",get:function(){return!1}}],[{key:"compile",value:function(types,schema){var result=Object.create(null);for(var name in types){for(var type=types[name],kinds=type.kinds.split(" "),i=0;i<kinds.length;i++)schema.registerKind(kinds[i],i?kinds[i-1]:null);result[name]=new type(name,kinds[kinds.length-1],schema)}for(var name in result){var contains=result[name].contains;!contains||contains in schema.kinds||SchemaError.raise("Node type "+name+" is specified to contain non-existing kind "+contains)}return result.doc||SchemaError.raise("Every schema needs a 'doc' type"),result.text||SchemaError.raise("Every schema needs a 'text' type"),result}},{key:"kinds",get:function(){return"node"}}]),NodeType}(SchemaItem),Block=exports.Block=function(_NodeType){function Block(){return _classCallCheck(this,Block),_possibleConstructorReturn(this,Object.getPrototypeOf(Block).apply(this,arguments))}return _inherits(Block,_NodeType),_createClass(Block,[{key:"defaultContent",value:function(){var inner=this.schema.defaultTextblockType().create(),conn=this.findConnection(inner.type);conn||SchemaError.raise("Can't create default content for "+this.name);for(var i=conn.length-1;i>=0;i--)inner=conn[i].create(null,inner);return _fragment.Fragment.from(inner)}},{key:"contains",get:function(){return"block"}},{key:"isBlock",get:function(){return!0}},{key:"canBeEmpty",get:function(){return null==this.contains}}],[{key:"kinds",get:function(){return"block"}}]),Block}(NodeType),Inline=(exports.Textblock=function(_Block){function Textblock(){return _classCallCheck(this,Textblock),_possibleConstructorReturn(this,Object.getPrototypeOf(Textblock).apply(this,arguments))}return _inherits(Textblock,_Block),_createClass(Textblock,[{key:"contains",get:function(){return"inline"}},{key:"containsMarks",get:function(){return!0}},{key:"isTextblock",get:function(){return!0}},{key:"canBeEmpty",get:function(){return!0}}]),Textblock}(Block),exports.Inline=function(_NodeType2){function Inline(){return _classCallCheck(this,Inline),_possibleConstructorReturn(this,Object.getPrototypeOf(Inline).apply(this,arguments))}return _inherits(Inline,_NodeType2),_createClass(Inline,[{key:"isInline",get:function(){return!0}}],[{key:"kinds",get:function(){return"inline"}}]),Inline}(NodeType)),MarkType=(exports.Text=function(_Inline){function Text(){return _classCallCheck(this,Text),_possibleConstructorReturn(this,Object.getPrototypeOf(Text).apply(this,arguments))}return _inherits(Text,_Inline),_createClass(Text,[{key:"create",value:function(attrs,content,marks){return new _node.TextNode(this,this.computeAttrs(attrs,content),content,marks)}},{key:"selectable",get:function(){return!1}},{key:"isText",get:function(){return!0}}],[{key:"kinds",get:function(){return _get(Object.getPrototypeOf(Text),"kinds",this)+" text"}}]),Text}(Inline),exports.Attribute=function Attribute(){var options=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,Attribute),this["default"]=options["default"],this.compute=options.compute,this.label=options.label},exports.MarkType=function(_SchemaItem2){function MarkType(name,rank,schema){_classCallCheck(this,MarkType);var _this8=_possibleConstructorReturn(this,Object.getPrototypeOf(MarkType).call(this));_this8.name=name,_this8.freezeAttrs(),_this8.rank=rank,_this8.schema=schema;var defaults=_this8.getDefaultAttrs();return _this8.instance=defaults&&new _mark.Mark(_this8,defaults),_this8}return _inherits(MarkType,_SchemaItem2),_createClass(MarkType,[{key:"create",value:function(attrs){return!attrs&&this.instance?this.instance:new _mark.Mark(this,this.computeAttrs(attrs))}},{key:"removeFromSet",value:function(set){for(var i=0;i<set.length;i++)if(set[i].type==this)return set.slice(0,i).concat(set.slice(i+1));return set}},{key:"isInSet",value:function(set){for(var i=0;i<set.length;i++)if(set[i].type==this)return set[i]}}],[{key:"getOrder",value:function(marks){var sorted=[];for(var name in marks)sorted.push({name:name,rank:marks[name].rank});sorted.sort(function(a,b){return a.rank-b.rank});for(var ranks=Object.create(null),i=0;i<sorted.length;i++)ranks[sorted[i].name]=i;return ranks}},{key:"compile",value:function(marks,schema){var order=this.getOrder(marks),result=Object.create(null);for(var name in marks)result[name]=new marks[name](name,order[name],schema);return result}},{key:"rank",get:function(){return 50}}]),MarkType}(SchemaItem)),Schema=(exports.SchemaSpec=function(){function SchemaSpec(nodes,marks){_classCallCheck(this,SchemaSpec),this.nodes=nodes||{},this.marks=marks||{}}return _createClass(SchemaSpec,[{key:"update",value:function(nodes,marks){return new SchemaSpec(nodes?overlayObj(this.nodes,nodes):this.nodes,marks?overlayObj(this.marks,marks):this.marks)}}]),SchemaSpec}(),function(){function Schema(spec){_classCallCheck(this,Schema),this.spec=spec,this.kinds=Object.create(null),this.nodes=NodeType.compile(spec.nodes,this),this.marks=MarkType.compile(spec.marks,this);for(var prop in this.nodes)prop in this.marks&&SchemaError.raise(prop+" can not be both a node and a mark");this.cached=Object.create(null),this.node=this.node.bind(this),this.text=this.text.bind(this),this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this)}return _createClass(Schema,[{key:"node",value:function(type,attrs,content,marks){return"string"==typeof type?type=this.nodeType(type):type instanceof NodeType?type.schema!=this&&SchemaError.raise("Node type from different schema used ("+type.name+")"):SchemaError.raise("Invalid node type: "+type),type.create(attrs,content,marks)}},{key:"text",value:function(_text,marks){return this.nodes.text.create(null,_text,_mark.Mark.setFrom(marks))}},{key:"defaultTextblockType",value:function(){var cached=this.cached.defaultTextblockType;if(void 0!==cached)return cached;for(var name in this.nodes)if(this.nodes[name].defaultTextblock)return this.cached.defaultTextblockType=this.nodes[name];return this.cached.defaultTextblockType=null}},{key:"mark",value:function(name,attrs){var spec=this.marks[name]||SchemaError.raise("No mark named "+name);return spec.create(attrs)}},{key:"nodeFromJSON",value:function(json){return _node.Node.fromJSON(this,json)}},{key:"markFromJSON",value:function(json){var type=this.marks[json._],attrs=null;for(var prop in json)"_"!=prop&&(attrs||(attrs=Object.create(null)),attrs[prop]=json[prop]);return attrs?type.create(attrs):type.instance}},{key:"nodeType",value:function(name){return this.nodes[name]||SchemaError.raise("Unknown node type: "+name)}},{key:"registerKind",value:function(kind,sup){if(kind in this.kinds){if(this.kinds[kind]==sup)return;SchemaError.raise("Inconsistent superkinds for kind "+kind+": "+sup+" and "+this.kinds[kind])}this.subKind(kind,sup)&&SchemaError.raise("Conflicting kind hierarchy through "+kind+" and "+sup),this.kinds[kind]=sup}},{key:"subKind",value:function(sub,sup){for(;;){if(sub==sup)return!0;if(sub=this.kinds[sub],!sub)return!1}}},{key:"registry",value:function registry(namespace,f){for(var i=0;2>i;i++){var obj=i?this.marks:this.nodes;for(var tname in obj){var type=obj[tname],registry=type.registry,ns=registry&&registry[namespace];if(ns)for(var prop in ns){var value=ns[prop](type);null!=value&&f(prop,value,type,tname)}}}}}]),Schema}());exports.Schema=Schema},{"../util/error":52,"../util/obj":55,"./fragment":33,"./mark":35,"./node":36}],39:[function(require,module,exports){"use strict";function canBeLifted(doc,range){for(var content=[doc.path(range.from.path)],unwrap=!1;;){for(var parentDepth=-1,_loop=function(_node,i){content.some(function(inner){return!_node.type.canContainContent(inner.type)})||(parentDepth=i),_node=_node.child(range.from.path[i]),node=_node},node=doc,i=0;i<range.from.path.length;i++)_loop(node,i);if(parentDepth>-1)return{path:range.from.path.slice(0,parentDepth),unwrap:unwrap};if(unwrap||!content[0].isBlock)return null;content=content[0].content.slice(range.from.offset,range.to.offset),unwrap=!0}}function canLift(doc,from,to){var range=doc.siblingRange(from,to||from),found=canBeLifted(doc,range);return found?{found:found,range:range}:void 0}function canWrap(doc,from,to,type){var range=doc.siblingRange(from,to||from);if(range.from.offset==range.to.offset)return null;var parent=doc.path(range.from.path),around=parent.type.findConnection(type),inside=type.findConnection(parent.child(range.from.offset).type);return around&&inside?{range:range,around:around,inside:inside}:void 0}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj};Object.defineProperty(exports,"__esModule",{value:!0}),exports.canLift=canLift,exports.canWrap=canWrap;var _model=require("../model"),_transform=require("./transform"),_step=require("./step"),_tree=require("./tree"),_map=require("./map");_step.Step.define("ancestor",{apply:function(doc,step){var from=step.from,to=step.to;if(!(0,_tree.isFlatRange)(from,to))return null;for(var toParent=from.path,start=from.offset,end=to.offset,_step$param=step.param,_step$param$depth=_step$param.depth,depth=void 0===_step$param$depth?0:_step$param$depth,_step$param$types=_step$param.types,types=void 0===_step$param$types?[]:_step$param$types,_step$param$attrs=_step$param.attrs,attrs=void 0===_step$param$attrs?[]:_step$param$attrs,inner=doc.path(from.path),i=0;depth>i;i++){if(start>0||end<doc.path(toParent).size||0==toParent.length)return null;start=toParent[toParent.length-1],end=start+1,toParent=toParent.slice(0,toParent.length-1)}if(0==depth&&0==types.length)return null;var parent=doc.path(toParent),parentSize=parent.size,newParent=void 0;if(parent.type.locked)return null;if(types.length){var _ret=function(){var lastWrapper=types[types.length-1],content=inner.content.slice(from.offset,to.offset);if(!parent.type.canContainType(types[0])||content.some(function(n){return!lastWrapper.canContain(n)})||!inner.size&&!lastWrapper.canBeEmpty||lastWrapper.locked)return{v:null};for(var node=null,i=types.length-1;i>=0;i--)node=types[i].create(attrs[i],node||content);newParent=parent.splice(start,end,_model.Fragment.from(node))}();if("object"===("undefined"==typeof _ret?"undefined":_typeof(_ret)))return _ret.v}else{if(!parent.type.canContainFragment(inner.content)||!inner.size&&0==start&&end==parent.size&&!parent.type.canBeEmpty)return null;newParent=parent.splice(start,end,inner.content)}for(var copy=doc.replaceDeep(toParent,newParent),toInner=toParent.slice(),i=0;i<types.length;i++)toInner.push(i?0:start);var startOfInner=new _model.Pos(toInner,types.length?0:start),replaced=null,insertedSize=types.length?1:to.offset-from.offset;if(depth!=types.length||depth>1||types.length>1){var posBefore=new _model.Pos(toParent,start),posAfter1=new _model.Pos(toParent,end),posAfter2=new _model.Pos(toParent,start+insertedSize),endOfInner=new _model.Pos(toInner,startOfInner.offset+(to.offset-from.offset));replaced=[new _map.ReplacedRange(posBefore,from,posBefore,startOfInner),new _map.ReplacedRange(to,posAfter1,endOfInner,posAfter2,posAfter1,posAfter2)]}var moved=[new _map.MovedRange(from,to.offset-from.offset,startOfInner)];return end-start!=insertedSize&&moved.push(new _map.MovedRange(new _model.Pos(toParent,end),parentSize-end,new _model.Pos(toParent,start+insertedSize))),new _step.StepResult(copy,new _map.PosMap(moved,replaced))},invert:function(step,oldDoc,map){var types=[],attrs=[];if(step.param.depth)for(var i=0;i<step.param.depth;i++){var parent=oldDoc.path(step.from.path.slice(0,step.from.path.length-i));types.unshift(parent.type),attrs.unshift(parent.attrs)}var newFrom=map.map(step.from).pos,newTo=step.from.cmp(step.to)?map.map(step.to,-1).pos:newFrom;return new _step.Step("ancestor",newFrom,newTo,null,{depth:step.param.types?step.param.types.length:0,types:types,attrs:attrs})},paramToJSON:function(param){return{depth:param.depth,types:param.types&&param.types.map(function(t){return t.name}),attrs:param.attrs}},paramFromJSON:function(schema,json){return{depth:json.depth,types:json.types&&json.types.map(function(n){return schema.nodeType(n)}),attrs:json.attrs}}}),_transform.Transform.prototype.lift=function(from){var to=arguments.length<=1||void 0===arguments[1]?from:arguments[1],can=canLift(this.doc,from,to);if(!can)return this;for(var found=can.found,range=can.range,depth=range.from.path.length-found.path.length,rangeNode=found.unwrap&&this.doc.path(range.from.path),d=0,pos=range.to;;d++){if(pos.offset<this.doc.path(pos.path).size){this.split(pos,depth-d);break}if(d==depth-1)break;pos=pos.shorten(null,1)}for(var d=0,pos=range.from;;d++){if(pos.offset>0){this.split(pos,depth-d);for(var cut=range.from.path.length-depth,path=pos.path.slice(0,cut).concat(pos.path[cut]+1);path.length<range.from.path.length;)path.push(0);range={from:new _model.Pos(path,0),to:new _model.Pos(path,range.to.offset-range.from.offset)};break}if(d==depth-1)break;pos=pos.shorten()}if(found.unwrap){for(var i=range.to.offset-1;i>range.from.offset;i--)this.join(new _model.Pos(range.from.path,i));for(var child,size=0,i=rangeNode.iter(range.from.offset,range.to.offset);child=i.next().value;)size+=child.size;var path=range.from.path.concat(range.from.offset);range={from:new _model.Pos(path,0),to:new _model.Pos(path,size)},++depth}return this.step("ancestor",range.from,range.to,null,{depth:depth}),this},_transform.Transform.prototype.wrap=function(from,to,type,wrapAttrs){var can=canWrap(this.doc,from,to,type);if(!can)return this;var range=can.range,around=can.around,inside=can.inside,types=around.concat(type).concat(inside),attrs=around.map(function(){return null}).concat(wrapAttrs).concat(inside.map(function(){return null}));if(this.step("ancestor",range.from,range.to,null,{types:types,attrs:attrs}),inside.length){for(var toInner=range.from.path.slice(),i=0;i<around.length+inside.length+1;i++)toInner.push(i?0:range.from.offset);for(var i=range.to.offset-1-range.from.offset;i>0;i--)this.split(new _model.Pos(toInner,i),inside.length)}return this},_transform.Transform.prototype.setBlockType=function(from,to,type,attrs){var _this=this;return this.doc.nodesBetween(from,to||from,function(node,path){return node.isTextblock&&!node.hasMarkup(type,attrs)?(path=path.slice(),_this.clearMarkup(new _model.Pos(path,0),new _model.Pos(path,node.size),type),_this.step("ancestor",new _model.Pos(path,0),new _model.Pos(path,_this.doc.path(path).size),null,{depth:1,types:[type],attrs:[attrs]}),!1):void 0}),this},_transform.Transform.prototype.setNodeType=function(pos,type,attrs){var node=this.doc.nodeAfter(pos),path=pos.toPath();return this.step("ancestor",new _model.Pos(path,0),new _model.Pos(path,node.size),null,{depth:1,types:[type],attrs:[attrs]}),this}},{"../model":34,"./map":42,"./step":46,"./transform":47,"./tree":48}],40:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Remapping=exports.MapResult=exports.PosMap=exports.joinableBlocks=exports.joinPoint=exports.canWrap=exports.canLift=exports.StepResult=exports.Step=exports.Transform=void 0;var _transform=require("./transform");Object.defineProperty(exports,"Transform",{enumerable:!0,get:function(){return _transform.Transform}});var _step=require("./step");Object.defineProperty(exports,"Step",{enumerable:!0,get:function(){return _step.Step}}),Object.defineProperty(exports,"StepResult",{enumerable:!0,get:function(){return _step.StepResult}});var _ancestor=require("./ancestor");Object.defineProperty(exports,"canLift",{enumerable:!0,get:function(){return _ancestor.canLift}}),Object.defineProperty(exports,"canWrap",{enumerable:!0,get:function(){return _ancestor.canWrap}});var _join=require("./join");Object.defineProperty(exports,"joinPoint",{enumerable:!0,get:function(){return _join.joinPoint}}),Object.defineProperty(exports,"joinableBlocks",{enumerable:!0,get:function(){return _join.joinableBlocks;
}});var _map=require("./map");Object.defineProperty(exports,"PosMap",{enumerable:!0,get:function(){return _map.PosMap}}),Object.defineProperty(exports,"MapResult",{enumerable:!0,get:function(){return _map.MapResult}}),Object.defineProperty(exports,"Remapping",{enumerable:!0,get:function(){return _map.Remapping}}),require("./mark"),require("./split"),require("./replace")},{"./ancestor":39,"./join":41,"./map":42,"./mark":43,"./replace":44,"./split":45,"./step":46,"./transform":47}],41:[function(require,module,exports){"use strict";function joinableBlocks(doc,pos){if(0==pos.offset)return!1;var parent=doc.path(pos.path);if(parent.isTextblock||pos.offset==parent.size)return!1;var type=parent.child(pos.offset-1).type;return!type.isTextblock&&type.contains&&type==parent.child(pos.offset).type}function joinPoint(doc,pos){for(var dir=arguments.length<=2||void 0===arguments[2]?-1:arguments[2];;){if(joinableBlocks(doc,pos))return pos;if(0==pos.depth)return null;pos=pos.shorten(null,0>dir?0:1)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.joinableBlocks=joinableBlocks,exports.joinPoint=joinPoint;var _model=require("../model"),_transform=require("./transform"),_step=require("./step"),_map=require("./map");_step.Step.define("join",{apply:function(doc,step){var before=doc.path(step.from.path),after=doc.path(step.to.path);if(step.from.offset<before.size||step.to.offset>0||!before.type.canContainFragment(after.content))return null;var pFrom=step.from.path,pTo=step.to.path,last=pFrom.length-1,offset=pFrom[last]+1;if(pFrom.length!=pTo.length||0==pFrom.length||offset!=pTo[last])return null;for(var i=0;last>i;i++)if(pFrom[i]!=pTo[i])return null;var targetPath=pFrom.slice(0,last),target=doc.path(targetPath),oldSize=target.size;if(target.type.locked)return null;var joined=before.append(after.content),copy=doc.replaceDeep(targetPath,target.splice(offset-1,offset+1,_model.Fragment.from(joined))),map=new _map.PosMap([new _map.MovedRange(step.to,after.size,step.from),new _map.MovedRange(new _model.Pos(targetPath,offset+1),oldSize-offset-1,new _model.Pos(targetPath,offset))],[new _map.ReplacedRange(step.from,step.to,step.from,step.from,step.to.shorten())]);return new _step.StepResult(copy,map)},invert:function(step,oldDoc){return new _step.Step("split",null,null,step.from,oldDoc.path(step.to.path).copy())}}),_transform.Transform.prototype.join=function(at){var parent=this.doc.path(at.path);return 0==at.offset||at.offset==parent.size||parent.isTextblock?this:(this.step("join",new _model.Pos(at.path.concat(at.offset-1),parent.child(at.offset-1).size),new _model.Pos(at.path.concat(at.offset),0)),this)}},{"../model":34,"./map":42,"./step":46,"./transform":47}],42:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function offsetFrom(base,pos){if(pos.path.length>base.path.length){for(var path=[pos.path[base.path.length]-base.offset],i=base.path.length+1;i<pos.path.length;i++)path.push(pos.path[i]);return new _model.Pos(path,pos.offset)}return new _model.Pos([],pos.offset-base.offset)}function mapThrough(map,pos){for(var bias=arguments.length<=2||void 0===arguments[2]?1:arguments[2],back=arguments[3],i=0;i<map.replaced.length;i++){var range=map.replaced[i],side=back?range.after:range.before,left=void 0,right=void 0;if((left=pos.cmp(side.from))>=0&&(right=pos.cmp(side.to))<=0){var other=back?range.before:range.after;return new MapResult(0>bias?other.from:other.to,!(!left||!right),{rangeID:i,offset:offsetFrom(side.ref,pos)})}}for(var i=0;i<map.moved.length;i++){var range=map.moved[i],start=back?range.dest:range.start;if(pos.cmp(start)>=0&&_model.Pos.cmp(pos.path,pos.offset,start.path,start.offset+range.size)<=0){var dest=back?range.start:range.dest,depth=start.depth;if(pos.depth>depth){var offset=dest.offset+(pos.path[depth]-start.offset);return new MapResult(new _model.Pos(dest.path.concat(offset).concat(pos.path.slice(depth+1)),pos.offset))}return new MapResult(new _model.Pos(dest.path,dest.offset+(pos.offset-start.offset)))}}return new MapResult(pos)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.Remapping=exports.nullMap=exports.MapResult=exports.PosMap=exports.ReplacedRange=exports.MovedRange=void 0;var _model=require("../model"),Side=(exports.MovedRange=function(){function MovedRange(start,size){var dest=arguments.length<=2||void 0===arguments[2]?null:arguments[2];_classCallCheck(this,MovedRange),this.start=start,this.size=size,this.dest=dest}return _createClass(MovedRange,[{key:"toString",value:function(){return"[moved "+this.start+"+"+this.size+" to "+this.dest+"]"}},{key:"end",get:function(){return new _model.Pos(this.start.path,this.start.offset+this.size)}}]),MovedRange}(),function Side(from,to,ref){_classCallCheck(this,Side),this.from=from,this.to=to,this.ref=ref}),empty=(exports.ReplacedRange=function(){function ReplacedRange(from,to,newFrom,newTo){var ref=arguments.length<=4||void 0===arguments[4]?from:arguments[4],newRef=arguments.length<=5||void 0===arguments[5]?newFrom:arguments[5];_classCallCheck(this,ReplacedRange),this.before=new Side(from,to,ref),this.after=new Side(newFrom,newTo,newRef)}return _createClass(ReplacedRange,[{key:"toString",value:function(){return"[replaced "+this.before.from+"-"+this.before.to+" with "+this.after.from+"-"+this.after.to+"]"}}]),ReplacedRange}(),[]),PosMap=exports.PosMap=function(){function PosMap(moved,replaced){_classCallCheck(this,PosMap),this.moved=moved||empty,this.replaced=replaced||empty}return _createClass(PosMap,[{key:"recover",value:function(offset){return this.replaced[offset.rangeID].after.ref.extend(offset.offset)}},{key:"map",value:function(pos,bias){return mapThrough(this,pos,bias,!1)}},{key:"invert",value:function(){return new InvertedPosMap(this)}},{key:"toString",value:function(){return this.moved.concat(this.replaced).join(" ")}}]),PosMap}(),MapResult=exports.MapResult=function MapResult(pos){var deleted=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],recover=arguments.length<=2||void 0===arguments[2]?null:arguments[2];_classCallCheck(this,MapResult),this.pos=pos,this.deleted=deleted,this.recover=recover},InvertedPosMap=function(){function InvertedPosMap(map){_classCallCheck(this,InvertedPosMap),this.inner=map}return _createClass(InvertedPosMap,[{key:"recover",value:function(offset){return this.inner.replaced[offset.rangeID].before.ref.extend(offset.offset)}},{key:"map",value:function(pos,bias){return mapThrough(this.inner,pos,bias,!0)}},{key:"invert",value:function(){return this.inner}},{key:"toString",value:function(){return"-"+this.inner}}]),InvertedPosMap}();exports.nullMap=new PosMap,exports.Remapping=function(){function Remapping(){var head=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],tail=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],mirror=arguments.length<=2||void 0===arguments[2]?Object.create(null):arguments[2];_classCallCheck(this,Remapping),this.head=head,this.tail=tail,this.mirror=mirror}return _createClass(Remapping,[{key:"addToFront",value:function(map,corr){this.head.push(map);var id=-this.head.length;return null!=corr&&(this.mirror[id]=corr),id}},{key:"addToBack",value:function(map,corr){this.tail.push(map);var id=this.tail.length-1;return null!=corr&&(this.mirror[corr]=id),id}},{key:"get",value:function(id){return 0>id?this.head[-id-1]:this.tail[id]}},{key:"map",value:function map(pos,bias){for(var deleted=!1,i=-this.head.length;i<this.tail.length;i++){var map=this.get(i),result=map.map(pos,bias);if(result.recover){var corr=this.mirror[i];if(null!=corr){i=corr,pos=this.get(corr).recover(result.recover);continue}}result.deleted&&(deleted=!0),pos=result.pos}return new MapResult(pos,deleted)}}]),Remapping}()},{"../model":34}],43:[function(require,module,exports){"use strict";var _model=require("../model"),_transform=require("./transform"),_step=require("./step"),_tree=require("./tree");_step.Step.define("addMark",{apply:function(doc,step){return new _step.StepResult((0,_tree.copyStructure)(doc,step.from,step.to,function(node,from,to){return node.type.canContainMark(step.param)?(0,_tree.copyInline)(node,from,to,function(node){return node.mark(step.param.addToSet(node.marks))}):node}))},invert:function(step,_oldDoc,map){return new _step.Step("removeMark",step.from,map.map(step.to).pos,null,step.param)},paramToJSON:function(param){return param.toJSON()},paramFromJSON:function(schema,json){return schema.markFromJSON(json)}}),_transform.Transform.prototype.addMark=function(from,to,mark){var _this=this,removed=[],added=[],removing=null,adding=null;return this.doc.inlineNodesBetween(from,to,function(_ref,path,start,end,parent){var marks=_ref.marks;if(mark.isInSet(marks)||!parent.type.canContainMark(mark.type))adding=removing=null;else{var rm=mark.type.isInSet(marks);rm?removing&&removing.param.eq(rm)?removing.to=new _model.Pos(path,end):(removing=new _step.Step("removeMark",new _model.Pos(path,start),new _model.Pos(path,end),null,rm),removed.push(removing)):removing&&(removing=null),adding?adding.to=new _model.Pos(path,end):(adding=new _step.Step("addMark",new _model.Pos(path,start),new _model.Pos(path,end),null,mark),added.push(adding))}}),removed.forEach(function(s){return _this.step(s)}),added.forEach(function(s){return _this.step(s)}),this},_step.Step.define("removeMark",{apply:function(doc,step){return new _step.StepResult((0,_tree.copyStructure)(doc,step.from,step.to,function(node,from,to){return(0,_tree.copyInline)(node,from,to,function(node){return node.mark(step.param.removeFromSet(node.marks))})}))},invert:function(step,_oldDoc,map){return new _step.Step("addMark",step.from,map.map(step.to).pos,null,step.param)},paramToJSON:function(param){return param.toJSON()},paramFromJSON:function(schema,json){return schema.markFromJSON(json)}}),_transform.Transform.prototype.removeMark=function(from,to){var _this2=this,mark=arguments.length<=2||void 0===arguments[2]?null:arguments[2],matched=[],step=0;return this.doc.inlineNodesBetween(from,to,function(_ref2,path,start,end){var marks=_ref2.marks;step++;var toRemove=null;if(mark instanceof _model.MarkType){var found=mark.isInSet(marks);found&&(toRemove=[found])}else mark?mark.isInSet(marks)&&(toRemove=[mark]):toRemove=marks;if(toRemove&&toRemove.length){path=path.slice();for(var i=0;i<toRemove.length;i++){for(var rm=toRemove[i],found=void 0,j=0;j<matched.length;j++){var m=matched[j];m.step==step-1&&rm.eq(matched[j].style)&&(found=m)}found?(found.to=new _model.Pos(path,end),found.step=step):matched.push({style:rm,from:new _model.Pos(path,start),to:new _model.Pos(path,end),step:step})}}}),matched.forEach(function(m){return _this2.step("removeMark",m.from,m.to,null,m.style)}),this},_transform.Transform.prototype.clearMarkup=function(from,to,newParent){var _this3=this,delSteps=[];this.doc.inlineNodesBetween(from,to,function(_ref3,path,start,end){var marks=_ref3.marks,type=_ref3.type;if(newParent?!newParent.canContainType(type):!type.isText){path=path.slice();var _from=new _model.Pos(path,start);return void delSteps.push(new _step.Step("replace",_from,new _model.Pos(path,end),_from))}for(var i=0;i<marks.length;i++){var mark=marks[i];newParent&&newParent.canContainMark(mark.type)||(path=path.slice(),_this3.step("removeMark",new _model.Pos(path,start),new _model.Pos(path,end),null,mark))}});for(var i=delSteps.length-1;i>=0;i--)this.step(delSteps[i]);return this}},{"../model":34,"./step":46,"./transform":47,"./tree":48}],44:[function(require,module,exports){"use strict";function findMovedChunks(oldNode,oldPath,newNode,startDepth){for(var moved=[],newPath=oldPath.path.slice(0,startDepth),depth=startDepth;;depth++){var joined=depth==oldPath.depth?0:1,cut=depth==oldPath.depth?oldPath.offset:oldPath.path[depth],afterCut=oldNode.size-cut,newOffset=newNode.size-afterCut,from=oldPath.shorten(depth,joined),to=new _model.Pos(newPath,newOffset+joined);if(from.cmp(to)&&moved.push(new _map.MovedRange(from,afterCut-joined,to)),!joined)return moved;oldNode=oldNode.child(cut),newNode=newNode.child(newOffset),newPath=newPath.concat(newOffset)}}function replace(node,from,to,root,repl){var depth=arguments.length<=5||void 0===arguments[5]?0:arguments[5];if(depth==root.length){var before=node.sliceBetween(null,from,depth),after=node.sliceBetween(to,null,depth),result=void 0;return before.type.canContainFragment(repl.content)?(result=repl.content.size?before.append(repl.content,from.depth-depth,repl.openLeft).append(after.content,repl.openRight,to.depth-depth):before.append(after.content,from.depth-depth,to.depth-depth),result.size||result.type.canBeEmpty||(result=result.copy(result.type.defaultContent())),{doc:result,moved:findMovedChunks(node,to,result,depth)}):null}var pos=root[depth],result=replace(node.child(pos),from,to,root,repl,depth+1);return result?{doc:node.replace(pos,result.doc),moved:result.moved}:null}function shiftFromStack(stack,depth){for(var shifted=stack[depth]=stack[depth].slice(1),i=depth-1;i>=0;i--)shifted=stack[i]=stack[i].replace(0,shifted)}function buildInserted(nodesLeft,source,start,end){for(var sliced=source.sliceBetween(start,end),nodesRight=[],node=sliced,i=0;i<=start.path.length;i++,node=node.firstChild)nodesRight.push(node);var same=(0,_tree.samePathDepth)(start,end),searchLeft=nodesLeft.length-1,searchRight=nodesRight.length-1,result=null,inner=nodesRight[searchRight];for(inner.isTextblock&&inner.size&&nodesLeft[searchLeft].isTextblock&&(result=nodesLeft[searchLeft--].copy(inner.content),--searchRight,shiftFromStack(nodesRight,searchRight));;searchRight--){for(var node=nodesRight[searchRight],type=node.type,matched=null,outside=same>=searchRight,i=searchLeft;i>=0;i--){var left=nodesLeft[i];if(outside?left.type.canContainContent(node.type):left.type==type){matched=i;break}}if(null!=matched)if(result)for(;searchLeft>=matched;){var wrap=nodesLeft[searchLeft],content=_model.Fragment.from(result);result=wrap.copy(searchLeft==matched?content.append(node.content):content),searchLeft--}else result=nodesLeft[matched].copy(node.content),searchLeft=matched-1;if(null!=matched||0==node.size){if(outside)break;shiftFromStack(nodesRight,searchRight-1)}}var repl={content:result?result.content:_model.emptyFragment,openLeft:start.depth-searchRight,openRight:end.depth-searchRight};return{repl:repl,depth:searchLeft+1}}function moveText(tr,doc,before,after){for(var root=(0,_tree.samePathDepth)(before,after),cutAt=after.shorten(null,1);cutAt.path.length>root&&1==doc.path(cutAt.path).size;)cutAt=cutAt.shorten(null,1);tr.split(cutAt,cutAt.path.length-root);for(var start=after,end=new _model.Pos(start.path,doc.path(start.path).size),parent=doc.path(start.path.slice(0,root)),wanted=parent.pathNodes(before.path.slice(root)),existing=parent.pathNodes(start.path.slice(root));wanted.length&&existing.length&&wanted[0].sameMarkup(existing[0]);)wanted.shift(),existing.shift();(existing.length||wanted.length)&&tr.step("ancestor",start,end,null,{depth:existing.length,types:wanted.map(function(n){return n.type}),attrs:wanted.map(function(n){return n.attrs})});for(var i=root;i<before.path.length;i++)tr.join(before.shorten(i,1))}Object.defineProperty(exports,"__esModule",{value:!0}),exports.replace=replace;var _model=require("../model"),_transform=require("./transform"),_step=require("./step"),_map=require("./map"),_tree=require("./tree"),nullRepl={content:_model.emptyFragment,openLeft:0,openRight:0};_step.Step.define("replace",{apply:function(doc,step){var rootPos=step.pos,root=rootPos.path;if(step.from.depth<root.length||step.to.depth<root.length)return null;for(var i=0;i<root.length;i++)if(step.from.path[i]!=root[i]||step.to.path[i]!=root[i])return null;var result=replace(doc,step.from,step.to,rootPos.path,step.param||nullRepl);if(!result)return null;var out=result.doc,moved=result.moved,end=moved.length?moved[moved.length-1].dest:step.to,replaced=new _map.ReplacedRange(step.from,step.to,step.from,end,rootPos,rootPos);return new _step.StepResult(out,new _map.PosMap(moved,[replaced]))},invert:function(step,oldDoc,map){var depth=step.pos.depth;return new _step.Step("replace",step.from,map.map(step.to).pos,step.from.shorten(depth),{content:oldDoc.path(step.pos.path).content.sliceBetween(step.from,step.to,depth),openLeft:step.from.depth-depth,openRight:step.to.depth-depth})},paramToJSON:function(param){return param&&{content:param.content.size&&param.content.toJSON(),openLeft:param.openLeft,openRight:param.openRight}},paramFromJSON:function(schema,json){return json&&{content:_model.Fragment.fromJSON(schema,json.content),openLeft:json.openLeft,openRight:json.openRight}}}),_transform.Transform.prototype["delete"]=function(from,to){return from.cmp(to)&&this.replace(from,to),this},_transform.Transform.prototype.replace=function(from,to,source,start,end){var repl=void 0,depth=void 0,doc=this.doc,maxDepth=(0,_tree.samePathDepth)(from,to);if(source){var _buildInserted=buildInserted(doc.pathNodes(from.path),source,start,end);for(repl=_buildInserted.repl,depth=_buildInserted.depth;depth>maxDepth;)repl.content.size&&(repl={content:_model.Fragment.from(doc.path(from.path.slice(0,depth)).copy(repl.content)),openLeft:repl.openLeft+1,openRight:repl.openRight+1}),depth--}else repl=nullRepl,depth=maxDepth;var root=from.shorten(depth),docAfter=doc,after=to;if(repl.content.size||(0,_tree.replaceHasEffect)(doc,from,to)){var result=this.step("replace",from,to,root,repl);docAfter=result.doc,after=result.map.map(to).pos}if(!doc.path(to.path).isTextblock)return this;if(!(repl.content.size?source.path(end.path).isTextblock:doc.path(from.path).isTextblock))return this;var nodesAfter=doc.path(root.path).pathNodes(to.path.slice(depth)).slice(1),nodesBefore=void 0;if(repl.content.size){var inserted=repl.content;nodesBefore=[];for(var i=0;i<repl.openRight;i++){var last=inserted.child(inserted.size-1);nodesBefore.push(last),inserted=last.content}}else nodesBefore=doc.path(root.path).pathNodes(from.path.slice(depth)).slice(1);if(nodesBefore.length&&(nodesAfter.length!=nodesBefore.length||!nodesAfter.every(function(n,i){return n.sameMarkup(nodesBefore[i])}))){for(var _after$shorten=after.shorten(root.depth),path=_after$shorten.path,offset=_after$shorten.offset,before=void 0,node=docAfter.path(path),i=0;;i++){if(i==nodesBefore.length){before=new _model.Pos(path,offset);break}path.push(offset-1),node=node.child(offset-1),offset=node.size}moveText(this,docAfter,before,after)}return this},_transform.Transform.prototype.replaceWith=function(from,to,content){return content instanceof _model.Fragment||(content=_model.Fragment.from(content)),_model.Pos.samePath(from.path,to.path)?this.step("replace",from,to,from,{content:content,openLeft:0,openRight:0}):this["delete"](from,to).step("replace",from,from,from,{content:content,openLeft:0,openRight:0}),this},_transform.Transform.prototype.insert=function(pos,content){return this.replaceWith(pos,pos,content)},_transform.Transform.prototype.insertText=function(pos,text){return this.insert(pos,this.doc.type.schema.text(text,this.doc.marksAt(pos)))},_transform.Transform.prototype.insertInline=function(pos,node){return this.insert(pos,node.mark(this.doc.marksAt(pos)))}},{"../model":34,"./map":42,"./step":46,"./transform":47,"./tree":48}],45:[function(require,module,exports){"use strict";var _model=require("../model"),_transform=require("./transform"),_step=require("./step"),_map=require("./map");_step.Step.define("split",{apply:function(doc,step){var pos=step.pos;if(0==pos.depth)return null;var _pos$shorten=pos.shorten(),parentPath=_pos$shorten.path,offset=_pos$shorten.offset,parent=doc.path(parentPath),target=parent.child(offset),targetSize=target.size,_ref=step.param||target,typeAfter=_ref.type,attrsAfter=_ref.attrs,splitAt=pos.offset;if(0==splitAt&&!target.type.canBeEmpty||target.type.locked||splitAt==target.size&&!typeAfter.canBeEmpty)return null;var newParent=parent.splice(offset,offset+1,_model.Fragment.from([target.slice(0,splitAt),typeAfter.create(attrsAfter,target.content.slice(splitAt))])),copy=doc.replaceDeep(parentPath,newParent),dest=new _model.Pos(parentPath.concat(offset+1),0),map=new _map.PosMap([new _map.MovedRange(pos,targetSize-pos.offset,dest),new _map.MovedRange(new _model.Pos(parentPath,offset+1),newParent.size-2-offset,new _model.Pos(parentPath,offset+2))],[new _map.ReplacedRange(pos,pos,pos,dest,pos,pos.shorten(null,1))]);return new _step.StepResult(copy,map)},invert:function(step,_oldDoc,map){return new _step.Step("join",step.pos,map.map(step.pos).pos)},paramToJSON:function(param){return param&&{type:param.type.name,attrs:param.attrs}},paramFromJSON:function(schema,json){return json&&{type:schema.nodeType(json.type),attrs:json.attrs}}}),_transform.Transform.prototype.split=function(pos){var depth=arguments.length<=1||void 0===arguments[1]?1:arguments[1],typeAfter=arguments[2],attrsAfter=arguments[3];if(0==depth)return this;for(var i=0;;i++){if(this.step("split",null,null,pos,typeAfter&&{type:typeAfter,attrs:attrsAfter}),i==depth-1)return this;typeAfter=null,pos=pos.shorten(null,1)}},_transform.Transform.prototype.splitIfNeeded=function(pos){for(var depth=arguments.length<=1||void 0===arguments[1]?1:arguments[1],off=0;depth>off;off++){var here=pos.shorten(pos.depth-off);here.offset&&here.offset<this.doc.path(here.path).size&&this.step("split",null,null,here)}return this}},{"../model":34,"./map":42,"./step":46,"./transform":47}],46:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.StepResult=exports.Step=void 0;var _model=require("../model"),_error=require("../util/error"),_map=require("./map"),steps=(exports.Step=function(){function Step(type,from,to,pos){var param=arguments.length<=4||void 0===arguments[4]?null:arguments[4];_classCallCheck(this,Step),type in steps||_error.NamespaceError.raise("Unknown step type: "+type),this.type=type,this.from=from,this.to=to,this.pos=pos,this.param=param}return _createClass(Step,[{key:"apply",value:function(doc){return steps[this.type].apply(doc,this)}},{key:"invert",value:function(oldDoc,map){return steps[this.type].invert(this,oldDoc,map)}},{key:"map",value:function(remapping){var allDeleted=!0,from=null,to=null,pos=null;if(this.from){var result=remapping.map(this.from,1);from=result.pos,result.deleted||(allDeleted=!1)}if(this.to)if(0==this.to.cmp(this.from))to=from;else{var result=remapping.map(this.to,-1);to=result.pos.max(from),result.deleted||(allDeleted=!1)}if(this.pos)if(from&&0==this.pos.cmp(this.from))pos=from;else if(to&&0==this.pos.cmp(this.to))pos=to;else{var result=remapping.map(this.pos,1);pos=result.pos,result.deleted||(allDeleted=!1)}return allDeleted?null:new Step(this.type,from,to,pos,this.param)}},{key:"toJSON",value:function(){var impl=steps[this.type];return{type:this.type,from:this.from,to:this.to,pos:this.pos,param:impl.paramToJSON?impl.paramToJSON(this.param):this.param}}}],[{key:"fromJSON",value:function(schema,json){var impl=steps[json.type];return new Step(json.type,json.from&&_model.Pos.fromJSON(json.from),json.to&&_model.Pos.fromJSON(json.to),json.pos&&_model.Pos.fromJSON(json.pos),impl.paramFromJSON?impl.paramFromJSON(schema,json.param):json.param)}},{key:"define",value:function(type,implementation){steps[type]=implementation}}]),Step}(),exports.StepResult=function StepResult(doc){var map=arguments.length<=1||void 0===arguments[1]?_map.nullMap:arguments[1];_classCallCheck(this,StepResult),this.doc=doc,this.map=map},Object.create(null))},{"../model":34,"../util/error":52,"./map":42}],47:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.Transform=void 0;var _step2=require("./step"),_map=require("./map"),Transform=function(){function Transform(doc){_classCallCheck(this,Transform),this.steps=[],this.docs=[doc],this.maps=[]}return _createClass(Transform,[{key:"step",value:function(_step,from,to,pos,param){"string"==typeof _step&&(_step=new _step2.Step(_step,from,to,pos,param));var result=_step.apply(this.doc);return result&&(this.steps.push(_step),this.maps.push(result.map),this.docs.push(result.doc)),result}},{key:"map",value:function(pos,bias){for(var deleted=!1,i=0;i<this.maps.length;i++){var result=this.maps[i].map(pos,bias);pos=result.pos,result.deleted&&(deleted=!0)}return new _map.MapResult(pos,deleted)}},{key:"doc",get:function(){return this.docs[this.docs.length-1]}},{key:"before",get:function(){return this.docs[0]}}]),Transform}();exports.Transform=Transform},{"./map":42,"./step":46}],48:[function(require,module,exports){"use strict";function copyStructure(node,from,to,f){var depth=arguments.length<=4||void 0===arguments[4]?0:arguments[4];if(node.isTextblock)return f(node,from?from.offset:0,to?to.offset:node.size);if(!node.size)return node;for(var child,start=from?from.path[depth]:0,end=to?to.path[depth]+1:node.size,content=node.content.toArray(0,start),iter=node.iter(start,end);child=iter.next().value;){var passFrom=iter.offset-child.width==start?from:null,passTo=iter.offset==end?to:null;content.push(copyStructure(child,passFrom,passTo,f,depth+1))}return node.copy(_model.Fragment.fromArray(content.concat(node.content.toArray(end))))}function copyInline(node,from,to,f){return node.splice(from,to,node.content.slice(from,to).map(f))}function isFlatRange(from,to){if(from.path.length!=to.path.length)return!1;for(var i=0;i<from.path.length;i++)if(from.path[i]!=to.path[i])return!1;return from.offset<=to.offset}function canBeJoined(node,offset,depth){if(!depth||0==offset||offset==node.size)return!1;var left=node.child(offset-1),right=node.child(offset);return left.sameMarkup(right)}function replaceHasEffect(doc,from,to){for(var depth=0,node=doc;;depth++){var fromEnd=depth==from.depth,toEnd=depth==to.depth;if(fromEnd||toEnd||from.path[depth]!=to.path[depth]){var gapStart=void 0,gapEnd=void 0;if(fromEnd)gapStart=from.offset;else{gapStart=from.path[depth]+1;for(var i=depth+1,n=node.child(gapStart-1);i<=from.path.length;i++)if(i==from.path.length){if(from.offset<n.size)return!0}else{if(from.path[i]+1<n.size)return!0;n=n.child(from.path[i])}}if(toEnd)gapEnd=to.offset;else{gapEnd=to.path[depth];for(var i=depth+1;i<=to.path.length;i++)if((i==to.path.length?to.offset:to.path[i])>0)return!0}return gapStart!=gapEnd?!0:canBeJoined(node,gapStart,Math.min(from.depth,to.depth)-depth)}node=node.child(from.path[depth])}}function samePathDepth(a,b){for(var i=0;;i++)if(i==a.path.length||i==b.path.length||a.path[i]!=b.path[i])return i}Object.defineProperty(exports,"__esModule",{value:!0}),exports.copyStructure=copyStructure,exports.copyInline=copyInline,exports.isFlatRange=isFlatRange,exports.replaceHasEffect=replaceHasEffect,exports.samePathDepth=samePathDepth;var _model=require("../model")},{"../model":34}],49:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function openPrompt(pm,content,options){var button=(0,_dom.elt)("button",{"class":"ProseMirror-prompt-close"}),wrapper=(0,_dom.elt)("div",{"class":"ProseMirror-prompt"},content,button),outerBox=pm.wrapper.getBoundingClientRect();if(pm.wrapper.appendChild(wrapper),options&&options.pos)wrapper.style.left=options.pos.left-outerBox.left+"px",wrapper.style.pos=options.pos.top-outerBox.top+"px";else{var blockBox=wrapper.getBoundingClientRect(),cX=Math.max(0,outerBox.left)+Math.min(window.innerWidth,outerBox.right)-blockBox.width,cY=Math.max(0,outerBox.top)+Math.min(window.innerHeight,outerBox.bottom)-blockBox.height;wrapper.style.left=cX/2-outerBox.left+"px",wrapper.style.top=cY/2-outerBox.top+"px"}var close=function close(){pm.off("interaction",close),wrapper.parentNode&&(wrapper.parentNode.removeChild(wrapper),options&&options.onClose&&options.onClose())};return button.addEventListener("click",close),pm.on("interaction",close),{close:close}}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.ParamPrompt=void 0,exports.openPrompt=openPrompt;var _error=require("../util/error"),_dom=require("../dom"),ParamPrompt=exports.ParamPrompt=function(){function ParamPrompt(pm,command){var _this=this;_classCallCheck(this,ParamPrompt),this.pm=pm,this.command=command,this.doClose=null,this.fields=command.params.map(function(param){return param.type in _this.paramTypes||_error.AssertionError.raise("Unsupported parameter type: "+param.type),_this.paramTypes[param.type].render.call(_this.pm,param,_this.defaultValue(param))}),this.form=(0,_dom.elt)("form",null,this.fields.map(function(f){return(0,_dom.elt)("div",null,f)}))}return _createClass(ParamPrompt,[{key:"close",value:function(){this.doClose&&(this.doClose(),this.doClose=null)}},{key:"open",value:function(){var _this2=this;this.close();var prompt=this.prompt(),hadFocus=this.pm.hasFocus();this.doClose=function(){prompt.close(),hadFocus&&setTimeout(function(){return _this2.pm.focus()},50)};var submit=function(){var params=_this2.values();params&&(_this2.close(),_this2.command.exec(_this2.pm,params))};this.form.addEventListener("submit",function(e){e.preventDefault(),submit()}),this.form.addEventListener("keydown",function(e){27==e.keyCode?prompt.close():13!=e.keyCode||e.ctrlKey||e.metaKey||e.shiftKey||submit()});var input=this.form.querySelector("input, textarea");input&&input.focus()}},{key:"values",value:function(){for(var result=[],i=0;i<this.command.params.length;i++){var param=this.command.params[i],dom=this.fields[i],type=this.paramTypes[param.type],value=void 0,bad=void 0;if(type.validate&&(bad=type.validate(dom)),bad||(value=type.read.call(this.pm,dom),param.validate?bad=param.validate(value):value||null!=param["default"]||(bad="No default value available")),bad)return type.reportInvalid?type.reportInvalid.call(this.pm,dom,bad):this.reportInvalid(dom,bad),
null;result.push(value)}return result}},{key:"defaultValue",value:function(param){if(param.prefill){var prefill=param.prefill.call(this.command.self,this.pm);if(null!=prefill)return prefill}return param["default"]}},{key:"prompt",value:function(){var _this3=this;return openPrompt(this.pm,this.form,{onClose:function(){return _this3.close()}})}},{key:"reportInvalid",value:function(dom,message){var parent=dom.parentNode,style="left: "+(dom.offsetLeft+dom.offsetWidth+2)+"px; top: "+(dom.offsetTop-5)+"px",msg=parent.appendChild((0,_dom.elt)("div",{"class":"ProseMirror-invalid",style:style},message));setTimeout(function(){return parent.removeChild(msg)},1500)}}]),ParamPrompt}();ParamPrompt.prototype.paramTypes=Object.create(null),ParamPrompt.prototype.paramTypes.text={render:function(param,value){return(0,_dom.elt)("input",{type:"text",placeholder:param.label,value:value,autocomplete:"off"})},read:function(dom){return dom.value}},ParamPrompt.prototype.paramTypes.select={render:function(param,value){var options=param.options.call?param.options(this):param.options;return(0,_dom.elt)("select",null,options.map(function(o){return(0,_dom.elt)("option",{value:o.value,selected:o.value==value?"true":null},o.label)}))},read:function(dom){return dom.value}},(0,_dom.insertCSS)('\n.ProseMirror-prompt {\n  background: white;\n  padding: 2px 6px 2px 15px;\n  border: 1px solid silver;\n  position: absolute;\n  border-radius: 3px;\n  z-index: 11;\n}\n\n.ProseMirror-prompt input[type="text"],\n.ProseMirror-prompt textarea {\n  background: #eee;\n  border: none;\n  outline: none;\n}\n\n.ProseMirror-prompt input[type="text"] {\n  padding: 0 4px;\n}\n\n.ProseMirror-prompt-close {\n  position: absolute;\n  left: 2px; top: 1px;\n  color: #666;\n  border: none; background: transparent; padding: 0;\n}\n\n.ProseMirror-prompt-close:after {\n  content: "✕";\n  font-size: 12px;\n}\n\n.ProseMirror-invalid {\n  background: #ffc;\n  border: 1px solid #cc7;\n  border-radius: 4px;\n  padding: 5px 10px;\n  position: absolute;\n  min-width: 10em;\n}\n')},{"../dom":1,"../util/error":52}],50:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.Tooltip=void 0;var _dom=require("../dom"),prefix="ProseMirror-tooltip";exports.Tooltip=function(){function Tooltip(wrapper,dir){var _this=this;_classCallCheck(this,Tooltip),this.wrapper=wrapper,this.dir=dir||"above",this.pointer=wrapper.appendChild((0,_dom.elt)("div",{"class":prefix+"-pointer-"+this.dir+" "+prefix+"-pointer"})),this.pointerWidth=this.pointerHeight=null,this.dom=wrapper.appendChild((0,_dom.elt)("div",{"class":prefix})),this.dom.addEventListener("transitionend",function(){"0"==_this.dom.style.opacity&&(_this.dom.style.display=_this.pointer.style.display="")}),this.isOpen=!1,this.lastLeft=this.lastTop=null}return _createClass(Tooltip,[{key:"detach",value:function(){this.dom.parentNode.removeChild(this.dom),this.pointer.parentNode.removeChild(this.pointer)}},{key:"getSize",value:function(node){var wrap=this.wrapper.appendChild((0,_dom.elt)("div",{"class":prefix,style:"display: block; position: absolute"},node)),size={width:wrap.offsetWidth+1,height:wrap.offsetHeight};return wrap.parentNode.removeChild(wrap),size}},{key:"open",value:function(node,pos){for(var next,left=this.lastLeft=pos?pos.left:this.lastLeft,top=this.lastTop=pos?pos.top:this.lastTop,size=this.getSize(node),around=this.wrapper.getBoundingClientRect(),child=this.dom.firstChild;child;child=next)next=child.nextSibling,child!=this.pointer&&this.dom.removeChild(child);this.dom.appendChild(node),this.dom.style.display=this.pointer.style.display="block",null==this.pointerWidth&&(this.pointerWidth=this.pointer.offsetWidth-1,this.pointerHeight=this.pointer.offsetHeight-1),this.dom.style.width=size.width+"px",this.dom.style.height=size.height+"px";var margin=5;if("above"==this.dir||"below"==this.dir){var tipLeft=Math.max(0,Math.min(left-size.width/2,window.innerWidth-size.width));if(this.dom.style.left=tipLeft-around.left+"px",this.pointer.style.left=left-around.left-this.pointerWidth/2+"px","above"==this.dir){var tipTop=top-around.top-margin-this.pointerHeight-size.height;this.dom.style.top=tipTop+"px",this.pointer.style.top=tipTop+size.height+"px"}else{var tipTop=top-around.top+margin;this.pointer.style.top=tipTop+"px",this.dom.style.top=tipTop+this.pointerHeight+"px"}}else if("left"==this.dir||"right"==this.dir)if(this.dom.style.top=top-around.top-size.height/2+"px",this.pointer.style.top=top-this.pointerHeight/2-around.top+"px","left"==this.dir){var pointerLeft=left-around.left-margin-this.pointerWidth;this.dom.style.left=pointerLeft-size.width+"px",this.pointer.style.left=pointerLeft+"px"}else{var pointerLeft=left-around.left+margin;this.dom.style.left=pointerLeft+this.pointerWidth+"px",this.pointer.style.left=pointerLeft+"px"}else if("center"==this.dir){var _top=Math.max(around.top,0),bottom=Math.min(around.bottom,window.innerHeight),fromTop=(bottom-_top-size.height)/2;this.dom.style.left=(around.width-size.width)/2+"px",this.dom.style.top=_top-around.top+fromTop+"px"}getComputedStyle(this.dom).opacity,getComputedStyle(this.pointer).opacity,this.dom.style.opacity=this.pointer.style.opacity=1,this.isOpen=!0}},{key:"close",value:function(){this.isOpen&&(this.isOpen=!1,this.dom.style.opacity=this.pointer.style.opacity=0)}}]),Tooltip}();(0,_dom.insertCSS)("\n\n."+prefix+" {\n  position: absolute;\n  display: none;\n  box-sizing: border-box;\n  -moz-box-sizing: border- box;\n  overflow: hidden;\n\n  -webkit-transition: width 0.4s ease-out, height 0.4s ease-out, left 0.4s ease-out, top 0.4s ease-out, opacity 0.2s;\n  -moz-transition: width 0.4s ease-out, height 0.4s ease-out, left 0.4s ease-out, top 0.4s ease-out, opacity 0.2s;\n  transition: width 0.4s ease-out, height 0.4s ease-out, left 0.4s ease-out, top 0.4s ease-out, opacity 0.2s;\n  opacity: 0;\n\n  border-radius: 5px;\n  padding: 3px 7px;\n  margin: 0;\n  background: white;\n  border: 1px solid #777;\n  color: #555;\n\n  z-index: 11;\n}\n\n."+prefix+"-pointer {\n  position: absolute;\n  display: none;\n  width: 0; height: 0;\n\n  -webkit-transition: left 0.4s ease-out, top 0.4s ease-out, opacity 0.2s;\n  -moz-transition: left 0.4s ease-out, top 0.4s ease-out, opacity 0.2s;\n  transition: left 0.4s ease-out, top 0.4s ease-out, opacity 0.2s;\n  opacity: 0;\n\n  z-index: 12;\n}\n\n."+prefix+'-pointer:after {\n  content: "";\n  position: absolute;\n  display: block;\n}\n\n.'+prefix+"-pointer-above {\n  border-left: 6px solid transparent;\n  border-right: 6px solid transparent;\n  border-top: 6px solid #777;\n}\n\n."+prefix+"-pointer-above:after {\n  border-left: 6px solid transparent;\n  border-right: 6px solid transparent;\n  border-top: 6px solid white;\n  left: -6px; top: -7px;\n}\n\n."+prefix+"-pointer-below {\n  border-left: 6px solid transparent;\n  border-right: 6px solid transparent;\n  border-bottom: 6px solid #777;\n}\n\n."+prefix+"-pointer-below:after {\n  border-left: 6px solid transparent;\n  border-right: 6px solid transparent;\n  border-bottom: 6px solid white;\n  left: -6px; top: 1px;\n}\n\n."+prefix+"-pointer-right {\n  border-top: 6px solid transparent;\n  border-bottom: 6px solid transparent;\n  border-right: 6px solid #777;\n}\n\n."+prefix+"-pointer-right:after {\n  border-top: 6px solid transparent;\n  border-bottom: 6px solid transparent;\n  border-right: 6px solid white;\n  left: 1px; top: -6px;\n}\n\n."+prefix+"-pointer-left {\n  border-top: 6px solid transparent;\n  border-bottom: 6px solid transparent;\n  border-left: 6px solid #777;\n}\n\n."+prefix+"-pointer-left:after {\n  border-top: 6px solid transparent;\n  border-bottom: 6px solid transparent;\n  border-left: 6px solid white;\n  left: -7px; top: -6px;\n}\n\n."+prefix+' input[type="text"],\n.'+prefix+" textarea {\n  background: #eee;\n  border: none;\n  outline: none;\n}\n\n."+prefix+' input[type="text"] {\n  padding: 0 4px;\n}\n\n')},{"../dom":1}],51:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function scheduleDOMUpdate(pm,f){CentralScheduler.get(pm).set(f)}function unscheduleDOMUpdate(pm,f){CentralScheduler.get(pm).unset(f)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.scheduleDOMUpdate=scheduleDOMUpdate,exports.unscheduleDOMUpdate=unscheduleDOMUpdate;var UPDATE_TIMEOUT=50,MIN_FLUSH_DELAY=100,CentralScheduler=function(){function CentralScheduler(pm){_classCallCheck(this,CentralScheduler),this.waiting=[],this.timeout=null,this.lastForce=0,this.pm=pm,this.force=this.force.bind(this),pm.on("flush",this.onFlush.bind(this))}return _createClass(CentralScheduler,[{key:"set",value:function(f){0==this.waiting.length&&(this.timeout=setTimeout(this.force,UPDATE_TIMEOUT)),-1==this.waiting.indexOf(f)&&this.waiting.push(f)}},{key:"unset",value:function(f){var index=this.waiting.indexOf(f);index>-1&&this.waiting.splice(index,1)}},{key:"force",value:function(){for(clearTimeout(this.timeout),this.lastForce=Date.now();this.waiting.length;)for(var i=0;i<this.waiting.length;i++){var result=this.waiting[i]();result?this.waiting[i]=result:this.waiting.splice(i--,1)}}},{key:"onFlush",value:function(){this.waiting.length&&Date.now()-this.lastForce>MIN_FLUSH_DELAY&&this.force()}}],[{key:"get",value:function(pm){return pm.mod.centralScheduler||(pm.mod.centralScheduler=new this(pm))}}]),CentralScheduler}();exports.UpdateScheduler=function(){function UpdateScheduler(pm,events,start){var _this=this;_classCallCheck(this,UpdateScheduler),this.pm=pm,this.start=start,this.events=events.split(" "),this.onEvent=this.onEvent.bind(this),this.events.forEach(function(event){return pm.on(event,_this.onEvent)})}return _createClass(UpdateScheduler,[{key:"detach",value:function(){var _this2=this;unscheduleDOMUpdate(this.pm,this.start),this.events.forEach(function(event){return _this2.pm.off(event,_this2.onEvent)})}},{key:"onEvent",value:function(){scheduleDOMUpdate(this.pm,this.start)}},{key:"force",value:function(){if(this.pm.operation)this.onEvent();else{unscheduleDOMUpdate(this.pm,this.start);for(var run=this.start;run;run=run());}}}]),UpdateScheduler}()},{}],52:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function functionName(f){var match=/^function (\w+)/.exec(f.toString());return match&&match[1]}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0});var ProseMirrorError=exports.ProseMirrorError=function(_Error){function ProseMirrorError(message){_classCallCheck(this,ProseMirrorError);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(ProseMirrorError).call(this,message));return _this.message!=message&&(_this.message=message,Error.captureStackTrace?Error.captureStackTrace(_this,_this.name):_this.stack=new Error(message).stack),_this}return _inherits(ProseMirrorError,_Error),_createClass(ProseMirrorError,[{key:"name",get:function(){return this.constructor.name||functionName(this.constructor)||"ProseMirrorError"}}],[{key:"raise",value:function(message){throw new this(message)}}]),ProseMirrorError}(Error);exports.AssertionError=function(_ProseMirrorError){function AssertionError(){return _classCallCheck(this,AssertionError),_possibleConstructorReturn(this,Object.getPrototypeOf(AssertionError).apply(this,arguments))}return _inherits(AssertionError,_ProseMirrorError),AssertionError}(ProseMirrorError),exports.NamespaceError=function(_ProseMirrorError2){function NamespaceError(){return _classCallCheck(this,NamespaceError),_possibleConstructorReturn(this,Object.getPrototypeOf(NamespaceError).apply(this,arguments))}return _inherits(NamespaceError,_ProseMirrorError2),NamespaceError}(ProseMirrorError)},{}],53:[function(require,module,exports){"use strict";function eventMixin(ctor){var proto=ctor.prototype;for(var prop in methods)methods.hasOwnProperty(prop)&&(proto[prop]=methods[prop])}Object.defineProperty(exports,"__esModule",{value:!0}),exports.eventMixin=eventMixin;var methods={on:function(type,handler){var map=this._handlers||(this._handlers={}),arr=map[type]||(map[type]=[]);arr.push(handler)},off:function(type,handler){var arr=this._handlers&&this._handlers[type];if(arr)for(var i=0;i<arr.length;++i)if(arr[i]==handler){arr.splice(i,1);break}},signal:function(type){for(var arr=this._handlers&&this._handlers[type],_len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_len>_key;_key++)args[_key-1]=arguments[_key];if(arr)for(var i=0;i<arr.length;++i)arr[i].apply(arr,args)},signalHandleable:function(type){var arr=this._handlers&&this._handlers[type];if(arr){for(var _len2=arguments.length,args=Array(_len2>1?_len2-1:0),_key2=1;_len2>_key2;_key2++)args[_key2-1]=arguments[_key2];for(var i=0;i<arr.length;++i){var result=arr[i].apply(arr,args);if(result!==!1)return result}}return!1},signalPipelined:function(type,value){var arr=this._handlers&&this._handlers[type];if(arr)for(var i=0;i<arr.length;++i)value=arr[i](value);return value},signalDOM:function(event,type){var arr=this._handlers&&this._handlers[type||event.type];if(arr)for(var i=0;i<arr.length;++i)if(arr[i](event)||event.defaultPrevented)return!0;return!1},hasHandler:function(type){var arr=this._handlers&&this._handlers[type];return arr&&arr.length>0}}},{}],54:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0});exports.Map=window.Map||function(){function _class(){_classCallCheck(this,_class),this.content=[]}return _createClass(_class,[{key:"set",value:function(key,value){var found=this.find(key);found>-1?this.content[found+1]=value:this.content.push(key,value)}},{key:"get",value:function(key){var found=this.find(key);return-1==found?void 0:this.content[found+1]}},{key:"has",value:function(key){return this.find(key)>-1}},{key:"find",value:function(key){for(var i=0;i<this.content.length;i+=2)if(this.content[i]===key)return i}},{key:"clear",value:function(){this.content.length=0}},{key:"size",get:function(){return this.content.length/2}}]),_class}()},{}],55:[function(require,module,exports){"use strict";function copyObj(obj,base){var copy=base||Object.create(null);for(var prop in obj)copy[prop]=obj[prop];return copy}Object.defineProperty(exports,"__esModule",{value:!0}),exports.copyObj=copyObj},{}],56:[function(require,module,exports){"use strict";function sortedInsert(array,elt,compare){for(var i=0;i<array.length&&!(compare(array[i],elt)>0);i++);array.splice(i,0,elt)}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=sortedInsert},{}],57:[function(require,module,exports){!function(mod){if("object"==typeof exports&&"object"==typeof module)module.exports=mod();else{if("function"==typeof define&&define.amd)return define([],mod);(this||window).browserKeymap=mod()}}(function(){"use strict";function keyName(event){if("keypress"==event.type)return"'"+String.fromCharCode(event.charCode)+"'";var base=keyNames[event.keyCode],name=base;return null==name||event.altGraphKey?null:(event.altKey&&"Alt"!=base&&(name="Alt-"+name),event.ctrlKey&&"Ctrl"!=base&&(name="Ctrl-"+name),event.metaKey&&"Cmd"!=base&&(name="Cmd-"+name),event.shiftKey&&"Shift"!=base&&(name="Shift-"+name),name)}function isModifierKey(name){return name=/[^-]*$/.exec(name)[0],"Ctrl"==name||"Alt"==name||"Shift"==name||"Mod"==name}function normalizeKeyName(name){for(var alt,ctrl,shift,cmd,parts=name.split(/-(?!'?$)/),result=parts[parts.length-1],i=0;i<parts.length-1;i++){var mod=parts[i];if(/^(cmd|meta|m)$/i.test(mod))cmd=!0;else if(/^a(lt)?$/i.test(mod))alt=!0;else if(/^(c|ctrl|control)$/i.test(mod))ctrl=!0;else if(/^s(hift)$/i.test(mod))shift=!0;else{if(!/^mod$/i.test(mod))throw new Error("Unrecognized modifier name: "+mod);mac?cmd=!0:ctrl=!0}}return alt&&(result="Alt-"+result),ctrl&&(result="Ctrl-"+result),cmd&&(result="Cmd-"+result),shift&&(result="Shift-"+result),result}function Keymap(keys,options){if(this.options=options||{},this.bindings=Object.create(null),keys)for(var keyname in keys)Object.prototype.hasOwnProperty.call(keys,keyname)&&this.addBinding(keyname,keys[keyname])}for(var mac="undefined"!=typeof navigator?/Mac/.test(navigator.platform):"undefined"!=typeof os?"darwin"==os.platform():!1,keyNames={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},i=0;10>i;i++)keyNames[i+48]=keyNames[i+96]=String(i);for(var i=65;90>=i;i++)keyNames[i]=String.fromCharCode(i);for(var i=1;12>=i;i++)keyNames[i+111]=keyNames[i+63235]="F"+i;return Keymap.prototype={normalize:function(name){return this.options.multi!==!1?name.split(/ +(?!\'$)/).map(normalizeKeyName):[normalizeKeyName(name)]},addBinding:function(keyname,value){for(var keys=this.normalize(keyname),i=0;i<keys.length;i++){var name=keys.slice(0,i+1).join(" "),val=i==keys.length-1?value:"...",prev=this.bindings[name];if(prev){if(prev!=val)throw new Error("Inconsistent bindings for "+name)}else this.bindings[name]=val}},removeBinding:function(keyname){for(var keys=this.normalize(keyname),i=keys.length-1;i>=0;i--){var name=keys.slice(0,i).join(" "),val=this.bindings[name];if("..."==val&&!this.unusedMulti(name))break;val&&delete this.bindings[name]}},unusedMulti:function(name){for(var binding in this.bindings)if(binding.length>name&&0==binding.indexOf(name)&&" "==binding.charAt(name.length))return!1;return!0},lookup:function(key,context){return this.options.call?this.options.call(key,context):this.bindings[key]},constructor:Keymap},Keymap.keyName=keyName,Keymap.isModifierKey=isModifierKey,Keymap.normalizeKeyName=normalizeKeyName,Keymap})},{}],58:[function(require,module,exports){"use strict";var _edit=require("prosemirror/dist/edit");require("prosemirror/dist/menu/tooltipmenu"),require("prosemirror/dist/menu/menubar"),require("prosemirror/dist/inputrules/autoinput");var _menu=require("prosemirror/dist/menu/menu"),_widgets=require("./widgets"),_utils=require("./utils"),_schema=require("./schema");window.pm=new _edit.ProseMirror({place:document.querySelector("#editor"),menuBar:{"float":!0,content:[_menu.inlineGroup,[_menu.blockGroup,_menu.textblockMenu],_widgets.alignGroup,[_widgets.contentInsertMenu,_widgets.questionInsertMenu],_menu.historyGroup]},schema:_schema.widgetSchema,commands:_schema.commands,autoInput:!0,doc:document.querySelector("#content"),docFormat:"dom"});(0,_utils.defineFileHandler)(function(files){console.log(files)})},{"./schema":59,"./utils":60,"./widgets":72,"prosemirror/dist/edit":11,"prosemirror/dist/inputrules/autoinput":24,"prosemirror/dist/menu/menu":27,"prosemirror/dist/menu/menubar":28,"prosemirror/dist/menu/tooltipmenu":29}],59:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.commands=exports.widgetSchema=void 0;var _edit=require("prosemirror/dist/edit"),_dom=require("prosemirror/dist/dom"),_model=require("prosemirror/dist/model"),_widgets=require("./widgets"),_menu=require("prosemirror/dist/menu/menu"),widgetSpec=new _model.SchemaSpec({doc:_model.Doc,blockquote:_model.BlockQuote,ordered_list:_model.OrderedList,bullet_list:_model.BulletList,list_item:_model.ListItem,paragraph:_model.Paragraph,heading:_model.Heading,text:_model.Text,hard_break:_model.HardBreak,input:_widgets.Input,checkbox:_widgets.CheckBox,radiobutton:_widgets.RadioButton,select:_widgets.Select,textfield:_widgets.TextField,textarea:_widgets.TextArea,question:_widgets.Question,textbox:_widgets.TextBox,choice:_widgets.Choice,multiplechoice:_widgets.MultipleChoice,scaledisplay:_widgets.ScaleDisplay,scale:_widgets.Scale,checkitem:_widgets.CheckItem,checklist:_widgets.CheckList,shortanswer:_widgets.ShortAnswer,essay:_widgets.Essay,selection:_widgets.Selection,horizontal_rule:_model.HorizontalRule,image:_widgets.Image,inlinemath:_widgets.InlineMath,blockmath:_widgets.BlockMath,website:_widgets.Website,carryforward:_widgets.CarryForward,spreadsheet:_widgets.SpreadSheet,leftalign:_widgets.LeftAlign,centeralign:_widgets.CenterAlign,rightalign:_widgets.RightAlign},{em:_model.EmMark,strong:_model.StrongMark,link:_model.LinkMark,code:_model.CodeMark,underline:_widgets.UnderlineMark,strikethrough:_widgets.StrikeThroughMark});exports.widgetSchema=new _model.Schema(widgetSpec);_menu.textblockMenu.options.label="Format";exports.commands=_edit.CommandSet["default"].update({selectParentNode:{menu:null},lift:{menu:null},"horizontal_rule:insert":{menu:{group:"content",rank:71,display:{type:"label",label:"Horizontal Rule"}}},"code:toggle":{menu:{group:"textblock",rank:99,display:{type:"label",label:"Code"}}}});(0,_dom.insertCSS)('\n		\n.ProseMirror {\n	width: 800px;\n	min-height: 200px;\n}\n\n.ProseMirror-menu {\n	background: white;\n	color: black;\n}\n\ndiv.ProseMirror-dropdown-menu {\n  position: absolute;\n  background: white;\n  color: black;\n  border-radius: 6px;\n  border: 1px solid silver;\n  padding: 2px 2px;\n  z-index: 15;\n}\n\ndiv.ProseMirror-dropdown-menu {\n  cursor: pointer;\n  padding: 0 1em 0 2px;\n}\n\ndiv.ProseMirror-menubar-inner {\n  background: linear-gradient(to bottom, white, #0191C8);\n}\n\ndiv.ProseMirror-menu form {\n	background: linear-gradient(to bottom, white, #0191C8);\n	width: 300px;\n}\n\ndiv.ProseMirror-menu form select {\n	width: 100px;\n	background: white;\n}\n\ndiv.ProseMirror-menu input[type = "text"] {\n	background: white;\n}\n\n')},{"./widgets":72,"prosemirror/dist/dom":1,"prosemirror/dist/edit":11,"prosemirror/dist/menu/menu":27,"prosemirror/dist/model":34}],60:[function(require,module,exports){"use strict";function defParser(type,tag,cls){type.register("parseDOM",tag,{rank:25,parse:function(dom,state){return dom.classList.contains(cls)?(console.log(dom),void state.insert(type)):!1}})}function getPosInParent(pm,pos,child){var i=0,parent=pm.doc.path(pos.path);return parent.forEach(function(node,start){i=node==child?start:0}),new _model.Pos(pos.path,i)}function nodeBefore(pm,pos){for(var before=void 0,cut=void 0,i=pos.path.length-1;!before&&i>=0;i--)pos.path[i]>0&&(cut=pos.shorten(i),before=pm.doc.path(cut.path).child(cut.offset-1));return{before:before,at:new _model.Pos(cut.path,cut.offset-1)}}function insertWidget(pm,pos,w){for(;;){if(0==pos.depth)return pm.tr.insert(pos,w).apply(pm.apply.scroll);pos=pos.shorten(null,1)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.selectedNodeAttr=exports.defParamsClick=exports.nameTitle=exports.namePattern=exports.defineFileHandler=exports.widgetParamHandler=void 0;var _params=require("./params");Object.defineProperty(exports,"widgetParamHandler",{enumerable:!0,get:function(){return _params.widgetParamHandler}}),Object.defineProperty(exports,"defineFileHandler",{enumerable:!0,get:function(){return _params.defineFileHandler}}),Object.defineProperty(exports,"namePattern",{enumerable:!0,get:function(){return _params.namePattern}}),Object.defineProperty(exports,"nameTitle",{enumerable:!0,get:function(){return _params.nameTitle}}),Object.defineProperty(exports,"defParamsClick",{enumerable:!0,get:function(){return _params.defParamsClick}}),Object.defineProperty(exports,"selectedNodeAttr",{enumerable:!0,get:function(){return _params.selectedNodeAttr}}),exports.defParser=defParser,exports.getPosInParent=getPosInParent,exports.nodeBefore=nodeBefore,exports.insertWidget=insertWidget;var _model=require("prosemirror/dist/model");require("prosemirror/dist/edit/selection");window.MathJax&&MathJax.Hub.Queue(function(){MathJax.Hub.Config({tex2jax:{displayMath:[["\\[","\\]"]],inlineMath:[["\\(","\\)"]],processEscapes:!0},displayAlign:"left"})})},{"./params":61,"prosemirror/dist/edit/selection":17,"prosemirror/dist/model":34}],61:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function defineFileHandler(handler){fhandler=handler}function getLastClicked(){return lastClicked}function openWidgetPrompt(wpp,options){var close=function close(){wpp.pm.off("interaction",close),dialog.parentNode&&(dialog.parentNode.removeChild(dialog),options&&options.onClose&&options.onClose())},submit=function(){var params=wpp.values();params&&(wpp.command.exec(wpp.pm,params),close())};wpp.pm.on("interaction",close);var save=(0,_dom.elt)("input",{name:"save",type:"button",value:"Save"});save.addEventListener("mousedown",function(e){submit()});var cancel=(0,_dom.elt)("input",{name:"cancel",type:"button",value:"Cancel"});cancel.addEventListener("mousedown",function(e){e.preventDefault(),e.stopPropagation(),close()});var buttons=(0,_dom.elt)("div",{"class":"widgetButtons"},save,cancel);wpp.form=(0,_dom.elt)("form",{"class":"widgetForm"},(0,_dom.elt)("h4",null,wpp.command.label+" Settings"),wpp.fields.map(function(f){return(0,_dom.elt)("div",null,f)}),buttons),wpp.form.addEventListener("keypress",function(e){13==e.keyCode&&(e.preventDefault(),e.stopPropagation(),save.click())});var dialog=(0,_dom.elt)("div",null,(0,_dom.elt)("div",{"class":"widgetDialog"}),wpp.form);return wpp.pm.wrapper.appendChild(dialog),{close:close}}function selectClickedNode(pm,e){var pos=(0,_dompos.selectableNodeAbove)(pm,e.target,{left:e.clientX,top:e.clientY},!0);if(!pos)return pm.sel.fastPoll();var _pm$selection=pm.selection,node=_pm$selection.node,from=_pm$selection.from;if(node&&pos.depth>=from.depth&&0==pos.shorten(from.depth).cmp(from)){if(0==from.depth)return pm.sel.fastPoll();pos=from.shorten()}pm.setNodeSelection(pos),lastClicked=e.target}function defParamsClick(type,cmdname){var spots=arguments.length<=2||void 0===arguments[2]?["topright"]:arguments[2];type.prototype.handleClick=function(pm,e,path,node){selectClickedNode(pm,e);var spotClicked=!1;if(spots.forEach(function(loc){var r=e.target.getBoundingClientRect();"all"==loc?spotClicked=!0:"topright"==loc?spotClicked=spotClicked||e.clientX>r.right-16&&e.clientY<r.top+16:"topleft"==loc?spotClicked=spotClicked||e.clientX<r.left+16&&e.clientY<r.top+16:"bottomright"==loc&&(spotClicked=spotClicked||e.clientX>r.right-32&&e.clientY>r.bottom-32)}),spotClicked){var cmd=pm.commands[cmdname];return cmd?(cmd.exec(pm),!0):!1}}}function selectedNodeAttr(pm,type,name){var node=pm.selection.node;return node&&node.type==type?node.attrs[name]:void 0}function FileDragHover(e){e.stopPropagation(),e.preventDefault(),e.target.className="dragover"==e.type?"hover":""}function buildUploadForm(pm,field){var legend=(0,_dom.elt)("h4",null,"File Upload"),label=((0,_dom.elt)("input",{type:"hidden",id:"MAX_FILE_SIZE",name:"MAX_FILE_SIZE",value:"300000"}),(0,_dom.elt)("label",{"for":"fileselect"},"File to upload:")),fileselect=(0,_dom.elt)("input",{id:"fileselect",type:"file",name:"fileselect[]",multiple:"multiple"}),filedrag=(0,_dom.elt)("div",{id:"filedrag"},"or drop files here"),cancel=(0,_dom.elt)("input",{type:"button",value:"Cancel"});cancel.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),pm.wrapper.removeChild(form)});var saveFile=function(e){e.preventDefault(),e.stopPropagation(),FileDragHover(e);var files=e.target.files||e.dataTransfer.files;files&&(field.value=files[0].name),fhandler&&fhandler(files),pm.wrapper.removeChild(form)};fileselect.addEventListener("change",saveFile);var xhr=new XMLHttpRequest;xhr.upload&&(filedrag.addEventListener("dragover",FileDragHover),filedrag.addEventListener("dragleave",FileDragHover),filedrag.addEventListener("drop",saveFile),filedrag.style.display="block");var form=(0,_dom.elt)("form",{id:"upload",enctype:"multipart/form-data"},legend,(0,_dom.elt)("div",null,label,fileselect,filedrag),(0,_dom.elt)("div",null,cancel));pm.wrapper.appendChild(form)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor);
}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.nameTitle=exports.namePattern=void 0,exports.defineFileHandler=defineFileHandler,exports.getLastClicked=getLastClicked,exports.defParamsClick=defParamsClick,exports.selectedNodeAttr=selectedNodeAttr;var _dom=require("prosemirror/dist/dom"),_prompt=require("prosemirror/dist/ui/prompt"),_edit=require("prosemirror/dist/edit"),_dompos=require("prosemirror/dist/edit/dompos"),fhandler=(require("prosemirror/dist/util/error"),null),lastClicked=null,WidgetParamPrompt=(exports.namePattern="[A-Za-z0-9_-]{1,10}",exports.nameTitle="letters,digits, -, _ (max:10)",function(_ParamPrompt){function WidgetParamPrompt(){return _classCallCheck(this,WidgetParamPrompt),_possibleConstructorReturn(this,Object.getPrototypeOf(WidgetParamPrompt).apply(this,arguments))}return _inherits(WidgetParamPrompt,_ParamPrompt),_createClass(WidgetParamPrompt,[{key:"prompt",value:function(){var _this2=this;return openWidgetPrompt(this,{onClose:function(){return _this2.close()}})}}]),WidgetParamPrompt}(_prompt.ParamPrompt));(0,_edit.defineOption)("commandParamPrompt",WidgetParamPrompt),["text","number","range","email","url","date"].map(function(type){return _prompt.ParamPrompt.prototype.paramTypes[type]={render:function(param,value){var field=(0,_dom.elt)("input",{type:type,placeholder:param.label,value:value,required:"required",autocomplete:"off"}),label=param.name?param.name:param.label;field.setAttribute("name",label);var opt=param.options;if(opt)for(var prop in opt)field.setAttribute(prop,opt[prop]);var fieldLabel=(0,_dom.elt)("label",{"for":label},label);return(0,_dom.elt)("div",{"class":"widgetField"},fieldLabel,field)},validate:function(dom){var input=dom.querySelector("input");return input.checkValidity()?null:input.name+": "+input.validationMessage},read:function(dom){var input=dom.querySelector("input");return input?input.value:input}}}),_prompt.ParamPrompt.prototype.paramTypes.file={render:function(param,value){var field=(0,_dom.elt)("input",{type:"text",readonly:!0,placeholder:param.label,value:value,required:"required",autocomplete:"off",required:!0}),label=param.name?param.name:param.label;field.setAttribute("name",label);var opt=param.options;if(opt)for(var prop in opt)field.setAttribute(prop,opt[prop]);var fieldLabel=(0,_dom.elt)("label",{"for":label},label),uploadButton=(0,_dom.elt)("input",{name:"upload",type:"button",value:"Upload"});return uploadButton.addEventListener("click",function(e){buildUploadForm(pm,field)}),(0,_dom.elt)("div",{"class":"widgetField"},fieldLabel,field,uploadButton)},validate:function(dom){var input=dom.querySelector("input");return input.checkValidity()?null:input.name+": "+input.validationMessage},read:function(dom){var input=dom.querySelector("input");return input?input.value:input}},_prompt.ParamPrompt.prototype.paramTypes.select={render:function(param,value){var options=param.options.call?param.options(this):param.options,field=(0,_dom.elt)("select",null,options.map(function(o){return(0,_dom.elt)("option",{value:o.value,selected:o.value==value?"true":null},o.label)}));field.setAttribute("required","required");var label=param.name?param.name:param.label;field.setAttribute("name",label);var fieldLabel=(0,_dom.elt)("label",{"for":name},label);return(0,_dom.elt)("div",{"class":"widgetField"},fieldLabel,field)},validate:function(dom){var select=dom.querySelector("select");return select.checkValidity()?null:select.name+": "+select.validationMessage},read:function(dom){var select=dom.querySelector("select");return select?select.value:select}},(0,_dom.insertCSS)('\n\n.widgetDialog {\n	position: absolute;\n	top: 0;\n	left: 0;\n	width: 100%;\n	height: 100%;\n	background: #FFF;\n	z-index: 8888;\n	opacity:0.7;\n}\n\n.widgetForm {\n	font-family: Helvetica, Arial, Sans-Serif;\n	font-size: 80%;\n	background: white;\n	position: absolute;\n	top: 10px;\n	left: 10px;\n	z-index: 9999;\n	display: block;\n	border-radius: 6px;\n	border: 1px solid #AAA;\n	padding: 4px;\n}\n\n.widgetForm h4 {\n	margin: 0;\n}\n\n.widgetField {\n	display: block;\n	padding: 2px;\n}\n\n.widgetField label {\n	width: 80px;\n	color: black;\n	display: inline-block;\n	padding: 2px;\n	float: left;\n}\n\n.widgetField input {\n	margin: 2px;\n	display: inline;\n}\n\n.widgetField input[type = "number"] {\n	width: 60px;\n	margin: 2px;\n	display: inline;\n}\n\n.widgetField input[type = "button"] {\n	margin: 5px;\n}\n\n.widgetFieldName {\n	color: black;\n	display: inline;\n	padding: 4px;\n}\n\n.widgetButtons {\n	text-align: center;\n	display: inline-block;\n	white-space: nowrap;\n}\n\n.widgetButtons input {\n	margin: 5px;\n}\n\n#upload {\n	position: absolute;\n	top: 40px;\n	left: 40px;\n	padding: 5px;\n	border: 1px solid #AAA;\n	border-radius: 6px;\n	background: white;\n	z-index: 10000;\n	display: block;\n}\n\n#upload input {\n	margin: 5px;\n}\n\n#upload h4 {\n	margin: 0;\n}\n\n#filedrag {\n	display: none;\n	font-weight: bold;\n	text-align: center;\n	padding: 1em 0;\n	margin: 1em 0;\n	color: #555;\n	border: 2px dashed #555;\n	border-radius: 6px;\n	cursor: default;\n}\n\n#filedrag:hover {\n	color: #f00;\n	border-color: #f00;\n	border-style: solid;\n	box-shadow: inset 0 3px 4px #888;\n}\n\n.ProseMirror-invalid {\n	  white-space: nowrap;\n	  font-size: 80%;\n	  background: white;\n	  border: 1px solid red;\n	  border-radius: 4px;\n	  padding: 5px 10px;\n	  position: absolute;\n	  min-width: 10em;\n	}\n\n')},{"prosemirror/dist/dom":1,"prosemirror/dist/edit":11,"prosemirror/dist/edit/dompos":8,"prosemirror/dist/ui/prompt":49,"prosemirror/dist/util/error":52}],62:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.BlockMath=void 0;var _model=require("prosemirror/dist/model"),_dom=require("prosemirror/dist/dom"),_utils=require("../../utils"),BlockMath=exports.BlockMath=function(_Block){function BlockMath(){return _classCallCheck(this,BlockMath),_possibleConstructorReturn(this,Object.getPrototypeOf(BlockMath).apply(this,arguments))}return _inherits(BlockMath,_Block),_createClass(BlockMath,[{key:"attrs",get:function(){return{tex:new _model.Attribute({"default":""})}}},{key:"contains",get:function(){return null}}]),BlockMath}(_model.Block);(0,_utils.defParser)(BlockMath,"div","widgets-blockmath"),BlockMath.prototype.serializeDOM=function(node){return node.rendered?node.rendered=node.rendered.cloneNode(!0):(node.rendered=(0,_dom.elt)("div",{"class":"widgets-blockmath widgets-edit"},"\\["+node.attrs.tex+"\\]"),MathJax.Hub.Queue(["Delay",MathJax.Callback,100],["Typeset",MathJax.Hub,node.rendered])),node.rendered},BlockMath.register("command","insert",{derive:{params:[{name:"Latex",attr:"tex",label:"Latex Expression",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"tex")}}]},label:"BlockMath",menu:{group:"content",rank:72,display:{type:"label",label:"Block Math"}}}),(0,_utils.defParamsClick)(BlockMath,"blockmath:insert"),(0,_dom.insertCSS)("\n\n.ProseMirror .widgets-blockmath {}\n\n")},{"../../utils":60,"prosemirror/dist/dom":1,"prosemirror/dist/model":34}],63:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function getCarryOptions(names){return names.map(function(w){return{value:w,label:w}})}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.CarryForward=void 0;var _model=require("prosemirror/dist/model"),_dom=require("prosemirror/dist/dom"),_utils=require("../../utils"),CarryForward=exports.CarryForward=function(_Inline){function CarryForward(){return _classCallCheck(this,CarryForward),_possibleConstructorReturn(this,Object.getPrototypeOf(CarryForward).apply(this,arguments))}return _inherits(CarryForward,_Inline),_createClass(CarryForward,[{key:"attrs",get:function(){return{name:new _model.Attribute,model:new _model.Attribute({"default":"user_response"}),type:new _model.Attribute({"default":"carry_forward"}),"class":new _model.Attribute({"default":"widgets-carryforward widgets-edit"})}}}]),CarryForward}(_model.Inline);(0,_utils.defParser)(CarryForward,"thinkspace","widgets-carryforward"),CarryForward.prototype.serializeDOM=function(node){return(0,_dom.elt)("thinkspace",node.attrs,(0,_dom.elt)("img",{src:"forward.png",width:16,height:16,title:"Carry forward "+node.attrs.name}))},CarryForward.register("command","insert",{derive:{params:[{name:"Name",attr:"name",label:"Element name",type:"select",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"name")},options:function(){return getCarryOptions(["test1","test2"])}}]},label:"CarryForward",menu:{group:"content",rank:73,display:{type:"label",label:"Carry Forward"}}}),(0,_utils.defParamsClick)(CarryForward,"carryforward:insert",["all"]),(0,_dom.insertCSS)("\n\n.ProseMirror .widgets-carryforward img:hover {\n	cursor: pointer;\n}\n\n")},{"../../utils":60,"prosemirror/dist/dom":1,"prosemirror/dist/model":34}],64:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.Image=void 0;var _model=require("prosemirror/dist/model"),_dom=require("prosemirror/dist/dom"),_utils=require("../../utils"),Image=exports.Image=function(_Inline){function Image(){return _classCallCheck(this,Image),_possibleConstructorReturn(this,Object.getPrototypeOf(Image).apply(this,arguments))}return _inherits(Image,_Inline),_createClass(Image,[{key:"attrs",get:function(){return{src:new _model.Attribute,alt:new _model.Attribute,title:new _model.Attribute,"class":new _model.Attribute({"default":"widgets-img widgets-edit"})}}}]),Image}(_model.Inline);(0,_utils.defParser)(Image,"img","widgets-img"),Image.prototype.serializeDOM=function(node,s){return s.renderAs(node,"img",node.attrs)},Image.register("command","insert",{derive:{params:[{name:"File",attr:"src",label:"Image File",type:"file","default":"img.png",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"src")}},{name:"Description",attr:"alt",label:"Description / alternative text",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"alt")}},{name:"Title",attr:"title",label:"Title",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"title")}}]},label:"Image",menu:{group:"content",rank:70,display:{type:"label",label:"Image"}}}),(0,_utils.defParamsClick)(Image,"image:insert",["all"]),(0,_dom.insertCSS)("\n\n.ProseMirror .widgets-img {}\n\n")},{"../../utils":60,"prosemirror/dist/dom":1,"prosemirror/dist/model":34}],65:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _blockmath=require("./blockmath");Object.defineProperty(exports,"BlockMath",{enumerable:!0,get:function(){return _blockmath.BlockMath}});var _website=require("./website");Object.defineProperty(exports,"Website",{enumerable:!0,get:function(){return _website.Website}});var _inlinemath=require("./inlinemath");Object.defineProperty(exports,"InlineMath",{enumerable:!0,get:function(){return _inlinemath.InlineMath}});var _image=require("./image");Object.defineProperty(exports,"Image",{enumerable:!0,get:function(){return _image.Image}});var _spreadsheet=require("./spreadsheet");Object.defineProperty(exports,"SpreadSheet",{enumerable:!0,get:function(){return _spreadsheet.SpreadSheet}});var _carryforward=require("./carryforward");Object.defineProperty(exports,"CarryForward",{enumerable:!0,get:function(){return _carryforward.CarryForward}})},{"./blockmath":62,"./carryforward":63,"./image":64,"./inlinemath":66,"./spreadsheet":67,"./website":68}],66:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.InlineMath=void 0;var _model=require("prosemirror/dist/model"),_dom=require("prosemirror/dist/dom"),_utils=require("../../utils"),InlineMath=exports.InlineMath=function(_Inline){function InlineMath(){return _classCallCheck(this,InlineMath),_possibleConstructorReturn(this,Object.getPrototypeOf(InlineMath).apply(this,arguments))}return _inherits(InlineMath,_Inline),_createClass(InlineMath,[{key:"attrs",get:function(){return{tex:new _model.Attribute}}},{key:"contains",get:function(){return null}}]),InlineMath}(_model.Inline);(0,_utils.defParser)(InlineMath,"span","widgets-inlinemath"),InlineMath.prototype.serializeDOM=function(node){return node.rendered?node.rendered=node.rendered.cloneNode(!0):(node.rendered=(0,_dom.elt)("span",{"class":"widgets-inlinemath widgets-edit"}," \\("+node.attrs.tex+"\\) "),MathJax.Hub.Queue(["Delay",MathJax.Callback,100],["Typeset",MathJax.Hub,node.rendered])),node.rendered},InlineMath.register("command","insert",{derive:{params:[{name:"Latex",attr:"tex",label:"Latex Expression",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"tex")}}]},label:"InlineMath",menu:{group:"content",rank:71,display:{type:"label",label:"Inline Math"}}}),(0,_utils.defParamsClick)(InlineMath,"inlinemath:insert"),(0,_dom.insertCSS)("\n\n.ProseMirror .widgets-inlinemath {}\n\n")},{"../../utils":60,"prosemirror/dist/dom":1,"prosemirror/dist/model":34}],67:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.SpreadSheet=void 0;var _model=require("prosemirror/dist/model"),_dom=require("prosemirror/dist/dom"),_utils=require("../../utils"),SpreadSheet=exports.SpreadSheet=function(_Block){function SpreadSheet(){return _classCallCheck(this,SpreadSheet),_possibleConstructorReturn(this,Object.getPrototypeOf(SpreadSheet).apply(this,arguments))}return _inherits(SpreadSheet,_Block),_createClass(SpreadSheet,[{key:"attrs",get:function(){return{data:new _model.Attribute}}},{key:"contains",get:function(){return null}}]),SpreadSheet}(_model.Block);(0,_utils.defParser)(SpreadSheet,"div","widgets-spreadsheet"),SpreadSheet.prototype.serializeDOM=function(node){return node.rendered?node.rendered=node.rendered.cloneNode(!0):(node.rendered=(0,_dom.elt)("div",{"class":"widgets-spreadsheet widgets-edit"}),window.setTimeout(function(){var data=[["","Ford","Volvo","Toyota","Honda"],["2014",10,11,12,13],["2015",20,11,14,13],["2016",30,15,12,13]];new Handsontable(node.rendered,{data:data,minSpareRows:1,rowHeaders:!0,colHeaders:!0,contextMenu:!0})},100)),node.rendered},SpreadSheet.register("command","insert",{derive:{params:[{name:"Data Link",attr:"data",label:"Link to CSV (fixed for demo)",type:"file","default":"cars.csv",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"data")}}]},label:"SpreadSheet",menu:{group:"content",rank:75,display:{type:"label",label:"Spreadsheet"}}}),(0,_utils.defParamsClick)(SpreadSheet,"spreadsheet:insert",["all"]),(0,_dom.insertCSS)("\n\n.ProseMirror .widgets-spreadsheet {\n}\n\n")},{"../../utils":60,"prosemirror/dist/dom":1,"prosemirror/dist/model":34}],68:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.Website=void 0;var _model=require("prosemirror/dist/model"),_dom=require("prosemirror/dist/dom"),_utils=require("../../utils"),Website=exports.Website=function(_Block){function Website(){return _classCallCheck(this,Website),_possibleConstructorReturn(this,Object.getPrototypeOf(Website).apply(this,arguments))}return _inherits(Website,_Block),_createClass(Website,[{key:"attrs",get:function(){return{src:new _model.Attribute,width:new _model.Attribute({"default":200}),height:new _model.Attribute({"default":200})}}},{key:"contains",get:function(){return null}}]),Website}(_model.Block);(0,_utils.defParser)(Website,"website","widgets-website"),Website.prototype.serializeDOM=function(node,s){return s.renderAs(node,"iframe",{src:node.attrs.src,width:node.attrs.width,height:node.attrs.height,content:"text/html;charset=UTF-8","class":"widgets-website widgets-edit",frameborder:"1",allowfullscreen:"1"})},Website.register("command","insert",{derive:{params:[{name:"URL",attr:"src",label:"Link to website, youTube, Google Maps ...",type:"url",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"src")}},{name:"Width",attr:"width",label:"Width in pixels",type:"number","default":200,prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"width")},options:{min:50,height:800}},{name:"Height",attr:"height",label:"Height in pixels",type:"number","default":200,prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"height")},options:{min:50,height:800}}]},label:"Website",menu:{group:"content",rank:74,display:{type:"label",label:"Website"}}}),(0,_utils.defParamsClick)(Website,"website:insert"),(0,_dom.insertCSS)("\n\n.ProseMirror .widgets-website:hover {\n    padding-top: 16px;\n}\n\n")},{"../../utils":60,"prosemirror/dist/dom":1,"prosemirror/dist/model":34}],69:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function getTextblockPos(pm,pos){for(var node=void 0;node=pm.doc.path(pos.path),!(node.type instanceof _model.Textblock||0==pos.depth);)pos=pos.shorten();return pos.depth>0?pos.shorten():pos}function findAlignWrapper(pm,align){var _pm$selection=pm.selection,from=_pm$selection.from,to=_pm$selection.to,isLeft=(_pm$selection.node,"leftalign"==align.name),start=getTextblockPos(pm,from),parent=pm.doc.path(start.path);if(parent.type instanceof Align)return isLeft?pm.tr.lift(new _model.Pos(start.path,0),new _model.Pos(start.path,parent.size)).apply(pm.apply.scroll):pm.tr.setNodeType((0,_utils.getPosInParent)(pm,start.shorten(),parent),align,{"class":align.style}).apply(pm.apply.scroll);if(isLeft)return!1;var end=from.cmp(to)?getTextblockPos(pm,to):start;return pm.tr.wrap(start,end.move(1),align,{"class":align.style}).apply(pm.apply.scroll)}function alignApplies(pm,type){var _pm$selection2=pm.selection,from=_pm$selection2.from,isLeft=(_pm$selection2.to,_pm$selection2.node,"leftalign"==type.name),start=getTextblockPos(pm,from),parent=pm.doc.path(start.path);return!isLeft||parent.type instanceof Align?parent.type.name==type.name:!0}function defAlign(type,label,path){type.register("command","align",{run:function(pm){return findAlignWrapper(pm,this)},active:function(pm){return alignApplies(pm,this)},label:label,menu:{group:"align",rank:51,display:{type:"icon",width:8,height:8,path:path}}})}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.RightAlign=exports.CenterAlign=exports.LeftAlign=exports.alignGroup=void 0;var _menu=require("prosemirror/dist/menu/menu"),_model=require("prosemirror/dist/model"),_dom=require("prosemirror/dist/dom"),_utils=(require("prosemirror/dist/transform"),require("../../utils")),Align=function(_Block){function Align(){return _classCallCheck(this,Align),_possibleConstructorReturn(this,Object.getPrototypeOf(Align).apply(this,arguments))}return _inherits(Align,_Block),_createClass(Align,[{key:"attrs",get:function(){return{"class":new _model.Attribute({"default":"widgets-leftalign"})}}},{key:"contains",get:function(){return"block"}}]),Align}(_model.Block);Align.prototype.serializeDOM=function(node,s){return s.renderAs(node,"div",node.attrs)};var LeftAlign=(exports.alignGroup=new _menu.MenuCommandGroup("align"),exports.LeftAlign=function(_Align){function LeftAlign(){return _classCallCheck(this,LeftAlign),_possibleConstructorReturn(this,Object.getPrototypeOf(LeftAlign).apply(this,arguments))}return _inherits(LeftAlign,_Align),_createClass(LeftAlign,[{key:"style",get:function(){return"widgets-leftalign"}}]),LeftAlign}(Align)),CenterAlign=exports.CenterAlign=function(_Align2){function CenterAlign(){return _classCallCheck(this,CenterAlign),_possibleConstructorReturn(this,Object.getPrototypeOf(CenterAlign).apply(this,arguments))}return _inherits(CenterAlign,_Align2),_createClass(CenterAlign,[{key:"style",get:function(){return"widgets-centeralign"}}]),CenterAlign}(Align),RightAlign=exports.RightAlign=function(_Align3){function RightAlign(){return _classCallCheck(this,RightAlign),_possibleConstructorReturn(this,Object.getPrototypeOf(RightAlign).apply(this,arguments))}return _inherits(RightAlign,_Align3),_createClass(RightAlign,[{key:"style",get:function(){return"widgets-rightalign"}}]),RightAlign}(Align);(0,_utils.defParser)(LeftAlign,"div","icons/leftalign.png"),(0,_utils.defParser)(CenterAlign,"div","widgets-centeralign"),(0,_utils.defParser)(RightAlign,"div","widgets-rightalign"),defAlign(LeftAlign,"Left Align","M0 0v1h8v-1h-8zm0 2v1h6v-1h-6zm0 2v1h8v-1h-8zm0 2v1h6v-1h-6z"),defAlign(CenterAlign,"Center Align","M0 0v1h8v-1h-8zm1 2v1h6v-1h-6zm-1 2v1h8v-1h-8zm1 2v1h6v-1h-6z"),defAlign(RightAlign,"Right Align","M0 0v1h8v-1h-8zm2 2v1h6v-1h-6zm-2 2v1h8v-1h-8zm2 2v1h6v-1h-6z"),(0,_dom.insertCSS)("\ndiv.widgets-leftalign {\n	text-align: left;\n}\n\ndiv.widgets-centeralign {\n	text-align: center;\n}\n\ndiv.widgets-rightalign {\n	text-align: right;\n}\n\ndiv.widgets-justifyalign {\n	text-align: justify;\n}\n\n")},{"../../utils":60,"prosemirror/dist/dom":1,"prosemirror/dist/menu/menu":27,"prosemirror/dist/model":34,"prosemirror/dist/transform":40}],70:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _align=require("./align");Object.defineProperty(exports,"alignGroup",{enumerable:!0,get:function(){return _align.alignGroup}}),Object.defineProperty(exports,"LeftAlign",{enumerable:!0,get:function(){return _align.LeftAlign}}),Object.defineProperty(exports,"CenterAlign",{enumerable:!0,get:function(){return _align.CenterAlign}}),Object.defineProperty(exports,"RightAlign",{enumerable:!0,get:function(){return _align.RightAlign}});var _marks=require("./marks");Object.defineProperty(exports,"UnderlineMark",{enumerable:!0,get:function(){return _marks.UnderlineMark}}),Object.defineProperty(exports,"StrikeThroughMark",{enumerable:!0,get:function(){return _marks.StrikeThroughMark}})},{"./align":69,"./marks":71}],71:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.StrikeThroughMark=exports.UnderlineMark=void 0;var _model=require("prosemirror/dist/model"),_dom=require("prosemirror/dist/dom"),UnderlineMark=(require("../../utils"),exports.UnderlineMark=function(_MarkType){function UnderlineMark(){return _classCallCheck(this,UnderlineMark),_possibleConstructorReturn(this,Object.getPrototypeOf(UnderlineMark).apply(this,arguments));
}return _inherits(UnderlineMark,_MarkType),UnderlineMark}(_model.MarkType));UnderlineMark.prototype.serializeDOM=function(mark,s){return s.elt("span",{style:"text-decoration: underline;"})},UnderlineMark.register("command","set",{derive:!0,label:"Set underline"}),UnderlineMark.register("command","unset",{derive:!0,label:"Unset underline"}),UnderlineMark.register("command","toggle",{derive:!0,label:"Toggle underline",menu:{group:"inline",rank:22,display:{type:"icon",width:8,height:8,path:"M1 0v4c0 1.1 1.12 2 2.5 2h.5c1.1 0 2-.9 2-2v-4h-1v4c0 .55-.45 1-1 1s-1-.45-1-1v-4h-2zm-1 7v1h7v-1h-7z"}},keys:["Mod-U"]}),UnderlineMark.register("parseDOMStyle","text-decoration",{parse:function(value,state,inner){"underline"==value?state.wrapMark(inner,this):inner()}});var StrikeThroughMark=exports.StrikeThroughMark=function(_MarkType2){function StrikeThroughMark(){return _classCallCheck(this,StrikeThroughMark),_possibleConstructorReturn(this,Object.getPrototypeOf(StrikeThroughMark).apply(this,arguments))}return _inherits(StrikeThroughMark,_MarkType2),StrikeThroughMark}(_model.MarkType);StrikeThroughMark.prototype.serializeDOM=function(mark,s){return s.elt("span",{style:"text-decoration: line-through;"})},StrikeThroughMark.register("command","set",{derive:!0,label:"Set strike-through"}),StrikeThroughMark.register("command","unset",{derive:!0,label:"Unset strike-through"}),StrikeThroughMark.register("command","toggle",{derive:!0,label:"Toggle strike-through",menu:{group:"inline",rank:23,display:{type:"icon",width:512,height:512,path:"M100.382,486.283v-69.5c8.006,7.789,17.585,14.803,28.743,21.053c11.151,6.263,22.901,11.513,35.257,15.776  c12.349,4.276,24.756,7.578,37.217,9.934c12.467,2.368,23.974,3.54,34.526,3.54c36.454,0,63.664-6.908,81.638-20.711  c17.948-13.815,26.948-33.671,26.948-59.565c0-13.474-3.026-25.237-9.053-35.264s-14.329-19.157-24.921-27.395  c-10.593-8.237-23.132-16.145-37.605-23.737l-31.224-15.895H0v-53.895h149.289c-4.395-3.553-8.552-7.224-12.474-11.007  c-11.342-10.928-20.25-23.315-26.724-37.164c-6.474-13.842-9.71-30.086-9.71-48.73c0-22.829,5.105-42.685,15.322-59.56  c10.217-16.881,23.638-30.789,40.257-41.717c16.611-10.928,35.552-19.066,56.809-24.421C234.033,2.678,255.704,0,277.789,0  c50.29,0,86.974,6.625,110.026,19.875V86.23c-29.868-23.947-68.236-35.928-115.078-35.928c-12.954,0-25.908,1.388-38.855,4.151  c-12.954,2.776-24.48,7.303-34.586,13.585c-10.105,6.29-18.335,14.375-24.697,24.257c-6.361,9.882-9.546,21.935-9.546,36.151  c0,12.803,2.414,23.862,7.243,33.185c4.829,9.315,11.954,17.809,21.389,25.486c9.434,7.671,20.921,15.119,34.467,22.343  l41.73,21.164H512v53.895H359.395c3.474,2.961,6.816,5.987,10,9.093c12.29,11.907,22.014,25.065,29.211,39.46  c7.184,14.421,10.763,30.947,10.763,49.579c0,24.711-4.921,45.605-14.763,62.711c-9.843,17.104-23.105,31-39.79,41.71  c-16.71,10.711-35.947,18.435-57.776,23.185c-21.828,4.763-44.822,7.132-69,7.132l-29.861-2.079  c-11.829-1.382-23.921-3.396-36.27-6.053c-12.349-2.658-24.026-5.961-35.033-9.895C115.875,495.44,107.039,491.072,100.382,486.283z  "}},keys:["Mod-S"]}),StrikeThroughMark.register("parseDOMStyle","text-decoration",{parse:function(value,state,inner){"line-through"==value?state.wrapMark(inner,this):inner()}}),(0,_dom.insertCSS)("\n")},{"../../utils":60,"prosemirror/dist/dom":1,"prosemirror/dist/model":34}],72:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.questionInsertMenu=exports.contentInsertMenu=exports.questionCommandGroup=exports.contentCommandGroup=exports.StrikeThroughMark=exports.UnderlineMark=exports.RightAlign=exports.CenterAlign=exports.LeftAlign=exports.alignGroup=exports.TextArea=exports.TextField=exports.Select=exports.RadioButton=exports.CheckBox=exports.Website=exports.SpreadSheet=exports.InlineMath=exports.Image=exports.CarryForward=exports.BlockMath=exports.Selection=exports.ShortAnswer=exports.Essay=exports.Scale=exports.ScaleDisplay=exports.Choice=exports.MultipleChoice=exports.CheckItem=exports.CheckList=exports.TextBox=exports.Input=exports.Question=void 0;var _questions=require("./questions");Object.defineProperty(exports,"Question",{enumerable:!0,get:function(){return _questions.Question}}),Object.defineProperty(exports,"Input",{enumerable:!0,get:function(){return _questions.Input}}),Object.defineProperty(exports,"TextBox",{enumerable:!0,get:function(){return _questions.TextBox}}),Object.defineProperty(exports,"CheckList",{enumerable:!0,get:function(){return _questions.CheckList}}),Object.defineProperty(exports,"CheckItem",{enumerable:!0,get:function(){return _questions.CheckItem}}),Object.defineProperty(exports,"MultipleChoice",{enumerable:!0,get:function(){return _questions.MultipleChoice}}),Object.defineProperty(exports,"Choice",{enumerable:!0,get:function(){return _questions.Choice}}),Object.defineProperty(exports,"ScaleDisplay",{enumerable:!0,get:function(){return _questions.ScaleDisplay}}),Object.defineProperty(exports,"Scale",{enumerable:!0,get:function(){return _questions.Scale}}),Object.defineProperty(exports,"Essay",{enumerable:!0,get:function(){return _questions.Essay}}),Object.defineProperty(exports,"ShortAnswer",{enumerable:!0,get:function(){return _questions.ShortAnswer}}),Object.defineProperty(exports,"Selection",{enumerable:!0,get:function(){return _questions.Selection}});var _content=require("./content");Object.defineProperty(exports,"BlockMath",{enumerable:!0,get:function(){return _content.BlockMath}}),Object.defineProperty(exports,"CarryForward",{enumerable:!0,get:function(){return _content.CarryForward}}),Object.defineProperty(exports,"Image",{enumerable:!0,get:function(){return _content.Image}}),Object.defineProperty(exports,"InlineMath",{enumerable:!0,get:function(){return _content.InlineMath}}),Object.defineProperty(exports,"SpreadSheet",{enumerable:!0,get:function(){return _content.SpreadSheet}}),Object.defineProperty(exports,"Website",{enumerable:!0,get:function(){return _content.Website}});var _input=require("./input");Object.defineProperty(exports,"Input",{enumerable:!0,get:function(){return _input.Input}}),Object.defineProperty(exports,"CheckBox",{enumerable:!0,get:function(){return _input.CheckBox}}),Object.defineProperty(exports,"RadioButton",{enumerable:!0,get:function(){return _input.RadioButton}}),Object.defineProperty(exports,"Select",{enumerable:!0,get:function(){return _input.Select}}),Object.defineProperty(exports,"TextField",{enumerable:!0,get:function(){return _input.TextField}}),Object.defineProperty(exports,"TextArea",{enumerable:!0,get:function(){return _input.TextArea}});var _format=require("./format");Object.defineProperty(exports,"alignGroup",{enumerable:!0,get:function(){return _format.alignGroup}}),Object.defineProperty(exports,"LeftAlign",{enumerable:!0,get:function(){return _format.LeftAlign}}),Object.defineProperty(exports,"CenterAlign",{enumerable:!0,get:function(){return _format.CenterAlign}}),Object.defineProperty(exports,"RightAlign",{enumerable:!0,get:function(){return _format.RightAlign}}),Object.defineProperty(exports,"UnderlineMark",{enumerable:!0,get:function(){return _format.UnderlineMark}}),Object.defineProperty(exports,"StrikeThroughMark",{enumerable:!0,get:function(){return _format.StrikeThroughMark}});var _dom=require("prosemirror/dist/dom"),_menu=require("prosemirror/dist/menu/menu"),contentCommandGroup=exports.contentCommandGroup=new _menu.MenuCommandGroup("content"),questionCommandGroup=exports.questionCommandGroup=new _menu.MenuCommandGroup("question");exports.contentInsertMenu=new _menu.Dropdown({label:"Content..",displayActive:!0,"class":"ProseMirror-widgetinsert-dropdown"},[contentCommandGroup]),exports.questionInsertMenu=new _menu.Dropdown({label:"Question..",displayActive:!0,"class":"ProseMirror-widgetinsert-dropdown"},[questionCommandGroup]);(0,_dom.insertCSS)("\n\n.ProseMirror .widgets-edit:hover {\n	background-image: url('icons/settings.png');\n	background-repeat: no-repeat;\n	background-position: top right;\n	cursor: pointer;\n }\n\n.ProseMirror-menu-dropdown-item {\n	white-space: nowrap;\n}\n\n.ProseMirror-menu-dropdown-menu {\n	border-radius: 6px;\n}\n\n.ProseMirror-menu-submenu {\n	border-radius: 6px;\n}\n\n")},{"./content":65,"./format":70,"./input":74,"./questions":82,"prosemirror/dist/dom":1,"prosemirror/dist/menu/menu":27}],73:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.CheckBox=void 0;var _model=require("prosemirror/dist/model"),_dom=require("prosemirror/dist/dom"),_input=require("./input"),_utils=require("../../utils"),CheckBox=exports.CheckBox=function(_Input){function CheckBox(){return _classCallCheck(this,CheckBox),_possibleConstructorReturn(this,Object.getPrototypeOf(CheckBox).apply(this,arguments))}return _inherits(CheckBox,_Input),_createClass(CheckBox,[{key:"attrs",get:function(){return{name:new _model.Attribute,type:new _model.Attribute({"default":"checkbox"}),value:new _model.Attribute({"default":"1"}),"class":new _model.Attribute({"default":"widgets-checkbox"})}}}]),CheckBox}(_input.Input);(0,_utils.defParser)(CheckBox,"input","widgets-checkbox"),CheckBox.register("command","insert",{label:"CheckBox",run:function(pm,name){return pm.tr.replaceSelection(this.create({name:name})).apply(pm.apply.scroll)},params:[{name:"Name",label:"Short ID",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"name")},options:{pattern:_utils.namePattern,size:10,title:_utils.nameTitle}}]}),(0,_utils.defParamsClick)(CheckBox,"checkbox:insert",["all"]),(0,_dom.insertCSS)("\n\n.ProseMirror .widgets-checkbox:hover {\n	cursor: pointer;\n}\n\n")},{"../../utils":60,"./input":75,"prosemirror/dist/dom":1,"prosemirror/dist/model":34}],74:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _input=require("./input");Object.defineProperty(exports,"Input",{enumerable:!0,get:function(){return _input.Input}});var _checkbox=require("./checkbox");Object.defineProperty(exports,"CheckBox",{enumerable:!0,get:function(){return _checkbox.CheckBox}});var _radiobutton=require("./radiobutton");Object.defineProperty(exports,"RadioButton",{enumerable:!0,get:function(){return _radiobutton.RadioButton}});var _select=require("./select");Object.defineProperty(exports,"Select",{enumerable:!0,get:function(){return _select.Select}});var _textfield=require("./textfield");Object.defineProperty(exports,"TextField",{enumerable:!0,get:function(){return _textfield.TextField}});var _textarea=require("./textarea");Object.defineProperty(exports,"TextArea",{enumerable:!0,get:function(){return _textarea.TextArea}})},{"./checkbox":73,"./input":75,"./radiobutton":76,"./select":77,"./textarea":78,"./textfield":79}],75:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.Input=void 0;var _model=require("prosemirror/dist/model"),_dom=require("prosemirror/dist/dom"),_utils=require("../../utils"),Input=exports.Input=function(_Block){function Input(){return _classCallCheck(this,Input),_possibleConstructorReturn(this,Object.getPrototypeOf(Input).apply(this,arguments))}return _inherits(Input,_Block),_createClass(Input,[{key:"attrs",get:function(){return{name:new _model.Attribute,type:new _model.Attribute({"default":"text"}),value:new _model.Attribute}}},{key:"selectable",get:function(){return!1}},{key:"contains",get:function(){return null}}]),Input}(_model.Block);(0,_utils.defParser)(Input,"widgets-input"),Input.prototype.serializeDOM=function(node){return(0,_dom.elt)("input",node.attrs)},(0,_dom.insertCSS)("\n		\n.widgets-input {}\n\n")},{"../../utils":60,"prosemirror/dist/dom":1,"prosemirror/dist/model":34}],76:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.RadioButton=void 0;var _model=require("prosemirror/dist/model"),_dom=require("prosemirror/dist/dom"),_utils=require("../../utils"),_input=require("./input"),RadioButton=exports.RadioButton=function(_Input){function RadioButton(){return _classCallCheck(this,RadioButton),_possibleConstructorReturn(this,Object.getPrototypeOf(RadioButton).apply(this,arguments))}return _inherits(RadioButton,_Input),_createClass(RadioButton,[{key:"attrs",get:function(){return{name:new _model.Attribute,type:new _model.Attribute({"default":"radio"}),value:new _model.Attribute,"class":new _model.Attribute({"default":"widgets-radiobutton"})}}}]),RadioButton}(_input.Input);(0,_utils.defParser)(RadioButton,"input","widgets-radiobutton"),(0,_dom.insertCSS)("\n\n.widgets-radiobutton {}\n\n")},{"../../utils":60,"./input":75,"prosemirror/dist/dom":1,"prosemirror/dist/model":34}],77:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.Select=void 0;var _model=require("prosemirror/dist/model"),_dom=require("prosemirror/dist/dom"),_utils=require("../../utils"),Select=exports.Select=function(_Inline){function Select(){return _classCallCheck(this,Select),_possibleConstructorReturn(this,Object.getPrototypeOf(Select).apply(this,arguments))}return _inherits(Select,_Inline),_createClass(Select,[{key:"contains",get:function(){return null}},{key:"attrs",get:function(){return{name:new _model.Attribute,options:new _model.Attribute,size:new _model.Attribute({"default":1}),multiple:new _model.Attribute({"default":"single"})}}}]),Select}(_model.Inline);(0,_utils.defParser)(Select,"select","widgets-select"),Select.prototype.serializeDOM=function(node){var select=("multiple"==node.attrs.multiple,(0,_dom.elt)("select",node.attrs));return node.attrs.options.split(",").map(function(option){select.appendChild((0,_dom.elt)("option",{value:option.trim()},option))}),select},Select.register("command","delete",{run:function(pm){var _pm$selection=pm.selection,node=(_pm$selection.from,_pm$selection.node);return node&&node.type==this?!0:!1},keys:["Backspace(10)","Mod-Backspace(10)"]}),Select.register("command","insert",{label:"Select",run:function(pm,name,options,size,multiple){return pm.tr.replaceSelection(this.create({name:name,options:options,size:size,multiple:multiple})).apply(pm.apply.scroll)},params:[{name:"Name",label:"Short ID",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"name")},options:{pattern:_utils.namePattern,size:10,title:_utils.nameTitle}},{name:"Options",label:"comma separated names",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"options")}},{name:"Size",label:"options displayed",type:"range",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"options")},options:{min:1,max:10,"default":1}},{name:"Selection",label:"Selection (single or multiple)",type:"select",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"multiple")},options:[{value:"multiple",label:"multiple"},{value:"single",label:"single"}]}]}),(0,_dom.insertCSS)("\n\n.ProseMirror .widgets-select {}\n\n")},{"../../utils":60,"prosemirror/dist/dom":1,"prosemirror/dist/model":34}],78:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextArea=void 0;var _model=require("prosemirror/dist/model"),_dom=require("prosemirror/dist/dom"),_utils=(require("./input"),require("../../utils")),TextArea=exports.TextArea=function(_Block){function TextArea(){return _classCallCheck(this,TextArea),_possibleConstructorReturn(this,Object.getPrototypeOf(TextArea).apply(this,arguments))}return _inherits(TextArea,_Block),_createClass(TextArea,[{key:"attrs",get:function(){return{name:new _model.Attribute,rows:new _model.Attribute,cols:new _model.Attribute,"class":new _model.Attribute({"default":"widgets-textarea"})}}}]),TextArea}(_model.Block);(0,_utils.defParser)(TextArea,"textarea","widgets-textarea"),TextArea.prototype.serializeDOM=function(node,s){return(0,_dom.elt)("textarea",node.attrs)},TextArea.register("command","delete",{run:function(pm){var _pm$selection=pm.selection,node=(_pm$selection.from,_pm$selection.node);return node&&node.type==this?!0:!1},keys:["Backspace(10)","Mod-Backspace(10)"]}),TextArea.register("command","insert",{label:"TextArea",run:function(pm,name,rows,cols){return pm.tr.replaceSelection(this.create({name:name,rows:rows,cols:cols})).apply(pm.apply.scroll)},params:[{name:"Name",label:"Short ID",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"name")},options:{pattern:_utils.namePattern,size:10,title:_utils.nameTitle}},{name:"Rows",label:"In lines",type:"number","default":"4",options:{min:2,max:24},prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"rows")}},{name:"Columns",label:"In characters",type:"number","default":"40",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"cols")},options:{min:2,max:80}}]}),(0,_dom.insertCSS)("\n\n.ProseMirror .widgets-textarea:hover {\n	cursor: pointer;\n}\n\n")},{"../../utils":60,"./input":75,"prosemirror/dist/dom":1,"prosemirror/dist/model":34}],79:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextField=void 0;var _model=require("prosemirror/dist/model"),_dom=require("prosemirror/dist/dom"),_input=require("./input"),_utils=require("../../utils"),TextField=exports.TextField=function(_Input){function TextField(){return _classCallCheck(this,TextField),_possibleConstructorReturn(this,Object.getPrototypeOf(TextField).apply(this,arguments))}return _inherits(TextField,_Input),_createClass(TextField,[{key:"attrs",get:function(){return{name:new _model.Attribute,type:new _model.Attribute({"default":"text"}),size:new _model.Attribute({"default":"20"}),"class":new _model.Attribute({"default":"widgets-textfield"})}}}]),TextField}(_input.Input);(0,_utils.defParser)(TextField,"input","widgets-textfield"),TextField.register("command","insert",{label:"TextField",run:function(pm,name){return pm.tr.replaceSelection(this.create({name:name})).apply(pm.apply.scroll)},params:[{name:"Name",label:"Short ID",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"name")},options:{pattern:_utils.namePattern,size:10,title:_utils.nameTitle}},{name:"Size",label:"Size in characters",type:"number","default":"20",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"size")},options:{min:1,max:80}}]}),(0,_dom.insertCSS)("\n\n.ProseMirror .widgets-textfield:hover {\n	cursor: pointer;\n}\n\n")},{"../../utils":60,"./input":75,"prosemirror/dist/dom":1,"prosemirror/dist/model":34}],80:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function renumber(pm,pos){var cl=pm.doc.path(pos.path),i=1;cl.forEach(function(node,start){"checkitem"==node.type.name&&pm.tr.setNodeType(new _model.Pos(pos.path,start),node.type,{name:node.attrs.name+"-"+i,value:i++}).apply()})}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;if(void 0!==getter)return getter.call(receiver)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.CheckList=exports.CheckItem=void 0;var _model=require("prosemirror/dist/model"),_dom=require("prosemirror/dist/dom"),_utils=(require("./textbox"),require("../../utils")),_question=require("./question"),CheckItem=exports.CheckItem=function(_Block){function CheckItem(){return _classCallCheck(this,CheckItem),_possibleConstructorReturn(this,Object.getPrototypeOf(CheckItem).apply(this,arguments))}return _inherits(CheckItem,_Block),_createClass(CheckItem,[{key:"create",value:function(attrs,content,marks){var len=content.content.length;return content=_model.Fragment.from([this.schema.nodes.checkbox.create(attrs),content.content[len-1]]),_get(Object.getPrototypeOf(CheckItem.prototype),"create",this).call(this,attrs,content,marks)}},{key:"attrs",get:function(){return{name:new _model.Attribute,value:new _model.Attribute,"class":new _model.Attribute({"default":"widgets-checkitem"})}}}],[{key:"kinds",get:function(){return"checkitem"}}]),CheckItem}(_model.Block),CheckList=exports.CheckList=function(_Question){function CheckList(){return _classCallCheck(this,CheckList),_possibleConstructorReturn(this,Object.getPrototypeOf(CheckList).apply(this,arguments))}return _inherits(CheckList,_Question),_createClass(CheckList,[{key:"attrs",get:function(){return{name:new _model.Attribute,"class":new _model.Attribute({"default":"widgets-checklist"})}}},{key:"isList",get:function(){return!0}}]),CheckList}(_question.Question);(0,_utils.defParser)(CheckItem,"div","widgets-checkitem"),(0,_utils.defParser)(CheckList,"div","widgets-checklist"),CheckItem.prototype.serializeDOM=function(node,s){return s.renderAs(node,"div",node.attrs)},CheckItem.register("command","split",{label:"Split the current checkitem",run:function(pm){var _pm$selection=pm.selection,from=_pm$selection.from,to=_pm$selection.to,node=_pm$selection.node;if(node&&node.isBlock||from.path.length<2||!_model.Pos.samePath(from.path,to.path))return!1;var toParent=from.shorten(),parent=pm.doc.path(toParent.path);if(parent.type!=this)return!1;var tr=pm.tr["delete"](from,to).split(from,2).apply(pm.apply.scroll);return renumber(pm,toParent.shorten()),tr},keys:["Enter(20)"]}),CheckItem.register("command","delete",{label:"delete this checkitem or checklist",run:function(pm){var _pm$selection2=pm.selection,from=_pm$selection2.from,to=_pm$selection2.to,toCH=(_pm$selection2.head,from.shorten()),ch=pm.doc.path(toCH.path);if(ch.type!=this)return!1;if(from.offset>0)return pm.tr["delete"](from,to).apply(pm.apply.scroll);var toCL=toCH.shorten(),cl=pm.doc.path(toCL.path),_nodeBefore=(0,_utils.nodeBefore)(pm,toCH),before=_nodeBefore.before;_nodeBefore.at;if(2==cl.size||before.type!=this||ch.lastChild.size>0)return!0;var tr=pm.tr["delete"](toCL,toCL.move(1)).apply();return renumber(pm,toCL),tr},keys:["Backspace(20)","Mod-Backspace(20)"]}),CheckList.register("command","insert",{label:"Check List",run:function(pm,name){var _pm$selection3=pm.selection,from=_pm$selection3.from,node=(_pm$selection3.to,_pm$selection3.node);if(node&&node.type==this){var tr=pm.tr.setNodeType(from,this,{name:name}).apply();return renumber(pm,_model.Pos.from(from.toPath().concat(from.offset),0)),tr}var choice_content=_model.Fragment.from([this.schema.nodes.checkbox.create({name:name,value:1}),this.schema.nodes.textbox.create()]),content=_model.Fragment.from([this.schema.nodes.paragraph.create(null,""),this.schema.nodes.checkitem.create({name:name,value:1},choice_content)]);return(0,_utils.insertWidget)(pm,from,this.create({name:name},content))},select:function(pm){return!0},menu:{group:"question",rank:70,display:{type:"label",label:"CheckList"}},params:[{name:"Name",attr:"name",label:"Short ID",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"name")},options:{pattern:_utils.namePattern,size:10,title:_utils.nameTitle}}]}),(0,_utils.defParamsClick)(CheckList,"checklist:insert"),
(0,_dom.insertCSS)("\n\n.ProseMirror .widgets-checkitem input {\n	float: left;\n}\n\n.ProseMirror .widgets-checkitem {\n	cursor: text;\n}\n\n\n")},{"../../utils":60,"./question":84,"./textbox":88,"prosemirror/dist/dom":1,"prosemirror/dist/model":34}],81:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;if(void 0!==getter)return getter.call(receiver)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Essay=void 0;var _model=require("prosemirror/dist/model"),_dom=require("prosemirror/dist/dom"),_utils=require("../../utils"),_question=require("./question"),Essay=exports.Essay=function(_Question){function Essay(){return _classCallCheck(this,Essay),_possibleConstructorReturn(this,Object.getPrototypeOf(Essay).apply(this,arguments))}return _inherits(Essay,_Question),_createClass(Essay,[{key:"create",value:function(attrs,content,marks){var ta=this.schema.nodes.textarea.create(attrs);if(content){var nodes=content.toArray();nodes.pop(),content=_model.Fragment.fromArray(nodes.concat(ta))}else content=_model.Fragment.from([this.schema.nodes.paragraph.create(null,""),ta]);return _get(Object.getPrototypeOf(Essay.prototype),"create",this).call(this,attrs,content,marks)}},{key:"attrs",get:function(){return{name:new _model.Attribute,rows:new _model.Attribute,cols:new _model.Attribute,"class":new _model.Attribute({"default":"widgets-essay"})}}}]),Essay}(_question.Question);(0,_utils.defParser)(Essay,"div","widgets-essay"),Essay.register("command","insert",{label:"Essay",run:function(pm,name,rows,cols){var _pm$selection=pm.selection,from=_pm$selection.from,node=(_pm$selection.to,_pm$selection.node);return node&&node.type==this?pm.tr.setNodeType(from,this,{name:name,rows:rows,cols:cols}).apply(pm.apply.scroll):(0,_utils.insertWidget)(pm,from,this.create({name:name,rows:rows,cols:cols}))},select:function(pm){return pm.doc.path(pm.selection.from.path).type.canContainType(this)},menu:{group:"question",rank:72,display:{type:"label",label:"Essay"},select:"ignore"},params:[{name:"Name",attr:"name",label:"Short ID",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"name")},options:{pattern:_utils.namePattern,size:10,title:_utils.nameTitle}},{name:"Rows",attr:"rows",label:"In lines lines",type:"number","default":"4",options:{min:2,max:24},prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"rows")}},{name:"Columns",attr:"cols",label:"In characters",type:"number","default":"40",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"cols")},options:{min:2,max:80}}]}),(0,_utils.defParamsClick)(Essay,"essay:insert"),(0,_dom.insertCSS)("\n\n.ProseMirror .widgets-essay textarea {\n	resize: none;\n}\n\n")},{"../../utils":60,"./question":84,"prosemirror/dist/dom":1,"prosemirror/dist/model":34}],82:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _textbox=require("./textbox");Object.defineProperty(exports,"TextBox",{enumerable:!0,get:function(){return _textbox.TextBox}});var _shortanswer=require("./shortanswer");Object.defineProperty(exports,"ShortAnswer",{enumerable:!0,get:function(){return _shortanswer.ShortAnswer}});var _essay=require("./essay");Object.defineProperty(exports,"Essay",{enumerable:!0,get:function(){return _essay.Essay}});var _multiplechoice=require("./multiplechoice");Object.defineProperty(exports,"MultipleChoice",{enumerable:!0,get:function(){return _multiplechoice.MultipleChoice}}),Object.defineProperty(exports,"Choice",{enumerable:!0,get:function(){return _multiplechoice.Choice}});var _checklist=require("./checklist");Object.defineProperty(exports,"CheckList",{enumerable:!0,get:function(){return _checklist.CheckList}}),Object.defineProperty(exports,"CheckItem",{enumerable:!0,get:function(){return _checklist.CheckItem}});var _scale=require("./scale");Object.defineProperty(exports,"Scale",{enumerable:!0,get:function(){return _scale.Scale}}),Object.defineProperty(exports,"ScaleDisplay",{enumerable:!0,get:function(){return _scale.ScaleDisplay}});var _selection=require("./selection");Object.defineProperty(exports,"Selection",{enumerable:!0,get:function(){return _selection.Selection}});var _question=require("./question");Object.defineProperty(exports,"Question",{enumerable:!0,get:function(){return _question.Question}})},{"./checklist":80,"./essay":81,"./multiplechoice":83,"./question":84,"./scale":85,"./selection":86,"./shortanswer":87,"./textbox":88}],83:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function renumber(pm,pos){var cl=pm.doc.path(pos.path),i=1;cl.forEach(function(node,start){"choice"==node.type.name&&pm.tr.setNodeType(new _model.Pos(pos.path,start),node.type,{name:cl.attrs.name,value:i++}).apply()})}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;if(void 0!==getter)return getter.call(receiver)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.MultipleChoice=exports.Choice=void 0;var _model=require("prosemirror/dist/model"),_dom=require("prosemirror/dist/dom"),_utils=require("../../utils"),_question=require("./question"),Choice=exports.Choice=function(_Block){function Choice(){return _classCallCheck(this,Choice),_possibleConstructorReturn(this,Object.getPrototypeOf(Choice).apply(this,arguments))}return _inherits(Choice,_Block),_createClass(Choice,[{key:"create",value:function(attrs,content,marks){var len=content.content.length;return content=_model.Fragment.from([this.schema.nodes.radiobutton.create(attrs),content.content[len-1]]),_get(Object.getPrototypeOf(Choice.prototype),"create",this).call(this,attrs,content,marks)}},{key:"attrs",get:function(){return{name:new _model.Attribute,value:new _model.Attribute,"class":new _model.Attribute({"default":"widgets-choice"})}}}]),Choice}(_model.Block),MultipleChoice=exports.MultipleChoice=function(_Question){function MultipleChoice(){return _classCallCheck(this,MultipleChoice),_possibleConstructorReturn(this,Object.getPrototypeOf(MultipleChoice).apply(this,arguments))}return _inherits(MultipleChoice,_Question),_createClass(MultipleChoice,[{key:"attrs",get:function(){return{name:new _model.Attribute,"class":new _model.Attribute({"default":"widgets-multiplechoice"})}}},{key:"isList",get:function(){return!0}}]),MultipleChoice}(_question.Question);(0,_utils.defParser)(Choice,"div","widgets-choice"),(0,_utils.defParser)(MultipleChoice,"div","widgets-multiplechoice"),Choice.prototype.serializeDOM=function(node,s){return s.renderAs(node,"div",node.attrs)},Choice.register("command","split",{label:"Split the current choice",run:function(pm){var _pm$selection=pm.selection,from=_pm$selection.from,to=_pm$selection.to,node=_pm$selection.node;if(node&&node.isBlock||from.path.length<2||!_model.Pos.samePath(from.path,to.path))return!1;var toParent=from.shorten(),parent=pm.doc.path(toParent.path);if(parent.type!=this)return!1;var tr=pm.tr["delete"](from,to).split(from,2).apply(pm.apply.scroll);return renumber(pm,toParent.shorten()),tr},keys:["Enter(20)"]}),Choice.register("command","delete",{label:"delete text, this choice or choicelist",run:function(pm){var _pm$selection2=pm.selection,from=_pm$selection2.from,to=_pm$selection2.to,toCH=(_pm$selection2.head,from.shorten()),ch=pm.doc.path(toCH.path);if(ch.type!=this)return!1;if(from.offset>0)return pm.tr["delete"](from,to).apply(pm.apply.scroll);var toMC=toCH.shorten(),mc=pm.doc.path(toMC.path),_nodeBefore=(0,_utils.nodeBefore)(pm,toCH),before=_nodeBefore.before;_nodeBefore.at;if(2==mc.size||before.type!=this||ch.lastChild.size>0)return!0;var tr=pm.tr["delete"](toMC,toMC.move(1)).apply();return renumber(pm,toMC),tr},keys:["Backspace(20)","Mod-Backspace(20)"]}),MultipleChoice.register("command","insert",{label:"MultipleChoice",run:function(pm,name){var _pm$selection3=pm.selection,from=_pm$selection3.from,node=(_pm$selection3.to,_pm$selection3.node);if(node&&node.type==this){var tr=pm.tr.setNodeType(from,this,{name:name}).apply();return renumber(pm,_model.Pos.from(from.toPath().concat(from.offset),0)),tr}var choice_content=_model.Fragment.from([this.schema.nodes.radiobutton.create({name:name,value:1}),this.schema.nodes.textbox.create()]),content=_model.Fragment.from([this.schema.nodes.paragraph.create(null,""),this.schema.nodes.choice.create({name:name,value:1},choice_content)]);return(0,_utils.insertWidget)(pm,from,this.create({name:name},content))},select:function(pm){return!0},menu:{group:"question",rank:70,display:{type:"label",label:"MultipleChoice"}},params:[{name:"Name",attr:"name",label:"Short ID",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"name")},options:{pattern:_utils.namePattern,size:10,title:_utils.nameTitle}}]}),(0,_utils.defParamsClick)(MultipleChoice,"multiplechoice:insert"),(0,_dom.insertCSS)("\n\n.widgets-choice input {\n	float: left;\n}\n\n.ProseMirror .widgets-choice:hover {\n	cursor: text;\n}\n\n")},{"../../utils":60,"./question":84,"prosemirror/dist/dom":1,"prosemirror/dist/model":34}],84:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Question=void 0;var _model=require("prosemirror/dist/model"),_dom=require("prosemirror/dist/dom"),_utils=require("../../utils"),Question=(require("prosemirror/dist/transform"),exports.Question=function(_Block){function Question(){return _classCallCheck(this,Question),_possibleConstructorReturn(this,Object.getPrototypeOf(Question).apply(this,arguments))}return _inherits(Question,_Block),Question}(_model.Block));(0,_utils.defParser)(Question,"div","widgets-question"),Question.prototype.serializeDOM=function(node,s){return(0,_dom.elt)("div",{"class":"widgets-question widgets-edit"},s.renderAs(node,"div",node.attrs))},Question.register("command","delete",{label:"delete text from question",run:function(pm){var _pm$selection=pm.selection,from=_pm$selection.from,para=(_pm$selection.to,_pm$selection.head,pm.doc.path(from.path));if(from.offset>0||"paragraph"!=para.type.name)return!1;from=from.shorten();var parent=pm.doc.path(from.path);return parent.type instanceof Question?parent.firstChild==para:!1},keys:["Backspace(10)","Mod-Backspace(10)"]}),Question.register("command","enter",{label:"process enter",run:function(pm){var _pm$selection2=pm.selection,from=_pm$selection2.from,node=_pm$selection2.node,para=pm.doc.path(from.path);if(node&&node.type instanceof Question){var _parent=pm.doc.path(from.path);if(_parent.lastChild==node||!_parent.child(from.offset+1).isTextblock){var side=from.move(1);pm.tr.insert(side,pm.schema.defaultTextblockType().create()).apply(pm.apply.scroll),pm.setTextSelection(new _model.Pos(side.toPath(),0))}return!0}if(from.offset>0||"paragraph"!=para.type.name)return!1;var parent=pm.doc.path(from.shorten().path);return parent.type instanceof Question},keys:["Enter(10)","Mod-Enter(10)"]}),(0,_dom.insertCSS)('\n		\n.widgets-question {\n	counter-increment: qcnt;\n	border: 1px solid #DDD;\n    border-radius: 4px;\n	padding: 8px;\n	margin-top: 1em;\n}\n\n.widgets-question:before {\n	content: "Question " counter(qcnt) ".";\n	font-size: 80%;\n	font-weight: bold;\n//	cursor: move;\n}\n\n.ProseMirror .widgets-question p:hover {\n    cursor: text;\n}\n\n')},{"../../utils":60,"prosemirror/dist/dom":1,"prosemirror/dist/model":34,"prosemirror/dist/transform":40}],85:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;if(void 0!==getter)return getter.call(receiver)},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.Scale=exports.ScaleDisplay=void 0;var _model=require("prosemirror/dist/model"),_dom=require("prosemirror/dist/dom"),_utils=require("../../utils"),_question=require("./question"),ScaleDisplay=exports.ScaleDisplay=function(_Block){function ScaleDisplay(){return _classCallCheck(this,ScaleDisplay),_possibleConstructorReturn(this,Object.getPrototypeOf(ScaleDisplay).apply(this,arguments))}return _inherits(ScaleDisplay,_Block),_createClass(ScaleDisplay,[{key:"attrs",get:function(){return{name:new _model.Attribute,startvalue:new _model.Attribute({"default":"1"}),startlabel:new _model.Attribute({"default":"low"}),endvalue:new _model.Attribute({"default":"10"}),endlabel:new _model.Attribute({"default":"high"}),contenteditable:new _model.Attribute({"default":!1})}}}]),ScaleDisplay}(_model.Block);ScaleDisplay.prototype.serializeDOM=function(node,s){var para=(0,_dom.elt)("div",node.attrs);para.appendChild((0,_dom.elt)("span",null,node.attrs.startlabel+" "));var startVal=Number(node.attrs.startvalue),endVal=Number(node.attrs.endvalue);if(endVal>startVal)for(var i=startVal;endVal>=i;i++){var _name=node.attrs.name+i;para.appendChild((0,_dom.elt)("span",{"class":"widgets-scaleitem"},(0,_dom.elt)("label",{"for":_name},i.toString()),(0,_dom.elt)("input",{id:_name,name:node.attrs.name,type:"radio",value:i})))}else for(var i=startVal;i>=endVal;i--)para.appendChild((0,_dom.elt)("span",{"class":"widgets-scaleitem"},(0,_dom.elt)("label",{"for":name},i.toString()),(0,_dom.elt)("input",{id:name,name:node.attrs.name,type:"radio",value:i})));return para.appendChild((0,_dom.elt)("span",null," "+node.attrs.endlabel)),para};var Scale=exports.Scale=function(_Question){function Scale(){return _classCallCheck(this,Scale),_possibleConstructorReturn(this,Object.getPrototypeOf(Scale).apply(this,arguments))}return _inherits(Scale,_Question),_createClass(Scale,[{key:"create",value:function(attrs,content,marks){var sd=this.schema.nodes.scaledisplay.create(attrs);if(content){var nodes=content.toArray();nodes.pop(),content=_model.Fragment.fromArray(nodes.concat(sd))}else content=_model.Fragment.from([this.schema.nodes.paragraph.create(null,""),sd]);return _get(Object.getPrototypeOf(Scale.prototype),"create",this).call(this,attrs,content,marks)}},{key:"attrs",get:function(){return{name:new _model.Attribute,startvalue:new _model.Attribute({"default":"1"}),startlabel:new _model.Attribute({"default":"low"}),endvalue:new _model.Attribute({"default":"10"}),endlabel:new _model.Attribute({"default":"high"}),"class":new _model.Attribute({"default":"widgets-scale"})}}}],[{key:"contains",get:function(){return"text"}}]),Scale}(_question.Question);(0,_utils.defParser)(Scale,"div","widgets-scale"),Scale.register("command","insert",{label:"Scale",run:function(pm,name,startvalue,startlabel,endvalue,endlabel){var _pm$selection=pm.selection,from=_pm$selection.from,node=(_pm$selection.to,_pm$selection.node);return node&&node.type==this?pm.tr.setNodeType(from,this,{name:name,startvalue:startvalue,startlabel:startlabel,endvalue:endvalue,endlabel:endlabel}).apply(pm.apply.scroll):(0,_utils.insertWidget)(pm,from,this.create({name:name,startvalue:startvalue,startlabel:startlabel,endvalue:endvalue,endlabel:endlabel}))},menu:{group:"question",rank:74,display:{type:"label",label:"Scale"}},params:[{name:"Name",attr:"name",label:"Short ID",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"name")},options:{pattern:_utils.namePattern,size:10,title:_utils.nameTitle}},{label:"Start value",attr:"startvalue",type:"number","default":1,prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"startvalue")}},{name:"Start Label",attr:"startlabel",label:"Text on left",type:"text","default":"low",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"startlabel")}},{label:"End value",attr:"endvalue",type:"number","default":10,prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"endvalue")}},{name:"End Label",attr:"endlabel",label:"Text on right",type:"text","default":"high",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"endlabel")}}]}),(0,_utils.defParamsClick)(Scale,"scale:insert"),(0,_dom.insertCSS)("\n\n.widgets-scaleitem {\n	display: inline-block;\n	text-align: center;\n    padding: 4px;\n}\n\n.widgets-scaleitem input {\n	display: block;\n}\n\n.widgets-scale span {\n	vertical-align: middle;\n	font-weight: normal;\n}\n\n.widgets-scale div {\n	display: inline-block;\n	padding: 4px;\n	background: #EEE;\n    border-radius: 6px;\n    border: 1px solid #AAA;\n}\n")},{"../../utils":60,"./question":84,"prosemirror/dist/dom":1,"prosemirror/dist/model":34}],86:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;if(void 0!==getter)return getter.call(receiver)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Selection=void 0;var _model=require("prosemirror/dist/model"),_dom=require("prosemirror/dist/dom"),_utils=(require("../input"),require("../../utils")),_question=require("./question"),Selection=exports.Selection=function(_Question){function Selection(){return _classCallCheck(this,Selection),_possibleConstructorReturn(this,Object.getPrototypeOf(Selection).apply(this,arguments))}return _inherits(Selection,_Question),_createClass(Selection,[{key:"create",value:function(attrs,content,marks){var sel=this.schema.nodes.select.create(attrs);if(content){var nodes=content.toArray();nodes.pop(),content=_model.Fragment.fromArray(nodes.concat(sel))}else content=_model.Fragment.from([this.schema.nodes.paragraph.create(null,""),sel]);return _get(Object.getPrototypeOf(Selection.prototype),"create",this).call(this,attrs,content,marks)}},{key:"attrs",get:function(){return{name:new _model.Attribute,options:new _model.Attribute,size:new _model.Attribute({"default":1}),multiple:new _model.Attribute({"default":"single"}),"class":new _model.Attribute({"default":"widgets-selection"})}}}]),Selection}(_question.Question);(0,_utils.defParser)(Selection,"div","widgets-selection"),Selection.register("command","insert",{label:"Selection",run:function(pm,name,options,size,multiple){var _pm$selection=pm.selection,from=_pm$selection.from,node=(_pm$selection.to,_pm$selection.node);return node&&node.type==this?pm.tr.setNodeType(from,this,{name:name,options:options,size:size,multiple:multiple}).apply(pm.apply.scroll):(0,_utils.insertWidget)(pm,from,this.create({name:name,options:options,size:size,multiple:multiple}))},menu:{group:"question",rank:75,display:{type:"label",label:"Selection"}},params:[{name:"Name",attr:"name",label:"Short ID",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"name")},options:{pattern:_utils.namePattern,size:10,title:_utils.nameTitle}},{name:"Options",attr:"options",label:"comma separated names",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"options")}},{name:"Size",attr:"size",label:"options displayed",type:"number","default":1,prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"size")},options:{min:1,max:10}},{name:"Selection",attr:"multiple",label:"Selection (single or multiple)",type:"select","default":"single",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"multiple")},options:[{value:"multiple",label:"multiple"},{value:"single",label:"single"}]}]}),(0,_utils.defParamsClick)(Selection,"selection:insert"),(0,_dom.insertCSS)("\n\n")},{"../../utils":60,"../input":74,"./question":84,"prosemirror/dist/dom":1,"prosemirror/dist/model":34}],87:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;if(void 0!==getter)return getter.call(receiver)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ShortAnswer=void 0;var _model=require("prosemirror/dist/model"),_dom=require("prosemirror/dist/dom"),_utils=(require("../input"),require("../../utils")),_question=require("./question"),ShortAnswer=exports.ShortAnswer=function(_Question){function ShortAnswer(){return _classCallCheck(this,ShortAnswer),_possibleConstructorReturn(this,Object.getPrototypeOf(ShortAnswer).apply(this,arguments))}return _inherits(ShortAnswer,_Question),_createClass(ShortAnswer,[{key:"create",value:function(attrs,content,marks){var tf=this.schema.nodes.textfield.create(attrs);if(content){var nodes=content.toArray();nodes.pop(),content=_model.Fragment.fromArray(nodes.concat(tf))}else content=_model.Fragment.from([this.schema.nodes.paragraph.create(null,""),tf]);return _get(Object.getPrototypeOf(ShortAnswer.prototype),"create",this).call(this,attrs,content,marks)}},{key:"attrs",get:function(){return{name:new _model.Attribute,type:new _model.Attribute({"default":"text"}),size:new _model.Attribute({"default":"20"}),"class":new _model.Attribute({"default":"widgets-shortanswer"})}}}]),ShortAnswer}(_question.Question);(0,_utils.defParser)(ShortAnswer,"div","widgets-shortanswer"),ShortAnswer.register("command","insert",{label:"Short Answer",run:function(pm,name,size){var _pm$selection=pm.selection,from=_pm$selection.from,node=(_pm$selection.to,_pm$selection.node);return node&&node.type==this?pm.tr.setNodeType(from,this,{name:name,size:size}).apply(pm.apply.scroll):(0,_utils.insertWidget)(pm,from,this.create({name:name,size:size}))},menu:{group:"question",rank:71,display:{type:"label",label:"Short Answer"}},params:[{name:"Name",attr:"name",label:"Short ID",type:"text",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"name")},options:{pattern:_utils.namePattern,size:10,title:_utils.nameTitle}},{name:"Size",attr:"size",label:"Size in characters",type:"number","default":"20",prefill:function(pm){return(0,_utils.selectedNodeAttr)(pm,this,"size")},options:{min:1,max:80}}]}),(0,_utils.defParamsClick)(ShortAnswer,"shortanswer:insert"),(0,_dom.insertCSS)("\n")},{"../../utils":60,"../input":74,"./question":84,"prosemirror/dist/dom":1,"prosemirror/dist/model":34}],88:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextBox=void 0;var _model=require("prosemirror/dist/model"),_dom=require("prosemirror/dist/dom"),_utils=require("../../utils"),TextBox=exports.TextBox=function(_Textblock){function TextBox(){return _classCallCheck(this,TextBox),_possibleConstructorReturn(this,Object.getPrototypeOf(TextBox).apply(this,arguments))}return _inherits(TextBox,_Textblock),TextBox}(_model.Textblock);(0,_utils.defParser)(TextBox,"div","widgets-textbox"),TextBox.prototype.serializeDOM=function(node,s){return s.renderAs(node,"div",{"class":"widgets-textbox"})},(0,_dom.insertCSS)("\n\n.widgets-textbox {\n	margin-left: 1.2em;\n}\n\n")},{"../../utils":60,"prosemirror/dist/dom":1,"prosemirror/dist/model":34}]},{},[58]);