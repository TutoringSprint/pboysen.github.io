!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function saturation(temp){return 10*.611*Math.exp(17.27*temp/(temp+237.3))}function humidity(temp,vapor){return 100*vapor/saturation(temp)}function dewpoint(temp,vapor){return temp-(100-humidity(temp,vapor))/5}var _get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;if(void 0!==getter)return getter.call(receiver)},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_utils=require("../utils");createjs.MotionGuidePlugin.install(),createjs.Sound.registerPlugins([createjs.WebAudioPlugin,createjs.HTMLAudioPlugin,createjs.FlashAudioPlugin]),createjs.Ticker.frameRate=60;var Trial=function(){function Trial(){_classCallCheck(this,Trial),this.start=null,this.cloudbase=0,this.temp=0,this.altitude=0,this.vapor=0,this.humidity=0,this.dewpoint=0}return _createClass(Trial,[{key:"init",value:function(start){this.start=start,this.cloudbase=0,this.temp=start.temp,this.altitude=0,this.vapor=start.vapor,this.humidity=start.humidity,this.dewpoint=start.dewpoint}},{key:"getCol",value:function(val){var v=val.toFixed(1),td=document.createElement("td");return td.appendChild(document.createTextNode(v)),td}},{key:"getRow",value:function(){var tr=document.createElement("tr");return tr.appendChild(this.getCol(this.start.temp)),tr.appendChild(this.getCol(this.start.vapor)),tr.appendChild(this.getCol(this.start.dewpoint)),tr.appendChild(this.getCol(this.temp)),tr.appendChild(this.getCol(this.vapor)),tr.appendChild(this.getCol(this.dewpoint)),this.cloudbase>0?tr.appendChild(this.getCol(this.cloudbase)):tr.appendChild(document.createElement("td").appendChild(document.createTextNode("Clear"))),tr}}]),Trial}(),Settings=function(){function Settings(){function slidef(e,input,out,f){e.stopPropagation(),out.value=input.valueAsNumber,f&&f(input)}var _this=this;_classCallCheck(this,Settings),this.temp=document.getElementById("temp"),this.vapor=document.getElementById("vapor"),this.tempout=document.getElementById("tempout"),this.vaporout=document.getElementById("vaporout"),this.mute=document.getElementById("mute"),this.listener=null;var event=/msie|trident/g.test(window.navigator.userAgent.toLowerCase())?"change":"input";this.temp.addEventListener(event,function(e){return slidef(e,temp,tempout,_this.listener)}),this.vapor.addEventListener(event,function(e){return slidef(e,vapor,vaporout,_this.listener)})}return _createClass(Settings,[{key:"getTemp",value:function(){return this.temp.valueAsNumber}},{key:"getVapor",value:function(){return this.vapor.valueAsNumber}},{key:"setTemp",value:function(value){this.temp.value=value,this.tempout.value=value.toFixed(1)}},{key:"setVapor",value:function(value){this.vapor.value=value,this.vaporout.value=value.toFixed(1)}},{key:"addListener",value:function(listener){this.listener=listener}}]),Settings}(),Buttons=function(){function Buttons(){_classCallCheck(this,Buttons),this.run=document.getElementById("run"),this.pause=document.getElementById("pause"),this.restart=document.getElementById("restart"),this.mute=document.getElementById("mute")}return _createClass(Buttons,[{key:"addListener",value:function(listener){this.run.addEventListener("click",function(e){return listener(e)}),this.pause.addEventListener("click",function(e){return listener(e)}),this.restart.addEventListener("click",function(e){return listener(e)})}},{key:"mute",value:function(){return this.mute.checked}}]),Buttons}(),ETGraph=function(_Graph){function ETGraph(stage,settings){_classCallCheck(this,ETGraph);var _this2=_possibleConstructorReturn(this,Object.getPrototypeOf(ETGraph).call(this,{stage:stage,w:200,h:200,xlabel:"Temperature(C)",ylabel:"Vapor Pressure(mb)",xscale:"linear",yscale:"linear",minX:-20,maxX:30,minY:0,maxY:50,majorX:10,minorX:5,majorY:10,minorY:5}));return _this2.settings=settings,_this2.lasth=0,_this2.leaf=new createjs.Bitmap("assets/leaf.gif"),_this2.marker=new createjs.Shape,_this2.marker.graphics.beginFill("#000").drawRect(_this2.xaxis.getLoc(_this2.temp)-2,_this2.yaxis.getLoc(_this2.vapor)-2,4,4),stage.addChild(_this2.leaf),stage.addChild(_this2.marker),_this2.settings.addListener(function(slider){"temp"==slider.id?_this2.temp=slider.valueAsNumber:"vapor"==slider.id&&(_this2.vapor=slider.valueAsNumber),_this2.moveMarker(!0)}),_this2}return _inherits(ETGraph,_Graph),_createClass(ETGraph,[{key:"render",value:function(){this.temp=this.settings.getTemp(),this.vapor=this.settings.getVapor(),_get(Object.getPrototypeOf(ETGraph.prototype),"render",this).call(this),this.plotSaturation(),this.moveMarker(!0)}},{key:"plotSaturation",value:function(){for(var t=this.xaxis.min;t<=this.xaxis.max;t++)this.plot(t,Math.round(saturation(t)));this.endPlot()}},{key:"clear",value:function(){_get(Object.getPrototypeOf(ETGraph.prototype),"clear",this).call(this),this.stage.addChild(this.leaf)}},{key:"moveLeaf",value:function(x,y){this.leaf.x=x-10,this.leaf.y=y-10}},{key:"showLeaf",value:function(on){if(on===!0){var x=this.xaxis.getLoc(this.temp),y=this.yaxis.getLoc(this.vapor);this.moveLeaf(x,y)}else this.leaf.x=-1e3}},{key:"moveMarker",value:function(updateSettings){var sat=saturation(this.temp);this.vapor>sat&&(this.vapor=sat,updateSettings===!0&&(this.settings.setTemp(this.temp),this.settings.setVapor(sat)));var x=this.xaxis.getLoc(this.temp),y=this.yaxis.getLoc(this.vapor);this.marker.x=x-2,this.marker.y=y-2,updateSettings===!0&&this.moveLeaf(x,y)}},{key:"update",value:function(trial){this.temp=trial.temp,this.vapor=trial.vapor,this.plot(trial.temp,trial.vapor),this.moveMarker(!1)}}]),ETGraph}(_utils.Graph),ATGraph=function(_Graph2){function ATGraph(stage){_classCallCheck(this,ATGraph);var _this3=_possibleConstructorReturn(this,Object.getPrototypeOf(ATGraph).call(this,{stage:stage,w:200,h:200,xlabel:"Temperature(C)",ylabel:"Altitude(km)",xscale:"linear",yscale:"linear",minX:-20,maxX:30,minY:0,maxY:5,majorX:10,minorX:5,majorY:1,minorY:.5}));return _this3.temp=20,_this3.altitude=0,_this3.cloudbase=0,_this3}return _inherits(ATGraph,_Graph2),_createClass(ATGraph,[{key:"update",value:function(trial){this.plot(trial.temp,trial.altitude)}}]),ATGraph}(_utils.Graph),Mtn=function(){function Mtn(stage,settings,finish){_classCallCheck(this,Mtn),this.stage=stage,this.settings=settings,this.finish=finish,createjs.Sound.registerSound({id:"thunder",src:"assets/thunder.mp3"}),createjs.Sound.registerSound({id:"wind",src:"assets/wind.mp3"}),this.wind=null,this.thunder=null,this.mtn=new createjs.Bitmap("assets/mountain.png"),this.leaf=new createjs.Bitmap("assets/leaf.gif"),this.cloud=new createjs.Bitmap("assets/thundercloud.png"),this.bolt=new createjs.Bitmap("assets/lightning.png"),this.leaftween=null,this.mtn.x=0,this.mtn.y=0,this.mtn.scaleX=.5,this.mtn.scaleY=.5,this.bolt.x=-100,this.bolt.scaleX=.015,this.bolt.scaleY=.015,this.running=!1,this.lightning=!1,this.lighttick=0,this.path=[50,164,74,152,90,131,112,122,137,92,151,64,173,56,204,70,221,92,224,105,246,121,268,141,290,164],this.results=document.getElementById("results_table"),this.trial=new Trial}return _createClass(Mtn,[{key:"render",value:function(){this.stage.addChild(this.mtn),this.stage.addChild(this.leaf),this.stage.addChild(this.cloud),this.stage.addChild(this.bolt),this.leaf.x=50,this.leaf.y=165,this.cloud.x=-1e3,this.cloud.y=0,this.lastalt=0,this.cloud.scaleX=.1,this.cloud.scaleY=.05}},{key:"clear",value:function(){this.stage.removeAllChildren(),this.render()}},{key:"play",value:function(){var _this4=this;this.temp=this.settings.getTemp(),this.vapor=this.settings.getVapor(),this.trial.init({temp:this.temp,vapor:this.vapor,humidity:humidity(this.temp,this.vapor),dewpoint:dewpoint(this.temp,this.vapor)}),this.factor=10,this.lastalt=0,this.leaftween=createjs.Tween.get(this.leaf).to({guide:{path:this.path}},8e3),this.leaftween.call(function(){_this4.wind&&_this4.wind.stop(),_this4.running=!1,_this4.results.appendChild(_this4.trial.getRow()),_this4.finish&&_this4.finish()}),this.running=!0,this.leaftween.play(),this.playSound("wind")}},{key:"pause",value:function(_pause){this.leaftween.setPaused(_pause),this.wind&&(this.wind.paused=_pause),this.thunder&&(this.thunder.paused=_pause),this.running=!_pause}},{key:"playSound",value:function(sound){if(!this.settings.mute.checked)switch(sound){case"wind":this.wind=createjs.Sound.play(sound,{loop:2});break;case"thunder":this.thunder=createjs.Sound.play(sound)}}},{key:"update",value:function(trial){var oldA=trial.altitude,oldT=trial.temp;trial.altitude=(165-this.leaf.y)/165*5,trial.altitude<0&&(trial.altitude=0),trial.temp=Number(oldT-this.factor*(trial.altitude-oldA)),trial.humidity=humidity(trial.temp,trial.vapor),trial.dewpoint=dewpoint(trial.temp,trial.vapor);var sat=saturation(trial.temp);trial.vapor>sat&&(this.animateClouds(),trial.vapor=sat,trial.humidity=100,this.factor=6),trial.temp>oldT&&(this.factor=10)}},{key:"animateClouds",value:function(){0==this.trial.cloudbase&&(this.trial.cloudbase=this.trial.altitude,(this.trial.temp<=0||this.trial.altitude<1)&&(this.playSound("thunder"),this.lighttick=0,this.lightning=!0),this.cloud.x=this.leaf.x-2,this.cloud.y=this.leaf.y,this.lasty=this.leaf.y),this.trial.altitude-this.lastalt>.1&&(this.lastalt=this.trial.altitude,this.cloud.scaleX+=.021,this.cloud.scaleY+=.02,this.cloud.y=this.leaf.y)}},{key:"newTrial",value:function(){this.trial=new Trial}},{key:"tick",value:function(etgraph,atgraph){this.running===!0&&(this.update(this.trial),etgraph.update(this.trial),atgraph.update(this.trial),this.lightning===!0&&(20==this.lighttick?(this.bolt.x=this.leaf.x-30,this.bolt.y=this.leaf.y+40):25==this.lighttick?this.bolt.x=this.bolt.x+20:35==this.lighttick&&(this.bolt.x=-100,this.lightning=!1),this.lighttick++))}}]),Mtn}(),MtnSim=function(){function MtnSim(){var _this5=this;_classCallCheck(this,MtnSim),this.mainstage=new createjs.Stage("maincanvas"),this.etstage=new createjs.Stage("etgraph"),this.atstage=new createjs.Stage("atgraph"),this.buttons=new Buttons,this.settings=new Settings,this.etgraph=new ETGraph(this.etstage,this.settings),this.atgraph=new ATGraph(this.atstage),this.mtn=new Mtn(this.mainstage,this.settings,function(){_this5.buttons.restart.disabled=!1,_this5.buttons.pause.disabled=!0}),this.pause=!1,this.buttons.addListener(function(e){switch(e.target.id){case"run":_this5.etgraph.showLeaf(!1),_this5.enablePlay(!1),_this5.buttons.pause.value="Pause",_this5.pause=!1,_this5.mtn.play();break;case"pause":_this5.pause=!_this5.pause,_this5.mtn.pause(_this5.pause),e.target.value=_this5.pause?"Resume":"Pause";break;case"restart":_this5.reset(),_this5.mtn.clear(),_this5.etgraph.clear(),_this5.atgraph.clear(),_this5.etgraph.render(),_this5.atgraph.render(),_this5.mtn.newTrial()}})}return _createClass(MtnSim,[{key:"reset",value:function(){this.enablePlay(!0),this.settings.setTemp(20),this.settings.setVapor(7),this.etgraph.showLeaf(!0)}},{key:"enablePlay",value:function(play){this.buttons.run.disabled=!play,this.buttons.pause.disabled=play,this.buttons.restart.disabled=!play}},{key:"render",value:function(){var _this6=this;this.buttons.run.disabled=!1,this.buttons.mute.checked=!1,this.buttons.pause.disabled=!0,this.buttons.restart.disabled=!0,this.etgraph.render(),this.atgraph.render(),this.mtn.render(),createjs.Ticker.addEventListener("tick",function(e){_this6.mtn.tick(_this6.etgraph,_this6.atgraph),_this6.etstage.update(),_this6.atstage.update(),_this6.mainstage.update()})}}]),MtnSim}();(new MtnSim).render()},{"../utils":4}],2:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0});var marginX=40,marginY=30,endMargin=5;exports.Axis=function(){function Axis(spec){_classCallCheck(this,Axis),this.stage=spec.stage,this.w=spec.dim.w||100,this.h=spec.dim.h||100,this.min=spec.dim.min||0,this.max=spec.dim.max||100,this.font=spec.font||"12px Arial",this.color=spec.color||"#000",this.label=spec.label||"label",this.major=spec.major||10,this.minor=spec.minor||5,this.precision=spec.precision||0,this.vertical=spec.orient&&"vertical"==spec.orient||!1,this.linear=spec.scale&&"linear"==spec.scale||!1,this.originX=marginX,this.originY=this.h-marginY,this.scale=this.vertical?(this.originY-endMargin)/(this.max-this.min):(this.w-this.originX-endMargin)/(this.max-this.min)}return _createClass(Axis,[{key:"drawLine",value:function(x1,y1,x2,y2){var line=new createjs.Shape;line.graphics.setStrokeStyle(1),line.graphics.beginStroke(this.color),line.graphics.moveTo(x1,y1),line.graphics.lineTo(x2,y2),line.graphics.endStroke(),this.stage.addChild(line)}},{key:"drawText",value:function(text,x,y){return text.x=x,text.y=y,this.vertical&&text.text==this.label&&(text.rotation=270),this.stage.addChild(text),text}},{key:"getText",value:function(s){return new createjs.Text(s,this.font,this.color)}},{key:"render",value:function(){var label=this.getText(this.label),label_bnds=label.getBounds();if(this.vertical){this.drawLine(this.originX,this.originY,this.originX,endMargin);var y=this.originY-(this.originY-label_bnds.width)/2;this.drawText(label,4,y);for(var val=this.min;val<=this.max;val+=this.major){var v=this.getLoc(val);this.drawLine(this.originX-3,v,this.originX+3,v);var text=this.getText(val.toFixed(this.precision)),bnds=text.getBounds();this.drawText(text,this.originX-5-bnds.width,v+bnds.height/2-10)}}else{this.drawLine(this.originX,this.originY,this.w-endMargin,this.originY);var x=(this.w-endMargin-label_bnds.width)/2;this.drawText(label,this.originX+x,this.originY+15);for(var val=this.min;val<=this.max;val+=this.major){var v=this.getLoc(val);this.drawLine(v,this.originY-3,v,this.originY+3);var text=this.getText(val.toFixed(this.precision)),bnds=text.getBounds();this.drawText(text,v-bnds.width/2,this.originY+4)}}}},{key:"getLoc",value:function(val){var ival=this.linear?Math.round(this.scale*(val-this.min)):Math.round(Math.log(this.scale*(val-this.min)));return this.vertical?this.originY-ival:this.originX+ival}},{key:"getValue",value:function(v){var factor=this.vertical?(this.h-(v-this.originY))/this.h:(v-this.originX)/this.w;return this.min+(this.max-this.min)*factor}},{key:"isInside",value:function(v){return this.vertical?v>=this.originY&&v<=this.originY+this.h:v>=this.originX&&v<=this.originY+this.w}}]),Axis}()},{}],3:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.Graph=void 0;var _axis=require("./axis");exports.Graph=function(){function Graph(spec){_classCallCheck(this,Graph),this.stage=spec.stage,this.xaxis=new _axis.Axis({stage:this.stage,label:spec.xlabel,dim:{w:spec.w,h:spec.h,min:spec.minX,max:spec.maxX},orient:"horizontal",scale:spec.xscale,major:spec.majorX,minor:spec.minorX,precision:spec.precisionX}),this.yaxis=new _axis.Axis({stage:this.stage,label:spec.ylabel,dim:{w:spec.w,h:spec.h,min:spec.minY,max:spec.maxY},orient:"vertical",scale:spec.yscale,major:spec.majorY,minor:spec.minorY,precision:spec.precisionY}),this.last=null,this.marker=null,this.color="#000000",this.dotted=!1}return _createClass(Graph,[{key:"setDotted",value:function(dotted){this.dotted=dotted}},{key:"setColor",value:function(color){this.color=color,this.endPlot(),this.marker=new createjs.Shape,this.marker.graphics.beginStroke(color).beginFill(color).drawRect(0,0,4,4),this.marker.x=-10,this.stage.addChild(this.marker)}},{key:"render",value:function(){this.xaxis.render(),this.yaxis.render()}},{key:"clear",value:function(){this.stage.removeAllChildren(),this.endPlot()}},{key:"moveMarker",value:function(x,y){this.marker&&(this.marker.x=x-2,this.marker.y=y-2)}},{key:"drawLine",value:function(x1,y1,x2,y2){var line=new createjs.Shape;this.dotted===!0?line.graphics.setStrokeDash([1,4]).setStrokeStyle(1).beginStroke(this.color).moveTo(x1,y1).lineTo(x2,y2).endStroke():line.graphics.setStrokeStyle(1).beginStroke(this.color).moveTo(x1,y1).lineTo(x2,y2).endStroke(),this.stage.addChild(line)}},{key:"plot",value:function(xv,yv){if(xv>=this.xaxis.min&&xv<=this.xaxis.max&&yv>=this.yaxis.min&&yv<=this.yaxis.max){var x=this.xaxis.getLoc(xv),y=this.yaxis.getLoc(yv);this.last&&(this.moveMarker(this.last.x,this.last.y),this.drawLine(this.last.x,this.last.y,x,y)),this.last=new createjs.Point(x,y),this.moveMarker(x,y)}}},{key:"endPlot",value:function(){this.last=null}}]),Graph}()},{"./axis":2}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _graph=require("./graph");Object.defineProperty(exports,"Graph",{enumerable:!0,get:function(){return _graph.Graph}})},{"./graph":3}]},{},[1]);